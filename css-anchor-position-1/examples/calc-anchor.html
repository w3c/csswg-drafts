<!doctype html>
<meta charset=utf-8>
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<title>Anchor + calc() example</title>

<div class="chart">
  <div class="chart__bar" id="bar-1"></div>
  <div class="chart__bar" id="bar-2"></div>
  <div class="chart__bar" id="bar-3"></div>
</div>
<div popover=manual class="chart__tooltip chart__tooltip--max">ðŸ‘ˆ Max!</div>
<div popover=manual class="chart__tooltip chart__tooltip--min">Min! ðŸ‘‰</div>
<div class="actions">
  <input data-bar-id="bar-1" type="range" min="0" max="100" value="90" />
  <input data-bar-id="bar-2" type="range" min="0" max="100" value="25" />
  <input data-bar-id="bar-3" type="range" min="0" max="100" value="75" />
</div>

<style>
@layer demo {
  .chart__bar:nth-of-type(1) {
    anchor-name: --anchor-1;
  }

  .chart__bar:nth-of-type(2) {
    anchor-name: --anchor-2;
  }

  .chart__bar:nth-of-type(3) {
    anchor-name: --anchor-3;
  }

  .chart {
    anchor-name: --chart;
  }

  [popover] { inset: unset; }

  .chart__tooltip {
    position: absolute;
    height: 2em;
    translate: 0 50%;
    overflow: visible;
    background: black;
    color: white;
    border: none;
    place-content: center;
  }

  .chart__tooltip--max {
    left: anchor(--chart right);
    bottom: max(
      anchor(--anchor-1 top),
      anchor(--anchor-2 top),
      anchor(--anchor-3 top)
    );
    &::after {
      content: "";
      position: absolute;
      right: 100%;
      top: 0;
      bottom: 0;
      border: solid transparent 2px;
      border-right-color: black;
      border-width: 1em 1em 1em 0;
    }
  }
  .chart__tooltip--min {
    position: absolute;
    right: calc(anchor(--chart left) + 1rem);
    bottom: min(
      anchor(--anchor-1 top),
      anchor(--anchor-2 top),
      anchor(--anchor-3 top)
    );
    translate: 0 50%;
  }
}
@layer base {
  :root {
    --anchor-size: 50px;
    --anchored-size: 250px;
  }

  *,
  *:after,
  *:before {
    box-sizing: border-box;
  }

  body {
    display: grid;
    place-items: center;
    align-content: center;
    gap: 1rem;
    min-height: 100vh;
    font-family: "Google Sans", sans-serif, system-ui;
    background: var(--gray-1);
    position: relative;
    overflow: hidden;
  }

  .actions {
    width: 60vmin;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-gap: 1rem;
    padding: 1rem;
  }

  input {
    min-width: 0;
  }

  .chart {
    width: 60vmin;
    aspect-ratio: 4 / 3;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    padding: 1rem;
    align-items: end;
    border-left: 4px solid var(--gray-9);
    border-bottom: 4px solid var(--gray-9);
  }

  .chart__bar {
    background: var(--bg, var(--indigo-4));
    height: calc(var(--height, 100) * 1%);
  }

  .chart__bar:nth-of-type(1) {
    anchor-name: --anchor-1;
    --bg: #4dabf7;
    height: 90%;
  }

  .chart__bar:nth-of-type(2) {
    anchor-name: --anchor-2;
    --bg: #69db7c;
    height: 25%;
  }

  .chart__bar:nth-of-type(3) {
    anchor-name: --anchor-3;
    --bg: #ff8787;
    height: 75%;
  }
}
</style>

<script>
// Just a little script to hook up the bar heights to the range inputs.
const INPUTS = document.querySelectorAll("input");
const POPS = document.querySelectorAll("[popover]")

POPS.forEach(pop => pop.showPopover())

const update = (e) => {
  document.querySelector(
    `#${e.target.getAttribute("data-bar-id")}`
  ).style.height = `${e.target.value}%`;
};

INPUTS.forEach((input) => {
  console.info(input);
  input.addEventListener("input", update);
});
</script>