<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
<head profile="http://www.w3.org/2006/03/hcard">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>CSS Image Values and Replaced Content Module Level 4</title>
	<link rel="stylesheet" type="text/css" href="../default.css">
	<link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/W3C-[STATUS].css">
</head>

<div class="head">
<!--logo-->

<h1>CSS Image Values and Replaced Content Module Level 4</h1>

	<h2 class="no-num no-toc">[LONGSTATUS] [DATE]</h2>
	<dl>
		<dt>This Version:
		<dd><a href="http://dev.w3.org/csswg/css4-images/">http://dev.w3.org/csswg/css4-images/</a>
		<!-- <dd><a href="[VERSION]">http://www.w3.org/TR/[YEAR]/WD-css4-images-[CDATE]/</a>-->
<!--
		<dt>Latest Version:
		<dd><a href="http://www.w3.org/TR/css4-images/">http://www.w3.org/TR/css4-images/</a>
-->
		<dt>Editor's Draft:
		<dd><a href="http://dev.w3.org/csswg/css4-images/">http://dev.w3.org/csswg/css4-images/</a>
<!--
		<dt>Previous Version:
		<dd><a href="http://www.w3.org/TR/2012/WD-css4-images-20120112/">http://www.w3.org/TR/2012/WD-css4-images-20120112/</a>
-->
		<dt>Issue Tracking:
		<dd><a href="http://www.w3.org/Style/CSS/Tracker/products/27">http://www.w3.org/Style/CSS/Tracker/products/27</a>

		<dt>Feedback:
		<dd><a href="http://lists.w3.org/Archives/Public/www-style/">www-style@w3.org</a> with subject line &ldquo;<kbd>[[SHORTNAME]] <var>&hellip; message topic &hellip;</var></kbd>&rdquo;

		<dt>Editors:
		<dd class='vcard'>
			<a class='url fn' href="http://fantasai.inkedblade.net/contact">Elika J. Etemad</a> (<span class='org'>Mozilla</span>)
		<dd class='vcard'>
			<a class='url fn' href="http://www.xanthir.com/contact/">Tab Atkins Jr.</a> (<span class='org'>Google</span>)
	</dl>

<!--copyright-->

<hr title="Separator for header">
</div>

<h2 class="no-num no-toc" id="abstract">Abstract</h2>

	<p>
		CSS is a language for describing the rendering of structured documents 
		(such as HTML and XML) 
		on screen, on paper, in speech, etc. 
		This module contains the features of CSS level&nbsp;4 
		relating to the &lt;image> type 
		and replaced elements. 
		It includes and extends the functionality of CSS Image Values and Replaced Content Module Level 3.
		The main extensions compared to level&nbsp;3 are 
		several additions to the ''&lt;image>'' type,
		additions to the ''&lt;gradient>'' type,
		extentions to the ''image()'' function,
		definitions for interpolating several ''&lt;image>'' types,
		and several properties controlling the interaction of replaced elements and CSS's layout models.

<h2 class="no-num no-toc" id="status">Status of this document</h2>

<!--status-->

<h2 class="no-num no-toc" id="contents">Table of contents</h2>

<!--toc-->

<h2 id="intro">
Introduction</h2>

	<p><em>This section is not normative.</em>

	<p>
		In CSS Levels 1 and 2, 
		image values, such as those used in the 'background-image' property, 
		could only be given by a single URL value. 
		This module introduces additional ways of representing 2D images, 
		for example as <a href="#image-notation">a list of URIs denoting fallbacks</a>, 
		as <a href="#element-image">a reference to an element</a>, 
		or as <a href="#gradients">a gradient</a>.

	<p>
		This module also defines several properties for <a href="#image-processing">manipulating raster images</a> 
		and for <a href="#object-fit">sizing</a> 
		or <a href="#object-position">positioning</a> 
		replaced elements such as images within the box determined by the CSS layout algorithms. 
		It also defines in a generic way CSS's <a href="#sizing">sizing algorithm</a> for images and other replaced elements.

<h3 id="placement">
Module Interactions</h3>

	<p>
		This module defines and extends the ''&lt;image>'' value type defined in [[!CSS3VAL]]. 
		Furthermore it replaces the ''&lt;url>'' type 
		in the 'background-image' and 'list-style-image' definitions in CSS1 and CSS2 
		and adds ''&lt;image>'' as an alternative to ''&lt;url>'' in the 'content' property's value. 
		It is presumed that CSS specifications beyond CSS2.1 will use the ''&lt;image>'' notation 
		in place of ''&lt;url>'' where 2D images are expected. (See e.g. [[CSS3BG]].)

	<p>
		Of the properties defined in this module, 
		only 'image-resolution' 
		applies to <code>::first-line</code> and <code>::first-letter</code>.

<h3 id="values">
Values</h3>

	<p>
		This specification follows the <a href="http://www.w3.org/TR/CSS21/about.html#property-defs">CSS property definition conventions</a> from [[!CSS21]]. 
		Value types not defined in this specification 
		are defined in CSS Level 2 Revision 1 [[!CSS21]]. 
		Other CSS modules may expand the definitions of these value types: 
		for example [[CSS3COLOR]], 
		when combined with this module, 
		expands the definition of the &lt;color> value type as used in this specification.
	
	<p>
		In addition to the property-specific values listed in their definitions, 
		all properties defined in this specification also accept the <a href="http://www.w3.org/TR/css-values">global keywords</a> as their property value. 
		For readability they has not been repeated explicitly.


<h2>Planned Features</h2>

<ol>
	<li>Resolution tagging in image()

	<li>Logical keywords for specifying linear gradient direction.

	<li>Conical gradients

	<li>More interpolation modes for gradients: <a href="http://lists.w3.org/Archives/Public/www-style/2012Jan/0635.html">http://lists.w3.org/Archives/Public/www-style/2012Jan/0635.html</a>

	<li>How to transition/animate gradients

	<li>Ability to reference an SVG paint server via url (maybe as element(&lt;string>)?)
</ol>


<!--
RRRRRRRRRRRRRRRRR                                                         lllllll         
R::::::::::::::::R                                                        l:::::l         
R::::::RRRRRR:::::R                                                       l:::::l         
RR:::::R     R:::::R                                                      l:::::l         
  R::::R     R:::::R    eeeeeeeeeeee        ssssssssss      ooooooooooo    l::::l         
  R::::R     R:::::R  ee::::::::::::ee    ss::::::::::s   oo:::::::::::oo  l::::l         
  R::::RRRRRR:::::R  e::::::eeeee:::::eess:::::::::::::s o:::::::::::::::o l::::l         
  R:::::::::::::RR  e::::::e     e:::::es::::::ssss:::::so:::::ooooo:::::o l::::l         
  R::::RRRRRR:::::R e:::::::eeeee::::::e s:::::s  ssssss o::::o     o::::o l::::l         
  R::::R     R:::::Re:::::::::::::::::e    s::::::s      o::::o     o::::o l::::l         
  R::::R     R:::::Re::::::eeeeeeeeeee        s::::::s   o::::o     o::::o l::::l         
  R::::R     R:::::Re:::::::e           ssssss   s:::::s o::::o     o::::o l::::l         
RR:::::R     R:::::Re::::::::e          s:::::ssss::::::so:::::ooooo:::::ol::::::l        
R::::::R     R:::::R e::::::::eeeeeeee  s::::::::::::::s o:::::::::::::::ol::::::l ...... 
R::::::R     R:::::R  ee:::::::::::::e   s:::::::::::ss   oo:::::::::::oo l::::::l .::::. 
RRRRRRRR     RRRRRRR    eeeeeeeeeeeeee    sssssssssss       ooooooooooo   llllllll ...... 
-->


<h2 id='resolution-units'>
Resolution Units: the &lt;resolution> type</h2>

	<p>
		This specification defines the following units as part of the <dfn id='resolution-type'>&lt;resolution></dfn> value type:

	<dl>
		<dt><dfn>''dpi''</dfn>
		<dd>dots per inch

		<dt><dfn>''dpcm''</dfn>
		<dd>dots per centimeter

		<dt><dfn>''dppx''</dfn> 
		<dd>dots per ''px'' unit

		<dt><dfn>''x''</dfn>
		<dd>identical to ''dppx''
	</dl>

	<p>
		The ''&lt;resolution>'' unit represents the size of a single "dot" in a graphical representation 
		by indicating how many of these dots fit in a CSS 'in', 'cm', or 'px'. 
		For uses, see e.g. the  ''resolution'' media query in [[MEDIAQ]] 
		or the 'image-resolution' property defined below.

	<p class="note">
		Note that due to the 1:96 fixed ratio of CSS ''in'' to CSS ''px'', 
		''1dppx'' is equivalent to ''96dpi''. 
		This corresponds to the default resolution of images displayed in CSS: see 'image-resolution'.

	<div class="example">
		<p>
			The following @media rule uses Media Queries [[MEDIAQ]] 
			to assign some special style rules to devices that use two or more device pixels per CSS ''px'' unit:

		<pre>@media (min-resolution: 2dppx) { ... }</pre>
	</div>

<!-- ====================================================================== -->

<h2 id="image-values">
Image Values: the &lt;image> type</h2>

	<p>
		The ''&lt;image>'' value type denotes a 2D image. It can be a
		<a href="#url-notation">url reference</a>,
		<a href="#image-notation">image notation</a>,
		<!-- <a href="#element-image">element reference</a>, -->
		or <a href="#gradients">gradient notation</a>.
		Its syntax is:

	<pre class="prod"><dfn id='image-type'>&lt;image></dfn> = <i>&lt;url></i> | <i>&lt;image-list></i> | <i>&lt;image-set></i> | <i>&lt;gradient></i></pre>

	<p>
		An ''&lt;image>'' can be used in many CSS properties, 
		including the 'background-image', 'list-style-image', 'cursor' properties [[!CSS21]] 
		(where it replaces the ''&lt;url>'' component in the property's value).

	<p>
		In some cases, an image is invalid, 
		such as a ''&lt;url>'' pointing to a resource that is not a valid image format.  
		An <dfn>invalid image</dfn> is rendered as a solid-color ''transparent'' image with no intrinsic dimensions.  
		However, <i>invalid images</i> have special behavior in some contexts, 
		such as the ''image()'' notation.


<!--
UUUUUUUU     UUUUUUUURRRRRRRRRRRRRRRRR   LLLLLLLLLLL             
U::::::U     U::::::UR::::::::::::::::R  L:::::::::L             
U::::::U     U::::::UR::::::RRRRRR:::::R L:::::::::L             
UU:::::U     U:::::UURR:::::R     R:::::RLL:::::::LL             
 U:::::U     U:::::U   R::::R     R:::::R  L:::::L               
 U:::::D     D:::::U   R::::R     R:::::R  L:::::L               
 U:::::D     D:::::U   R::::RRRRRR:::::R   L:::::L               
 U:::::D     D:::::U   R:::::::::::::RR    L:::::L               
 U:::::D     D:::::U   R::::RRRRRR:::::R   L:::::L               
 U:::::D     D:::::U   R::::R     R:::::R  L:::::L               
 U:::::D     D:::::U   R::::R     R:::::R  L:::::L               
 U::::::U   U::::::U   R::::R     R:::::R  L:::::L         LLLLLL
 U:::::::UUU:::::::U RR:::::R     R:::::RLL:::::::LLLLLLLLL:::::L
  UU:::::::::::::UU  R::::::R     R:::::RL::::::::::::::::::::::L
    UU:::::::::UU    R::::::R     R:::::RL::::::::::::::::::::::L
      UUUUUUUUU      RRRRRRRR     RRRRRRRLLLLLLLLLLLLLLLLLLLLLLLL
-->


<h3 id="url-notation">
Image References and Image Slices: the ''&lt;url>'' type and ''url()'' notation</h3>

	<p>
		The simplest way to indicate an image is to reference an image file by URL. 
		This can be done with the <a href="http://www.w3.org/TR/CSS21/syndata.html#uri">''url()'' notation</a>, defined in [[!CSS21]].

	<div class="example">
		<p>
			In the example below, a background image is specified with ''url()''syntax:

		<pre>background-image: url(wavy.png);</pre>
	</div>

	<p>
		If the UA cannot download, parse, or otherwise successfully display the contents at the URL as an image, 
		it must be treated as an <i>invalid image</i>.


<!--
IIIIIIIIII                                                                                 
I::::::::I                                                                                 
I::::::::I                                                                                 
II::::::II                                                                                 
  I::::I     mmmmmmm    mmmmmmm     aaaaaaaaaaaaa     ggggggggg   ggggg    eeeeeeeeeeee    
  I::::I   mm:::::::m  m:::::::mm   a::::::::::::a   g:::::::::ggg::::g  ee::::::::::::ee  
  I::::I  m::::::::::mm::::::::::m  aaaaaaaaa:::::a g:::::::::::::::::g e::::::eeeee:::::ee
  I::::I  m::::::::::::::::::::::m           a::::ag::::::ggggg::::::gge::::::e     e:::::e
  I::::I  m:::::mmm::::::mmm:::::m    aaaaaaa:::::ag:::::g     g:::::g e:::::::eeeee::::::e
  I::::I  m::::m   m::::m   m::::m  aa::::::::::::ag:::::g     g:::::g e:::::::::::::::::e 
  I::::I  m::::m   m::::m   m::::m a::::aaaa::::::ag:::::g     g:::::g e::::::eeeeeeeeeee  
  I::::I  m::::m   m::::m   m::::ma::::a    a:::::ag::::::g    g:::::g e:::::::e           
II::::::IIm::::m   m::::m   m::::ma::::a    a:::::ag:::::::ggggg:::::g e::::::::e          
I::::::::Im::::m   m::::m   m::::ma:::::aaaa::::::a g::::::::::::::::g  e::::::::eeeeeeee  
I::::::::Im::::m   m::::m   m::::m a::::::::::aa:::a gg::::::::::::::g   ee:::::::::::::e  
IIIIIIIIIImmmmmm   mmmmmm   mmmmmm  aaaaaaaaaa  aaaa   gggggggg::::::g     eeeeeeeeeeeeee  
                                                               g:::::g                     
                                                   gggggg      g:::::g                     
                                                   g:::::gg   gg:::::g                     
                                                    g::::::ggg:::::::g                     
                                                     gg:::::::::::::g                      
                                                       ggg::::::ggg                        
                                                          gggggg
-->


<h3 id="image-notation">
Image Fallbacks and Annotations: the ''image()'' notation</h3>

	<p>
		The ''image()'' function allows an author to:

	<ul>
		<li>
			use <a href="http://www.w3.org/TR/media-frags/">media fragments</a> to clip out a portion of an image

		<li>
			specify fallback images in case the preferred image can't be decoded or is a type that the browser doesn't recognize

		<li>
			use a solid color as an image
	</ul>

	<p>
		The ''image()'' notation is defined as:

	<pre class='prod'><br><!--
		--><dfn id='image-list-type'>&lt;image-list></dfn> = image( [ &lt;image-decl> , ]* [ &lt;image-decl> | &lt;color> ] )<br><!--
		--><dfn id='image-decl-type'>&lt;image-decl></dfn> = [ &lt;url> | &lt;string> ]</pre>

	<p>
		Each ''&lt;string>'' or ''&lt;url>'' inside ''image()'' represents an image, 
		just as if the <a href="#url-notation">''url()'' notation</a> had been used.  
		As usual for URLs in CSS, 
		relative URLs are resolved to an absolute URL 
		(as described in Values &amp; Units [[!CSS3VAL]]) 
		when a specified ''image()'' value is computed.

<h4 id="image-fragments">
Image Fragments</h4>

	<p>
		When a URL specified in ''image()'' represents a portion of a resource 
		(e.g. by the use of <a href="http://www.w3.org/TR/media-frags/#naming-space">media fragment identifiers</a>) 
		that portion is clipped out of its context and used as a standalone image.

	<div class="example">
		<p>
			For example, given the following image and CSS:

		<a href="sprites.svg">
			<img src="images/sprites.svg" height="20" width="180" alt="[9 circles, with 0 to 8 eighths filled in]">
		</a>

		<pre>background-image: image('sprites.svg#xywh=40,0,20,20')</pre>

		<p>
			...the background of the element will be the portion of the image that starts at (40px,0px) and is 20px wide and tall, 
			which is just the circle with a quarter filled in.
	</div>

	<p>
		So that authors can take advantage of CSS's forwards-compatible parsing rules to provide a fallback for image slices, 
		implementations that support the ''image()'' notation 
		<em>must</em> support the <code>xywh=#,#,#,#</code> form of media fragment identifiers 
		for images specified via ''image()''. [[!MEDIA-FRAGS]]

	<div class='example'>
		<p>
			Note that image fragments can also be used with the ''url()'' notation.  
			However, a legacy UA that doesn't understand the media fragments notation 
			will ignore the fragment and simply display the entirety of the image.

		<p>
			Since the ''image()'' notation requires UAs to support media fragments, 
			authors can take advantage of CSS's forward-compatible parsing rules 
			to provide a fallback when using an image fragment URL:

		<pre><!--
		-->background-image: url('swirl.png'); /* old UAs */&#xa;<!--
		-->background-image: image('sprites.png#xywh=10,30,60,20'); /* new UAs */</pre>
	</div>

<h4 id="image-fallbacks">
Image Fallbacks</h4>

	<p>
		Multiple ''&lt;image-decl>s'' can be given separated by commas, 
		in which case the function represents the first image that's not an <i>invalid image</i>.  
		The final argument can specify a ''&lt;color>'' to serve as an ultimate fallback; 
		this can be used, e.g. for 'background-image', 
		to ensure adequate contrast if none of the preceding ''&lt;image-decl>s'' can be used. 
		If the final argument is a ''&lt;color>'', 
		it represents a solid-color image of the given color with no <i>intrinsic dimensions</i>.  
		If all of the provided ''&lt;image-decl>s'' are <i>invalid images</i> 
		and a fallback color was not provided as the last argument, 
		the entire ''image()'' function must be treated as an <i>invalid image</i>.

	<div class="example">
		<p>
			The rule below would tell the UA to load ''wavy.svg'' if it can; 
			failing that to load ''wavy.png''; 
			and failing that to display ''wavy.gif''.  
			For example, the browser might not understand how to render SVG images, 
			and the PNG may be temporarily 404 
			(returning an HTML 404 page, which the browser can't decode as an image) 
			due to a server move, 
			so the GIF is used until one of the previous problems corrects itself.

		<pre>background-image: image("wavy.svg", 'wavy.png' , "wavy.gif");</pre>
	</div>

	<div class='example'>
		<p>
			The fallback color can be used to ensure that text is still readable 
			even when the image fails to load.  
			For example, the following code works fine if the image is rectangular and has no transparency:

		<pre><!--
		-->body      { color: black; background: white; }&#xa;<!--
		-->p.special { color: white; background: url("dark.png") black; }</pre>

		<p>
			When the image doesn't load, 
			the background color is still there to ensure that the white text is readable.  
			However, if the image has some transparency, 
			the black will be visible behind it, 
			which is probably not desired.  
			The ''image()'' function addresses this:

		<pre><!--
		-->body      { color: black; background: white; }&#xa;<!--
		-->p.special { color: white; background: image("dark.png", black); }</pre>

		<p>
			Now, the black won't show at all if the image loads, 
			but if for whatever reason the image fails, 
			it'll pop in and prevent the white text from being set against a white background.
	</div>

	<p>
		If a URL uses a fragment identifier syntax that the implementation does not understand, 
		or does not consider valid for that type of image, 
		the URL must be treated as representing an <i>invalid image</i>. 
		<span class='note'>This error-handling is limited to image(), 
			and not in the definition of URL, 
			for legacy compat reasons.</span>

	<div class='example'>
		<p>
			For example, if a future specification defined a way to refer to a specific frame of an animated GIF with a fragment identifier, 
			an author could write the following to get newer browsers to use the GIF's frame, 
			and older browsers to instead download the fallback image:

		<pre>background-image: image('cat_meme.gif#frame=5', 'lolcat.png');</pre>
	</div>

	<!-- XXX SVG fragment example with spriting / fallbacks (once SVG can provide this) -->

<h4 id="color-images">
Solid-color Images</h4>

	<div class='example'>
		<p>
			At times, one may need a solid-color image for a property or function that does not accept the ''&lt;color>'' type directly.  
			The ''image()'' function can be used for this: 
			by specifying <em>only</em> a color without any URLs, 
			the function immediately falls back to representing a solid-color image of the chosen color.

		<pre>background-image: image(rgba(0,0,255,.5)), url("bg-image.png");</pre>

		<p>
			In the above, the background is the image "bg-image.png", 
			overlaid with partially-transparent blue.
	</div>


<h4 id='bidi-images'>
Bidi-sensitive Images</h4>

	<p>
		Along with each ''&lt;image-decl>'', 
		the author may specify a directionality, 
		similar to adding a <code>dir</code> attribute to an element in HTML.  
		The ''image()'' function takes on the directionality of the used ''&lt;image-decl>'', if any.  
		If a directional image is used on or in an element with opposite <a href="http://www.w3.org/TR/CSS21/visuren.html#propdef-direction">direction</a>, 
		the image must be flipped in the inline direction 
		(as if it was transformed by, e.g., <code>scaleX(-1)</code>, if the inline direction is the X axis).

	<div class='example'>
		<p>
			A list may use an arrow for a bullet that points into the content.  
			If the list can contain both LTR and RTL text, 
			though, the bullet may be on the left or the right, 
			and an image designed to point into the text on one side will point out of the text on the other side.  
			This can be fixed with code like:

		<pre><!--
		-->&lt;ul style="list-style-image: image("arrow.png" ltr);">&#xa;<!--
		-->	&lt;li dir='ltr'>My bullet is on the left!&lt;/li>&#xa;<!--
		-->	&lt;li dir='rtl'>MY BULLET IS ON THE RIGHT!&lt;/li>&#xa;<!--
		-->&lt;/ul></pre>

		<p>
			This should render something like:

		<pre><!--
		-->&#8658; My bullet is on the left!&#xa;<!--
		-->  !THGIR EHT NO SI TELLUB YM &#8656;</pre>

		<p>
			In LTR list items, the image will be used as-is.  
			In the RTL list items, however, 
			it will be flipped in the inline direction, 
			so it still points into the content.
	</div>

<!--                                                                                                                                 
  iiii                                                                                                                                 tttt          
 i::::i                                                                                                                             ttt:::t          
  iiii                                                                                                                              t:::::t          
                                                                                                                                    t:::::t          
iiiiiii    mmmmmmm    mmmmmmm     aaaaaaaaaaaaa     ggggggggg   ggggg    eeeeeeeeeeee        ssssssssss       eeeeeeeeeeee    ttttttt:::::ttttttt    
i:::::i  mm:::::::m  m:::::::mm   a::::::::::::a   g:::::::::ggg::::g  ee::::::::::::ee    ss::::::::::s    ee::::::::::::ee  t:::::::::::::::::t    
 i::::i m::::::::::mm::::::::::m  aaaaaaaaa:::::a g:::::::::::::::::g e::::::eeeee:::::eess:::::::::::::s  e::::::eeeee:::::eet:::::::::::::::::t    
 i::::i m::::::::::::::::::::::m           a::::ag::::::ggggg::::::gge::::::e     e:::::es::::::ssss:::::se::::::e     e:::::etttttt:::::::tttttt    
 i::::i m:::::mmm::::::mmm:::::m    aaaaaaa:::::ag:::::g     g:::::g e:::::::eeeee::::::e s:::::s  ssssss e:::::::eeeee::::::e      t:::::t          
 i::::i m::::m   m::::m   m::::m  aa::::::::::::ag:::::g     g:::::g e:::::::::::::::::e    s::::::s      e:::::::::::::::::e       t:::::t          
 i::::i m::::m   m::::m   m::::m a::::aaaa::::::ag:::::g     g:::::g e::::::eeeeeeeeeee        s::::::s   e::::::eeeeeeeeeee        t:::::t          
 i::::i m::::m   m::::m   m::::ma::::a    a:::::ag::::::g    g:::::g e:::::::e           ssssss   s:::::s e:::::::e                 t:::::t    tttttt
i::::::im::::m   m::::m   m::::ma::::a    a:::::ag:::::::ggggg:::::g e::::::::e          s:::::ssss::::::se::::::::e                t::::::tttt:::::t
i::::::im::::m   m::::m   m::::ma:::::aaaa::::::a g::::::::::::::::g  e::::::::eeeeeeee  s::::::::::::::s  e::::::::eeeeeeee        tt::::::::::::::t
i::::::im::::m   m::::m   m::::m a::::::::::aa:::a gg::::::::::::::g   ee:::::::::::::e   s:::::::::::ss    ee:::::::::::::e          tt:::::::::::tt
iiiiiiiimmmmmm   mmmmmm   mmmmmm  aaaaaaaaaa  aaaa   gggggggg::::::g     eeeeeeeeeeeeee    sssssssssss        eeeeeeeeeeeeee            ttttttttttt  
                                                             g:::::g                                                                                 
                                                 gggggg      g:::::g                                                                                 
                                                 g:::::gg   gg:::::g                                                                                 
                                                  g::::::ggg:::::::g                                                                                 
                                                   gg:::::::::::::g                                                                                  
                                                     ggg::::::ggg                                                                                    
                                                        gggggg       
-->


<h3 id='image-set-notation'>
Resolution Negotiation: the ''image-set()'' notation</h3>

	<p>
		Delivering the most appropriate image resolution for a user's device can be a difficult task.
		Ideally, images should be in the same resolution as the device they're being viewed in,
		which can vary between users.
		However, other factors can factor into the decision of which image to send;
		for example, if the user is on a slow mobile connection,
		they may prefer to receive lower-res images
		rather than waiting for a large proper-res image to load.
		The ''image-set()'' function allows an author to ignore most of these issues,
		simply providing multiple resolutions of an image
		and letting the UA decide which is most appropriate in a given situation.

	<p>
		The syntax for ''image-set()'' is:

	<pre class='prod'>&#xa;<!--
	--><dfn id='image-set-type'>&lt;image-set></dfn> = image-set( [ <i>&lt;image-set-decl></i>, ]+ [ <i>image-set-decl></i> | &lt;color>] )&#xa;<!--
	--><dfn id='image-set-decl-type'>&lt;image-set-decl></dfn> = [ &lt;url> | &lt;string> ] <i>&lt;resolution></i></pre>

	<p>
		Each ''&lt;string>'' or ''&lt;url>'' inside ''image-set()'' represents an image, 
		just as if the <a href="#url-notation">''url()'' notation</a> had been used.  
		As usual for URLs in CSS, 
		relative URLs are resolved to an absolute URL 
		(as described in Values &amp; Units [[!CSS3VAL]]) 
		when a specified ''image-set()'' value is computed.

	<p>
		Every <i>&lt;image-set-decl></i> in a given ''image-set()'' must have a different <i>&lt;resolution></i>,
		or else the function is invalid.

	<p>
		The value that a given ''image-set()'' represents is determined by
		the UA first ordering the set of <i>&lt;image-set-decl></i>s
		in a UA-defined order
		(which should be based on the <i>&lt;resolution></i> of each <i>&lt;image-set-decl></i>,
		but may include other factors that the UA deems relevant,
		such as connection speed).
		The function then represents the first such image that is not an <i>invalid image</i>.
		If a fallback color was provided,
		the UA may decide at any point that the remaining <i>&lt;image-set-decl></i>s are unsuitable,
		and choose to use the fallback color instead,
		in which case the function represents a solid-color image of the given color with no <i>intrinsic dimensions</i>.
		If <em>all</em> of the <i>&lt;image-set-decl></i>s represent <i>invalid images</i>,
		then if a fallback color was provided,
		the function represents a solid-color image of the given color with no <i>intrinsic dimensions</i>;
		otherwise, the function represents an <i>invalid image</i>.

	<p>
		If an <i>&lt;image-set-decl></i> is chosen and successfully loaded,
		the associated <i>&lt;resolution></i> is the image's <i>intrinsic resolution</i>.

	<div class='example'>
		<p>
			This example shows how to use ''image-set()'' to provide an image in three versions:
			a "normal" version,
			a "high-res" version,
			and an extra-high resolution version for use in high-quality printing
			(as printers can have <em>extremely</em> high resolution):

		<pre><!--
		-->background-image: image-set( "foo.png" 1x,&#xa;<!--
		-->                             "foo-2x.png" 2x,&#xa;<!--
		-->                             "foo-print.png" 600dpi );</pre>
	</div>


<!--
EEEEEEEEEEEEEEEEEEEEEElllllll                                                                                            tttt          
E::::::::::::::::::::El:::::l                                                                                         ttt:::t          
E::::::::::::::::::::El:::::l                                                                                         t:::::t          
EE::::::EEEEEEEEE::::El:::::l                                                                                         t:::::t          
  E:::::E       EEEEEE l::::l     eeeeeeeeeeee       mmmmmmm    mmmmmmm       eeeeeeeeeeee    nnnn  nnnnnnnn    ttttttt:::::ttttttt    
  E:::::E              l::::l   ee::::::::::::ee   mm:::::::m  m:::::::mm   ee::::::::::::ee  n:::nn::::::::nn  t:::::::::::::::::t    
  E::::::EEEEEEEEEE    l::::l  e::::::eeeee:::::eem::::::::::mm::::::::::m e::::::eeeee:::::een::::::::::::::nn t:::::::::::::::::t    
  E:::::::::::::::E    l::::l e::::::e     e:::::em::::::::::::::::::::::me::::::e     e:::::enn:::::::::::::::ntttttt:::::::tttttt    
  E:::::::::::::::E    l::::l e:::::::eeeee::::::em:::::mmm::::::mmm:::::me:::::::eeeee::::::e  n:::::nnnn:::::n      t:::::t          
  E::::::EEEEEEEEEE    l::::l e:::::::::::::::::e m::::m   m::::m   m::::me:::::::::::::::::e   n::::n    n::::n      t:::::t          
  E:::::E              l::::l e::::::eeeeeeeeeee  m::::m   m::::m   m::::me::::::eeeeeeeeeee    n::::n    n::::n      t:::::t          
  E:::::E       EEEEEE l::::l e:::::::e           m::::m   m::::m   m::::me:::::::e             n::::n    n::::n      t:::::t    tttttt
EE::::::EEEEEEEE:::::El::::::le::::::::e          m::::m   m::::m   m::::me::::::::e            n::::n    n::::n      t::::::tttt:::::t
E::::::::::::::::::::El::::::l e::::::::eeeeeeee  m::::m   m::::m   m::::m e::::::::eeeeeeee    n::::n    n::::n      tt::::::::::::::t
E::::::::::::::::::::El::::::l  ee:::::::::::::e  m::::m   m::::m   m::::m  ee:::::::::::::e    n::::n    n::::n        tt:::::::::::tt
EEEEEEEEEEEEEEEEEEEEEEllllllll    eeeeeeeeeeeeee  mmmmmm   mmmmmm   mmmmmm    eeeeeeeeeeeeee    nnnnnn    nnnnnn          ttttttttttt  
-->


<h3 id='element-notation'>
Using Elements as Images: the ''element()'' notation</h3>

	<p>
		The ''element()'' function allows an author to use an element in the document as an image.  
		As the referenced element changes appearance, 
		the image changes as well.  
		This can be used, for example, 
		to create live previews of the next/previous slide in a slideshow, 
		or to reference a canvas element for a fancy generated gradient or even an animated background.

	<p class='note'>
		Note that the ''element()'' function only reproduces the <em>appearance</em> of the referenced element, 
		not the actual content and its structure.  
		Authors should only use this for decorative purposes, 
		and must not use ''element()'' to reproduce an element with significant content across the page.  
		Instead, just insert multiple copies of the element into the document.

	<p>
		The syntax for ''element()'' is:

	<pre class=prod><dfn id='element-image-type'>&lt;element-image></dfn> = element( &lt;id-selector> )</pre>

	<p>
		where ''&lt;id-selector>'' is an ID selector [[!SELECT]].

	<p>
		The ''element()'' function references the element matched by its argument.  
		If multiple elements are matched, 
		the function references the first such element.

	<p>
		The image represented by the ''element()'' function can vary based on whether the element is visible in the document:

	<dl>
		<dt>an <i title="element-not-rendered">element that is rendered</i> and is not a descendant of a replaced element
		<dd>
			<p>
				The function represents an image with its intrinsic size equal to the <dfn>decorated bounding box</dfn> of the referenced element:

			<ul>
				<li>
					for an element rendered using a CSS rendering model, 
					the <i>decorated bounding box</i> is the smallest axis-aligned rectangle 
					that contains the <a href="http://www.w3.org/TR/2011/CR-css3-background-20110215/#border-image-area">border image areas</a> of all the fragments of the principal box

				<li>
					for an element rendered using the SVG rendering model, 
					<a href="http://www.w3.org/TR/SVGTiny12/intro.html#TermDecoratedBoundingBox">the decorated bounding box is defined by SVG</a>
			</ul>

			<p class=note>
				Note: Because images clip anything outside their bounds by default, 
				this means that decorations that extend outside the <i>decorated bounding box</i>, 
				like box shadows, 
				may be clipped.

			<p>
				The image is constructed by rendering the referenced element and its descendants 
				(at the same size that they would be in the document) 
				over an infinite ''transparent'' canvas, 
				positioned so that the edges of the <i>decorated bounding box</i> are flush with the edges of the image.

			<p>
				If the referenced element has a transform applied to it or an ancestor, 
				the transform must be ignored when rendering the element as an image.  [[!CSS-TRANSFORMS]]

			<p>
				If the referenced element is broken across pages, 
				the element is displayed as if the page content areas were joined flush in the pagination direction, 
				with pages' edges corresponding to the initial containing block's start edge aligned.  
				<span class='note'>Elements broken across lines or columns are just rendered with their <i>decorated bounding box</i>.</span>

			<p>
				Implementations may either re-use existing bitmap data generated for the referenced element 
				or regenerate the display of the element to maximize quality at the image's size 
				(for example, if the implementation detects that the referenced element is an SVG fragment); 
				in the latter case, the layout of the referenced element in the image must not be changed by the regeneration process.  
				That is, the image must look identical to the referenced element, 
				modulo rasterization quality.

			<div class='example'>
				<p>
					As a somewhat silly example, a <code>&lt;p></code> element can be reused as a background elsewhere in the document:

				<pre><!--
				-->&lt;style>&#xa;<!--
				-->#src { color: white; background: lime; width: 300px; height: 40px; }&#xa;<!--
				-->#dst { color: black; background: element(#src); padding: 20px; margin: 20px 0; }&#xa;<!--
				-->&lt;/style>&#xa;<!--
				-->&lt;p id='src'>I'm an ordinary element!&lt;/p>&#xa;<!--
				-->&lt;p id='dst'>I'm using the previous element as my background!&lt;/p></pre>

				<img src="images/element-function.png" alt="">
			</div>
		

		<dt>an <i title='element-not-rendered'>element that is not rendered</i>, but which <i title='paint-source'>provides a paint source</i>
		<dd>
			<p>
				The function represents an image with the intrinsic size and appearance of the <i title=paint-source>paint source</i>.  
				The host language defines the size and appearance of paint sources.

			<div class='example'>
				<p>
					For example, the ''element()'' function can reference an SVG <code>&lt;pattern></code> element in an HTML document:

				<pre><!--
				-->&lt;!DOCTYPE html>&#xa;<!--
				-->&lt;svg>&#xa;<!--
				-->	&lt;defs>&#xa;<!--
				-->		&lt;pattern id='pattern1'>&#xa;<!--
				-->			&lt;path d='...'>&#xa;<!--
				-->		&lt;/pattern>&#xa;<!--
				-->	&lt;/defs>&#xa;<!--
				-->&lt;/svg>&#xa;<!--
				-->&lt;p style="background: element(#pattern1)">&#xa;<!--
				-->	I'm using the pattern as a background!&#xa;<!--
				-->	If the pattern is changed or animated, &#xa;<!--
				-->	my background will be updated too!&#xa;<!--
				-->&lt;/p></pre>

				<p>
					HTML also defines that a handful of elements, 
					such as <code>&lt;canvas></code>, <code>&lt;img></code>, and <code>&lt;video></code>, 
					provide a paint source.  
					This means that CSS can, for example, 
					reference a canvas that's being drawn into, 
					but not displayed in the page:

				<pre><!--
				-->&lt;!DOCTYPE html>&#xa;<!--
				-->&lt;script>&#xa;<!--
				-->	var canvas = document.querySelector('#animated-bullet');&#xa;<!--
				-->	canvas.width = 20; canvas.height = 20;&#xa;<!--
				-->	drawAnimation(canvas);&#xa;<!--
				-->&lt;/script>&#xa;<!--
				-->&lt;canvas id='animated-bullet' style='display:none'>&lt;/canvas>&#xa;<!--
				-->&lt;ul style="list-style-image: element(#animated-bullet);">&#xa;<!--
				-->	&lt;li>I'm using the canvas as a bullet!&lt;/li>&#xa;<!--
				-->	&lt;li>So am I!&lt;/li>&#xa;<!--
				-->	&lt;li>As the canvas is changed over time with Javascript,&#xa;<!--
				-->	    we'll all update our bullet image with it!&lt;/li>&#xa;<!--
				-->&lt;/ul></pre>
			</div>
		

		<dt>anything else
		<dd>
			<p>
				The function represents an <i>invalid image</i>.

			<div class='example'>
				<p>
					For example, all of the following ''element()'' uses will result in a transparent background:

				<pre><!--
				-->&lt;!DOCTYPE html>&#xa;<!--
				-->&lt;p id='one' style="display:none;">one&lt;/p>&#xa;<!--
				-->&lt;iframe src="http://example.com">&#xa;<!--
				-->	&lt;p id='two'>I'm fallback content!&lt;/p>&#xa;<!--
				-->&lt;/iframe>&#xa;<!--
				-->&lt;ul>&#xa;<!--
				-->	&lt;li style="background: element(#one);">&#xa;<!--
				-->	  A display:none element isn't rendered, and a P element&#xa;<!--
				-->	  doesn't provide a paint source.&#xa;<!--
				-->	&lt;/li>&#xa;<!--
				-->	&lt;li style="background: element(#two);">&#xa;<!--
				-->	  The descendants of a replaced element like an IFRAME&#xa;<!--
				-->	  can't be used in element() either.&#xa;<!--
				-->	&lt;/li>&#xa;<!--
				-->	&lt;li style="background: element(#three);">&#xa;<!--
				-->	  There's no element with an id of "three", so this also&#xa;<!--
				-->	  gets rendered as a transparent image.&#xa;<!--
				-->	&lt;/li>&#xa;<!--
				-->&lt;/ul></pre>
			</div>
		
	</dl>

	<p>
		An element is <dfn id='element-not-rendered' title='element-not-rendered'>not rendered</dfn> if it does not have an associated box.  
		This can happen, for example, 
		if the element or an ancestor is ''display:none''.  
		Host languages may define additional ways in which an element can be considered not rendered; 
		for example, in SVG, 
		any descendant of a <code>&lt;defs></code> element is considered to be not rendered.

	<div class='example'>
		<p>
			The ''element()'' function can be put to many uses.  
			For example, it can be used to show a preview of the previous or next slide in a slideshow:

		<pre><!--
		-->&lt;!DOCTYPE html>&#xa;<!--
		-->&lt;script>&#xa;<!--
		-->function navigateSlides() {&#xa;<!--
		-->	var currentSlide = ...;&#xa;<!--
		-->	document.querySelector('#prev-slide').id = '';&#xa;<!--
		-->	document.querySelector('#next-slide').id = '';&#xa;<!--
		-->	currentSlide.previousElementSibling.id = 'prev-slide';&#xa;<!--
		-->	currentSlide.nextElementSibling.id = 'next-slide';&#xa;<!--
		-->}&#xa;<!--
		-->&lt;/script>&#xa;<!--
		-->&lt;style>&#xa;<!--
		-->#prev-preview, #next-preview { &#xa;<!--
		-->	position: fixed;&#xa;<!--
		-->	...&#xa;<!--
		-->}&#xa;<!--
		-->#prev-preview { background: element(#prev-slide); }&#xa;<!--
		-->#next-preview { background: element(#next-slide); }&#xa;<!--
		-->&lt;/style>&#xa;<!--
		-->&lt;a id='prev-preview'>Previous Slide&lt;/a>&#xa;<!--
		-->&lt;a id='next-preview'>Next Slide&lt;/a>&#xa;<!--
		-->&lt;section class='slide'>...&lt;/section>&#xa;<!--
		-->&lt;section class='slide current-slide'>...&lt;/section>&#xa;<!--
		-->...</pre>

		<p>
			In this example, the <code>navigateSlides</code> function updates the ids of the next and previous slides, 
			which are then displayed in small floating boxes alongside the slides.  
			Since you can't interact with the slides through the ''element()'' function (it's just an image), 
			you could even use <code>click</code> handlers on the preview boxes to help navigate through the page.
	</div>

<h4 id='paint-sources'>
Paint Sources</h4>

	<p>
		Host languages may define that some elements provide a <dfn title="paint-source">paint source</dfn>.  
		Paint sources have an intrinsic width, height, and appearance, 
		separate from the process of rendering, 
		and so may be used as images even when they're <i title='element-not-rendered'>not rendered</i>.
	
	<p>
		In HTML, the <code>&lt;img></code>, <code>&lt;video></code>, and <code>&lt;canvas></code> elements provide paint sources 
		(defined in each element's section in <a href='http://www.whatwg.org/specs/web-apps/current-work/multipage/'>HTML5</a>).

	<p>
		In SVG, any element that provides a <a href='http://www.w3.org/TR/SVG/pservers.html'>paint server</a> provides a paint source.  
		<span class='note'>Note: In SVG1.1, 
			the <code>&lt;linearGradient></code>, 
			<code>&lt;radialGradient></code>, 
			and <code>&lt;pattern></code> elements 
			provide paint sources.</span>  
		They are drawn as described in the spec, 
		with the coordinate systems defined as follows:

	<dl>
		<dt>objectBoundingBox
		<dd>
			The coordinate system has its origin at the top left corner of the rectangle defined by the <i>concrete object size</i> that it's being drawn into, 
			and the same width and height as the <i>concrete object size</i>.  
			A single <a href="http://www.w3.org/TR/SVG/coords.html#Units">user coordinate</a> is the width and height of the <i>concrete object size</i>.

		<dt>userSpaceOnUse
		<dd>
			The coordinate system has its origin at the top left corner of the rectangle defined by the <i>concrete object size</i> that it's being drawn into, 
			and the same width and height as the <i>concrete object size</i>.  
			<a href="http://www.w3.org/TR/SVG/coords.html#Units">User coordinates</a> are sized equivalently to the CSS ''px'' unit.
	</dl>

	<p class='note'>
		It is expected that a future version of this module will define ways to refer to paint sources in external documents, 
		or ones that are created solely by script and never inserted into a document at all.

<h4 id='element-cycles'>
Cycle Detection</h4>

	<p>
		The ''element()'' function can produce nonsensical circular relationships, 
		such as an element using itself as its own background.  
		These relationships can be easily and reliably detected and resolved, however, 
		by keeping track of a dependency graph and using common cycle-detection algorithms.

	<p>
		The dependency graph consists of edges such that:

	<ul>
		<li>
			every element depends on its children

		<li>
			for any element A with a property using the ''element()'' function pointing to an element B,
			A depends on B

		<li>
			if a host language defines a way for elements to refer to the rendering of other elements, 
			the referencing element depends on the referenced element.  
			For example, in SVG, 
			a &lt;use> element depends on the element it referenced.
	</ul>

	<p>
		If the graph contains a cycle, 
		any ''element()'' functions participating in the cycle are <i>invalid images</i>.


<!--
                                                                                                                                            dddddddd                    
        CCCCCCCCCCCCC                                                                          ffffffffffffffff                             d::::::d                    
     CCC::::::::::::C                                                                         f::::::::::::::::f                            d::::::d                    
   CC:::::::::::::::C                                                                        f::::::::::::::::::f                           d::::::d                    
  C:::::CCCCCCCC::::C                                                                        f::::::fffffff:::::f                           d:::::d                     
 C:::::C       CCCCCCrrrrr   rrrrrrrrr      ooooooooooo       ssssssssss       ssssssssss    f:::::f       ffffffaaaaaaaaaaaaa      ddddddddd:::::d     eeeeeeeeeeee    
C:::::C              r::::rrr:::::::::r   oo:::::::::::oo   ss::::::::::s    ss::::::::::s   f:::::f             a::::::::::::a   dd::::::::::::::d   ee::::::::::::ee  
C:::::C              r:::::::::::::::::r o:::::::::::::::oss:::::::::::::s ss:::::::::::::s f:::::::ffffff       aaaaaaaaa:::::a d::::::::::::::::d  e::::::eeeee:::::ee
C:::::C              rr::::::rrrrr::::::ro:::::ooooo:::::os::::::ssss:::::ss::::::ssss:::::sf::::::::::::f                a::::ad:::::::ddddd:::::d e::::::e     e:::::e
C:::::C               r:::::r     r:::::ro::::o     o::::o s:::::s  ssssss  s:::::s  ssssss f::::::::::::f         aaaaaaa:::::ad::::::d    d:::::d e:::::::eeeee::::::e
C:::::C               r:::::r     rrrrrrro::::o     o::::o   s::::::s         s::::::s      f:::::::ffffff       aa::::::::::::ad:::::d     d:::::d e:::::::::::::::::e 
C:::::C               r:::::r            o::::o     o::::o      s::::::s         s::::::s    f:::::f            a::::aaaa::::::ad:::::d     d:::::d e::::::eeeeeeeeeee  
 C:::::C       CCCCCC r:::::r            o::::o     o::::ossssss   s:::::s ssssss   s:::::s  f:::::f           a::::a    a:::::ad:::::d     d:::::d e:::::::e           
  C:::::CCCCCCCC::::C r:::::r            o:::::ooooo:::::os:::::ssss::::::ss:::::ssss::::::sf:::::::f          a::::a    a:::::ad::::::ddddd::::::dde::::::::e          
   CC:::::::::::::::C r:::::r            o:::::::::::::::os::::::::::::::s s::::::::::::::s f:::::::f          a:::::aaaa::::::a d:::::::::::::::::d e::::::::eeeeeeee  
     CCC::::::::::::C r:::::r             oo:::::::::::oo  s:::::::::::ss   s:::::::::::ss  f:::::::f           a::::::::::aa:::a d:::::::::ddd::::d  ee:::::::::::::e  
        CCCCCCCCCCCCC rrrrrrr               ooooooooooo     sssssssssss      sssssssssss    fffffffff            aaaaaaaaaa  aaaa  ddddddddd   ddddd    eeeeeeeeeeeeee  
-->

<h3 id='cross-fade-function'>
Combining images: the ''cross-fade()'' notation</h3>

	<p>
		When transitioning between images, 
		CSS requires a way to explicitly refer to the intermediate image 
		that is a combination of the start and end images. 
		This is accomplished with the ''cross-fade()'' function, 
		which indicates the two images to be combined 
		and how far along in the transition the combination is.

	<p class="note">
		Authors can also use the ''cross-fade()'' function for many simple image manipulations, 
		such as tinting an image with a solid color 
		or highlighting a particular area of the page by combining an image with a radial gradient.

	<p>
		The syntax for ''cross-fade()'' is defined as:

	<pre class=prod><dfn>&lt;image-combination></dfn> = cross-fade( &lt;image>, &lt;image>, &lt;percentage> )</pre>

	<p>
		The function represents an image generated by 
		combining the first and second image 
		(referred to in this section as the "start" and "end" images, respectively).  
		The percentage represents how far along the transformation is, 
		with 0% representing the start image, 
		100% representing the end image, 
		and percentages between that representing corresponding combinations of the two images.  
		The <code>&lt;percentage></code> must be between 0% and 100% inclusive; 
		any other value is invalid.

	<p>
		More precisely, 
		given ''cross-fade(A,B,p)'', 
		where <var>A</var> and <var>B</var> are images 
		and <var>p</var> is a percentage between 0% and 100%, 
		the function represents an image 
		with width equal to <code>width<sub>A</sub> &times; (1-<var>p</var>) + width<sub>B</sub> &times; p</code> 
		and height equal to <code>height<sub>A</sub> &times; (1-<var>p</var>) + height<sub>B</sub> &times; p</code>. 
		The contents of the image must be constructed by 
		first scaling <var>A</var> and <var>B</var> to the size of the generated image, 
		then applying <code>dissolve(<var>A</var>,1-<var>p</var>) plus dissolve(<var>B</var>,<var>p</var>)</code>.
		<span class='note'>The "dissolve()" function and "plus" compositing operator are defined in the literature by Porter-Duff.</span>


<!--
                                                                    dddddddd                                                                                      
        GGGGGGGGGGGGG                                               d::::::d  iiii                                                 tttt                           
     GGG::::::::::::G                                               d::::::d i::::i                                             ttt:::t                           
   GG:::::::::::::::G                                               d::::::d  iiii                                              t:::::t                           
  G:::::GGGGGGGG::::G                                               d:::::d                                                     t:::::t                           
 G:::::G       GGGGGGrrrrr   rrrrrrrrr   aaaaaaaaaaaaa      ddddddddd:::::d iiiiiii     eeeeeeeeeeee    nnnn  nnnnnnnn    ttttttt:::::ttttttt        ssssssssss   
G:::::G              r::::rrr:::::::::r  a::::::::::::a   dd::::::::::::::d i:::::i   ee::::::::::::ee  n:::nn::::::::nn  t:::::::::::::::::t      ss::::::::::s  
G:::::G              r:::::::::::::::::r aaaaaaaaa:::::a d::::::::::::::::d  i::::i  e::::::eeeee:::::een::::::::::::::nn t:::::::::::::::::t    ss:::::::::::::s 
G:::::G    GGGGGGGGGGrr::::::rrrrr::::::r         a::::ad:::::::ddddd:::::d  i::::i e::::::e     e:::::enn:::::::::::::::ntttttt:::::::tttttt    s::::::ssss:::::s
G:::::G    G::::::::G r:::::r     r:::::r  aaaaaaa:::::ad::::::d    d:::::d  i::::i e:::::::eeeee::::::e  n:::::nnnn:::::n      t:::::t           s:::::s  ssssss 
G:::::G    GGGGG::::G r:::::r     rrrrrrraa::::::::::::ad:::::d     d:::::d  i::::i e:::::::::::::::::e   n::::n    n::::n      t:::::t             s::::::s      
G:::::G        G::::G r:::::r           a::::aaaa::::::ad:::::d     d:::::d  i::::i e::::::eeeeeeeeeee    n::::n    n::::n      t:::::t                s::::::s   
 G:::::G       G::::G r:::::r          a::::a    a:::::ad:::::d     d:::::d  i::::i e:::::::e             n::::n    n::::n      t:::::t    ttttttssssss   s:::::s 
  G:::::GGGGGGGG::::G r:::::r          a::::a    a:::::ad::::::ddddd::::::ddi::::::ie::::::::e            n::::n    n::::n      t::::::tttt:::::ts:::::ssss::::::s
   GG:::::::::::::::G r:::::r          a:::::aaaa::::::a d:::::::::::::::::di::::::i e::::::::eeeeeeee    n::::n    n::::n      tt::::::::::::::ts::::::::::::::s 
     GGG::::::GGG:::G r:::::r           a::::::::::aa:::a d:::::::::ddd::::di::::::i  ee:::::::::::::e    n::::n    n::::n        tt:::::::::::tt s:::::::::::ss  
        GGGGGG   GGGG rrrrrrr            aaaaaaaaaa  aaaa  ddddddddd   dddddiiiiiiii    eeeeeeeeeeeeee    nnnnnn    nnnnnn          ttttttttttt    sssssssssss    
 
-->


<h2 id="gradients">
Gradients</h2>

	<p>
		A gradient is an image that smoothly fades from one color to another.  
		These are commonly used for subtle shading in background images, buttons, and many other things.  
		The gradient notations described in this section allow an author to specify such an image in a terse syntax, 
		so that the UA can generate the image automatically when rendering the page. 
		The syntax of a <i>&lt;gradient></i> is:

	<pre class=prod><dfn id='gradient-type'>&lt;gradient></dfn> = [ 
	<i>&lt;linear-gradient></i> | <i>&lt;radial-gradient></i> | 
	<i>&lt;repeating-linear-gradient></i> | <i>&lt;repeating-radial-gradient></i> ]</pre>

	<div class=example>
		<p>
			As with the other <i>&lt;image></i> types defined in this specification, 
			gradients can be used in any property that accepts images.  
			For example:

		<ul>
			<li><code>background: linear-gradient(white, gray);</code>
			<li><code>list-style-image: radial-gradient(circle, #006, #00a 90%, #0000af 100%, white 100%)</code>
		</ul>
	</div>

	<p>
		A gradient is drawn into a box with the dimensions of the <i>concrete object size</i>, 
		referred to as the <dfn>gradient box</dfn>.  
		However, the gradient itself has no <i>intrinsic dimensions</i>.

	<div class='example'>
		<p>
			For example, if you use a gradient as a background, 
			by default the gradient will draw into a <i>gradient box</i> the size of the element's padding box.  
			If 'background-size' is explicitly set to a value such as ''100px 200px'', 
			then the <i>gradient box</i> will be 100px wide and 200px tall.  
			Similarly, for a gradient used as a 'list-style-image', 
			the box would be a 1em square, 
			which is the <i>default object size</i> for that property.
	</div>


<!--
LLLLLLLLLLL               iiii                                                                          
L:::::::::L              i::::i                                                                         
L:::::::::L               iiii                                                                          
LL:::::::LL                                                                                             
  L:::::L               iiiiiiinnnn  nnnnnnnn        eeeeeeeeeeee    aaaaaaaaaaaaa  rrrrr   rrrrrrrrr   
  L:::::L               i:::::in:::nn::::::::nn    ee::::::::::::ee  a::::::::::::a r::::rrr:::::::::r  
  L:::::L                i::::in::::::::::::::nn  e::::::eeeee:::::eeaaaaaaaaa:::::ar:::::::::::::::::r 
  L:::::L                i::::inn:::::::::::::::ne::::::e     e:::::e         a::::arr::::::rrrrr::::::r
  L:::::L                i::::i  n:::::nnnn:::::ne:::::::eeeee::::::e  aaaaaaa:::::a r:::::r     r:::::r
  L:::::L                i::::i  n::::n    n::::ne:::::::::::::::::e aa::::::::::::a r:::::r     rrrrrrr
  L:::::L                i::::i  n::::n    n::::ne::::::eeeeeeeeeee a::::aaaa::::::a r:::::r            
  L:::::L         LLLLLL i::::i  n::::n    n::::ne:::::::e         a::::a    a:::::a r:::::r            
LL:::::::LLLLLLLLL:::::Li::::::i n::::n    n::::ne::::::::e        a::::a    a:::::a r:::::r            
L::::::::::::::::::::::Li::::::i n::::n    n::::n e::::::::eeeeeeeea:::::aaaa::::::a r:::::r            
L::::::::::::::::::::::Li::::::i n::::n    n::::n  ee:::::::::::::e a::::::::::aa:::ar:::::r            
LLLLLLLLLLLLLLLLLLLLLLLLiiiiiiii nnnnnn    nnnnnn    eeeeeeeeeeeeee  aaaaaaaaaa  aaaarrrrrrr   
-->


<h3 id='linear-gradients'>
Linear Gradients: the ''linear-gradient()'' notation</h3>

	<p>
		A linear gradient is created by specifying a gradient line 
		and then several colors placed along that line.  
		The image is constructed by creating an infinite canvas 
		and painting it with lines perpendicular to the gradient line, 
		with the color of the painted line being the color of the gradient line where the two intersect.  
		This produces a smooth fade from each color to the next, 
		progressing in the specified direction.

<!-- ====================================================================== -->

<h4 class='no-toc' id='linear-gradient-syntax'>
linear-gradient() syntax</h4>

	<p>The linear gradient syntax is:

	<pre class=prod><!--
		--><dfn id='linear-gradient-type'>&lt;linear-gradient></dfn> = linear-gradient(&#xa;<!--
		-->	[ [ &lt;angle> | to &lt;side-or-corner> ] ,]? &#xa;<!--
		-->	&lt;color-stop>[, &lt;color-stop>]+&#xa;<!--
		-->)&#xa;<!--
		-->&#xa;<!--
		--><dfn id='side-or-corner'>&lt;side-or-corner></dfn> = [left | right] || [top | bottom]</pre>

	<p>
		The first argument to the function specifies the <dfn>gradient line</dfn>, 
		which gives the gradient a direction and determines how color-stops are positioned.  
		It may be omitted; 
		if so, it defaults to ''to bottom''.

	<p>
		The <i title="gradient line">gradient line's</i> direction may be specified in two ways:

	<dl>
		<dt>using angles
		<dd>
			For the purpose of this argument, 
			''0deg'' points upward, 
			and positive angles represent clockwise rotation, 
			so ''90deg'' point toward the right.

		<dt>using keywords
		<dd>
			<p>
				If the argument is ''to top'', ''to right'', ''to bottom'', or ''to left'', 
				the angle of the <i>gradient line</i> is ''0deg'', ''90deg'', ''180deg'', or ''270deg'', respectively.
			<p>
				If the argument instead specifies a corner of the box such as ''to top left'', 
				the <i>gradient line</i> must be angled such that it points into the same quadrant as the specified corner, 
				and is perpendicular to a line intersecting the two neighboring corners of the <i>gradient box</i>.
				<span class='note'>This causes a color-stop at 50% to intersect the two neighboring corners (see <a href='#corner-gradient-example'>example</a>).</span>
		
	</dl>

	<p>
		Starting from the center of the <i>gradient box</i>, 
		extend a line at the specified angle in both directions. 
		The ending point is the point on the <i>gradient line</i> 
		where a line drawn perpendicular to the <i>gradient line</i> 
		would intersect the corner of the <i>gradient box</i> in the specified direction.  
		The starting point is determined identically, but in the opposite direction.

	<p class='note'>
		It is expected that the next level of this module will provide the ability to define the gradient's direction relative to the current text direction and writing-mode.

	<div class=example>
		<div style="overflow: hidden">
			<img style="float: right; margin-left: 1em;" src='images/gradient-diagram.png' alt="[An image showing a box with a background shading gradually from white in the bottom-left corner to black in the top-right corner.  There is a line, illustrating the gradient line, angled at 45 degrees and passing through the center of the box.  The starting point and ending point of the gradient line are indicated by the intersection of the gradient line with two additional lines that pass through the bottom-left and top-right corners of the box.]">
			
			<p>
				This example illustrates visually how to calculate the <i>gradient line</i> from the rules above.  
				This shows the starting and ending point of the <i>gradient line</i>, 
				long with the actual gradient, 
				produced by an element with ''background: linear-gradient(45deg, white, black);''.

			<p>
				Notice how, though the starting point and ending point are outside of the box, 
				they're positioned precisely right so that the gradient is pure white <em>exactly</em> at the corner, 
				and pure black <em>exactly</em> at the opposite corner.  
				That's intentional, and will always be true for linear gradients.
		</div>
	</div>

	<p>
		The gradient's color stops are typically placed between the starting point and ending point on the <i>gradient line</i>, 
		but this isn't required - 
		the <i>gradient line</i> extends infinitely in both directions.  
		The starting point and ending point are merely arbitrary location markers - 
		the starting point defines where 0%, 0px, etc are located when specifying color-stops, 
		and the ending point defines where 100% is located.  
		Color-stops are allowed to have positions before 0% or after 100%.

	<p>
		The color of the gradient at any point is determined 
		by finding the unique line passing through that point that is perpendicular to the <i>gradient line</i>.  
		The point's color is the color of the <i>gradient line</i> 
		at the point where this line intersects it.

<!-- ====================================================================== -->

<h4 class='no-toc' id='linear-gradient-examples'>
Linear Gradient Examples</h4>

	<p>
		All of the following ''linear-gradient()'' examples are presumed to be backgrounds applied to a box that is 200px wide and 100px tall.

	<div class=example>	
		<p>
			Below are various ways of specifying a basic vertical gradient:

		<pre><!--
		-->linear-gradient(yellow, blue);&#xa;<!--
		-->linear-gradient(to bottom, yellow, blue);&#xa;<!--
		-->linear-gradient(180deg, yellow, blue);&#xa;<!--
		-->linear-gradient(to top, blue, yellow);&#xa;<!--
		-->linear-gradient(to bottom, yellow 0%, blue 100%);</pre>

		<p><img src="images/linear1.png" alt="" >
	</div>

	<div class=example>	
		<p>
			This demonstrates the use of an angle in the gradient.  
			Note that, though the angle is not exactly the same as the angle between the corners, 
			the <i>gradient line</i> is still sized so as to make the gradient yellow exactly at the upper-left corner, 
			and blue exactly at the lower-right corner.

		<pre><!--
		-->linear-gradient(135deg, yellow, blue);&#xa;<!--
		-->linear-gradient(-45deg, blue, yellow);</pre>

		<p><img src="images/linear3.png" alt="" >
	</div>

	<div class=example>	
		<p>
			This demonstrates a 3-color gradient, and how to specify the location of a stop explicitly:

		<pre>linear-gradient(yellow, blue 20%, #0f0);</pre>

		<p><img src="images/linear4.png" alt="" >
	</div>

	<div class=example id='corner-gradient-example'>
		<p>
			This demonstrates a corner-to-corner gradient specified with keywords.  
			Note how the gradient is red and blue exactly in the bottom-left and top-right corners, respectively, 
			exactly like the second example.  
			Additionally, the angle of the gradient is automatically computed so that the color at 50% (in this case, white) 
			stretches across the top-left and bottom-right corners.

		<pre>linear-gradient(to top right, red, white, blue)</pre>

		<p><object data="images/gradient1.svg" width="200" height="100">(Image requires SVG)</object>
	</div>


<!--
                                                 dddddddd                                  
RRRRRRRRRRRRRRRRR                                d::::::d  iiii                    lllllll 
R::::::::::::::::R                               d::::::d i::::i                   l:::::l 
R::::::RRRRRR:::::R                              d::::::d  iiii                    l:::::l 
RR:::::R     R:::::R                             d:::::d                           l:::::l 
  R::::R     R:::::R  aaaaaaaaaaaaa      ddddddddd:::::d iiiiiii   aaaaaaaaaaaaa    l::::l 
  R::::R     R:::::R  a::::::::::::a   dd::::::::::::::d i:::::i   a::::::::::::a   l::::l 
  R::::RRRRRR:::::R   aaaaaaaaa:::::a d::::::::::::::::d  i::::i   aaaaaaaaa:::::a  l::::l 
  R:::::::::::::RR             a::::ad:::::::ddddd:::::d  i::::i            a::::a  l::::l 
  R::::RRRRRR:::::R     aaaaaaa:::::ad::::::d    d:::::d  i::::i     aaaaaaa:::::a  l::::l 
  R::::R     R:::::R  aa::::::::::::ad:::::d     d:::::d  i::::i   aa::::::::::::a  l::::l 
  R::::R     R:::::R a::::aaaa::::::ad:::::d     d:::::d  i::::i  a::::aaaa::::::a  l::::l 
  R::::R     R:::::Ra::::a    a:::::ad:::::d     d:::::d  i::::i a::::a    a:::::a  l::::l 
RR:::::R     R:::::Ra::::a    a:::::ad::::::ddddd::::::ddi::::::ia::::a    a:::::a l::::::l
R::::::R     R:::::Ra:::::aaaa::::::a d:::::::::::::::::di::::::ia:::::aaaa::::::a l::::::l
R::::::R     R:::::R a::::::::::aa:::a d:::::::::ddd::::di::::::i a::::::::::aa:::al::::::l
RRRRRRRR     RRRRRRR  aaaaaaaaaa  aaaa  ddddddddd   dddddiiiiiiii  aaaaaaaaaa  aaaallllllll
-->


<h3 id='radial-gradients'>
Radial Gradients: the ''radial-gradient()'' notation</h3>

	<p>
		In a radial gradient, 
		rather than colors smoothly fading from one side of the <i>gradient box</i> to the other 
		as with linear gradients, 
		they instead emerge from a single point 
		and smoothly spread outward in a circular or elliptical shape.

	<p>
		A radial gradient is specified by indicating the center of the gradient 
		(where the 0% ellipse will be) 
		and the size and shape of the <dfn>ending shape</dfn> 
		(the 100% ellipse). 
		Color stops are given as a list, 
		just as for ''linear-gradient()''. 
		Starting from the <i>center</i> 
		and progressing towards (and potentially beyond) the <i>ending shape</i> 
		uniformly-scaled concentric ellipses are drawn and colored 
		according to the specified color stops.

<!-- ====================================================================== -->

<h4 class='no-toc' id='radial-gradient-syntax'>
radial-gradient() Syntax</h4>

	<p>
		The radial gradient syntax is:

	<pre><!--
		--><dfn id='radial-gradient-type'>&lt;radial-gradient></dfn> = radial-gradient(&#xa;<!--
		-->  [ [ &lt;shape> || &lt;size> ] [ at &lt;position> ]? , |&#xa;<!--
		-->    at &lt;position>, &#xa;<!--
		-->  ]?&#xa;<!--
		-->  &lt;color-stop> [ , &lt;color-stop> ]+&#xa;<!--
		-->)</pre>

	<div class=example>
		<p>
			Here is an example of a circular radial gradient 5em wide 
			and positioned with its center in the top left corner:

		<pre>radial-gradient(5em circle at top left, yellow, blue)</pre>
	</div>

	<p>
		The arguments are defined as follows:

	<dl>

		<dt id='radial-position'><dfn id='position'>&lt;position></dfn>
		<dd>
			Determines the center of the gradient. 
			The <a href="http://www.w3.org/TR/css3-values/#position">&lt;position></a> value type 
			(which is also used for 'background-position') 
			is defined in [[!CSS3VAL]], 
			and is resolved using the center-point as the object area 
			and the <i>gradient box</i> as the positioning area. 
			If this argument is omitted, 
			it defaults to ''center''.

		<dt id='radial-shape'><dfn id='shape'>&lt;shape></dfn>
		<dd>
			Can be either ''circle'' or ''ellipse''; 
			determines whether the gradient's <i>ending shape</i> is a circle or an ellipse, respectively. 
			If <i>&lt;shape></i> is omitted, 
			the <i>ending shape</i> defaults to a circle 
			if the <i>&lt;size></i> is a single &lt;length>, 
			and to an ellipse otherwise.

		<dt id='radial-size'><dfn id='size'>&lt;size></dfn>
		<dd>
			<p>
				Determines the size of the gradient's <i>ending shape</i>. 
				If omitted it defaults to ''farthest-corner''. 
				It can be given explicitly or by keyword. 
				For the purpose of the keyword definitions, 
				consider the <i>gradient box</i> edges as extending infinitely in both directions, 
				rather than being finite line segments.

			<p>
				If the ending-shape is an ellipse, 
				its axises are aligned with the horizontal and vertical axises.

			<p>
				Both ''circle'' and ''ellipse'' gradients accept the following keywords as their <i>&lt;size></i>:

			<dl>
				<dt><dfn id='radial-closest-side'>''closest-side''</dfn>
				<dd>
					The <i>ending shape</i> is sized so that 
					it exactly meets the side of the <i>gradient box</i> closest to the gradient's center. 
					If the shape is an ellipse, 
					it exactly meets the closest side in each dimension.

				<dt><dfn id='radial-farthest-side'>''farthest-side''</dfn>
				<dd>
					Same as ''closest-side'', 
					except the <i>ending shape</i> is sized based on the farthest side(s).

				<dt><dfn id='radial-closest-corner'>''closest-corner''</dfn>
				<dd>
					The <i>ending shape</i> is sized so that 
					it passes through the corner of the <i>gradient box</i> closest to the gradient's center. 
					If the shape is an ellipse, 
					the <i>ending shape</i> is given the same aspect-ratio it would have if ''closest-side'' were specified.

				<dt><dfn id='radial-farthest-corner'>''farthest-corner''</dfn>
				<dd>
					Same as ''closest-corner'', 
					except the <i>ending shape</i> is sized based on the farthest corner. 
					If the shape is an ellipse, 
					the <i>ending shape</i> is given the same aspect ratio it would have if ''farthest-side'' were specified.
			</dl>

			<p>
				If <i>&lt;shape></i> is specified as ''circle'' or is omitted, 
				the <i>&lt;size></i> may be given explicitly as:

			<dl>
				<dt><dfn id='radial-size-circle'>&lt;length></dfn>
				<dd>
					<p>
						Gives the radius of the circle explicitly. 
						Negative values are invalid.
			
					<p class='note'>
						Note that percentages are <em>not</em> allowed here; 
						they can only be used to specify the size of an elliptical gradient, 
						not a circular one.  
						This restriction exists because there is are multiple reasonable answers as to which dimension the percentage should be relative to.  
						A future level of this module may provide the ability to size circles with percentages, 
						perhaps with more explicit controls over which dimension is used.
				
			</dl>

			<p>
				If <i>&lt;shape></i> is specified as ''ellipse'' or is omitted, 
				<i>&lt;size></i> may instead be given explicitly as:

			<dl>
				<dt><dfn id='radial-size-ellipse'>[&lt;length> | &lt;percentage>]{2}</dfn>
				<dd>
					Gives the size of the ellipse explicitly. 
					The first value represents the horizontal radius, 
					the second the vertical radius. 
					Percentages values are relative to the corresponding dimension of the <i>gradient box</i>. 
					Negative values are invalid.
			</dl>
	</dl>

	<div class='note'>
		<p>
			Expanded with the above definitions, 
			the grammar becomes:

		<pre><!--
		-->&lt;radial-gradient> = radial-gradient(&#xa;<!--
		-->  [ [ circle               || &lt;length> ]                          [ at &lt;position> ]? , | &#xa;<!--
		-->    [ ellipse              || [ &lt;length> | &lt;percentage> ]{2} ]    [ at &lt;position> ]? , |&#xa;<!--
		-->    [ [ circle | ellipse ] || &lt;extent-keyword> ]                  [ at &lt;position> ]? , |&#xa;<!--
		-->    at &lt;position> ,&#xa;<!--
		-->  ]?&#xa;<!--
		-->  &lt;color-stop> [ , &lt;color-stop> ]+&#xa;<!--
		-->)&#xa;<!--
		-->&lt;extent-keyword> = closest-corner | closest-side | farthest-corner | farthest-side</pre>
	</div>

<h4 class="no-toc" id="radial-color-stops">
Placing Color Stops</h4>

	<p>
		Color-stops are placed on a <dfn>gradient ray</dfn>, 
		similar to the <i>gradient line</i> of linear gradients.  
		The <i>gradient ray</i> is anchored at the center of the gradient 
		and extends toward the right.  
		The 0% location is at the start of the <i>gradient ray</i>, 
		and the 100% location is on the point where the <i>gradient ray</i> intersects the <i>ending shape</i>.  
		A color-stop can be placed at a negative location; 
		though the negative region of the <i>gradient ray</i> is never directly consulted for rendering, 
		color stops placed there can affect the color of non-negative locations on the <i>gradient ray</i> through interpolation or repetition 
		(see <a href='#repeating-gradients'>repeating gradients</a>).  
		For example, ''radial-gradient(red -50px, yellow 100px)'' produces an elliptical gradient 
		that starts with a reddish-orange color in the center 
		(specifically, #f50) 
		and transitions to yellow.  
		Locations greater than 100% simply specify a location a correspondingly greater distance from the center of the gradient.

	<p>
		The color of the gradient at any point is determined by 
		first finding the unique ellipse passing through that point 
		with the same center, orientation, and ratio between major and minor axises as the ending-shape.
		The point's color is then the color of the <i>gradient ray</i> at the location where this ellipse intersects it.

<h4 class="no-toc" id="degenerate-radials">
Degenerate Radial Gradients</h4>

	<p>
		Some combinations of position, size, and shape 
		will produce a circle or ellipse with a radius of 0. 
		This will occur, for example, 
		if the center is on a <i>gradient box</i> edge and ''closest-side'' or ''closest-corner'' is specified 
		or if the size and shape are given explicitly and either of the radiuses is zero.  
		In these degenerate cases, 
		the gradient must be be rendered as follows:

	<dl>
		<dt>If the <i>ending shape</i> is a circle with zero radius:
		<dd>
			Render as if the <i>ending shape</i> was 
			a circle whose radius was an arbitrary very small number greater than zero.  
			<span class='note'>This will make the gradient continue to look like a circle.</span>

		<dt>If the <i>ending shape</i> has zero width (regardless of the height):
		<dd>
			Render as if the <i>ending shape</i> was 
			an ellipse whose height was an arbitrary very large number 
			and whose width was an arbitrary very small number greater than zero.  
			<span class='note'>This will make the gradient look similar to a horizontal linear gradient 
				that is mirrored across the center of the ellipse.  
				It also means that all color-stop positions specified with a percentage resolve to ''0px''.</span>

		<dt>Otherwise, if the <i>ending shape</i> has zero height:
		<dd>
			Render as if the <i>ending shape</i> was 
			an ellipse whose width was an arbitrary very large number 
			and whose height was an arbitrary very small number greater than zero.  
			<span class='note'>This will make the gradient look like a solid-color image 
				equal to the color of the last color-stop, 
				or equal to the average color of the gradient if it's repeating.</span>
	</dl>

<!-- ====================================================================== -->
	
<h4 class='no-toc' id='radial-gradient-examples'>
Radial Gradient Examples</h4>

	<p>
		All of the following examples are applied to a box that is 200px wide and 100px tall.

	<div class=example>	
		<p>
			These examples demonstrate different ways to write the basic syntax for radial gradients:

		<pre><!--
		-->radial-gradient(yellow, green);&#xa;<!--
		-->radial-gradient(ellipse at center, yellow 0%, green 100%);&#xa;<!--
		-->radial-gradient(farthest-corner at 50% 50%, yellow, green);</pre>
		<p><img src="images/radial1.png" alt="" >

		<pre>radial-gradient(circle, yellow, green);</pre>
		<p><img src="images/radial2.png" alt="" >

		<pre>radial-gradient(red, yellow, green);</pre>
		<p><img src="images/radial3.png" alt="" >
	</div>

	<div class=example>	
		<p>
			This image shows a gradient originating from somewhere other than the center of the box:

		<pre>radial-gradient(farthest-side at left bottom, red, yellow 50px, green);</pre>
		<p><img src="images/radial4.png" alt="" >
	</div>

	<div class=example>	
		<p>
			Here we illustrate a 'closest-side' gradient.

		<pre><!--
		-->radial-gradient(closest-side at 20px 30px, red, yellow, green);&#xa;<!--
		-->radial-gradient(20px 30px at 20px 30px, red, yellow, green);</pre>
		<p><img src="images/radial6.png" alt="" >

		<pre><!--
		-->radial-gradient(closest-side circle at 20px 30px, red, yellow, green);&#xa;<!--
		-->radial-gradient(20px 20px at 20px 30px, red, yellow, green);</pre>
		<p><img src="images/radial7.png" alt="" >
	</div>


<!--
RRRRRRRRRRRRRRRRR                                                                                       tttt            iiii                                       
R::::::::::::::::R                                                                                   ttt:::t           i::::i                                      
R::::::RRRRRR:::::R                                                                                  t:::::t            iiii                                       
RR:::::R     R:::::R                                                                                 t:::::t                                                       
  R::::R     R:::::R    eeeeeeeeeeee    ppppp   ppppppppp       eeeeeeeeeeee    aaaaaaaaaaaaa  ttttttt:::::ttttttt    iiiiiiinnnn  nnnnnnnn       ggggggggg   ggggg
  R::::R     R:::::R  ee::::::::::::ee  p::::ppp:::::::::p    ee::::::::::::ee  a::::::::::::a t:::::::::::::::::t    i:::::in:::nn::::::::nn    g:::::::::ggg::::g
  R::::RRRRRR:::::R  e::::::eeeee:::::eep:::::::::::::::::p  e::::::eeeee:::::eeaaaaaaaaa:::::at:::::::::::::::::t     i::::in::::::::::::::nn  g:::::::::::::::::g
  R:::::::::::::RR  e::::::e     e:::::epp::::::ppppp::::::pe::::::e     e:::::e         a::::atttttt:::::::tttttt     i::::inn:::::::::::::::ng::::::ggggg::::::gg
  R::::RRRRRR:::::R e:::::::eeeee::::::e p:::::p     p:::::pe:::::::eeeee::::::e  aaaaaaa:::::a      t:::::t           i::::i  n:::::nnnn:::::ng:::::g     g:::::g 
  R::::R     R:::::Re:::::::::::::::::e  p:::::p     p:::::pe:::::::::::::::::e aa::::::::::::a      t:::::t           i::::i  n::::n    n::::ng:::::g     g:::::g 
  R::::R     R:::::Re::::::eeeeeeeeeee   p:::::p     p:::::pe::::::eeeeeeeeeee a::::aaaa::::::a      t:::::t           i::::i  n::::n    n::::ng:::::g     g:::::g 
  R::::R     R:::::Re:::::::e            p:::::p    p::::::pe:::::::e         a::::a    a:::::a      t:::::t    tttttt i::::i  n::::n    n::::ng::::::g    g:::::g 
RR:::::R     R:::::Re::::::::e           p:::::ppppp:::::::pe::::::::e        a::::a    a:::::a      t::::::tttt:::::ti::::::i n::::n    n::::ng:::::::ggggg:::::g 
R::::::R     R:::::R e::::::::eeeeeeee   p::::::::::::::::p  e::::::::eeeeeeeea:::::aaaa::::::a      tt::::::::::::::ti::::::i n::::n    n::::n g::::::::::::::::g 
R::::::R     R:::::R  ee:::::::::::::e   p::::::::::::::pp    ee:::::::::::::e a::::::::::aa:::a       tt:::::::::::tti::::::i n::::n    n::::n  gg::::::::::::::g 
RRRRRRRR     RRRRRRR    eeeeeeeeeeeeee   p::::::pppppppp        eeeeeeeeeeeeee  aaaaaaaaaa  aaaa         ttttttttttt  iiiiiiii nnnnnn    nnnnnn    gggggggg::::::g 
                                         p:::::p                                                                                                           g:::::g 
                                         p:::::p                                                                                               gggggg      g:::::g 
                                        p:::::::p                                                                                              g:::::gg   gg:::::g 
                                        p:::::::p                                                                                               g::::::ggg:::::::g 
                                        p:::::::p                                                                                                gg:::::::::::::g  
                                        ppppppppp                                                                                                  ggg::::::ggg    

-->


<h3 id='repeating-gradients'>
Repeating Gradients: the ''repeating-linear-gradient()'' and ''repeating-radial-gradient()'' notations</h3>

	<p>
		In addition to <i>&lt;linear-gradient></i> and <i>&lt;radial-gradient></i>, 
		this specification defines <dfn id='repeating-linear-gradient-type'>&lt;repeating-linear-gradient></dfn> 
		and <dfn id='repeating-radial-gradient-type'>&lt;repeating-radial-gradient></dfn> values.  
		These two notations take the same values 
		and are interpreted the same 
		as their respective non-repeating siblings defined previously.

	<p>
		When rendered, however, the color-stops are repeated infinitely in both directions, 
		with their positions shifted by multiples of the difference between 
		the last specified color-stop's position 
		and the first specified color-stop's position.  
		For example, ''repeating-linear-gradient(red 10px, blue 50px)'' 
		is equivalent to ''linear-gradient(..., red -30px, blue 10px, red 10px, blue 50px, red 50px, blue 90px, ...)''. 
		Note that the last color-stop and first color-stop will always coincide at the boundaries of each group, 
		which will produce sharp transitions if the gradient does not start and end with the same color.

	<div class=example>
		<p>
			Repeating gradient syntax is identical to that of non-repeating gradients:

		<pre>repeating-linear-gradient(red, blue 20px, red 40px)</pre>
		<p><img src="images/repeating1.png" alt="">

		<pre>repeating-radial-gradient(red, blue 20px, red 40px)</pre>
		<p><img src="images/repeating2.png" alt="">

		<pre>repeating-radial-gradient(circle closest-side at 20px 30px, red, yellow, green 100%, yellow 150%, red 200%)</pre>
		<p><img src="images/repeating3.png" alt="">
		</div>

	<p>
		If the distance between the first and last color-stops is non-zero, 
		but is small enough that the implementation knows that the physical resolution of the output device is insufficient to faithfully render the gradient, 
		the implementation must <i title="gradient-average-color">find the average color of the gradient</i> 
		and render the gradient as a solid-color image equal to the average color.

	<p>
		If the distance between the first and last color-stops is zero 
		(or rounds to zero due to implementation limitations), 
		the implementation must <i title="gradient-average-color">find the average color of a gradient</i> 
		with the same number and color of color-stops, 
		but with the first and last color-stop an arbitrary non-zero distance apart, 
		and the remaining color-stops equally spaced between them.  
		Then it must render the gradient as a solid-color image equal to that average color.

	<p>
		If the height of a repeating radial gradient is zero, 
		or is close enough to zero that the implementation knows that the physical resolution of the output device is insufficient to faithfully render the gradient, 
		the implementation must <i title="gradient-average-color">find the average color of the gradient</i> 
		and render the gradient as a solid-color image equal to the average color.

	<p>
		To <dfn title="gradient-average-color">find the average color of a gradient</dfn>, 
		run these steps:

	<ol>
		<li>
			Define <var>list</var> as an initially-empty list of premultiplied RGBA colors,
			and <var>total-length</var> as the distance between first and last color stops.

		<li>
			For each adjacent pair of color-stops, 
			define <var>weight</var> as half the distance between the two color-stops, 
			divided by <var>total-length</var>.  
			Add two entries to <var>list</var>, 
			the first obtained by representing the color of the first color-stop in premultiplied sRGBA 
			and scaling all of the components by <var>weight</var>, 
			and the second obtained in the same way with the second color-stop.

		<li>
			Sum the entries of <var>list</var> component-wise to produce the average color, 
			and return it.
	</ol>

	<p class='note'>
		As usual, implementations may use whatever algorithm they wish, 
		so long as it produces the same result as the above.

	<div class='example'>
		<p>
			For example, the following gradient is rendered as a solid light-purple image (equal to <code>rgb(75%,50%,75%)</code>):
		
		<pre class="css">repeating-linear-gradient(red 0px, white 0px, blue 0px);</pre>

		<p>
			The following gradient would render the same as the previous under normal circumstances 
			(because desktop monitors can't faithfully render color-stops 1/10th of a pixel apart), 
			but would render as a normal repeating gradient if, for example, 
			the author applied "zoom:100;" to the element on which the gradient appears:

		<pre class="css">repeating-linear-gradient(red 0px, white .1px, blue .2px);</pre>
	</div>


<!--
   SSSSSSSSSSSSSSS      tttt                                                                
 SS:::::::::::::::S  ttt:::t                                                                
S:::::SSSSSS::::::S  t:::::t                                                                
S:::::S     SSSSSSS  t:::::t                                                                
S:::::S        ttttttt:::::ttttttt       ooooooooooo   ppppp   ppppppppp       ssssssssss   
S:::::S        t:::::::::::::::::t     oo:::::::::::oo p::::ppp:::::::::p    ss::::::::::s  
 S::::SSSS     t:::::::::::::::::t    o:::::::::::::::op:::::::::::::::::p ss:::::::::::::s 
  SS::::::SSSSStttttt:::::::tttttt    o:::::ooooo:::::opp::::::ppppp::::::ps::::::ssss:::::s
    SSS::::::::SS    t:::::t          o::::o     o::::o p:::::p     p:::::p s:::::s  ssssss 
       SSSSSS::::S   t:::::t          o::::o     o::::o p:::::p     p:::::p   s::::::s      
            S:::::S  t:::::t          o::::o     o::::o p:::::p     p:::::p      s::::::s   
            S:::::S  t:::::t    tttttto::::o     o::::o p:::::p    p::::::pssssss   s:::::s 
SSSSSSS     S:::::S  t::::::tttt:::::to:::::ooooo:::::o p:::::ppppp:::::::ps:::::ssss::::::s
S::::::SSSSSS:::::S  tt::::::::::::::to:::::::::::::::o p::::::::::::::::p s::::::::::::::s 
S:::::::::::::::SS     tt:::::::::::tt oo:::::::::::oo  p::::::::::::::pp   s:::::::::::ss  
 SSSSSSSSSSSSSSS         ttttttttttt     ooooooooooo    p::::::pppppppp      sssssssssss    
                                                        p:::::p                             
                                                        p:::::p                             
                                                       p:::::::p                            
                                                       p:::::::p                            
                                                       p:::::::p                            
                                                       ppppppppp    
-->


<h3 id='color-stop-syntax'>
Gradient Color-Stops</h3>

	<pre class=prod><dfn id='color-stop-type'>&lt;color-stop></dfn> = &lt;color> [ &lt;percentage> | &lt;length> ]?</pre>

	<p>
		Color-stops are points placed along the line 
		defined by the <i>gradient line</i> at the beginning of the rule. 
		Color-stops must be specified in order. 
		Percentages refer to the length of the gradient line, 
		with 0% being at the starting point 
		and 100% being at the ending point. 
		Lengths are measured from the starting point in the direction of the ending point.  
		Color-stops are usually placed between the starting point and ending point, 
		but that's not required; 
		the gradient line extends infinitely in both directions, 
		and a color-stop can be placed at any position on the line.

	<p>
		At each color-stop, 
		the line is the color of the color-stop.  
		Between two color-stops, 
		the line's color is linearly interpolated between the colors of the two color-stops, 
		with the interpolation taking place in premultiplied RGBA space.  
		Before the first color-stop, 
		the line is the color of the first color-stop.  
		After the last color-stop, the line is the color of the last color-stop.

	<p>
		The following steps must be applied <em>in order</em> to process the list of color-stops.  
		After applying these rules, 
		all color-stops will have a definite position 
		and they will be in ascending order:

	<ol>
		<li>
			If the first color-stop does not have a position, 
			set its position to 0%. 
			If the last color-stop does not have a position, 
			set its position to 100%.

		<li>
			If a color-stop has a position that is less than the specified position of any color-stop before it in the list, 
			set its position to be equal to the largest specified position of any color-stop before it.

		<li>
			If any color-stop still does not have a position, 
			then, for each run of adjacent color-stops without positions, 
			set their positions so that they are evenly spaced between the preceding and following color-stops with positions.
	</ol>

	<p>
		If multiple color-stops have the same position, 
		they produce an infinitesimal transition from the one specified first in the rule 
		to the one specified last.  
		In effect, the color suddenly changes at that position rather than smoothly transitioning.

	<div class=example>
		<p>
			Below are several pairs of gradients.  
			The latter of each pair is a manually "fixed-up" version of the former, 
			obtained by applying the above rules.  
			For each pair, both gradients will render identically.  
			<span class='note'>The numbers in each arrow specify which fixup steps are invoked in the transformation.</span>

		<pre><!--
		-->1. linear-gradient(red, white 20%, blue)&#xa;<!--
		-->   =1=>&#xa;<!--
		-->   linear-gradient(red 0%, white 20%, blue 100%)&#xa;<!--
		-->&#xa;<!--
		-->2. linear-gradient(red 40%, white, black, blue)&#xa;<!--
		-->   =13=>&#xa;<!--
		-->   linear-gradient(red 40%, white 60%, black 80%, blue 100%)&#xa;<!--
		-->&#xa;<!--
		-->3. linear-gradient(red -50%, white, blue)&#xa;<!--
		-->   =13=>&#xa;<!--
		-->   linear-gradient(red -50%, white 25%, blue 100%)&#xa;<!--
		-->&#xa;<!--
		-->4. linear-gradient(red -50px, white, blue)&#xa;<!--
		-->   =13=>&#xa;<!--
		-->   linear-gradient(red -50px, white calc(-25px + 50%), blue 100%)&#xa;<!--
		-->&#xa;<!--
		-->5. linear-gradient(red 20px, white 0px, blue 40px)&#xa;<!--
		-->   =2=>&#xa;<!--
		-->   linear-gradient(red 20px, white 20px, blue 40px)&#xa;<!--
		-->&#xa;<!--
		-->6. linear-gradient(red, white -50%, black 150%, blue)&#xa;<!--
		-->   =12=>&#xa;<!--
		-->   linear-gradient(red 0%, white 0%, black 150%, blue 150%)&#xa;<!--
		-->&#xa;<!--
		-->7. linear-gradient(red 80px, white 0px, black, blue 100px)&#xa;<!--
		-->   =23=>&#xa;<!--
		-->   linear-gradient(red 80px, white 80px, black 90px, blue 100px)</pre>
	</div>

	<div class=example>
		<p>
			The following example illustrates the difference between 
			a gradient transitioning in pre-multiplied sRGBA 
			and one transitioning (incorrectly) in non-premultiplied.  
			In both of these example, 
			the gradient is drawn over a white background.  
			Both gradients could be written with the following value:

		<pre>linear-gradient(90deg, red, transparent, blue)</pre>

		<p>
			In premultiplied space, 
			transitions to or from "transparent" always look nice:

		<p><object data="gradient2.svg" width="200"
			height="100">(Image requires SVG)</object>

		<p>
			On the other hand, 
			if a gradient were to incorrectly transition in non-premultiplied space, 
			the colors near "transparent" would noticeably darken to a grayish color, 
			because "transparent" is actually a shorthand for ''rgba(0,0,0,0)'', or transparent black:

		<p><object data="gradient3.svg" width="200"
			height="100">(Image requires SVG)</object>
	</div>

	<p class=note>
		Note: It is recommended that authors not mix different types of units, 
		such as px, em, or %, 
		in a single rule, 
		as this can cause a color-stop to unintentionally try to move before an earlier one.  
		For example, the rule ''background-image: linear-gradient(yellow 100px, blue 50%)'' 
		wouldn't require any fix-up as long as the background area is at least 200px tall. 
		If it was 150px tall, however, 
		the blue color-stop's position would be equivalent to "75px", 
		which precedes the yellow color-stop, 
		and would be corrected to a position of 100px.

	<p class=note>
		Note: The definition and implications of "premultiplied" color spaces are given elsewhere in the technical literature, 
		but a quick primer is given here to illuminate the process.  
		Given a color expressed as an rgba() 4-tuple, 
		one can convert this to a premultiplied representation 
		by multiplying the red, green, and blue components by the alpha component.  
		For example, a partially-transparent blue may be given as rgba(0,0,255,.5), 
		which would then be expressed as [0, 0, 127.5, .5] in its premultiplied representation. 
		Interpolating colors using the premultiplied representations 
		rather than the plain rgba representations 
		tends to produce more attractive transitions, 
		particularly when transitioning from a fully opaque color to fully transparent. 
		Note that transitions where either the transparency or the color are held constant 
		(for example, transitioning between rgba(255,0,0,100%) and rgba(0,0,255,100%) or rgba(255,0,0,100%) and rgba(255,0,0,0%)) 
		have identical results whether the color interpolation is done in premultiplied or non-premultiplied color-space.  
		Differences only arise when both the color and transparency differ between the two endpoints.


<!--
   SSSSSSSSSSSSSSS   iiii                     iiii                                       
 SS:::::::::::::::S i::::i                   i::::i                                      
S:::::SSSSSS::::::S  iiii                     iiii                                       
S:::::S     SSSSSSS                                                                      
S:::::S            iiiiiii zzzzzzzzzzzzzzzzziiiiiiinnnn  nnnnnnnn       ggggggggg   ggggg
S:::::S            i:::::i z:::::::::::::::zi:::::in:::nn::::::::nn    g:::::::::ggg::::g
 S::::SSSS          i::::i z::::::::::::::z  i::::in::::::::::::::nn  g:::::::::::::::::g
  SS::::::SSSSS     i::::i zzzzzzzz::::::z   i::::inn:::::::::::::::ng::::::ggggg::::::gg
    SSS::::::::SS   i::::i       z::::::z    i::::i  n:::::nnnn:::::ng:::::g     g:::::g 
       SSSSSS::::S  i::::i      z::::::z     i::::i  n::::n    n::::ng:::::g     g:::::g 
            S:::::S i::::i     z::::::z      i::::i  n::::n    n::::ng:::::g     g:::::g 
            S:::::S i::::i    z::::::z       i::::i  n::::n    n::::ng::::::g    g:::::g 
SSSSSSS     S:::::Si::::::i  z::::::zzzzzzzzi::::::i n::::n    n::::ng:::::::ggggg:::::g 
S::::::SSSSSS:::::Si::::::i z::::::::::::::zi::::::i n::::n    n::::n g::::::::::::::::g 
S:::::::::::::::SS i::::::iz:::::::::::::::zi::::::i n::::n    n::::n  gg::::::::::::::g 
 SSSSSSSSSSSSSSS   iiiiiiiizzzzzzzzzzzzzzzzziiiiiiii nnnnnn    nnnnnn    gggggggg::::::g 
                                                                                 g:::::g 
                                                                     gggggg      g:::::g 
                                                                     g:::::gg   gg:::::g 
                                                                      g::::::ggg:::::::g 
                                                                       gg:::::::::::::g  
                                                                         ggg::::::ggg    
                                                                            gggggg       
-->


<h2 id="sizing">
Sizing Images and Objects in CSS</h2>

	<p>
		Images used in CSS may come from a number of sources: 
		from binary image formats (such as gif, jpeg, etc), 
		dedicated markup formats (such as SVG), 
		and CSS-specific formats (such as the linear-gradient() value type defined in this specification).  
		As well, a document may contain many other types of objects, 
		such as video, plugins, or nested documents.  
		These images and objects 
		(just <dfn>objects</dfn> hereafter) 
		may offer many types of sizing information to CSS, 
		or none at all.  
		This section defines generically the size negotiation model between the object and the CSS layout algorithms.

<!-- ====================================================================== -->

<h3 id="sizing-terms">
Object-Sizing Terminology</h3>

	<p>
		In order to define this handling, 
		we define a few terms, 
		to make it easier to refer to various concepts:

	<dl>
		<dt><dfn>intrinsic dimensions</dfn>
		<dd>
			<p>
				The term intrinsic dimensions refers to the set of 
				the <dfn>intrinsic height</dfn>, 
				<dfn>intrinsic width</dfn>, 
				and <dfn>intrinsic aspect ratio</dfn> 
				(the ratio between the width and height), 
				each of which may or may not exist for a given object. 
				These intrinsic dimensions represent a preferred or natural size of the object itself; 
				that is, they are not a function of the context in which the object is used.  
				CSS does not define how the intrinsic dimensions are found in general.

			<p>
				Raster images are an example of an object with all three intrinsic dimensions.  
				SVG images designed to scale might have only an intrinsic aspect ratio; 
				SVG images can also be created with only an intrinsic width or height.  
				CSS gradients, defined in this specification, are an example of an object with no intrinsic dimensions at all.  
				Another example of this is embedded documents, 
				such as the <code>&lt;iframe></code> element in HTML.  
				An object cannot have only two intrinsic dimensions, 
				as any two automatically define the third.

			<p>
				If an object (such as an icon) has multiple sizes, 
				then the largest size (by area) is taken as its intrinsic size. 
				If it has multiple aspect ratios at that size, 
				or has multiple aspect ratios and no size, 
				then the aspect ratio closest to the aspect ratio of the <i>default object size</i> is used.  
				Determine this by seeing which aspect ratio produces the largest area 
				when fitting it within the <i>default object size</i> using a <i>contain</i> fit; 
				if multiple sizes tie for the largest area, 
				the wider size is chosen as its intrinsic size.
		

		<dt><dfn>specified size</dfn>
		<dd>
			The specified size of an object is given by CSS, 
			such as through the 'width' and 'height' or 'background-size' properties. 
			The specified size can be a definite width and height, 
			a set of constraints, 
			or a combination thereof.

		<dt><dfn>concrete object size</dfn>
		<dd>
			The <i>concrete object size</i> is the result of combining 
			an object's <i>intrinsic dimensions</i> and <i>specified size</i> 
			with the <i>default object size</i> of the context it's used in, 
			producing a rectangle with a definite width and height.

		<dt><dfn>default object size</dfn>
		<dd>
			<p>
				The <i>default object size</i> is a rectangle with a definite height and width 
				used to determine the <i>concrete object size</i> 
				when both the <i>intrinsic dimensions</i> and <i>specified size</i> are missing dimensions.
		
	</dl>

<!-- ====================================================================== -->

<h3 id="object-negotiation">
CSS&#x21CB;Object Negotiation</h3>

	<p>Objects in CSS are sized and rendered as follows:

	<ol>
		<li>
			When an image or object is specified in a document, 
			such as through a ''url()'' value in a 'background-image' property 
			or a <code>src</code> attribute on an <code>&lt;img></code> element, 
			CSS queries the object for its <i>intrinsic dimensions</i>.

		<li>
			Using the <i>intrinsic dimensions</i>, 
			the <i>specified size</i>, 
			and the <i>default object size</i> for the context the image or object is used in, 
			CSS then computes a <i>concrete object size</i>. 
			(See the <a href="#default-sizing">following section</a>.) 
			This defines the size and position of the region the object will render in.

		<li>
			CSS asks the object to render itself at the <i>concrete object size</i>. 
			CSS does not define how objects render when the <i>concrete object size</i> is different from the object's <i>intrinsic dimensions</i>. 
			The object may adjust itself to match the <i>concrete object size</i> in some way, 
			or even render itself larger or smaller than the <i>concrete object size</i> to satisfy sizing constraints of its own.

		<li>
			Unless otherwise specified by CSS, 
			the object is then clipped to the <i>concrete object size</i>.
	</ol>

<!-- ====================================================================== -->

<h3 id="concrete-size-resolution">
Concrete Object Size Resolution</h3>

	<p>
		Currently the rules for sizing objects are described in each context that such objects are used. 
		This section defines some common sizing constraints 
		and how to resolve them 
		so that future specs can refer to them instead of redefining size resolution in each instance.

<h4 id="default-sizing">
Default Sizing Algorithm</h4>

	<p>
		The <dfn>default sizing algorithm</dfn> is a set of rules commonly used to find an object's <i>concrete object size</i>. 
		It resolves the simultaneous constraints presented by the object's <i>intrinsic dimensions</i> 
		and either an unconstrained <i>specified size</i> 
		or one consisting of only a definite width and/or height.

	<p>
		Some object sizing rules 
		(such as those for 'list-style-image') 
		correspond exactly to the <i>default sizing algorithm</i>. 
		Others 
		(such as those for 'border-image') 
		invoke the default sizing algorithm 
		but also apply additional sizing rules before arriving at a final <i>concrete object size</i>.

	<p>
		The <i>default sizing algorithm</i> is defined as follows:

	<ul>
		<li>
			If the <i>specified size</i> is a definite width and height, 
			the <i>concrete object size</i> is given that width and height.

		<li>
			If the <i>specified size</i> is only a width or height (but not both) 
			then the <i>concrete object size</i> is given that specified width or height. 
			The other dimension is calculated as follows:

			<ol>
				<li>
					If the object has an <i>intrinsic aspect ratio</i>, 
					the missing dimension of the <i>concrete object size</i> 
					is calculated using the <i>intrinsic aspect ratio</i> and the present dimension.

				<li>
					Otherwise, if the missing dimension is present in the object's <i>intrinsic dimensions</i>, 
					the missing dimension is taken from the object's <i>intrinsic dimensions</i>.

				<li>
					Otherwise, the missing dimension of the <i>concrete object size</i> is taken from the <i>default object size</i>.
			</ol>
		

		<li>
			If the <i>specified size</i> has no constraints:

			<ol>
				<li>
					If the object has an intrinsic height or width, 
					its size is resolved as if its <i>intrinsic size</i> were given as the <i>specified size</i>.

				<li>
					Otherwise, its size is resolved as a <i>contain constraint</i> against the <i>default object size</i>.
			</ol>
		
	</ul>

<h4 id="cover-contain">
Cover and Contain Constraint Sizing</h4>

	<p>
		Two other common specified sizes are the <i>contain constraint</i> and the <i>cover constraint</i>, 
		both of which are resolved against a specified <dfn>constraint rectangle</dfn> 
		using the object's <i>intrinsic aspect ratio</i>:

	<ul>
		<li>
			A <dfn>contain constraint</dfn> is resolved 
			by setting the <i>concrete object size</i> to the largest rectangle that has the object's <i>intrinsic aspect ratio</i> 
			and additionally has neither width nor height larger than the constraint rectangle's width and height, respectively.

		<li>
			A <dfn>cover constraint</dfn> is resolved 
			by setting the <i>concrete object size</i> to the smallest rectangle that has the object's <i>intrinsic aspect ratio</i> 
			and additionally has neither width nor height smaller than the constraint rectangle's width and height, respectively.
	</ul>

	<p>
		In both cases, 
		if the object doesn't have an intrinsic aspect ratio, 
		the <i>concrete object size</i> is the specified constraint rectangle.

<h3 id='object-sizing-examples'>
Examples of CSS Object Sizing</h3>

	<div class="example">
		<p>
			The following examples show how the <a href="http://www.w3.org/TR/CSS21/">CSS 2.1</a> 
			and <a href="http://www.w3.org/TR/css3-background/">CSS3 Backgrounds &amp; Borders</a> sizing algorithms 
			correspond to concepts defined in this specification.

		<dl>
			<dt><a href="http://www.w3.org/TR/css3-background/#the-background-image">'background-image'</a>
			<dd>
				The rules for calculating the <i>concrete object size</i> of a background 
				are defined in <a href="http://www.w3.org/TR/CSS21/colors.html#background-properties">CSS2.1§14.2.1</a> 
				and <a href="http://www.w3.org/TR/css3-background/#the-background-size">CSS3BG§3.9</a>. 
				CSS2.1 uses the <i>default sizing algorithm</i> 
				with no <i>specified size</i> 
				and the <i>background positioning area</i> as the <i>default object size</i>. [[!CSS21]] 
				In CSS3, 'background-size' property can give a sizing constraint, 
				invoking either the <i>default sizing algorithm</i> 
				or one of the <i title="contain constraint">contain</i> or <i title="cover constraint">cover</i> constraints. 
				The concrete object size is further adjusted in later steps if 'background-repeat' has a ''round'' value. [[CSS3BG]]

			<dt><a href="http://www.w3.org/TR/CSS21/generate.html#propdef-list-style-image">'list-style-image'</a>
			<dd>
				The rules for calculating the <i>concrete object size</i> of a list-style image 
				are defined in <a href="http://www.w3.org/TR/CSS21/generate.html#propdef-list-style-image">CSS2.1§12.5.1</a>. 
				They use the <i>default sizing algorithm</i> 
				with no <i>specified size</i> 
				and a <i>default object size</i> of 1em square.

			<dt><a href="http://www.w3.org/TR/css3-background/#border-images">'border-image'
			<dd>
				Border images are sized twice: 
				first the entire image is sized to determine the slice points, 
				then the slices are sized to decorate the border.
				The first sizing operation is defined in <a href="http://www.w3.org/TR/css3-background/#the-border-image-slice">CSS3BG§6.2</a> 
				and uses the <i>default sizing algorithm</i> 
				with no <i>specified size</i>, 
				and the <a href="http://www.w3.org/TR/css3-background/#border-image-area">border image area</a> as the <i>default object size</i>.
				The second operation is defined in <a href="http://www.w3.org/TR/css3-background/#border-image-process">CSS3BG§6.2</a>: 
				the <i>default sizing algorithm</i> is used to determine an initial size for each slice 
				with the corresponding <i>border image area</i> part as the default object size. 
				By default the <i>specified size</i> matches this <i>default object size</i>; 
				however the 'border-image-repeat' property can drop the specified size in one or more directions 
				and may also apply an additional rounding step. [[CSS3BG]]
			

			<dt><a href="http://www.w3.org/TR/CSS21/ui.html#cursor-props">'cursor'</a>
			<dd>
				The rules for calculating the <i>concrete object size</i> of a cursor 
				are defined in <a href="http://www.w3.org/TR/CSS21/ui.html#cursor-props">CSS2.1 § 18.1: Cursors</a>. 
				The <i>default object size</i> is a UA-defined size 
				that should be based on the size of a typical cursor on the UA's operating system.  [[!CSS21]]

			<dt><a href="http://www.w3.org/TR/CSS21/generate.html#content">'content'</a>
			<dd>
				Objects inserted via the CSS2.1 'content' property 
				are anonymous <a href="http://www.w3.org/TR/CSS21/conform.html#replaced-element">replaced elements</a>, 
				and are sized the same way. [[!CSS21]] 
				Note that such anonymous elements have all their non-inherited properties (including 'width', 'height', etc.) 
				set to their initial values.

			<dt><a href="http://www.w3.org/TR/CSS21/conform.html#replaced-element">replaced elements</a>
			<dd>
				<a href="http://www.w3.org/TR/CSS21/">CSS 2.1</a> defines the sizing of replaced elements 
				(including those inserted as <a href="http://www.w3.org/TR/CSS21/generate.html#content">generated content</a> via 'content') 
				in sections <a href="http://www.w3.org/TR/CSS21/visudet.html#inline-replaced-width">10.3.2</a>, 
				<a href="http://www.w3.org/TR/CSS2/visudet.html#min-max-widths">10.4</a>, 
				<a href="http://www.w3.org/TR/CSS21/visudet.html#inline-replaced-height">10.6.2</a>, 
				and <a href="http://www.w3.org/TR/CSS2/visudet.html#min-max-heights">10.7</a>. [[!CSS21]] 
				The 'object-fit' property defined below defines how the <i>concrete object size</i> corresponds to the element's used width and height; 
				by default they coincide.
		</dl>
	</div>

<!-- ====================================================================== -->

<h3 id="the-object-fit">
Sizing Objects: the 'object-fit' property</h3>

	<table class="propdef">
		<tr>
			<th>Name:
			<td><dfn>object-fit</dfn>
		<tr>
			<th><a href="#values">Value:</a>
			<td>fill | contain | cover | none | scale-down
		<tr>
			<th>Initial:
			<td>fill
		<tr>
			<th>Applies to:
			<td>replaced elements
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Percentages:
			<td>N/A
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Computed value:
			<td>specified value
	</table>

	<p>
		The 'object-fit' property specifies how the contents of a replaced element 
		should be fitted to the box established by its used height and width.

	<dl>
		<dt>''fill''
		<dd>
			The replaced content is sized to fill the element's content box: 
			the object's <i>concrete object size</i> is the element's used width and height.

		<dt>''contain''
		<dd>
			The replaced content is sized to maintain its aspect ratio 
			while fitting within the element's content box: 
			its <i>concrete object size</i> is resolved as a <i>contain constraint</i> 
			against the element's used width and height.

		<dt>''cover''
		<dd>
			The replaced content is sized to maintain its aspect ratio 
			while filling the element's entire content box: 
			its <i>concrete object size</i> is resolved as a <i>cover constraint</i> 
			against the element's used width and height.

		<dt>''none''
		<dd>
			The replaced content is not resized to fit inside the element's content box: 
			determine the object's <i>concrete object size</i> 
			using the <i>default sizing algorithm</i> with no specified size, 
			and a <i>default object size</i> equal to the replaced element's used width and height.

		<dt>''scale-down''
		<dd>
			<p>
				Size the content as if ''none'' or ''contain'' were specified, 
				whichever would result in a smaller <i>concrete object size</i>.

			<p class=note>
				Note that both ''none'' and ''contain'' respect the content's intrinsic aspect ratio, 
				so the concept of "smaller" is well-defined.
		
	</dl>

	<p>
		If the content does not completely fill the replaced element's content box, 
		the unfilled space shows the replaced element's background. 
		Since replaced elements always clip their contents to the content box, 
		the content will never overflow. 
		See the 'object-position' property for positioning the object with respect to the content box.

	<figure>
		<img src="images/img_scale.png" style="border: thin solid black;" alt>
		
		<figcaption>
			An example showing how four of the values of 'object-fit' cause the replaced element (blue figure) 
			to be scaled to fit its height/width box (shown with a green background), 
			using the initial value for 'object-position'.  
			The fifth value, ''scale-down'', 
			in this case looks identical to ''contain''.
		</figcaption>
	</figure>

	<p class="note">
		Note: the 'object-fit' property has similar semantics to 
		the <code>fit</code> attribute in [[SMIL10]] 
		and the &lt;meetOrSlice> parameter 
		on the <a href="http://www.w3.org/TR/SVG11/coords.html#PreserveAspectRatioAttribute"><code>preserveAspectRatio</code> attribute</a> in [[SVG11]].

	<p class=note>
		Note: Per the <i title=object-negotiation>CSS&#8651;Object Negotiation</i> algorithm, 
		the <i>concrete object size</i> 
		(or, in this case, the size of the content) 
		does not directly scale the object itself - 
		it is merely passed to the object as information about the size of the visible canvas.  
		How to then draw into that size is up to the image format.  
		In particular, raster images always scale to the given size, 
		while SVG uses the given size as the size of the "SVG Viewport" 
		(a term defined by SVG) 
		and then uses the values of several attributes on the root &lt;svg> element to determine how to draw itself.

<!-- ====================================================================== -->

<h3 id="the-object-position">
Positioning Objects: the 'object-position' property</h3>

	<table class="propdef">
		<thead>
			<tr>
				<th>Name:
				<td><dfn>object-position</dfn>
		<tbody>
			<tr>
				<th><a href="#values">Value:</a>
				<td>&lt;position>
			<tr>
				<th>Initial:
				<td>50% 50%
			<tr>
				<th>Applies to:
				<td>replaced elements
			<tr>
				<th>Inherited:
				<td>no
			<tr>
				<th>Percentages:
				<td>refer to width and height of box itself
			<tr>
				<th>Media:
				<td>visual
			<tr>
				<th>Computed value:
				<td>specified value
	</table>

	<p>
		The 'object-position' property determines the alignment of the replaced element inside its box. 
		The <a href="http://www.w3.org/TR/css3-values/#position">&lt;position></a> value type 
		(which is also used for 'background-position') 
		is defined in [[!CSS3VAL]], 
		and is resolved using the <i>concrete object size</i> as the object area 
		and the content box as the positioning area.
	
	<p class="note">
		Note that areas of the box not covered by the replaced element will show the element's background.


<!--
IIIIIIIIII                                                                                 
I::::::::I                                                                                 
I::::::::I                                                                                 
II::::::II                                                                                 
  I::::I     mmmmmmm    mmmmmmm     aaaaaaaaaaaaa     ggggggggg   ggggg    eeeeeeeeeeee    
  I::::I   mm:::::::m  m:::::::mm   a::::::::::::a   g:::::::::ggg::::g  ee::::::::::::ee  
  I::::I  m::::::::::mm::::::::::m  aaaaaaaaa:::::a g:::::::::::::::::g e::::::eeeee:::::ee
  I::::I  m::::::::::::::::::::::m           a::::ag::::::ggggg::::::gge::::::e     e:::::e
  I::::I  m:::::mmm::::::mmm:::::m    aaaaaaa:::::ag:::::g     g:::::g e:::::::eeeee::::::e
  I::::I  m::::m   m::::m   m::::m  aa::::::::::::ag:::::g     g:::::g e:::::::::::::::::e 
  I::::I  m::::m   m::::m   m::::m a::::aaaa::::::ag:::::g     g:::::g e::::::eeeeeeeeeee  
  I::::I  m::::m   m::::m   m::::ma::::a    a:::::ag::::::g    g:::::g e:::::::e           
II::::::IIm::::m   m::::m   m::::ma::::a    a:::::ag:::::::ggggg:::::g e::::::::e          
I::::::::Im::::m   m::::m   m::::ma:::::aaaa::::::a g::::::::::::::::g  e::::::::eeeeeeee  
I::::::::Im::::m   m::::m   m::::m a::::::::::aa:::a gg::::::::::::::g   ee:::::::::::::e  
IIIIIIIIIImmmmmm   mmmmmm   mmmmmm  aaaaaaaaaa  aaaa   gggggggg::::::g     eeeeeeeeeeeeee  
                                                               g:::::g                     
                                                   gggggg      g:::::g                     
                                                   g:::::gg   gg:::::g                     
                                                    g::::::ggg:::::::g                     
                                                     gg:::::::::::::g                      
                                                       ggg::::::ggg                        
                                                          gggggg                           


PPPPPPPPPPPPPPPPP                                                                                                                    iiii                                       
P::::::::::::::::P                                                                                                                  i::::i                                      
P::::::PPPPPP:::::P                                                                                                                  iiii                                       
PP:::::P     P:::::P                                                                                                                                                            
  P::::P     P:::::Prrrrr   rrrrrrrrr      ooooooooooo       cccccccccccccccc    eeeeeeeeeeee        ssssssssss       ssssssssss   iiiiiiinnnn  nnnnnnnn       ggggggggg   ggggg
  P::::P     P:::::Pr::::rrr:::::::::r   oo:::::::::::oo   cc:::::::::::::::c  ee::::::::::::ee    ss::::::::::s    ss::::::::::s  i:::::in:::nn::::::::nn    g:::::::::ggg::::g
  P::::PPPPPP:::::P r:::::::::::::::::r o:::::::::::::::o c:::::::::::::::::c e::::::eeeee:::::eess:::::::::::::s ss:::::::::::::s  i::::in::::::::::::::nn  g:::::::::::::::::g
  P:::::::::::::PP  rr::::::rrrrr::::::ro:::::ooooo:::::oc:::::::cccccc:::::ce::::::e     e:::::es::::::ssss:::::ss::::::ssss:::::s i::::inn:::::::::::::::ng::::::ggggg::::::gg
  P::::PPPPPPPPP     r:::::r     r:::::ro::::o     o::::oc::::::c     ccccccce:::::::eeeee::::::e s:::::s  ssssss  s:::::s  ssssss  i::::i  n:::::nnnn:::::ng:::::g     g:::::g 
  P::::P             r:::::r     rrrrrrro::::o     o::::oc:::::c             e:::::::::::::::::e    s::::::s         s::::::s       i::::i  n::::n    n::::ng:::::g     g:::::g 
  P::::P             r:::::r            o::::o     o::::oc:::::c             e::::::eeeeeeeeeee        s::::::s         s::::::s    i::::i  n::::n    n::::ng:::::g     g:::::g 
  P::::P             r:::::r            o::::o     o::::oc::::::c     ccccccce:::::::e           ssssss   s:::::s ssssss   s:::::s  i::::i  n::::n    n::::ng::::::g    g:::::g 
PP::::::PP           r:::::r            o:::::ooooo:::::oc:::::::cccccc:::::ce::::::::e          s:::::ssss::::::ss:::::ssss::::::si::::::i n::::n    n::::ng:::::::ggggg:::::g 
P::::::::P           r:::::r            o:::::::::::::::o c:::::::::::::::::c e::::::::eeeeeeee  s::::::::::::::s s::::::::::::::s i::::::i n::::n    n::::n g::::::::::::::::g 
P::::::::P           r:::::r             oo:::::::::::oo   cc:::::::::::::::c  ee:::::::::::::e   s:::::::::::ss   s:::::::::::ss  i::::::i n::::n    n::::n  gg::::::::::::::g 
PPPPPPPPPP           rrrrrrr               ooooooooooo       cccccccccccccccc    eeeeeeeeeeeeee    sssssssssss      sssssssssss    iiiiiiii nnnnnn    nnnnnn    gggggggg::::::g 
                                                                                                                                                                        g:::::g 
                                                                                                                                                            gggggg      g:::::g 
                                                                                                                                                            g:::::gg   gg:::::g 
                                                                                                                                                             g::::::ggg:::::::g 
                                                                                                                                                              gg:::::::::::::g  
                                                                                                                                                                ggg::::::ggg    
                                                                                                                                                                   gggggg       

-->


<h2 id="image-processing">
Image Processing</h2>

<h3 id="the-image-resolution">
Overriding Image Resolutions: the 'image-resolution' property</h3>

	<p>
		The <i>image resolution</i> is defined as 
		the number of image pixels per unit length, 
		e.g., pixels per inch. 
		Some image formats can record information about the resolution of images. 
		This information can be helpful when determining the actual size of the image in the formatting process. 
		However, the information can also be wrong, 
		in which case it should be ignored. 
		By default, CSS assumes a resolution of one image pixel per CSS ''px'' unit; 
		however, the 'image-resolution' property allows using some other resolution.

	<table class="propdef">
		<tr>
			<th>Name:
			<td><dfn>image-resolution</dfn>
		<tr>
			<th><a href="#values">Value:</a>
			<td>[from-image || &lt;resolution>] && snap?
		<tr>
			<th>Initial:
			<td>1dppx
		<tr>
			<th>Applies to:
			<td>all elements
		<tr>
			<th>Inherited:
			<td>yes
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Computed value:
			<td>as specified, except with ''&lt;resolution>'' possibly altered by computing for ''snap'' (see below)
	</table>

	<p>
		The 'image-resolution' property specifies the <i>intrinsic resolution</i> of all raster images used in or on the element. 
		It affects both content images 
		(e.g. replaced elements and generated content) 
		and decorative images 
		(such as 'background-image').  
		The <dfn>intrinsic resolution</dfn> of an image is used to determine the image's <i>intrinsic dimensions</i>. 
		Values have the following meanings:

	<dl>
		<dt>''&lt;resolution>''
		<dd>
			Specifies the intrinsic resolution explicitly.  
			A "dot" in this case corresponds to a single image pixel.

		<dt>''from-image''
		<dd>
			The image's intrinsic resolution is taken as that specified by the image format. 
			If the image does not specify its own resolution, 
			the explicitly specified resolution is used (if given), 
			else it defaults to ''1dppx''.

		<dt>''snap''
		<dd>
			If the "snap" keyword is provided, 
			the computed ''&lt;resolution>'' (if any) 
			is the specified resolution rounded to the nearest value 
			that would map one image pixel to an integer number of device pixels. 
			If the resolution is taken from the image, 
			then the used intrinsic resolution is the image's native resolution similarly adjusted.
	</dl>

	<p>
		As vector formats such as SVG do not have an intrinsic resolution, 
		this property has no effect on vector images.  

	<div class='example'>
		<p>
			Printers tend to have substantially higher resolution than computer monitors; 
			due to this, an image that looks fine on the screen may look pixellated when printed out. 
			The 'image-resolution' property can be used to embed a high-resolution image into the document 
			and maintain an appropriate size, 
			ensuring attractive display both on screen and on paper:

		<pre><!--
		-->img.high-res {&#xa;<!--
		-->	image-resolution: 300dpi;&#xa;<!--
		-->}</pre>

		<p>
			With this set, an image meant to be 5 inches wide at 300dpi 
			will actually display as 5in wide; 
			without this set, 
			the image would display as approximately 15.6in wide 
			since the image is 15000 image pixels across, 
			and by default CSS displays 96 image pixels per inch.
	</div>


	<div class="example">
		<p>
			Some image formats can encode the image resolution into the image data. 
			This rule specifies that the UA should use the image resolution found in the image itself, 
			falling back to 1 image pixel per CSS ''px'' unit.

		<pre>img { image-resolution: from-image }</pre>

		<p>
			These rules both specify that the UA should use the image resolution found in the image itself, 
			but if the image has no resolution, 
			the resolution is set to ''300dpi'' instead of the default ''1dppx''.

		<pre>&#xa;<!--
		-->img { image-resolution: from-image 300dpi }&#xa;<!--
		-->img { image-resolution: 300dpi from-image }</pre>

	</div>

	<div class="example">
		<p>
			Using this rule, the image resolution is set to 300dpi. 
			(The resolution in the image, if any, is ignored.)

		<pre>img { image-resolution: 300dpi }</pre>

		<p>
			This rule, on the other hand, 
			if used when the screen's resolution is 96dpi, 
			would instead render the image at 288dpi 
			(so that 3 image pixels map to 1 device pixel):

		<pre>img { image-resolution: 300dpi snap; }</pre>

		<p>
			The ''snap'' keyword can also be used when the resolution is taken from the image:

		<pre>img { image-resolution: snap from-image; }</pre>

		<p>
			An image declaring itself as 300dpi will, 
			in the situation above, 
			display at 288dpi 
			(3 image pixels per device pixel) 
			whereas an image declaring 72dpi will render at 96dpi 
			(1 image pixel per device pixel).
	</div>


<!-- ====================================================================== -->

<h3 id="the-image-orientation">
Orienting an Image on the Page: the 'image-orientation' property</h3>

	<p>
		If a picture is taken with a camera turned on its side, 
		or a document isn't positioned correctly within a scanner, 
		the resultant image may be "sideways" or even upside-down.  
		The 'image-orientation' property provides a way to apply an "out-of-band" rotation to image source data to correctly orient an image.

	<p class='note'>
		Note that some devices will "tag" an image with some metadata indicating its correct orientation, 
		so image viewing software can do the necessary transformation themselves.  
		Due to legacy compatibility restraints, 
		Web browsers are required to ignore this data by default.  
		A future level of this specification is expected to have a value that applies the metadata-specified transformation automatically.

	<p class="note">
		Note that this property is not intended to specify layout transformations 
		such as arbitrary rotation or flipping the image in the horizontal or vertical direction. 
		(See [[CSS3-2D-TRANSFORMS]] for a feature designed to do that.)
		It is also not needed to correctly orient an image when printing in landscape versus portrait orientation, 
		as that rotation is done as part of layout. (See [[CSS3PAGE]].)
		It should only be used to correct incorrectly-oriented images.

	<table class="propdef">
		<tr>
			<th>Name:
			<td><dfn>image-orientation</dfn>
		<tr>
			<th><a href="#values">Value:</a>
			<td>&lt;angle>
		<tr>
			<th>Initial:
			<td>0deg
		<tr>
			<th>Applies to:
			<td>all elements
		<tr>
			<th>Inherited:
			<td>yes
		<tr>
			<th>Media:
			<td>visual
		<tr>
			<th>Computed value:
			<td>specified value, rounded and normalized (see text)
	</table>

	<p>
		This property specifies an orthogonal rotation to be applied to an image before it is laid out. 
		It applies only to content images 
		(e.g. replaced elements and generated content), 
		not decorative images 
		(such as 'background-image').  
		CSS layout processing applies to the image <em>after</em> rotation. 
		This implies, for example:

	<ul>
		<li>
			The intrinsic height and width are derived from the rotated rather than the original image dimensions.

		<li>
			The height (width) property applies to the vertical (horizontal) dimension of the image, 
			<em>after</em> rotation.
	</ul>

	<p>
		Positive values cause the image to be rotated to the right 
		(in a clockwise direction), 
		while negative values cause a rotation to the left. 
		The computed value of the property is calculated 
		by rounding the specified angle to the nearest quarter-turn 
		(90deg, 100grad, .25turn, etc.), 
		rounding away from 0 
		(that is, 45deg is rounded  to 90deg, while -45deg is rounded to -90deg), 
		then moduloing the value by 1 turn (360deg, 400grad, etc.).

	<p>
		The 'image-orientation' property must be applied before any other transformations, 
		such as being specified in the ''image()'' function with an opposite directionality to its context, 
		or using CSS Transforms.

	<div class="example">
		<p>
			The following example rotates the image 90 degrees clockwise:

		<pre><!--
		-->img.ninety     { image-orientation: 90deg }&#xa;<!--
		-->...&#xa;<!--
		-->&lt;img class="ninety" src=... /></pre>

		<p>
			The same effect could be achieved with, for example, 
			an angle of -270deg or 450deg.
	</div>


<!--
IIIIIIIIII                         tttt                                                                              
I::::::::I                      ttt:::t                                                                              
I::::::::I                      t:::::t                                                                              
II::::::II                      t:::::t                                                                              
  I::::Innnn  nnnnnnnn    ttttttt:::::ttttttt        eeeeeeeeeeee    rrrrr   rrrrrrrrr   ppppp   ppppppppp           
  I::::In:::nn::::::::nn  t:::::::::::::::::t      ee::::::::::::ee  r::::rrr:::::::::r  p::::ppp:::::::::p          
  I::::In::::::::::::::nn t:::::::::::::::::t     e::::::eeeee:::::eer:::::::::::::::::r p:::::::::::::::::p         
  I::::Inn:::::::::::::::ntttttt:::::::tttttt    e::::::e     e:::::err::::::rrrrr::::::rpp::::::ppppp::::::p        
  I::::I  n:::::nnnn:::::n      t:::::t          e:::::::eeeee::::::e r:::::r     r:::::r p:::::p     p:::::p        
  I::::I  n::::n    n::::n      t:::::t          e:::::::::::::::::e  r:::::r     rrrrrrr p:::::p     p:::::p        
  I::::I  n::::n    n::::n      t:::::t          e::::::eeeeeeeeeee   r:::::r             p:::::p     p:::::p        
  I::::I  n::::n    n::::n      t:::::t    tttttte:::::::e            r:::::r             p:::::p    p::::::p        
II::::::IIn::::n    n::::n      t::::::tttt:::::te::::::::e           r:::::r             p:::::ppppp:::::::p        
I::::::::In::::n    n::::n      tt::::::::::::::t e::::::::eeeeeeee   r:::::r             p::::::::::::::::p  ...... 
I::::::::In::::n    n::::n        tt:::::::::::tt  ee:::::::::::::e   r:::::r             p::::::::::::::pp   .::::. 
IIIIIIIIIInnnnnn    nnnnnn          ttttttttttt      eeeeeeeeeeeeee   rrrrrrr             p::::::pppppppp     ...... 
                                                                                          p:::::p                    
                                                                                          p:::::p                    
                                                                                         p:::::::p                   
                                                                                         p:::::::p                   
                                                                                         p:::::::p                   
                                                                                         ppppppppp                   
-->

<h2 id='interpolation'>
Interpolation</h2>

	<p>
		This section describes how to interpolate between new value types defined in this specification, 
		for use with modules such as CSS Transitions and CSS Animations.

	<p>
		If an algorithm below simply states that two values should be "interpolated" or "transitioned" without further details, 
		then the value should be interpolated as described by the Transitions spec.  
		Otherwise, the algorithm may reference a variable "t" in its detailed description of the interpolation.  
		This is a number which starts at 0% and goes to 100%, 
		and is set to a value that represents the progress through the transition, 
		based on the duration of the transition, 
		the elapsed time, 
		and the timing function in use.  
		For example, with a linear timing function and a 1s duration, 
		after .3s t is equal to 30%.

<h3 id='interpolating-images'>
Interpolating <i>&lt;image></i></h3>

	<p>
		All images can be interpolated, 
		though some special types of images 
		(like some gradients) 
		have their own special interpolation rules.  
		In general terms, 
		images are interpolated by scaling them to the size of the start image 
		and cross-fading the two while they transition to the size of the end image.

	<p>
		In specific terms, 
		at each point in the interpolation 
		the image is equal to <code>cross-fade(&lt;start image>, &lt;end image>, t)</code>.


<h3 id='interpolating-image-combinations'>
Interpolating <i>&lt;image-combination></i></h3>

	<p>
		Combinations of the same images at different progress points can be smoothly animated by simply animating the progress.  
		Theoretically, this produces the same visual effect as the generic &lt;image> interpolation would; 
		in practice, implementations may have slight differences due to how they scale or rasterize images.  
		Additionally, the generic &lt;image> interpolation produces nested cross-fade() functions, 
		which is undesirable if it can be avoided.

	<p>
		If both the starting and ending images are &lt;image-combination>s with the same image arguments, 
		they must be interpolated by interpolating their third argument, 
		the percentage.  
		Otherwise, they must be interpolated as generic &lt;image>s.


<h3 id='interpolating-gradients'>
Interpolating <i>&lt;gradient></i></h3>

	<p>
		Gradient images can be interpolated directly in CSS transitions and animations, 
		smoothly animating from one gradient to another.  
		There are only a few restrictions on what gradients are allowed to be interpolated:

	<ol>
		<li>
			Both the starting and ending gradient must be expressed with the same function.  
			(For example, you can transition from a linear-gradient() to a linear-gradient(), 
			but not from a linear-gradient() to a radial-gradient() or a repeating-linear-gradient().)

		<li>
			Both the starting and ending gradient must have the same number of color-stops.  
			For this purpose, a repeating gradient is considered to have infinite color-stops, 
			and thus all repeating gradients have the same number of color-stops.  
			(Note that one may pad a gradient with additional color-stops placed atop each other, 
			if necessary to make two gradients have the same number of color-stops.)
	</ol>

	<p>
		If the two gradients satisfy both of those constraints, 
		they must be interpolated as described below.  
		If not, they must be interpolated as a generic image.

	<ol>
		<li>
			Convert both the start and end gradients to their explicit forms:

			<dl>
				<dt>For linear gradients:
				<dd>
					<ul>
						<li>
							If the direction is specified as an	&lt;angle>, 
							it is already in its explicit form.

						<li>
							Otherwise,
							change its direction to an &lt;angle> in [''0deg'',''360deg'')
							that would produce an equivalent rendering.

						<li>
							If both the start and end gradients had their direction specified with keywords, 
							and the absolute difference between the angles their directions mapped to is greater than 180deg, 
							add 360deg to the direction of the gradient with the smaller angle.  
							<span class='note'>This ensures that a transition from, for example, 
								"to left" (270deg) to "to top" (0deg) 
								rotates the gradient a quarter-turn clockwise, 
								as expected, 
								rather than rotating three-quarters of a turn counter-clockwise.</span>
					</ul>
				
				
				<dt>For radial gradients:
				<dd>
					<ul>
						<li>
							If the size is specified as two &lt;length>s or &lt;percentage>s, 
							it is already in its explicit form.

						<li>
							Otherwise, the size must be changed to a pair of &lt;length>s 
							that would produce an equivalent ending-shape.
					</ul>
				
			</dl>
		

		<li>
			Interpolate each component and color-stop of the gradients independently.  
			For linear gradients, 
			the only component is the angle.  
			For radial gradients, 
			the components are the horizontal and vertical position of the center 
			and the horizontal and vertical axis lengths.

		<li>
			To interpolate a color-stop, 
			first match each color-stop in the start gradient 
			to the corresponding color-stop at the same index in the end gradient.  
			For repeating gradients, 
			the first specified color-stop in the start and end gradients 
			are considered to be at the same index, 
			and all other color-stops following and preceding are indexed appropriately. 
			Then, for each pair of color-stops, 
			interpolate the position and color independently.
	</ol>

<!--
   SSSSSSSSSSSSSSS                                          iiii                    lllllll   iiii                     iiii                                       
 SS:::::::::::::::S                                        i::::i                   l:::::l  i::::i                   i::::i                                      
S:::::SSSSSS::::::S                                         iiii                    l:::::l   iiii                     iiii                                       
S:::::S     SSSSSSS                                                                 l:::::l                                                                       
S:::::S                eeeeeeeeeeee    rrrrr   rrrrrrrrr  iiiiiii   aaaaaaaaaaaaa    l::::l iiiiiii zzzzzzzzzzzzzzzzziiiiiiinnnn  nnnnnnnn       ggggggggg   ggggg
S:::::S              ee::::::::::::ee  r::::rrr:::::::::r i:::::i   a::::::::::::a   l::::l i:::::i z:::::::::::::::zi:::::in:::nn::::::::nn    g:::::::::ggg::::g
 S::::SSSS          e::::::eeeee:::::eer:::::::::::::::::r i::::i   aaaaaaaaa:::::a  l::::l  i::::i z::::::::::::::z  i::::in::::::::::::::nn  g:::::::::::::::::g
  SS::::::SSSSS    e::::::e     e:::::err::::::rrrrr::::::ri::::i            a::::a  l::::l  i::::i zzzzzzzz::::::z   i::::inn:::::::::::::::ng::::::ggggg::::::gg
    SSS::::::::SS  e:::::::eeeee::::::e r:::::r     r:::::ri::::i     aaaaaaa:::::a  l::::l  i::::i       z::::::z    i::::i  n:::::nnnn:::::ng:::::g     g:::::g 
       SSSSSS::::S e:::::::::::::::::e  r:::::r     rrrrrrri::::i   aa::::::::::::a  l::::l  i::::i      z::::::z     i::::i  n::::n    n::::ng:::::g     g:::::g 
            S:::::Se::::::eeeeeeeeeee   r:::::r            i::::i  a::::aaaa::::::a  l::::l  i::::i     z::::::z      i::::i  n::::n    n::::ng:::::g     g:::::g 
            S:::::Se:::::::e            r:::::r            i::::i a::::a    a:::::a  l::::l  i::::i    z::::::z       i::::i  n::::n    n::::ng::::::g    g:::::g 
SSSSSSS     S:::::Se::::::::e           r:::::r           i::::::ia::::a    a:::::a l::::::li::::::i  z::::::zzzzzzzzi::::::i n::::n    n::::ng:::::::ggggg:::::g 
S::::::SSSSSS:::::S e::::::::eeeeeeee   r:::::r           i::::::ia:::::aaaa::::::a l::::::li::::::i z::::::::::::::zi::::::i n::::n    n::::n g::::::::::::::::g 
S:::::::::::::::SS   ee:::::::::::::e   r:::::r           i::::::i a::::::::::aa:::al::::::li::::::iz:::::::::::::::zi::::::i n::::n    n::::n  gg::::::::::::::g 
 SSSSSSSSSSSSSSS       eeeeeeeeeeeeee   rrrrrrr           iiiiiiii  aaaaaaaaaa  aaaalllllllliiiiiiiizzzzzzzzzzzzzzzzziiiiiiii nnnnnn    nnnnnn    gggggggg::::::g 
                                                                                                                                                          g:::::g 
                                                                                                                                              gggggg      g:::::g 
                                                                                                                                              g:::::gg   gg:::::g 
                                                                                                                                               g::::::ggg:::::::g 
                                                                                                                                                gg:::::::::::::g  
                                                                                                                                                  ggg::::::ggg    
                                                                                                                                                     gggggg    
-->

<h2 id='serialization'>
Serialization</h2>

	<p>
		This section describes the serialization of all new properties and value types introduced in this specification, 
		for the purpose of interfacing with the CSS Object Model [[CSSOM]].

	<p>
		All of these algorithms refer to a variable "s".  
		For each, 
		let s initially be the empty string, 
		run the steps described, 
		and then return s.

	<p class='issue'>
		These descriptions are all old, 
		and need to be updated to the current state of the various value types.


<h3 id='serializing-resolution'>
Serializing a &lt;resolution></h3>

	<p>
		The serialization of the <i>&lt;resolution></i> value type is defined in the CSSOM spec.

	<p class=note>
		This spec defines several new units for resolutions.  
		These can all be converted to the canonical "dpcm" unit that CSSOM defines the serialization in terms of.


<h3 id='serializing-url-notation'>
Serializing the ''url()'' notation</h3>

	<p>
		The serialization of the url() function is defined in the CSSOM spec.


<h3 id='serializing-image-notation'>
Serializing the ''image()'' / <i>&lt;image-list></i> notation</h3>

	<p>
		To serialize an <i>&lt;image-list></i>:

	<ol>
		<li>
			Append "image(" to s.

		<li>
			For each argument, 
			serialize the argument as an &lt;image-decl> or &lt;color> as appropriate, 
			and  append it to s.  
			Then, if it is not the final argument, 
			append a comma and a space ", " to s.

		<li>
			Append a close parenthesis ")" to s.
	</ol>

	<p>
		To serialize an <i>&lt;image-decl></i>:

	<ol>
		<li>
			Serialize the first part of the value (the &lt;string>) as a string.

		<li>
			If a &lt;resolution> was provided, 
			append a space " " to s.  
			Then serialize the &lt;resolution> and append it to s.

		<li>
			If the 'snap' keyword was provided, 
			append a space " " and the literal string "snap" to s.

		<li>
			If a directional keyword was provided, 
			append a space " " to s, 
			then append the keyword to s.
	</ol>


<h3 id='serializing-element-notation'>
Serializing the ''element()'' / <i>&lt;element-image></i> notation</h3>

	<p>
		To serialize an <i>&lt;element-image></i>:

	<ol>
		<li>
			Append "element(" to s.

		<li>
			Serialize the argument as a selector or identifier, as appropriate, 
			and append it to s.

		<li>
			Append a close parenthesis ")" to s.
	</ol>


<h3 id='serializing-cross-fade'>
Serializing the ''cross-fade()'' / <i>&lt;image-combination></i> notation</h3>

	<p>
		To serialize an <i>&lt;image-combination></i>:

	<ol>
		<li>
			Append "cross-fade(" to s.

		<li>
			Serialize the first argument to the function as an <i>&lt;image></i>, 
			and append it to s.

		<li>
			Append a comma and a space ", " to s.

		<li>
			Serialize the second argument to the function as an <i>&lt;image></i>, 
			and append it to s.

		<li>
			Append a comma and a space ", " to s.

		<li>
			Serialize the third argument to the function as a &lt;percentage>, 
			and append it to s.

		<li>
			Append a close parenthesis ")" to s.
	</ol>


<h3 id="serializing-gradients">
Serializing Gradients</h3>

	<p>
		To serialize a <i>&lt;linear-gradient></i>:

	<ol>
		<li>
			Append "linear-gradient(" to s.

		<li>
			<ul>
				<li>
					If the first argument to the gradient function was a single keyword, 
					serialize the keyword and append it to s.

				<li>
					Otherwise, 
					if the first argument to the gradient function was two keywords, 
					serialize the vertical keyword (''top'' or ''bottom'') and append it to s, 
					then append a space " " to s, 
					then serialize the horizontal keyword (''left'' or ''right'') and append it to s.

				<li>
					Otherwise, if the first argument to the gradient function was an &lt;angle>, 
					serialize the &lt;angle> and append it to s.

				<li>
					Otherwise, append "top" to s.
			</ul>
		

		<li>
			Append a comma and a space ", " to s.

		<li>
			For each color-stop in the gradient, 
			serialize the color-stop, 
			and append it to s.  
			Then, if it is not the final color-stop, 
			append a comma and a space ", " to s.

		<li>
			Append a close parenthesis ")" to s.
	</ol>

	<p>
		To serialize a <i>&lt;radial-gradient></i>:

	<ol>
		<li>
			Append "radial-gradient(" to s.

		<li>
			If a &lt;bg-position> was specified in the first argument to the gradient function, 
			serialize it and append it to s.  
			Otherwise, append "center" to s.

		<li>
			Append a comma and a space ", " to s.

		<li>
			<ul>
				<li>
					If a &lt;shape> and/or &lt;size> was specified in the second argument to the gradient function:

					<ol>
						<li>
							If a &lt;shape> was specified, 
							serialize it as a keyword and append it to s.  
							Otherwise, append "ellipse" to s.

						<li>
							Append a space " " to s.

						<li>
							If a &lt;size> was specified, 
							serialize it as a keyword and append it to s.  
							Otherwise, append "cover" to s.
					</ol>
				

				<li>
					Otherwise, 
					if two &lt;length>s or &lt;percentage>s were specified in the second argument to the gradient function:

					<ol>
						<li>
							Serialize the first &lt;length> or &lt;percentage> 
							and append it to s.

						<li>
							Append a space " " to s.

						<li>
							Serialize the second &lt;length> or &lt;percentage> 
							and append it to s.
					</ol>
				

				<li>
					Otherwise, append "ellipse cover" to s.
			</ul>
		

		<li>
			Append a comma and a space ", " to s.

		<li>
			For each color-stop in the gradient, 
			serialize the color-stop, 
			and append it to s.  
			Then, if it is not the final color-stop, 
			append a comma and a space ", " to s.

		<li>
			Append a close parenthesis ")" to s.
	</ol>

	<p>
		To serialize a <i>&lt;repeating-linear-gradient></i>:

	<ol>
		<li>
			Append "repeating-linear-gradient(" to s.

		<li>
			Follow the steps for serializing a <i>&lt;linear-gradient></i>, 
			except skip step 1.
	</ol>

	<p>
		To serialize a <i>&lt;repeating-radial-gradient></i>:

	<ol>
		<li>
			Append "repeating-radial-gradient(" to s.

		<li>
			Follow the steps for serializing a <i>&lt;radial-gradient></i>, 
			except skip step 1.
	</ol>

	<p>
		To serialize a <i>&lt;color-stop></i>:

	<ol>
		<li>
			Serialize the &lt;color>, and append it to s.

		<li>
			If a &lt;length> or &lt;percentage> was specified, 
			append a space " " to s, 
			then serialize the &lt;length> or &lt;percentage> and append it to s.
	</ol>


<h3 id='serializing-properties'>
Serializing new properties</h3>

	<p>
		To serialize the 'image-resolution' property:

	<ol>
		<li>
			If the ''from-image'' keyword is specified in the property value, 
			append "from-image" to s.

		<li>
			If both the ''from-image'' keyword and a &lt;resolution> are specified, 
			append a space " " to s.

		<li>
			If a &lt;resolution> is specified, serialize it and append it to s.
	</ol>

	<p>
		To serialize the 'image-orientation' property:

	<ol>
		<li>
			Serialize the &lt;angle> and append it to s.
	</ol>

	<p>
		To serialize the 'image-rendering' property:

	<ol>
		<li>
			Serialize the keyword and append it to s.
	</ol>

	<p>
		To serialize the 'object-fit' property:

	<ol>
		<li>
			Serialize the keyword and append it to s.
	</ol>

	<p>
		To serialize the 'object-position' property:

	<ol>
		<li>
			Serialize the value as a &lt;bg-position> and append it to s.
	</ol>

<!--  
                                                                                                                        dddddddd
TTTTTTTTTTTTTTTTTTTTTTThhhhhhh                                      EEEEEEEEEEEEEEEEEEEEEE                              d::::::d
T:::::::::::::::::::::Th:::::h                                      E::::::::::::::::::::E                              d::::::d
T:::::::::::::::::::::Th:::::h                                      E::::::::::::::::::::E                              d::::::d
T:::::TT:::::::TT:::::Th:::::h                                      EE::::::EEEEEEEEE::::E                              d:::::d 
TTTTTT  T:::::T  TTTTTT h::::h hhhhh           eeeeeeeeeeee           E:::::E       EEEEEEnnnn  nnnnnnnn        ddddddddd:::::d 
        T:::::T         h::::hh:::::hhh      ee::::::::::::ee         E:::::E             n:::nn::::::::nn    dd::::::::::::::d 
        T:::::T         h::::::::::::::hh   e::::::eeeee:::::ee       E::::::EEEEEEEEEE   n::::::::::::::nn  d::::::::::::::::d 
        T:::::T         h:::::::hhh::::::h e::::::e     e:::::e       E:::::::::::::::E   nn:::::::::::::::nd:::::::ddddd:::::d 
        T:::::T         h::::::h   h::::::he:::::::eeeee::::::e       E:::::::::::::::E     n:::::nnnn:::::nd::::::d    d:::::d 
        T:::::T         h:::::h     h:::::he:::::::::::::::::e        E::::::EEEEEEEEEE     n::::n    n::::nd:::::d     d:::::d 
        T:::::T         h:::::h     h:::::he::::::eeeeeeeeeee         E:::::E               n::::n    n::::nd:::::d     d:::::d 
        T:::::T         h:::::h     h:::::he:::::::e                  E:::::E       EEEEEE  n::::n    n::::nd:::::d     d:::::d 
      TT:::::::TT       h:::::h     h:::::he::::::::e               EE::::::EEEEEEEE:::::E  n::::n    n::::nd::::::ddddd::::::dd
      T:::::::::T       h:::::h     h:::::h e::::::::eeeeeeee       E::::::::::::::::::::E  n::::n    n::::n d:::::::::::::::::d
      T:::::::::T       h:::::h     h:::::h  ee:::::::::::::e       E::::::::::::::::::::E  n::::n    n::::n  d:::::::::ddd::::d
      TTTTTTTTTTT       hhhhhhh     hhhhhhh    eeeeeeeeeeeeee       EEEEEEEEEEEEEEEEEEEEEE  nnnnnn    nnnnnn   ddddddddd   ddddd
-->




<h2 id="conformance">
Conformance</h2>

<h3 id="conventions">
Document Conventions</h3>

	<p>Conformance requirements are expressed with a combination of
	descriptive assertions and RFC 2119 terminology. The key words “MUST”,
	“MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
	“RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
	document are to be interpreted as described in RFC 2119.
	However, for readability, these words do not appear in all uppercase
	letters in this specification.
	
	<p>All of the text of this specification is normative except sections
	explicitly marked as non-normative, examples, and notes. [[!RFC2119]]
	
	<p>Examples in this specification are introduced with the words “for example”
	or are set apart from the normative text with <code>class="example"</code>,
	like this:
	
	<div class="example">
		<p>This is an example of an informative example.
	</div>
	
	<p>Informative notes begin with the word “Note” and are set apart from the
	normative text with <code>class="note"</code>, like this:
	
	<p class="note">Note, this is an informative note.

<h3 id="conformance-classes">
Conformance Classes</h3>

	<p>Conformance to CSS Image Values and Replaced Content Module Level 4
	is defined for three conformance classes:
	<dl>
		<dt><dfn title="style sheet!!as conformance class">style sheet</dfn>
			<dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
			style sheet</a>.
		<dt><dfn>renderer</dfn>
			<dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
			that interprets the semantics of a style sheet and renders
			documents that use them.
		<dt><dfn id="authoring-tool">authoring tool</dfn>
			<dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
			that writes a style sheet.
	</dl>
	
	<p>A style sheet is conformant to CSS Image Values and Replaced Content Module Level 4 if all of its statements that use syntax defined in this module are valid according to the generic CSS grammar and the individual grammars of each feature defined in this module.
	
	<p>A renderer is conformant to CSS Image Values and Replaced Content Module Level 4
	if, in addition to interpreting the style sheet as defined by the
	appropriate specifications, it supports all the features defined
	by CSS Image Values and Replaced Content Module Level 4 by parsing them correctly
	and rendering the document accordingly. However, the inability of a
	UA to correctly render a document due to limitations of the device
	does not make the UA non-conformant. (For example, a UA is not
	required to render color on a monochrome monitor.)
	
	<p>An authoring tool is conformant to CSS Image Values and Replaced Content Module Level 4
	if it writes style sheets that are syntactically correct according to the
	generic CSS grammar and the individual grammars of each feature in
	this module, and meet all other conformance requirements of style sheets
	as described in this module.

<h3 id="partial">
Partial Implementations</h3>

	<p>So that authors can exploit the forward-compatible parsing rules to
	assign fallback values, CSS renderers <strong>must</strong>
	treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
	as appropriate</a>) any at-rules, properties, property values, keywords,
	and other syntactic constructs for which they have no usable level of
	support. In particular, user agents <strong>must not</strong> selectively
	ignore unsupported component values and honor supported values in a single
	multi-value property declaration: if any value is considered invalid
	(as unsupported values must be), CSS requires that the entire declaration
	be ignored.
	
<h3 id="experimental">
Experimental Implementations</h3>

	<p>To avoid clashes with future CSS features, the CSS2.1 specification
	reserves a <a href="http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords">prefixed
	syntax</a> for proprietary and experimental extensions to CSS.
	
	<p>Prior to a specification reaching the Candidate Recommendation stage
	in the W3C process, all implementations of a CSS feature are considered
	experimental. The CSS Working Group recommends that implementations
	use a vendor-prefixed syntax for such features, including those in
	W3C Working Drafts. This avoids incompatibilities with future changes
	in the draft.
	
 
<h3 id="testing">Non-Experimental Implementations</h3>

	<p>Once a specification reaches the Candidate Recommendation stage,
	non-experimental implementations are possible, and implementors should
	release an unprefixed implementation of any CR-level feature they
	can demonstrate to be correctly implemented according to spec.
	
	<p>To establish and maintain the interoperability of CSS across
	implementations, the CSS Working Group requests that non-experimental
	CSS renderers submit an implementation report (and, if necessary, the
	testcases used for that implementation report) to the W3C before
	releasing an unprefixed implementation of any CSS features. Testcases
	submitted to W3C are subject to review and correction by the CSS
	Working Group.
	
	<p>Further information on submitting testcases and implementation reports
	can be found from on the CSS Working Group's website at
	<a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
	Questions should be directed to the
	<a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>
	mailing list.

<h3 id="cr-exit-criteria">
CR Exit Criteria</h3>

	<p>For this specification to be advanced to Proposed Recommendation,
	there must be at least two independent, interoperable implementations
	of each feature. Each feature may be implemented by a different set of
	products, there is no requirement that all features be implemented by
	a single product. For the purposes of this criterion, we define the
	following terms:
	
	<dl>
		<dt>independent <dd>each implementation must be developed by a
		different party and cannot share, reuse, or derive from code
		used by another qualifying implementation. Sections of code that
		have no bearing on the implementation of this specification are
		exempt from this requirement.
	
		<dt>interoperable <dd>passing the respective test case(s) in the
		official CSS test suite, or, if the implementation is not a Web
		browser, an equivalent test. Every relevant test in the test
		suite should have an equivalent test created if such a user
		agent (UA) is to be used to claim interoperability. In addition
		if such a UA is to be used to claim interoperability, then there
		must one or more additional UAs which can also pass those
		equivalent tests in the same way for the purpose of
		interoperability. The equivalent tests must be made publicly
		available for the purposes of peer review.
	
		<dt>implementation <dd>a user agent which:
	
		<ol class=inline>
			<li>implements the specification.
	
			<li>is available to the general public. The implementation may
			be a shipping product or other publicly available version
			(i.e., beta version, preview release, or “nightly build”). 
			Non-shipping product releases must have implemented the
			feature(s) for a period of at least one month in order to
			demonstrate stability.
	
			<li>is not experimental (i.e., a version specifically designed
			to pass the test suite and is not intended for normal usage
			going forward).
		</ol>
	</dl>
	
	<p>The specification will remain Candidate Recommendation for at least
	six months.

<h2 class=no-num id="acknowledgments">Acknowledgments</h2>

	<p>Thanks to the Webkit team, Brad Kemper, Brian Manthos, and Alan Gresley for their contributions to the definition of gradients;
	to Melinda Grant for her work on 'object-fit', 'object-position', and 'image-orientation';
	<!-- to Robert O'Callahan for the definition of ''element()''; -->
	to Michael Day, Håkon Lie, and Shinyu Murakami for ''image-resolution'';
	and to L. David Baron, Kang-Hao Lu, Leif Arne Storset, Erik Dahlstrom, and Øyvind Stenhaug for their careful review, comments, and corrections.

<h2 class=no-num id="references">References</h2>


<h3 class="no-num" id="normative-references">Normative references</h3>
<!--normative-->

<h3 class="no-num" id="other-references">Other references</h3>
<!--informative-->

<h3 class="no-num" id="changes">Changes Since Last Call</h3>

	<p>Major changes include:
	<ul>
		<li>The ''element()'' feature has been deferred to Level 4.
		<li>The directional images feature (''ltr''/''rtl'' annotations in ''image()'')
		has been deferred to Level 4 to address some design-level feedback.
		<li>Images referenced with unsupported URL fragment syntax are now considered
		invalid (and trigger fallback) within ''image()''.
		<li>The 'object-fit' property no longer resizes the element's content box in
		any cases.
		<li>The 'image-orientation' property is now inherited.
	</ul>

	<p>Significant details updated:

	<ul>
		<li>There is now a definition for <i>invalid images</i>, which trigger fallback
		in the ''image()'' notation.
		<li>Clarified that media fragments are only required to be supported within
		''image()'' in order to satisfy the prerequisite for supporting ''image()''.
		<li>Defined how to determine the closeness of two aspect ratios (used in
		the definition of <i>intrinsic dimensions</i>).
		<li>Corrected error in which 'image-orientation' was applied after CSS
		transforms.
		<li>The 'object-fit' and 'object-position' properties may no longer be
		aliased to 'image-fit' and 'image-position'. A future edition of the
		<a href="http://www.w3.org/TR/css-print/">CSS Print Profile</a> may allow
		this for printer implementations, however.
	</ul>

	<p>There were also many clarifications and several sections were rearranged to
	make them easier to read.

	<p>The <a href="http://dev.w3.org/csswg/css4-images/issues-lc-2012">Disposition
	of Last Call Comments</a> is available.

<h2 class="no-num" id="index">Index</h2>
<!--index-->


<h2 class="no-num" id="property-index">Property index</h2>
<!-- properties -->
</body>
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
sgml-omittag:nil
sgml-shorttag:nil
sgml-namecase-general:t
sgml-general-insert-case:lower
sgml-always-quote-attributes:t
sgml-indent-step:nil
sgml-indent-data:t
sgml-parent-document:nil
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->
 
