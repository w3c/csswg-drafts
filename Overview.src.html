<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en-US">
 <head>
  <title>Cascading Style Sheets Object Model (CSSOM)</title>

  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   dfn { font-weight:bold; font-style:normal }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   div.example table code { color:inherit }
   td, th { padding:.1em }
   .proposal { padding:.5em; border:solid blue }
   p.note {  margin-left:2em; color:green; font-style:italic; font-weight:bold }
   p.note::before { content:"Note: " }
   .issue { padding:.5em; border:solid red }
   .issue::before { content:"Issue: " }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
   .members dt { margin:.5em 0 }
   .members dd p:first-child { margin-top:0 }
   .members dd p:last-child { margin-bottom:0 }
  </style>

  <link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/W3C-[STATUS]">
 </head>

 <body class="draft">
  <div class="head">
   <h1 id="cssom">Cascading Style Sheets Object Model (<abbr>CSSOM</abbr>)</h1>
   <h2 class="no-num no-toc" id="">[LONGSTATUS] [DATE: 3 August 2002]</h2>

   <dl>

    <dt>This version:</dt>
    <dd><a href="http://dev.w3.org/csswg/cssom/">http://dev.w3.org/csswg/cssom/</a></dd>
    <!--<dd><a href="[VERSION]/">http://www.w3.org/TR/[YEAR]/WD-cssom-[CDATE]/</a></dd>-->

    <dt>Latest version:</dt>
    <dd><a href="http://www.w3.org/TR/cssom/">http://www.w3.org/TR/cssom/</a></dd>

    <dt>Previous version:</dt>
    <dd><a href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/">http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/</a></dd>

    <dt>Editor:</dt>

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a>
    (<a href="http://www.opera.com/">Opera Software ASA</a>)
    &lt;<a href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;</dd>
   </dl>
  </div>


  <h2 class="no-num no-toc" id="abstract">Abstract</h2>

  <p>The Cascading Style Sheets Object Model defines enables developers to
  find style sheets associated with a <code>Document</code> and to query
  and modify rules within a CSS style sheet (through an object model).</p>
  


  <h2 class="no-num no-toc" id="sotd">Status of this Document</h2>
  <!--status-->

  <p class="issue">This document is in its very early stages. The intention is
  that this specification will in due course supersede DOM Level 2 Style.</p>




  <h2 class="no-num no-toc" id="toc">Table of Contents</h2>
  <!--toc-->





  <h2 id="introduction">Introduction</h2>

  <p class="issue">...</p>

  <h3 id="history">History</h3>

  <p>Several interfaces from DOM Level 2 Style
  <a href="http://www.w3.org/mid/Pine.LNX.4.05.10310302134070.1173-100000@lanalana.inria.fr" title="[CSSOM] CSSValue and related interfaces (message from the CSS WG)">have
  been obsoleted</a> because they where thought to be too awkward for
  frequent use. This specification no longer contains those features.
  <code>DOMImplementationCSS</code> and <code>CSSCharsetRule</code> have
  been removed as well as they were not deemed necessary.</p>




  <h2 id="conformance">Conformance Requirements</h2>

  <p>Everything in this specification is normative except for diagrams,
  examples, notes and sections marked non-normative.</p>

  <p>The key words <em class="ct">must</em>, <em class="ct">must not</em>,
  <em class="ct">required</em>, <em class="ct">shall</em>, <em class="ct">shall
  not</em>, <em class="ct">should</em>, <em class="ct">should not</em>,
  <em class="ct">recommended</em>, <em class="ct">may</em>, and
  <em class="ct">optional</em> in the normative parts of this document are to be
  interpreted as described in
  [<cite><a href="#ref-rfc2119">RFC2119</a></cite>].</p>

  <p>The following conformance classes are defined (and considered) by this
  specification:</p>

  <dl>
   <dt><dfn id="conforming-implementation">conforming implementation</dfn></dt>

   <dd>A user agent that implements all interfaces described in this
   specification and follows all <em class="ct">must</em>-,
   <em class="ct">required</em>- and <em class="ct">shall</em>-level of criteria
   in this specification.</dd>

   <dt><dfn id="conforming-document">conforming document</dfn></dt>

   <dd>A document that follows all <em class="ct">must</em>-,
   <em class="ct">required</em>- and <em class="ct">shall</em>-level of criteria
   in this specification that apply to document authors.</dd>

   <dt><dfn id="conforming-authoring-tool">conforming authoring tool</dfn></dt>

   <dd>One that produces conforming documents.</dd>
  </dl>

  <h3 id="terminology">Terminology</h3>

  <p>A <dfn>color component integer</dfn> is a base-ten integer in the range
  0-255 using digits 0-9, U+0030 to U+0039, in the shortest form possible.</p>

  <p>A <dfn>color component separator</dfn> is a literal U+002C COMMA followed
  by a U+0020 SPACE.</p>

  <p>When this specification talks about object <code><var>A</var></code>
  where <code><var>A</var></code> is actually an interface, it generally means
  an object implementing interface <code><var>A</var></code>.</p>

  <!--
  <p>The term <dfn id="whitespace">whitespace</dfn> when  used in this
   specification refers to the U+0020 SPACE, U+0009 &lt;control>, U+000A
   &lt;control>, U+000D &lt;control> and U+000C &lt;control> (if
   applicable).</p>
  -->

  <p>The terms <dfn id="whitespace">whitespace</dfn> and
  <dfn id="style-sheet">style sheet</dfn> are used as defined in the <cite>CSS
  2.1 Specification</cite> [CSS21].</p>

  <p>A <dfn id="css-style-sheet">CSS style sheet</dfn> is a <span>style
  sheet</span> that conforms to the CSS syntax rules.</p>

  <!-- XXX: "Cascading Style Sheet style sheet" is just a joke... -->



  <h2>Style Sheets and the DOM</h2>

  <h3>Style Sheet</h3>

  <p>Each document has a collection of zero or more associated style sheets.
  A <dfn id="style-sheet">style sheet</dfn> is represented by an object that
  implements the <code>StyleSheet</code> interface (as described below) and
  has a number of properties that need to be set when a style sheet is
  created. These properties can be modified over time.</p>

  <dl>
   <dt><dfn id="style-sheet-type">style sheet type</dfn></dt>
   <dd><p>A string that is the MIME type of the style sheet.
   [RFC2046].</p></dd>
   
   <dt><dfn id="style-sheet-location">style sheet location</dfn></dt>
   <dd><p>A string that is the URI of the style sheet's location or the
   <code>null</code> value if the style sheet was embedded within a
   document.</p></dd>
   
   <dt><dfn id="style-sheet-media">style sheet media</dfn></dt>
   <dd><p>A string with the media queries applicable to the style sheet.
   When the style sheet is created the <code>mediaText</code> attribute
   returned by the <code>media</code> attribute on the style sheet
   <em class="ct">must</em> be set to this string.</p></dd>

   <dt><dfn id="style-sheet-title">style sheet title</dfn></dt>
   <dd>
    <p>A string that is the title of the style sheet. A style sheet is said
    to <dfn>have a title</dfn> if this string is not the empty string.</p>

    <div class="example">
     <p>The following CSS style sheets have a style sheet title that is the
     empty string:</p>
     <pre>&lt;style title=""> body { background:lime } &lt;/style></pre>
<pre>&lt;style> body { background:lime } &lt;/style></pre>
    </div>
   </dd>

   <dt><dfn id="style-sheet-alternate-flag">style sheet alternate
   flag</dfn></dt>
   <dd>
    <p>...</p>
    <div class="example">
     <p>The following style sheets have their style sheet alternate flag set
     to <i>true</i>:</p>
     <pre>&lt;?xml-stylesheet alternate="yes" title="x" href="data:text/css,&hellip;"?></pre>
<pre>&lt;link rel="alternate stylesheet" title="x" href="data:text/css,&hellip;"></pre>
    </div>
   </dd>

   <dt><dfn>style sheet disabled flag</dfn>
   <dd>
    <p>...</p>
    <p class="note">This flag is independent of whether the style sheet is
    actually applied. That depends on the style sheet media as well, for
    instance.</p>
   </dd>
  </dl>
  
  <p>Specifications <em class="ct">must not</em> allow the creation of
  <span title="style sheet">style sheets</span> with the <span>style sheet
  alternate flag</span> set to <i>true</i> and the <span>style sheet
  title</span> set to the empty string.</p>



  <h4>The <code title="">StyleSheet</code> Interface</h4>
  
  <pre class="idl">interface <dfn id="stylesheet">StyleSheet</dfn> {
  readonly attribute DOMString <span title="stylesheet-type">type</span>;
           attribute boolean <span title="stylesheet-disabled">disabled</span>;
  readonly attribute Node <span title="stylesheet-ownernode">ownerNode</span>;
  readonly attribute <span>StyleSheet</span> <span title="stylesheet-parentstylesheet">parentStyleSheet</span>;
  readonly attribute DOMString <span title="stylesheet-href">href</span>;
  readonly attribute DOMString <span title="stylesheet-title">title</span>;
  [PutForwards=mediaText] readonly attribute <span>MediaList</span> <span title="stylesheet-media">media</span>;
};</pre>

  <p class="note">CSS style sheets objects implement the
  <code>CSSStyleSheet</code> interface which inherits from the
  <code>StyleSheet</code> interface.</p>

  <p>The
  <dfn id="stylesheet-type" title="stylesheet-type"><code>type</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the <span>style
  sheet type</span>.</p>
  
  <p>The
  <dfn id="stylesheet-disabled" title="stylesheet-disabled"><code>disabled</code></dfn>
  attribute, on getting, <em class="ct">must</em> return <code>true</code>
  when the <span>style sheet disabled flag</span> is <i>true</i> and
  <code>false</code> if that flag is <i>false</i>. On setting, it
  <em class="ct">must</em> set the <span>style sheet disabled flag</span> to
  <i>true</i> if set to <code>true</code>, and set the flag to <i>false</i>
  if set to <code>false</code>.</p>
  
  <p>The
  <dfn id="stylesheet-ownernode" title="stylesheet-ownernode"><code>ownerNode</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the
  <code>Node</code> that associates the style sheet with the document or it
  <em class="ct">must</em> return <code>null</code> if there is no such
  <code>Node</code>.</p>
  
  <p class="note">The aformentioned <code>Node</code> has implemented the
  <code>LinkStyle</code> interface.</p>

  <p>The
  <dfn id="stylesheet-parentstylesheet" title="stylesheet-parentstylesheet"><code>parentStyleSheet</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the
  <code>StyleSheet</code> object that caused the inclusion of the current
  style sheet or <code>null</code> if there is no such object.</p>
  
  <p>The
  <dfn id="stylesheet-href" title="stylesheet-href"><code>href</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the <span>style
  sheet location</span>.</p>

  <p>The
  <dfn id="stylesheet-title" title="stylesheet-title"><code>title</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the <span>style
  sheet title</span>.</p>

  <p>The
  <dfn id="stylesheet-media" title="stylesheet-media"><code>media</code></dfn>
  attribute, on getting, <em class="ct">must</em> return an object
  implementing the <code>MediaList</code> interface that represents the
  <span>style sheet media</span>.</p>



  <h4>The <code title="">StyleSheetList</code> Interface</h4>

  <p>The object implementing this interface represents an ordered collection
  of objects implementing the <code>StyleSheet</code> interface. Items in
  this collection are accessible through an integral index, starting from
  zero.</p>

  <pre class="idl">interface <dfn>StyleSheetList</dfn> {
  readonly attribute unsigned long <span title="stylesheetlist-length">length</span>;
  [IndexGetter] <span>StyleSheet</span> <span title="stylesheetlist-item">item</span>(in unsigned long <var title="">index</var>);
};</pre>

  <p>The
  <dfn id="stylesheetlist-length" title="stylesheetlist-length"><code>length</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the number of
  objects currently in the list.</p>

  <p>The
  <dfn id="stylesheetlist-item" title="stylesheetlist-item"><code>item(<var title="">index</var>)</code></dfn>
  method, when invoked, <em class="ct">must</em> return the
  <code>StyleSheet</code> object in the list given by <var>index</var>. If
  <var>index</var> is less than zero or greater than or equal to the number
  of objects in the list then this method
  <em class="ct">must</em> raise an <code>INDEX_SIZE_ERR</code>
  exception.</p>



  <h3>Media Queries</h3>
  
  <p>creating a MediaList object?</p>
  
  <p>parsing and serializing ...</p>
  
  <h4>The <code>MediaList</code> Interface</h4>
  
  <div class="issue">
   <p>There are several rules:</p>
   
   <ul>
    <li>No duplicates
    <li>Canonicalized on getting
   </ul>
  </div>

  <p>Objects implementing the <code>MediaList</code> interface represent an
  ordered collection of media queries. Items in this collection are
  accessible through an integral index, starting from zero.</p>

  <pre class="idl">interface <dfn>MediaList</dfn> {
           attribute DOMString <span title="medialist-mediatext">mediaText</span>;
  readonly attribute unsigned long <span title="medialist-length">length</span>;
  [IndexGetter] DOMString <span title="medialist-item">item</span>(in unsigned long <var title="">index</var>);
  void <span title="medialist-appendmedium">appendMedium</span>(in DOMString <var title="">medium</var>)
  void <span title="medialist-deletemedium">deleteMedium</span>(in DOMString <var title="">medium</var>)
};</pre>

  <p>In bindings that allow it, such as ECMAScript, <code>MediaList</code>
  objects <em class="ct">must</em> stringify to their
  <code title="medialist-mediatext">mediaText</code> attribute's value.</p>
  <!-- XXX Web IDL ^^ -->

  <p>The
  <dfn id="medialist-mediatext" title="medialist-mediatext"><code>mediaText</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the results of
  <span>serializing a list of media queries</span>. On setting, the media
  queries currently in the collection <em class="ct">must</em> be replaced
  with the result of <span>parsing a list of media queries</span>.</p>
  <!-- XXX definitions -->
  
  <p>The
  <dfn id="medialist-length" title="medialist-length"><code>length</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the number of items
  in the collection.</p>

  <p>The
  <dfn id="medialist-item" title="medialist-item"><code>item(<var title="">index</var>)</code></dfn>
  method, when invoked, <em class="ct">must</em> return the item in the
  collection given by <var>index</var>. If <var>index</var> is
  less than zero or greater than or equal to the number of media queries
  currently in the collection then this method <em class="ct">must</em>
  raise an <code>INDEX_SIZE_ERR</code> exception.</p>

  <p>The
  <dfn id="medialist-appendmedium" title="medialist-appendmedium"><code>appendMedium(<var title="">medium</var>)</code></dfn>
  method, when invoked, <span class="issue">...</span>.</p>
  
  <p>The
  <dfn id="medialist-deletemedium" title="medialist-deletemedium"><code>deleteMedium(<var title="">medium</var>)</code></dfn>
  method, when invoked, <em class="ct">must</em> raise a
  <code>NOT_FOUND_ERR</code> exception when <var>medium</var> is not in the
  collection. Otherwise, <var>medium</var> <em class="ct">must</em> be
  removed from the collection.</p>





  <h3>Style Sheet Types</h3>
  
  <p>Lets see, we have persistent style sheets, alternative style sheet sets, preferred style sheet sets</p>



  <h3>Accessing Style Sheets</h3>

  <h4>The <code title="">LinkStyle</code> Interface</h4>

  <p>The <code>LinkStyle</code> interface provides a bridge between the node
  that takes care of the embedding or inclusion of a <span>style
  sheet</span> and the <code>StyleSheet</code> object representing the style
  sheet.</p>

  <p class="note">The <code>style</code> content attribute found in various
  markup languages does not embed, or represent, a style sheet.</p>

  <pre class="idl">interface <dfn>LinkStyle</dfn> {
  readonly attribute <span>StyleSheet</span> <span title="linkstyle-sheet">sheet</span>;
};</pre>

  <p>The
  <dfn id="linkstyle-sheet" title="linkstyle-sheet"><code>sheet</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the associated
  <code>StyleSheet</code> object, or <code>null</code>, if there is no
  associated <code>StyleSheet</code> object.</p>

  <div class="example">
   <p>In the following HTML snippet the first HTML <code>style</code>
   element has a <code>sheet</code> attribute that returns a
   <code>StyleSheet</code> object representing the CSS style sheet, but for
   the second <code>style</code> attribute it returns <code>null</code>.
   (Assuming the user agent supports CSS (<code>text/css</code>) and does
   not support ExampleSheets (<code>text/example-sheets</code>).</p>

   <pre>&lt;style type=text/css> body { background:lime } &lt;/style>
&lt;style type=text/example-sheets> $(body).background := lime &lt;/style></pre>
  </div>

  <p class="note">Whether or not the node refers to a style sheet is defined
  by the specification that defines the semantics of said node.</p>


  <h5>Requirements on specifications</h5>

  <p>Specifications introducing new ways of associating style sheets through
  the DOM <em class="ct">should</em> define which <code>Node</code>s
  implement the <code>LinkStyle</code> interface. These specifications
  <em class="ct">should</em> also define how the various properties of a
  <span>style sheet</span> are set when
  <code title="linkstyle-sheet">sheet</code> is not <code>null</code>.</p>
  
  <p class="note">This specification defines it for SVG,
  <code>&lt;?xml-stylesheet?></code>, and the HTTP <code>Link</code> header
  for the time being.</p>



  <h4>Requirements User Agents Implementing SVG</h4>

  <p><em>This section applies to user agents implementing SVG.</em></p>
  
  <p>SVG user agents <em class="ct">must</em> implement the
  <code>LinkStyle</code> interfaces on objects implementing the
  <code>SVGStyleElement</code> interface.</p>
  
  <p class="issue">...</p>


  <h4>Requirements on User Agents Implementing
  <code>&lt;?xml-stylesheet?></code></h4>
  
  <p><em>This section applies to user agents implementing
  <code>&lt;?xml-stylesheet?></code>.</em></p>

  <p>User agents supporting supporting <code>&lt;?xml-stylesheet?></code>
  <em class="ct">must</em> implement the <code>LinkStyle</code> on objects
  implementing <code>ProcessingInstruction</code>.</p>

  <p>If the <code title="">target</code> DOM attribute of the
  <code>ProcessingInstruction</code> is not <code>xml-stylesheet</code> then
  the <code title="linkstyle-sheet">sheet</code> attribute of the node's
  <code>LinkStyle</code> interface <em class="ct">must</em> return
  <code>null</code>.</p>
  
  <p>Else, if the <code title="">target</code> DOM attribute is
  <code>xml-stylesheet</code> but the specified resource has not completed
  downloading, or is not a supported style sheet language the
  <code title="linkstyle-sheet">sheet</code> attribute of the node's
  <code>LinkStyle</code> interface <em class="ct">must</em> return
  <code>null</code>.</p>
  
  <p>Otherwise, a new <span>style sheet</span> <em class="ct">must</em> be
  created with <span>style sheet type</span> set to the canonical type,
  <span>style sheet location</span> to the location of the style sheet,
  <span>style sheet title</span> to the value of the <code title="">title</code>
  pseudo-attribute, <span>style sheet media</span> to the value of the
  <code title="">media</code> pseudo-attribute, the <span>style sheet alternate
  flag</span> to <i>true</i> if the <code title="">alternate</code> pseudo-attribute
  is "<code>yes</code>" and <i>false</i> otherwise, and the <span>style
  sheet disabled flag</span> to <i>false</i>.</p>
  
  <h4>Requirements on User Agents Implementing the HTTP
  <code title="">Link</code> Header</h4>

  <p class="issue">...</p>



  <h4>The <code title="">DocumentStyle</code> Interface</h4>

  <p>Any object implementing the <code>Document</code> interface
  <em class="ct">must</em> also implement the <code>DocumentStyle</code>
  interface.</p>

  <!-- https://bugzilla.mozilla.org/show_bug.cgi?id=200930 (FIXED) -->
  <pre class="idl">interface <dfn>DocumentStyle</dfn> {
  readonly attribute <span>StyleSheetList</span> <span>styleSheets</span>;
           attribute DOMString <span>selectedStyleSheetSet</span>;
  readonly attribute DOMString <span>lastStyleSheetSet</span>;
  readonly attribute DOMString <span>preferredStyleSheetSet</span>;
  readonly attribute DOMStringList <span>styleSheetSets</span>;
  void <span title="documentstyle-enablestylesheetsforset">enableStylesheetsForSet</span>(in DOMString <var>name</var>);
};</pre>

  <!-- XXX Web IDL \/ -->
  <p>For this interface, the <code>DOMString</code> values <code>null</code>
  and "the empty string" are distinct and <em class="ct">must</em> not be
  considered equivalent.</p>

  <dl class="members">

   <dt><dfn id="documentstyle-stylesheets"><code>styleSheets</code></dfn> of
   type <code>StyleSheetList</code></dt>

   <dd><p>This attribute <em class="ct">must</em> be a
   <code>StyleSheetList</code> object containing a collection of all
   <code>StyleSheet</code> objects in document order (those returned by
   <code title="linkstyle-sheet">sheet</code> attribute on objects implementing
   the <code>LinkStyle</code> interface) preceded by style sheets introduced through
   the HTTP <code>Link</code> header.</p></dd>


   <dt><dfn id="documentstyle-selectedStyleSheetSet"><code>selectedStyleSheetSet</code></dfn>
   of type <code>DOMString</code></dt>

   <dd>
    <p>This attribute indicates which <span>style sheet set</span> is in use.
    This attribute is <span>live</span>; changing the
    <code title="stylesheet-disabled">disabled</code> attribute on style sheets
    directly will change the value of this attribute.</p>

    <p>If all the sheets that are enabled and <span>have a title</span> have the
    <em>same</em> title (by <span>case-sensitive</span> comparisons) then the
    value of this attribute <em class="ct">must</em> be exactly equal to the
    title of the first enabled style sheet with a title in the
    <code>styleSheets</code> list. Otherwise, if style sheets from different
    sets are enabled, then the return value <em class="ct">must</em> be
    <code>null</code> (there is no way to determine what the currently selected
    style sheet set is in those conditions). Otherwise, either all style sheets
    that <span>have a title</span> are disabled, or there are no alternative style
    sheets, and <code>selectedStyleSheetSet</code> <em class="ct">must</em>
    return the empty string.</p>

    <p>Setting this attribute to the <code>null</code> value
    <em class="ct">must</em> have no effect.</p>

    <p>Setting this attribute to a non-<code>null</code> value
    <em class="ct">must</em> call
    <code title="documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</code>
    with that value as the method's argument, and set
    <code>lastStyleSheetSet</code> to that value.</p>

    <p>From the DOM's perspective, all views have the same
    <code>selectedStyleSheetSet</code>. If a user agent supports multiple views
    with different selected alternative style sheets, then this attribute (and the
    <code>StyleSheet</code> interface's <code>disabled</code> attribute)
    <em class="ct">must</em> return and set the value for the default view.</p>
   </dd>

   <dt><dfn id="documentstyle-lastStyleSheetSet"><code>lastStyleSheetSet</code></dfn>
   of type <code>DOMString</code>, readonly</dt>

   <dd>
    <p>This attribute <em class="ct">must</em> initially have the value
    <code>null</code>. Its value changes when the
    <code>selectedStyleSheetSet</code> attribute is set.</p>
   </dd>

   <dt><dfn id="documentstyle-preferredStyleSheetSet"><code>preferredStyleSheetSet</code></dfn>
   of type <code>DOMString</code>, readonly</dt>

   <dd>
    <p>This attribute <em class="ct">must</em> be the preferred style
    sheet set as set by the author. It is determined from the order of
    style sheet declarations and the <code>Default-Style</code> HTTP headers.
    If there is no preferred style sheet set, this attribute
    <em class="ct">must</em> be the empty string. The case of this attribute
    <em class="ct">must</em> exactly match the case given by the author where
    the preferred style sheet is specified or implied. This attribute
    <em class="ct">must</em> never be <code>null</code>.</p>
   </dd>

   <dt><dfn id="documentstyle-styleSheetSets"><code>styleSheetSets</code></dfn>
   of type <code>DOMStringList</code>, readonly</dt>

   <dd>
    <p>This <em class="ct">must</em> be a <span>live</span> list of the
    currently available <span>style sheet sets</span>. This list is constructed
    by enumerating all the style sheets for this document available to the
    implementation, in the order they are listed in the <code>styleSheets</code>
    attribute, adding the title of each style sheet
    <span title="have a title">with a title</span> to the list, avoiding
    duplicates by dropping titles that match (<span>case-sensitively</span>)
    titles that have already been added to the list.</p>
   </dd>

   <dt><dfn id="documentstyle-enablestylesheetsforset" title="documentstyle-enablestylesheetsforset"><code>enableStylesheetsForSet(<var title="">name</var>)</code></dfn>,
    method</dt>

   <dd>
    <p>Invoking this method <em class="ct">must</em> change the
    <code title="stylesheet-disabled">disabled</code> attribute on each
    <code>StyleSheet</code> object
    <span title="have a title">with a title</span> in the
    <code>styleSheets</code> attribute, so that all those whose title matches
    the <var title="">name</var> argument are enabled, and all others are
    disabled. Title matches <em class="ct">must</em> be
    <span>case-sensitive</span>.</p>

    <p>Invoking this method with the empty string value <em class="ct">must</em>
    disable all alternative and preferred style sheets (but does not change the
    state of persistent style sheets).</p>

    <p>Invoking this method with the <code>null</code> value
    <em class="ct">must</em> have no effect.</p>

    <!-- fact: -->
    <p>Style sheets that do not <span>have a title</span> are never affected by
    this method. This method does not change the values of the
    <code>lastStyleSheetSet</code> or <code>preferredStyleSheetSet</code>
    attributes.</p>
   </dd>
  </dl>

  <h3>Dynamically adding new style sheets</h3>

  <p>If new style sheets <span title="have a title">with titles</span> are added
  to the document, the user agent <em class="ct">must</em> decide whether or not
  the style sheets should be initially enabled or not. How this happens depends
  on the exact state of the document at the time the style sheet is added, as
  follows.</p>

  <h4>Adding style sheets</h4>

  <p>First, if the style sheet is a preferred style sheet (it
  <span title="have a title">has a title</span>, but is not marked as
  alternative), and there is no
  current preferred style sheet (the <code>preferredStyleSheetSet</code>
  attribute is equal to the empty string) then the
  <code>preferredStyleSheetSet</code> attribute is set to the exact value of
  this style sheet's title. (This changes the preferred style sheet set, which
  causes further changes &mdash; see below.)</p>

  <p>Then, for all sheets, if any of the following is true, then the style sheet
  <em class="ct">must</em> be enabled:</p>

  <ul>
   <li>The style sheet has an empty title.</li>

   <li>The <code>lastStyleSheetSet</code> is <code>null</code>, and the style
   sheet's title matches (by <span>case-sensitive</span> match) the value of
   the <code>preferredStyleSheetSet</code> attribute.</li>

   <li>The style sheet's title matches (by <span>case-sensitive</span> match)
   the value of the <code>lastStyleSheetSet</code> attribute.</li>
  </ul>

  <p>Otherwise, the style sheet <em class="ct">must</em> be disabled.</p>

  <h4>Changing the preferred style sheet set</h4>

  <p>The first time the <span>preferred style sheet</span> set is set, which is
  either before any alternative style sheets are seen (e.g. using a
  <code>Default-Style</code> HTTP header), or is the first time a titled,
  non-alternative style sheet is seen (in the absence of information to
  the contrary, the first titled non-alternative sheet sets the name of
  the preferred set), the <code>preferredStyleSheetSet</code> attribute's value
  <em class="ct">must</em> be set to the name of that preferred style sheet
  set. This does not change the <code>lastStyleSheetSet</code> attribute.</p>

  <p>If the user agent has the preferred style sheet set changed, for example
  if it receives a <code>Default-Style</code> HTTP header after it receives HTTP
  <code>Link</code> headers implying another preferred style sheet, then the
  <code>preferredStyleSheetSet</code> attribute's value
  <em class="ct">must</em> be changed appropriately, and, if the
  <code>lastStyleSheetSet</code> is <code>null</code>, the
  <code title="documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</code>
  method <em class="ct">must</em> be called with the new
  <code>preferredStyleSheetSet</code> value. (The
  <code>lastStyleSheetSet</code> attribute is, again, not changed.)</p>

  <h4>Examples</h4>

  <div class="example">
   <p>Thus, in the following HTML snippet:</p>

   <pre>&lt;link rel="alternate stylesheet" title="foo" href="a"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="b"&gt;
&lt;script&gt;

  document.selectedStyleSheetSet = 'foo';
  document.styleSheets[1].disabled = false;
&lt;/script&gt;
&lt;link rel="alternate stylesheet" title="foo" href="c"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="d"&gt;</pre>

   <p>...the style sheets that end up enabled are style sheets "a", "b",
   and "c", the <code>selectedStyleSheetSet</code> attribute would
   return null, <code>lastStyleSheetSet</code> would return "foo", and
   <code>preferredStyleSheetSet</code> would return "".</p>

   <p>Similarly, in the following HTML snippet:</p>

   <pre>&lt;link rel="alternate stylesheet" title="foo" href="a"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="b"&gt;
&lt;script&gt;
  var before = document.preferredStyleSheetSet;
  document.styleSheets[1].disabled = false;
&lt;/script&gt;
&lt;link rel="stylesheet" title="foo" href="c"&gt;

&lt;link rel="alternate stylesheet" title="bar" href="d"&gt;
&lt;script&gt;
  var after = document.preferredStyleSheetSet;
&lt;/script&gt;</pre>

   <p>...the "before" variable will be equal to the empty string, the
   "after" variable will be equal to "foo", and style sheets "a" and "c"
   will be enabled. This is the case even though the first script block
   sets style sheet "b" to be enabled, because upon parsing the
   following <code>&lt;link&gt;</code> element, the
   <code>preferredStyleSheetSet</code> is set and the
   <code title="documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</code>
   method is called (since <code>selectedStyleSheetSet</code> was never set
   explicitly, leaving <code>lastStyleSheetSet</code> at <code>null</code>
   throughout), which changes which style sheets are enabled and which are
   not.</p>
  </div>

  <h3>Interaction with the User Interface</h3>

  <p>The user interface of Web browsers that support style sheets
  <em class="ct">should</em> list the style sheet titles given in the
  <code>styleSheetSets</code> list, showing the
  <code>selectedStyleSheetSet</code> as the selected style sheet set,
  leaving none selected if it is <code>null</code> or the empty string, and
  selecting an extra option "Basic Page Style" (or similar) if it is
  the empty string and the <code>preferredStyleSheetSet</code> is the
  empty string as well.</p>

  <p>Selecting a style sheet from this list should set the
  <code>selectedStyleSheetSet</code> attribute. This (by definition)
  affects the <code>lastStyleSheetSet</code> attribute.</p>

  <h4>Persisting the selected style sheet set</h4>

  <p>If UAs persist the selected style sheet set, they should use the
  value of the <code>selectedStyleSheetSet</code> attribute, or if
  that is <code>null</code>, the <code>lastStyleSheetSet</code> attribute, when
  leaving the page (or at some other time) to determine the set name
  to store. If that is <code>null</code> then the style sheet set should not be
  persisted.</p>

  <p>When re-setting the style sheet set to the persisted value (which can
  happen at any time, typically at the first time the style sheets are
  needed for styling the document, after the <code>&lt;head&gt;</code> of the document has
  been parsed, after any scripts that are not dependent on computed
  style have executed), the style sheet set should be set by setting the
  <code>selectedStyleSheetSet</code> attribute as if the user had selected the set
  manually.</p>

  <p class="note">This specification does not give any suggestions on
  how UAs should decide to persist the style sheet set or whether or
  how to persist the selected set across pages.</p>

  <h3>Forward compatibility</h3>

  <p>Future versions of CSS may introduce ways of having alternative style sheets
  declared at levels lower than the top level, i.e. embedded within other style
  sheets. Implementations of this specification that also support this proposed
  declaration of alternative style sheets are expected to perform depth-first
  traversals of the <code>styleSheets</code> list, not simply enumerations of
  the <code>styleSheets</code> list that only contains the top level.</p>

  <p class="issue">Would that actually work?!</p>









  <h2>Cascading Style Sheets APIs</h2>

  <p><em>This section (and its subsections) are only applicable to user agents
  implementing CSS.</em></p>

  <p>The previous section provided a way of getting access to style sheets in a
  generic way. This section provides a way for getting access to the individual
  style rules within a Cascading Style Sheet as defined by the CSS
  specifications. [CSS]</p>





  <h3>Parsing and Serializing CSS Constructs</h3>
  <!--
   statement "[S|CDO|CDC]* [ import [S|CDO|CDC]* ]* [ [ ruleset | media | page ] [S|CDO|CDC]* ]*" ??

   selectors "*"
   page selectors "S* pseudo_page? S*"

   declaration "S* declaration" (properties, property values, property priority)

   property value "S* expr"
  -->
  
  <p>This section (and its subsections) define rules for parsing and
  serialization of CSS constructs.</p>
  

  <h4>CSS Value Rules</h4>
  
  <p>The rules for <dfn title="CSS value parsing">parsing a CSS value</dfn> for
  a given <var title="">property</var> are as given in the following algorithm.
  The result is either a CSS value or "null" if the operation failed.</p>
  
  <ol>
   <li>Parse the value using the <code>S* expr</code> production in combination
   with the allowed values for the given <var title="">property</var>. If this
   fails return "null". Otherwise return the parsed value.</li>
  </ol>
  
  <p>The aforementioned production is defined in the CSS 2.1 specification.
  [CSS]</p>


  <p>The rules for <dfn title="CSS value serializing">serializing a CSS
  value</dfn> are as given in the following algorithm:</p>

  <ol>
   <li><p>Relative lengths (<code>em</code>, <code>ex</code>, <code>px</code>,
   all the font-size keywords and <code>%</code>) do not have their units
   changed. However, absolute lengths must be given in millimeters. For example,
   the canonical version of <code>+012.0pt</code> is <code>4.2333mm</code> (give
   or take a few significant figures). <span class="note"><em>Computed</em>
   values may well be in different units than the specified value. User agents
   are to use <code>px</code> as their final units for computed length
   values.</span></p></li>
   
   <li><p>When a <code>&lt;length></code> of zero is given, then any specified
   units <em class="ct">must</em> be removed.</p></li>
   <!-- apparently "0px" is better for interop -->
   
   <li>
    <p>A <code>&lt;color></code> value is canonicalized as follows:</p>

    <dl>
     <dt>It is a system color</dt>

     <dd>See below (you use the representation given in the specification that
     defines the keyword).</dd>

     <dt>Alpha component is equal to 1.0</dt>

     <dd>The color is an uppercase six-digit hexadecimal value, prefixed with a
     <code>#</code> character (U+0023 NUMBER SIGN), with the first two digits
     representing the red component, the next two digits representing the green
     component, and the last two digits representing the blue component, the
     digits being in the range 0-9 A-F (U+0030 to U+0039 and U+0041 to
     U+0046).</dd>

     <dt>Alpha component is less than 1.0</dt>

     <dd>The color is in the CSS <code>rgba()</code> functional-notation format:
     the literal string <code>rgba</code> (U+0072 U+0067 U+0062 U+0061) followed
     by a U+0028 LEFT PARENTHESIS, a <span>color component integer</span>
     representing the red component, a <span>color component separator</span>, a
     <span>color component integer</span> for the green component, a <span>color
     component separator</span>, a <span>color component integer</span> for the
     blue component, another <span>color component separator</span> a U+0030
     DIGIT ZERO, a U+002E FULL STOP (representing the decimal point), one or
     more digits in the range 0-9 (U+0030 to U+0039) representing the fractional
     part of the alpha value, and finally a U+0029 RIGHT PARENTHESIS.</dd>

     <dt>The keyword <code>transparent</code> is used</dt>

     <dd>The color is <code>rgba(0, 0, 0, 0)</code>.</dd>
    </dl>
   </li>
   
   <li><p>Angles are canonicalized to <code>deg</code> and normalized to the
   range of their property. For example, <code>azimuth: 700grad</code> would be
   canonicalized to <code>azimuth: 270deg</code>. This also applies to angle
   keywords as used in the <code>elevation</code> and <code>azimuth</code>
   properties, they are canonicalized to their value in degrees.</p></li>
   
   <li><p>Times are canonicalized to seconds (<code>s</code>).</p></li>
   
   <li><p>Frequencies are canonicalized to Hertz (<code>Hz</code>).</p></li>
   
   <li><p>For all integers and real numbers, including those with units, these
   canonicalization steps <em class="ct">must</em> be followed: If the number
   is <code>0</code>, the canonical result is the literal string <code>0</code>
   plus any units (for lengths, the unit identifier will have been removed
   before this step). Otherwise, leading <!--and trailing -->zeros
   <em class="ct">must</em> be omitted, any leading <code>+</code>
   <em class="ct">must</em> be omitted, the decimal point in a real number
   <em class="ct">must</em> be omitted unless there is a fractional part, and if
   the number is in the range <code>-1 &lt; <var>x</var> &lt; 1</code>, then one
   leading <code>0</code> <em class="ct">must</em> be inserted before the
   decimal point. The number of given significant figures is completely user
   agent dependent.</p></li>
   
   <li><p>Where multiple values may appear in any order without changing the
   meaning of the value (typically represented by a double bar <code>||</code>
   in the value syntax), user agents are to use the canonical order as given in
   the syntax (e.g. <code>&lt;border-width> &lt;border-style> &lt;color></code>
   for the <code>border</code> short-hand property).</p></li>
   
   <li><p>When repeated values may be omitted without changing the meaning of
   the value (e.g. as in the <code>margin</code> and <code>padding</code>
   properties), then the fewest number of values should be given.</p></li>
   
   <li><p>If whitespace may be removed without changing the meaning of the value
   it is to be removed.</p></li>
   
   <li><p><code>&lt;specific-voice></code> and <code>&lt;family-name</code>
   values are to be quoted.</p></li>
   
   <li><p>Double quotes (rather than single quotes) <em class="ct">shall</em> be
   used for string quotation. (When changing from single quotes to double
   quotes, double quotes already in the string are escaped.)</p></li>
   
   <li><p>The quotes in the <code>&lt;uri></code> form should be removed.
   (Parenthesises that were in the string, along with any other characters not
   legal when the string is not quoted (such as commas), must be
   escaped.)</p></li>
   
   <li><p>Unnecessary escapes should be removed. (For example, <code>\z</code>
   should be represented as <code>z</code>. This extends to unescaping UNICODE
   escapes, except, of course, if the encoding cannot contain those
   characters!)</p></li>
   
   <li><p>Where components of the value may be dropped without changing the
   meaning of the value (for example, initial values in shorthand properties),
   then they should be removed. If this would remove all the values, then the
   first allowed value must be given (For example, for <code>background</code>
   that would be <code>rgba(0, 0, 0, 0)</code> since
   <code>background-color</code> is the first component of the value; for
   <code>border</code> it would be <code>0</code> since the first component of
   that value is <code>border-width</code>).</p></li>
   
   <li>
    <p>A single space should be added after each comma that is not part of a
     string, except where that would change the meaning of the value. For
     example:</p>
    
    <pre>foo,bar,baz</pre>
    
    <p>should become:</p>
    
    <pre>foo, bar, baz</pre>
   </li>
   
   <li>
    <p>Whenever case is insensitive, for example in property or counter names,
     the text should be changed to the canonical case as given in the syntax
     definition. For example, the canonical value of:</p>
    
    <pre>COUNTER( PAR-NUM,UPPER-ROMAN ) DISC</pre>
    
    <p>is:</p>
    
    <pre>counter(par-num, upper-roman) disc</pre>
    
    <p>but the color <code>WINDOWTEXT</code> becomes
    <code>WindowText</code>.</p>
   </li>
  </ol>

  <h5>Examples of the CSS Value Serializing Algorithm</h4>

  <p>The steps above should guarantee that there is no data loss, from a CSS
  point of view<!--, other than for color values on systems with colors stored
  with more than 32 bits-->. Here are some examples of before and after results
  on specified values. The before column could be what the author wrote in a
  stylesheet, while the after column shows what querying the DOM would
  return.</p>

  <div class="example">
   <table>
    <thead>
     <tr><th>Before<th>After
    <tbody>
     <tr><td><code>background: none</code><td><code>background: rgba(0, 0, 0, 0)</code>
     <tr><td><code>outline: none</code><td><code>outline: invert</code>
     <tr><td><code>border: none</code><td><code>border: medium</code>
     <tr><td><code>list-style: none</code><td><code>list-style: disc</code>
     <tr><td><code>margin: 0px 1px 1px 1px</code><td><code>margin: 0 1px 1px</code>
     <tr><td><code>azimuth: behind left</code><td><code>azimuth: 220deg</code>
     <tr><td><code>font-family: a, 'b"', serif</code><td><code>font-family: "a", "b\"", serif</code>
     <tr><td><code>content: url('h)i') '\[\]'</code><td><code>content: url(h\)i) "[]"</code>
     <tr><td><code>azimuth: leftwards</code><td><code>azimuth: leftwards</code>
     <tr><td><code>color: rgb(18, 52, 86)</code><td><code>color: #123456</code>
     <tr><td><code>color: rgba(000001, 0, 0, 1)</code><td><code>color: #000000</code>
   </table>
  </div>




  <h4>Selectors Rules</h4>

  <p>The rules for <dfn title="selectors-parsing">parsing a group of
  selectors</dfn> are as given in the following algorithm. The return value is
  either a group of selectors or "null" (if parsing failed).</p>

  <ol>
   <li>Parse the value using the <code>selectors_group</code> production. If
   this fails return "null". Otherwise return the parsed value.</li>
  </ol>

  <p>The aforementioned production is defined in the Selectors specification.
  [Selectors]</p>

  <p>The rules for <dfn title="selectors serializing">serializing a group of
  selectors</dfn> are as given in the following algorithm. The input is a a
  non-normalized group of selectors and the output is a normalized group of
  selectors.</p>

  <ol>
   <li><p>Replace one or more consecutive <span>whitespace</span> characters
   with a single U+0020 character.</p></li>
   
   <li><p>Remove leading and trailing <span>whitespace</span>.</p></li>

   <li><p>Make sure combinators other than the descendant combinator are
   preceded and followed by a single U+0020 character (and not more).</p></li>

   <li><p>Make sure each U+002C (<code>,</code>) character is followed by a
   single U+0020 character (and not more).</p></li>

   <li><p>Convert pseudo-classes and pseudo-elements to their canonical form as
   given in the specification. <span class="note"><code>:HOver</code> becomes
   <code>:hover</code> and <code>:befoRe</code> becomes <code>::before</code>
   for example.</span></p></li>

   <li><p class="issue">Hmm, what about pseudo-classes taking arguments?
   Attribute selectors? Namespace prefixes?</p></li>
  </ol>



  <h4>CSS Page Selectors Rules</h4>
  
  <p class="issue">Need to define the rules for
  <dfn title="CSS page selector parsing">parsing a CSS page selector</dfn> and
  <dfn title="CSS page selector serializing">serializing a CSS page
  selector</dfn>.</p>


  <h4>Processing CSS Statements</h4>
  
  <p class="issue">Need to split this up in parsing and common algorithms.</p>

  <p>The rules for <dfn title="insert a statement">inserting a statement</dfn>
  are as given in the following algorithm. The variables <var>rule</var>,
  <var>rule list</var> and <var>index</var> are to be considered equivalent to
  the identically named variables used when invoking this algorithm. If an
  exception is raised the algorithm is to be aborted. The steps
  <em class="ct">must</em> be followed in order, as follows:</p>

  <ol>
   <li><p>If <var>index</var> is negative or greater than the length of the
   <var>rule list</var> an <code>INDEX_SIZE_ERR</code> exception
   <em class="ct">must</em> be raised.</p></li>

   <li><p>Parse <var>rule</var> as a CSS statement. If the <var>rule</var> is
   ignored by the CSS parser abort this algorithm (don't raise an exception).
   Otherwise, create an object that implements one of the inherited interfaces
   of <code>CSSStyle</code> appropriate for the parsed <var>rule</var>. Let
   <var>object</var> be the newly created object.</p></li>

   <li><p>If <var>object</var> can't be inserted within the <var>rule list</var>
   at the given <var>index</var> because that's not allowed per the CSS
   specification a <code>HIERARCHY_REQUEST_ERR</code> exception
   <em class="ct">must</em> be raised.</p></li>

   <li><p>Insert <var>object</var> at the given <var>index</var> within the
   <var>rule list</var>.</p></li>
  </ol>

  <p>The rules for <dfn title="remove a statement">removing a statement</dfn>
  are as given in the following algorithm. The variables <var>index</var> and
  <var>rule list</var> are to be considered equivalent to the identically
  named variables used when invoking this algorithm. If an exception is raised
  this algorithm is to be aborted. The steps <em class="ct">must</em> be
  followed in order, as follows:</p>

  <ol>
   <li><p>If <var>index</var> is negative or greater than the length of the
   <var>rule list</var> an <code>INDEX_SIZE_ERR</code> exception
   <em class="ct">must</em> be raised.</p></li>

   <li><p>Remove the object at <var>index</var> from <var>rule
   list</var>.</p></li>
  </ol>

  <p>The rules for <dfn title="replace a statement">replacing a
  statement</dfn> are as given in the following algorithm. The variable
  <var>rule</var> and <var>old object</var> are to be considered equivalent to
  the identically named variables used when invoking this algorithm. If an
  exception is raised this algorithm is to be aborted. The steps
  <em class="ct">must</em> be followed in order, as follows:</p>

  <ol>
   <li><p>Parse <var>rule</var> as a CSS statement. If the <var>rule</var> is
   ignored by the CSS parser abort this algorithm (don't raise an exception).
   Otherwise, create an object that implements one of the inherited interfaces
   of <code>CSSStyle</code> appropriate for the parsed <var>rule</var>. Let
   <var>object</var> be the newly created object.</p></li>

   <li><p>If the <code title="cssrule-type">type</code> of <var>object</var>
   does not match the <code title="cssrule-type">type</code> of <var>old
   object</var> it will replace user agents <em class="ct">must</em> raise an
   <code>INVALID_MODIFICATION_ERR</code> exception.</p></li>

   <li><p>Replace <var>old object</var> with <var>object</var>.</p></li>
  </ol>




  <h3>The <code title="">CSSStyleSheet</code> Interface</h3>

  <p>The <code>CSSStyleSheet</code> interface represents a <span>CSS style
  sheet</span>.</p>

  <!--
   IE exposes:
   owningElement, pages, id, type, href, disabled, cssText, readOnly, title,
   parentStyleSheet, imports, rules, media
  -->

  <pre class="idl">interface <dfn>CSSStyleSheet</dfn> : <span>StyleSheet</span> {
  readonly attribute <span>CSSRule</span> <span>ownerRule</span>;
  readonly attribute <span>CSSRuleList</span> <span title="cssstylesheet-cssrules">cssRules</span>;
  unsigned long <span title="cssstylesheet-insertrule">insertRule</span>(in DOMString <var>rule</var>, in unsigned long <var>index</var>);
  void <span title="cssstylesheet-deleterule">deleteRule</span>(in unsigned long <var>index</var>);
};</pre>

  <p>The <dfn id="cssstylesheet-ownerrule"><code>ownerRule</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the
  <code>CSSImportRule</code> that caused this style sheet to be imported (if
  any). Otherwise, if no <code>CSSImportRule</code> caused it to be imported the
  attribute <em class="ct">must</em> return <code>null</code>.</p>

  <p>The
  <dfn id="cssstylesheet-cssrules" title="cssstylesheet-cssrules"><code>cssRules</code></dfn>
  attribute, on getting, <em class="ct">must</em> return a
  <code>CSSRuleList</code> object consisting of a list of statements in order
  they were found in the <span>CSS style sheet</span>.</p>
  
  <p class="note">Statements that were dropped during parsing can not be found
  using these APIs.</p>

  <p>The
  <dfn id="cssstylesheet-insertrule" title="cssstylesheet-insertrule"><code>insertRule(<var title="">rule</var>,
  <var title="">index</var>)</code></dfn> method, when invoked,
  <em class="ct">must</em> <span>insert a statement</span> where <var>rule</var>
  is <var>rule</var>, <var>index</var> is <var>index</var> and <var>rule
  list</var> is <code title="cssstylesheet-cssrules">cssRules</code>.</p>

  <p>The
  <dfn id="cssstylesheet-deleterule" title="cssstylesheet-deleterule"><code>deleteRule(<var title="">index</var>)</code></dfn>
  method, when invoked, <em class="ct">must</em> <span>remove a statement</span>
  where <var>index</var> is <var>index</var> and <var>rule list</var> is
  <code title="cssmediarule-cssrules">cssRules</code>.</p>


  <h3>The <code title="">CSSRuleList</code> Interface</h3>

  <p>The <code>CSSRuleList</code> object represents an (ordered) list of
  statements.</p>

  <pre class="idl">interface <dfn>CSSRuleList</dfn> {
  readonly attribute unsigned long <span title="cssrulelist-length">length</span>;
  <span>CSSRule</span> <span title="cssrulelist-item">item</span>(in unsigned long <var title="">index</var>);
};</pre>

  <p>The
  <dfn id="cssrulelist-length" title="cssrulelist-length"><code>length</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the number of items
  associated with the object.</p>

  <p>The
  <dfn id="cssrulelist-item" title="cssrulelist-item"><code>item(<var title="">index</var>)</code></dfn>
  method, when invoked, if <var title="">index</var> is equal or greater than
  the <code title="cssrulelist-length">length</code> this method
  <em class="ct">must</em> return <code>null</code>. Otherwise, this method
  <em class="ct">must</em> return the <code>CSSRule</code> in the list given by
  <var title="">index</var>.</dd>
  <!-- negative numbers -->



  <h3>Interfaces for CSS Statements</h3>

  <p>This section defines several specific interfaces for different types of CSS
  statements and one generic from which the more specific inherit.</p>


  <h4>The <code title="">CSSRule</code> Interface</h4>
  
  <p>The <code>CSSRule</code> interface is the base interface from which all
  other CSS statement interfaces inherit.</p>

  <pre class="idl">interface <dfn>CSSRule</dfn> {
  // CSS statement type
  const unsigned short <span>STYLE_RULE</span> = 1;
  const unsigned short <span>IMPORT_RULE</span> = 3;
  const unsigned short <span>MEDIA_RULE</span> = 4;
  const unsigned short <span>FONT_FACE_RULE</span> = 5;
  const unsigned short <span>PAGE_RULE</span> = 6;
  const unsigned short <span>NAMESPACE_RULE</span> = 7;
  readonly attribute unsigned short <span title="cssrule-type">type</span>;

  // Textual representation
           attribute DOMString <span title="cssrule-csstext">cssText</span>;
  
  // Context information
  readonly attribute <span>CSSRule</span> <span title="cssrule-parentrule">parentRule</span>;
  readonly attribute <span>CSSStyleSheet</span> <span title="cssrule-parentstylesheet">parentStyleSheet</span>;
};</pre>

  <p>The <dfn id="cssrule-type" title="cssrule-type"><code>type</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the CSS statement type
  as detailed for each specific type.</p>

  <p>The
  <dfn id="cssrule-csstext" title="cssrule-csstext"><code>cssText</code></dfn>
  attribute allows for replacing a CSS statement or getting a textual
  representation. On setting, user agents <em class="ct">must</em> <span>replace
  a statement</span> where <var>rule</var> is the value being set and <var>old
  object</var> is the object of which this attribute is set.</p>

  <p>On getting the <code title="cssrule-csstext">cssText</code> attribute,
  <span class="issue">...</span>.</p>

  <p>The
  <dfn id="cssrule-parentrule" title="cssrule-parentrule"><code>parentRule</code></dfn>
  attribute <em class="ct">must</em> return the nearest enclosing rule of the
  current rule or <code>null</code> if there is no enclosing rule. For example,
  an <code title="">@media</code> block enclosing the current rule.</p>

  <p>The
  <dfn id="cssrule-parentstylesheet" title="cssrule-parentstylesheet"><code>parentStyleSheet</code></dfn>
  attribute <em class="ct">must</em> return the <code>CSSStyleSheet</code>
  object that contains the the current rule.</p>

  <h5>Extensibility</h5>

  <p>The constant values 0-1000 are reserved for future use by the CSS WG.</p>

  <p>Vendors are encouraged to use reasonably unique values outside this range
  so that they do not clash with extensions from other vendors. For example, the
  first value for Mozilla could be <code>0x0<strong>8EC0</strong>001</code> and
  <code>0x<strong>09E8A</strong>001</code> could be the first for Opera.</p>
  
  <p>Vendors are encouraged to prefix the new interface names with a vendor
  specific prefix. For example, "Example company" could have an interface called
  "ExampleCSSTestRule".</p>
  
  <p>In general, vendors are encouraged to discuss extensions on a public forum,
  such as <code>www-style@w3.org</code>.</p>


  <h4>The <code title="">CSSStyleRule</code> Interface</h4>

  <p>The <code>CSSStyleRule</code> object represents a ruleset specified (if
  any) in a <span>CSS style sheet</span>. It provides access to a declaration
  block as well as to the associated group of selectors.</p>

  <p>Objects implementing the <code>CSSStyleRule</code> interface can be
  identified by the <dfn id="cssrule-style-rule"><code>STYLE_RULE</code></dfn>
  constant. On these objects the <code title="cssrule-type">type</code>
  attribute <em class="ct">must</em> return the value of that constant.</p>

  <pre class="idl">interface <dfn>CSSStyleRule</dfn> : <span>CSSRule</span> {
           attribute DOMString <span title="cssstylerule-selectortext">selectorText</span>;
  readonly attribute <span>CSSStyleDeclaration</span> <span title="cssstylerule-style">style</span>;
};</pre>

  <p>The
  <dfn id="cssstylerule-selectortext" title="cssstylerule-selectortext"><code>selectorText</code></dfn>
  attribute allows for manipulation of the associated group of selectors or
  getting a textual representation of them. On setting, user agents
  <em class="ct">must</em> parse the given string as a group of selectors. If
  the given string is ignored user agents <em class="ct">must</em> act as if
  setting did not occur. Otherwise, set the attribute to the parsed string and
  re-apply the style rules stored in the
  <code title="cssstylerule-style">style</code> attribute.</p>

  <p>When getting the
  <code title="cssstylerule-selectortext">selectorText</code> attribute  it
  <em class="ct">must</em> return a <span title="canon-selectors">textual
  representation of the group of selectors</span>.</p>

  <p>The
  <dfn id="cssstylerule-style" title="cssstylerule-style"><code>style</code></dfn>
  attribute <em class="ct">must</em> return a live
  <code>CSSStyleDeclaration</code> object for the ruleset.</p>


  <h4>The <code title="">CSSImportRule</code> Interface</h4>

  <p>Objects implementing the <code>CSSImportRule</code> interface can be
  identified by the <dfn id="cssrule-import-rule"><code>IMPORT_RULE</code></dfn>
  constant. On these objects the <code title="cssrule-type">type</code>
  attribute <em class="ct">must</em> return the value of that constant.</p>

  <p>The <code>CSSImportRule</code> object represents an <code>@import</code>
  rule specified (if any) in a <span>CSS style sheet</span>.</p>

  <pre class="idl">interface <dfn>CSSImportRule</dfn> : <span>CSSRule</span> {
  readonly attribute DOMString <span title="cssimportrule-href">href</span>;
  readonly attribute <span>MediaList</span> <span title="cssimportrule-media">media</span>;
  readonly attribute <span>CSSStyleSheet</span> <span title="cssimportrule-stylesheet">styleSheet</span>;
};</pre>

  <p>The
  <dfn id="cssimportrule-href" title="cssimportrule-href"><code>href</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the <em>specified</em>
  URI of the style sheet referenced by the <code>@import</code> rule.</p>

  <p>The
  <dfn id="cssimportrule-media" title="cssimportrule-media"><code>media</code></dfn>
  attribute, on getting, <em class="ct">must</em> return a live
  <code>MediaList</code> object containing a list of media queries applicable to
  the imported style sheet as specified by the <code>@import</code> rule.</p>

  <p>The
  <dfn id="cssimportrule-stylesheet" title="cssimportrule-stylesheet"><code>styleSheet</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the
  <code>CSSStyleSheet</code> object that represents the referenced (parsed)
  style sheet from the <code>@import</code> rule.</p>
  
  <p class="note">If loading of the style sheet fails its
  <code title="cssstylesheet-cssrules">cssRules</code> list is simply empty.</p>


  <h4>The <code title="">CSSMediaRule</code> Interface</h4>

  <p>Objects implementing the <code>CSSMediaRule</code> interface can be
  identified by the <dfn id="cssrule-media-rule"><code>MEDIA_RULE</code></dfn>
  constant. On these objects the <code title="cssrule-type">type</code>
  attribute <em class="ct">must</em> return the value of that constant.</p>
  
  <p>The <code>CSSMediaRule</code> object represents an
  <code title="">@media</code> rule specified (if any) in a <span>CSS style
  sheet</span>. It is a single statement that contains zero or more rulesets
  which are contrained by one or more media queries (unless one happens to be
  <code>all</code>).</p>

  <pre class="idl">interface <dfn>CSSMediaRule</dfn> : <span>CSSRule</span> {
  readonly attribute <span>MediaList</span> <span title="cssmediarule-media">media</span>;
  readonly attribute <span>CSSRuleList</span> <span title="cssmediarule-cssrules">cssRules</span>;
  unsigned long <span title="cssmediarule-insertrule">insertRule</span>(in DOMString <var>rule</var>, in unsigned long <var>index</var>);
  void <span title="cssmediarule-deleterule">deleteRule</span>(in unsigned long <var>index</var>);
};</pre>

  <p>The
  <dfn id="cssmediarule-media" title="cssmediarule-media"><code>media</code></dfn>
  attribute, on getting, <em class="ct">must</em> return a
  <code>MediaList</code> object containing a list of media queries specified
  with the <code title="">@media</code> rule.</p>

  <p>The
  <dfn id="cssmediarule-cssrules" title="cssmediarule-cssrules"><code>cssRules</code></dfn>
  attribute, on getting, <em class="ct">must</em> return a
  <code>CSSRuleList</code> object containing a list of all the rulesets
  specified within the <code title="">@media</code> rule.</p>

  <p>The
  <dfn id="cssmediarule-insertrule" title="cssmediarule-insertrule"><code>insertRule(<var title="">rule</var>,
  <var title="">index</var>)</code></dfn> method, when invoked,
  <em class="ct">must</em> <span>insert a statement</span> where <var>rule</var>
  is <var>rule</var>, <var>index</var> is <var>index</var> and <var>rule
  list</var> is <code title="cssmediarule-cssrules">cssRules</code>.</dd>

  <p>The
  <dfn id="cssmediarule-deleterule" title="cssmediarule-deleterule"><code>deleteRule(<var title="">index</var>)</code></dfn>
  method, when invoked, <em class="ct">must</em> <span>remove a statement</span>
  where <var>index</var> is <var>index</var> and <var>rule list</var> is
  <code title="cssmediarule-cssrules">cssRules</code>.</p>


  <h4>The <code title="">CSSFontFaceRule</code> Interface</h4>

  <p>Objects implementing the <code>CSSFontFaceRule</code> interface can be
  identified by the
  <dfn id="cssrule-font-face-rule"><code>FONT_FACE_RULE</code></dfn> constant.
  On these objects the <code title="cssrule-type">type</code> attribute
  <em class="ct">must</em> return the value of that constant.</p>

  <p>The <code>CSSFontFaceRule</code> object represents an
  <code>@font-face</code> rule specified (if any) in a <span>CSS style
  sheet</span>.</p>

  <pre class="idl">interface <dfn>CSSFontFaceRule</dfn> : <span>CSSRule</span> {
  readonly attribute <span>CSSStyleDeclaration</span> <span title="cssfontfacerule-style">style</span>;
};</pre>

  <p>The
  <dfn id="cssfontfacerule-style" title="cssfontfacerule-style"><code>style</code></dfn>
  attribute <em class="ct">must</em> return a <code>CSSStyleDeclaration</code>
  block that contains the property declarations specified within the
  <code>@font-face</code> rule.</p>


  <h4>The <code title="">CSSPageRule</code> Interface</h4>

  <p>Objects implementing the <code>CSSPageRule</code> interface can be
  identified by the <dfn id="cssrule-page-rule"><code>PAGE_RULE</code></dfn>
  constant. On these objects the <code title="cssrule-type">type</code>
  attribute <em class="ct">must</em> return the value of that constant.</p>

  <p>The <code>CSSPageRule</code> object represents an <code>@page</code> rule
  specified (if any) in a <span>CSS style sheet</span>.</p>

  <pre class="idl">interface <dfn>CSSPageRule</dfn> : <span>CSSRule</span> {
           attribute DOMString <span title="csspagerule-selectortext">selectorText</span>;
  readonly attribute <span>CSSStyleDeclaration</span> <span title="csspagerule-style">style</span>;
};</pre>

  <p>The
  <dfn id="csspagerule-selectortext" title="csspagerule-selectortext"><code>selectorText</code></dfn>
  allows for setting a new page selector or getting the textual representation
  of the current one. On setting, user agents <em class="ct">must</em> parse the
  given string as a page selector. If the given string is ignored user agents
  <em class="ct">must</em> act as if setting did not occur. Otherwise, the
  attribute <em class="ct">must</em> be set to the parsed string and the styles
  <em class="ct">must</em> be re-applied.</p>

  <p>When getting the <code title="csspagerule-selectortext">selectorText</code>
  attribute it <em class="ct">must</em> return a textual representation of the
  page selector for the rule.</p>
  
  <p class="issue">We need to define normalization...</p>

  <p>The
  <dfn id="csspagerule-style" title="csspagerule-style"><code>style</code></dfn>
  attribute, on getting, <em class="ct">must</em> return a
  <code>CSSStyleDeclaration</code> that contains the specified property
  declarations within the <code>@page</code> rule.</p>


  <h4>The <code title="">CSSNamespaceRule</code> Interface</h4>

  <p>Objects implementing the <code>CSSNamespaceRule</code> interface can be
  identified by the
  <dfn id="cssrule-namespace-rule"><code>NAMESPACE_RULE</code></dfn> constant.
  On these objects the <code title="cssrule-type">type</code> attribute
  <em class="ct">must</em> return the value of that constant.</p>

  <p>The <code>CSSNamespaceRule</code> object represents an
  <code>@namespace</code> rule specified (if any) in a <span>CSS style
  sheet</span> that consists of a prefix and namespace.</p>

  <pre class="idl">interface <dfn>CSSNamespaceRule</dfn> : <span>CSSRule</span> {
  readonly attribute DOMString <span>namespaceURI</span>;
  readonly attribute DOMString <span>prefix</span>;
};</pre>

  <p>The <dfn id="cssnamespacerule-namespaceuri"><code>namespaceURI</code></dfn>
  attribute, on getting, <em class="ct">must</em> return specified namespace IRI
  from the <code>@namespace</code> rule.</p>

  <p>The <dfn id="cssnamespacerule-prefix"><code>prefix</code></dfn> attribute,
  on getting, <em class="ct">must</em> return the specified prefix from the
  <code>@namespace</code> rule or the empty string if there is no prefix.</p>
  <!-- XXX lowercased? -->


  <h3>Accessing declaration blocks</h3>

  <p>This section provides various way to get to declaration blocks which you
   can then manipulate.</p>

  <h4>Introduction</h4>

  <p class="issue">...</p>

  <h4>The <code>ElementCSSInlineStyle</code> Interface</h4>

  <pre class="idl">interface <dfn>ElementCSSInlineStyle</dfn> {
  readonly attribute <span>CSSStyleDeclaration</span> <span>style</span>;
  readonly attribute <span>CSSStyleDeclaration</span> <span title="elementcssinlinestyle-currentstyle">currentStyle</span>;
  readonly attribute <span>CSSStyleDeclaration</span> <span>runtimeStyle</span>;
};</pre>

  <p class="issue">...</p>
  
  <p>The
  <dfn id="elementcssinlinestyle-currentstyle" title="elementcssinlinestyle-currentstyle"><code>currentStyle</code></dfn>
  attribute, when called, <em class="ct">must</em> return a
  <span title="readonly declaration">readonly
  <code>CSSStyleDeclaration</code></span> object which represents the computed
  style for the element on which it was called.</p>

  <p class="issue">Serialization of the <code>style</code> attribute is not
   guaranteed to work.</p>



  <h4>The <code title="">ViewCSS</code> Interface</h4>

  <p>Objects implementing the <code>Window</code> interface
  <em class="ct">must</em> also implement the <code>ViewCSS</code>
  interface.</p>

  <!-- XXX wtf!? -->
  <p>Since a computed style is related to an <code>Element</code> node, if
  this element is removed from the document, the associated
  <code>CSSStyleDeclaration</code> is no longer valid.</p>

  <pre class="idl">interface <dfn>ViewCSS</dfn> {
  <span>CSSStyleDeclaration</span> <span>getComputedStyle</span>(in Element <var title="">elt</var>);
  <span>CSSStyleDeclaration</span> <span>getComputedStyle</span>(in Element <var title="">elt</var>, in DOMString <var title="">pseudoElt</var>);
};</pre>

  <p>The
  <dfn id="viewcss-getcomputedstyle"><code>getComputedStyle</code></dfn>
  method <em class="ct">must</em> return a live
  <code>CSSStyleDeclaration</code> object that contains the computed style
  declaration block for <var title="">elt</var>, when the
  <var title="">pseudoElt</var> argument is <code>null</code>, the empty string
  or omitted. Otherwise, for the pseudo-element <var title="">pseudoElt</var>
  of <var title="">elt</var>. [CSS]</p>

  <p>If <var title="">pseudoElt</var> is not a recognized CSS pseudo-element
  the invocation the method <em class="ct">must</em> return
  <span class="issue">...</span>.</p>


  <h4>The <code title="">DocumentCSS</code> Interface</h4>

  <p class="issue"><code>runtimeStyle</code> is way better than this feature.</p>

  <p>This interface represents a document with a CSS view.</p>

  <!--
    so this is how this all comes together:

    UA style sheet
    User style sheet
    Author style sheet
    Override ("temporary") style sheet
    Author !important styles
    Override !important styles
    User !important styles

    on getting you actually don't create an override style sheet you just read
    the computed style of a certain property. this should be clear.

    that's what runtimeStyle should do more or less. removeAttribute() allows
    you to remove the current style... removeAttribute is such an ugly name

    currentStyle works sort of like this
  -->

  <p>The <code>getOverrideStyle</code>
   method provides a mechanism through which a DOM author could effect
   immediate change to the style of an element without modifying the explicitly
   linked style sheets of a document or the inline style of elements in the
   style sheets. This style sheet comes after the author style sheet in the
   cascade algorithm and is called override style sheet. The override style
   sheet takes precedence over author style sheets. An <code>!important</code>
   declaration in an author style sheet still takes precedence over a normal
   declaration in an author style sheet. Override, author and user style sheets
   may all contain <code>!important</code> declarations. User
   <code>!important</code> rules take precedence over both override and author
   <code>!important</code> rules, and override <code>!important</code> rules
   take precedence over author <code>!important</code> rules.</p>
  <p>The expectation is that an instance of the <code>DocumentCSS</code>
   interface can be obtained by using binding-specific casting methods on an
   instance of the <code>Document</code> interface.</p>

  <pre class="idl">interface <dfn>DocumentCSS</dfn> : <span>DocumentStyle</span> {
  <span>CSSStyleDeclaration</span> <span>getOverrideStyle</span>(in Element <var>elt</var>, in DOMString <var>pseudoElt</var>);
};</pre>

  <p>The
  <dfn id="documentcss-getoverridestyle"><code>getOverrideStyle</code></dfn>
  method <em class="ct">must</em> return the override style declaration for
  the <code>Element</code> <var>elt</var> (when
  <var title="">pseudoElt</var> is <code>null</code>) or for the
  pseudo-element <var>pseudoElt</var> of <code>Element</code>
  <var title="">elt</var>.</p>

  <p>For language bindings that support optional arguments invoking
  <code>getOverrideStyle</code> without the <var>pseudoElt</var> argument
  <em class="ct">must</em> be identical to invoking the method with that
  argument being <code>null</code>.</p>





  <h3 id="css-declaration-blocks">CSS Declaration Blocks</h3>

  <p>The interfaces described in this section provide generic and convenient
  attributes for manipulating CSS declaration blocks.</p>


  <h4>The <code title="">CSSStyleDeclaration</code> Interface</h4>

  <p>The <code>CSSStyleDeclaration</code> interface gives access to read and
  manipulate CSS properties and their values within a declaration block.</p>

  <p>If an attribute or method returns an object implementing the
  <code>CSSStyleDeclaration</code> interface (and related interfaces) and says
  the object is <dfn title="readonly declaration">readonly</dfn> user agents
  <em class="ct">must</em> raise a <code>NO_MODIFICATION_ALLOWED_ERR</code>
  exception on an attempt to modify the object.</p>

  <p class="note">Invoking
  <code title="cssstyledeclaration-removeproperty">removeProperty</code> or
  setting <code title="cssstyledeclaration-csstext">cssText</code> would be
  examples of that.</p>

  <!-- XXX Or do we need to specify this independently for each attribute and
  method? -->

  <p class="issue"><code>CSSStyleDeclaration</code> can represent computed
  values and used values. (This also goes for interfaces implemented on top
  of <code>CSSStyleDeclaration</code> objects obviously.)</p>

  <p class="issue">This object stringifies to its cssText attribute. Or
  not?</p>

  <pre class="idl">interface <dfn>CSSStyleDeclaration</dfn> {
           attribute DOMString <span title="cssstyledeclaration-csstext">cssText</span>;
  DOMString <span title="cssstyledeclaration-getpropertyvalue">getPropertyValue</span>(in DOMString <var title="">property</var>);
  DOMString <span title="cssstyledeclaration-getpropertypriority">getPropertyPriority</span>(in DOMString <var title="">property</var>);
  DOMString <span title="cssstyledeclaration-removeproperty">removeProperty</span>(in DOMString <var title="">property</var>);
  void <span title="cssstyledeclaration-setproperty">setProperty</span>(in DOMString <var title="">property</var>, in DOMString <var title="">value</var>);
  void <span title="cssstyledeclaration-setproperty">setProperty</span>(in DOMString <var title="">property</var>, in DOMString <var title="">value</var>, in DOMString <var title="">priority</var>);
  readonly attribute unsigned long <span title="cssstyledeclaration-length">length</span>;
  DOMString <span title="cssstyledeclaration-item">item</span>(in unsigned long <var title="">index</var>);
  readonly attribute <span>CSSRule</span> <span title="cssstyledeclaration-parentrule">parentRule</span>;
};</pre>

  <p>The
  <dfn id="cssstyledeclaration-csstext" title="cssstyledeclaration-csstext"><code>cssText</code></dfn>
  attribute, on getting, <span class="issue">...</span>.</p>

  <p>On setting the <code title="">cssText</code> attribute, user agents
  <em class="ct">must</em> remove all properties currently set on the object and
  then parse the given string as the contents of a declaration block and set
  each property / value pair that is not ignored on the
  <code>CSSStyleDeclaration</code> block. [CSS]</p>

  <p>The
  <dfn id="cssstyledeclaration-getpropertyvalue" title="cssstyledeclaration-getpropertyvalue"><code>getPropertyValue(<var title="">property</var>)</code></dfn>
  method, when invoked, <span class="issue">...</span>.</p>
  <!-- Once we have defined how everything will be canonicalized we can start
  thinking about this... --></p>

  <p>The
  <dfn id="cssstyledeclaration-getpropertypriority" title="cssstyledeclaration-getpropertypriority"><code>getPropertyPriority(<var title="">property</var>)</code></dfn>
  method, when invoked, if <var title="">property</var> case-insensitively
  matches a specified property that has a priority user agents
  <em class="ct">must</em> return the canonical priority of that property as
  given in the syntax definition. Otherwise, the empty string
  <em class="ct">must</em> be returned.</p>

  <p class="note">For <code>background-color:lime !IMPORTANT</code> the return
  value would be <code>important</code>.</p>

  <p>The
  <dfn id="cssstyledeclaration-removeproperty" title="cssstyledeclaration-removeproperty"><code>removeProperty(<var title="">property</var>)</code></dfn>
  method, when invoked, if <var title="">property</var> case-insensitively
  matches a specified property user agents <em class="ct">must</em> remove that
  property declaration.</p>

  <p>The
  <dfn id="cssstyledeclaration-setproperty" title="cssstyledeclaration-setproperty"><code>setProperty(<var title="">property</var>,
  <var title="">value</var>, <var title="">priority</var>)</code></dfn> method
  gives a way to set a declaration. When invoked, user agents
  <em class="ct">must</em> run the following steps:</p>

  <ol>
   <li><p>If <var title="">property</var> does not case-insensitively match a
   supported property abort this algorithm.</p></li>

   <li><p>If <var title="">value</var> is <code>null</code> or the empty string
   invoke <code title="cssstyledeclaration-removeproperty">removeProperty</code>
   with <var title="">property</var> as argument and abort this
   algorithm.</p></li>

   <li><p>If the <var title="">priority</var> argument has been omitted let
   <var title="">priority</var> be <code>null</code>.</p></li>

   <li><p>If <var title="">priority</var> is neither a valid priority nor
   <code>null</code> or the empty string abort this algorithm.</p></li>

   <li>
    <p>If <span title="CSS value parsing">parsing the
    <var title="">value</var></span> returns "null" abort this algorithm.</p>

    <p class="note"><var title="">value</var> can not include
    <code>!important</code>.</p>
   </li>

   <li><p>Finally, set <var title="">property</var> to <var title="">value</var>
   with priority <var title="">priority</var> when <var title="">priority</var>
   is not <code>null</code> or the empty string. Otherwise set
   <var title="">property</var> to <var title="">value</var>.</p></li>
  </ol>
  
  <p>The
  <dfn id="cssstyledeclaration-length" title="cssstyledeclaration-length"><code>length</code></dfn>
  attribute <em class="ct">must</em> be the number of setted properties.</p>

  <p>The
  <dfn id="cssstyledeclaration-item" title="cssstyledeclaration-item"><code>item(<var title="">index</var>)</code></dfn>
  method, when invoked, <span class="issue">...</span>.</p>
  <!-- returns the value of property x stored at position item. -->

  <p>The
  <dfn id="cssstyledeclaration-parentrule" title="cssstyledeclaration-parentrule"><code>parentRule</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the
  <code>CSSrule</code> object the <code>CSSStyleDeclaration</code> is object is
  associated with or <code>null</code> if it is not associated with a
  <code>CSSrule</code> object.</p>

<!--
  <h4>CSS Properties</h4>

  <p>The DOM attribute name of a CSS property can be found by using the
  following algorithm:</p>

  <ol>
   <li>Let <var title="">r</var> be the CSS property to be
   converted.</li>

   <li>Uppercase the first character after every U+002D (<code>-</code>) in
   <var title="">r</var>.</li>

   <li>Remove every U+002D (<code>-</code>) in <var title="">r</var>.</li>

   <li>Return <var title="">r</var>.</li>
  </ol>

  <p class="note">This means that
  <code>-<var title="">vendor</var>-<var title="">property</var></code>
  becomes
  <code><var title=""><strong>V</strong>endor</var><var title=""><strong>P</strong>roperty</var></code>
  for instance.</p>
-->


  <h4>The <code title="">CSS2Properties</code> Interface</h4>

  <p class="issue">...</p>


  <h2 id="canon" >Canonicalization</h2>

  <p class="issue">This section will be integrated with the Cascading Style
  Sheets APIs section in due course.</p>

  <p>This section defines canonicalization of the various objects you typically
  encounter in <span>CSS style sheets</span>.</p>

  <p>The definitions from this section are used later to define attribute
  values, et cetera.</p>


  <h3>Media queries</h3>

  <p>The <dfn id="canon-media" title="canon-media">canonicalization of a media
   query</dfn> can be determined as follows:</p>

  <ol>
   <li>Convert each part of the media query to the case specified in the
    syntax. For example, <code>MaX-width</code> becomes
    <code>max-width</code>.</li>
   <li>Replace one or more consecutive <span>whitespace</span> characters with a
    U+0020 SPACE.</li>
   <li>Remove leading and trailing <span>whitespace</span>.
   <li>Remove <span>whitespace</span> between the media feature and the U+003A
    COLON.</li>
   <li>Remove <span>whitespace</span> between the media feature and the U+0028
    LEFT PARENTHESIS.</li>
   <li>Remove <span>whitespace</span> between the media feature value and the
    U+0029 RIGHT PARENTHESIS.</li>
   <li>Make sure there's exactly one U+0020 SPACE after the U+003A COLON which
    is then followed by its value.</li>
   <li>Sort the media features alphabetically ([a-z]).</li>
  </ol>

  <p class="issue">Did I miss anything?</p>

  <p class="issue">duplicate features?</p>

  <h4>Examples</h4>

  <div class="example">
   <p>The canonical form of the following query:</p>
   <pre>not screen and (min-width:5px) and   (max-width:40px  ) </pre>
   <p>would be:</p>
   <pre>not screen and (max-width: 40px) and (min-width: 5px)</pre>
  </div>






  <h2 class="no-num" id="references">References</h2>

  <p class="issue">This section will be done when going to Last Call. Before
  that state please ask the author whenever a reference is unclear.</p>


  <h2 class="no-num" id="acknowledgements">Acknowledgements</h2>

  <p>The editor would like to thank

  Alexey Feldgendler,
  Bjrn Hhrmann,
  David Baron,
  Hallvord R. M. Steen,
  Ian Hickson,
  Lachlan Hunt,
  Morten Stenshorne,
  Robert O'Callahan,
  Sjoerd Visscher,
  Simon Pieters, and
  Tarquin Wilton-Jones

  for contributing to this specification.</p>

  <p>Even more thanks to Ian Hickson for writing up the the initial version
  of the alternative style sheets API and canonicalization rules for CSS
  values.</p>
  
  <!-- XXX NOTES

  <style type=text/css;charset=utf-8> does create a StyleSheet in Firefox
  and Opera, but does not create a StyleSheet in IE. I prefer IE.

  <style type=TEXT/CSS> sets the style sheet type to text/css in Firefox and
  TEXT/CSS in Opera and IE. I prefer Firefox.

  <style> sets the style sheet location to the document location Firefox,
  the empty string in IE, and null in Opera. I prefer Opera

  <style media="x"> invokes .sheet.media.mediaText = "x"

  <style title=""> does not "have" a title
  -->
 </body>
</html>
