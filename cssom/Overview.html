<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html lang=en-US>
 <head>
  <title>Cascading Style Sheets Object Model (CSSOM)</title>

  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   dfn { font-weight:bold; font-style:normal }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   div.example table code { color:inherit }
   td, th { padding:.1em }
   .proposal { padding:.5em; border:solid blue }
   p.note {  margin-left:2em; color:green; font-style:italic; font-weight:bold }
   p.note::before { content:"Note: " }
   .issue { padding:.5em; border:solid red }
   .issue::before { content:"Issue: " }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
   .members dt { margin:.5em 0 }
   .members dd p:first-child { margin-top:0 }
   .members dd p:last-child { margin-bottom:0 }
  </style>
  <link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel=stylesheet>

 <body class=draft>
  <div class=head>
   <h1 id=cssom>Cascading Style Sheets Object Model (<abbr>CSSOM</abbr>)</h1>

   <h2 class="no-num no-toc" id="">Editor's Draft 27 December 2007</h2>

   <dl>
    <dt>This version:

    <dd><a
     href="http://dev.w3.org/csswg/cssom/">http://dev.w3.org/csswg/cssom/</a></dd>
    <!--<dd><a href="http://www.w3.org/TR/2007/ED-cssom-20071227/">http://www.w3.org/TR/2007/WD-cssom-20071227/</a></dd>-->

    <dt>Latest version:

    <dd><a href="http://www.w3.org/TR/cssom/">http://www.w3.org/TR/cssom/</a>

    <dt>Previous version:

    <dd><a
     href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/">http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/</a>

    <dt>Editor:

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a> (<a
     href="http://www.opera.com/">Opera Software ASA</a>) &lt;<a
     href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;
   </dl>
  </div>

  <h2 class="no-num no-toc" id=abstract>Abstract</h2>

  <p>The Cascading Style Sheets Object Model defines enables developers to
   find style sheets associated with a <code>Document</code> and to query and
   modify rules within a CSS style sheet (through an object model).

  <h2 class="no-num no-toc" id=sotd>Status of this Document</h2>
  <!--begin-status-->

  <p>This is a public copy of the editors' draft. It is provided for
   discussion only and may change at any moment. It probably contains errors.
   Its publication here does not imply endorsement of its contents by W3C.
   <!--end-status-->

  <p class=issue>This document is in its very early stages. The intention is
   that this specification will in due course supersede DOM Level 2 Style.

  <h2 class="no-num no-toc" id=toc>Table of Contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#introduction"><span class=secno>1. </span>Introduction</a>
    <ul class=toc>
     <li><a href="#history"><span class=secno>1.1. </span>History</a>
    </ul>

   <li><a href="#conformance"><span class=secno>2. </span>Conformance
    Requirements</a>
    <ul class=toc>
     <li><a href="#terminology"><span class=secno>2.1. </span>Terminology</a>
      
    </ul>

   <li><a href="#style"><span class=secno>3. </span>Style Sheets and the
    DOM</a>
    <ul class=toc>
     <li><a href="#style0"><span class=secno>3.1. </span>Style Sheet</a>
      <ul class=toc>
       <li><a href="#the-stylesheet"><span class=secno>3.1.1. </span>The
        <code title="">StyleSheet</code> Interface</a>

       <li><a href="#the-stylesheetlist"><span class=secno>3.1.2. </span>The
        <code title="">StyleSheetList</code> Interface</a>
      </ul>

     <li><a href="#media"><span class=secno>3.2. </span>Media Queries</a>
      <ul class=toc>
       <li><a href="#the-medialist"><span class=secno>3.2.1. </span>The
        <code>MediaList</code> Interface</a>
      </ul>

     <li><a href="#style1"><span class=secno>3.3. </span>Style Sheet
      Types</a>

     <li><a href="#accessing"><span class=secno>3.4. </span>Accessing Style
      Sheets</a>
      <ul class=toc>
       <li><a href="#the-linkstyle"><span class=secno>3.4.1. </span>The <code
        title="">LinkStyle</code> Interface</a>
        <ul class=toc>
         <li><a href="#requirements"><span class=secno>3.4.1.1.
          </span>Requirements on specifications</a>
        </ul>

       <li><a href="#requirements0"><span class=secno>3.4.2.
        </span>Requirements User Agents Implementing SVG</a>

       <li><a href="#requirements1"><span class=secno>3.4.3.
        </span>Requirements on User Agents Implementing
        <code>&lt;?xml-stylesheet?></code></a>

       <li><a href="#requirements2"><span class=secno>3.4.4.
        </span>Requirements on User Agents Implementing the HTTP <code
        title="">Link</code> Header</a>

       <li><a href="#the-documentstyle"><span class=secno>3.4.5. </span>The
        <code title="">DocumentStyle</code> Interface</a>
      </ul>

     <li><a href="#dynamically"><span class=secno>3.5. </span>Dynamically
      adding new style sheets</a>
      <ul class=toc>
       <li><a href="#adding"><span class=secno>3.5.1. </span>Adding style
        sheets</a>

       <li><a href="#changing"><span class=secno>3.5.2. </span>Changing the
        preferred style sheet set</a>

       <li><a href="#examples"><span class=secno>3.5.3. </span>Examples</a>
      </ul>

     <li><a href="#interaction"><span class=secno>3.6. </span>Interaction
      with the User Interface</a>
      <ul class=toc>
       <li><a href="#persisting"><span class=secno>3.6.1. </span>Persisting
        the selected style sheet set</a>
      </ul>

     <li><a href="#forward"><span class=secno>3.7. </span>Forward
      compatibility</a>
    </ul>

   <li><a href="#cascading"><span class=secno>4. </span>Cascading Style
    Sheets APIs</a>
    <ul class=toc>
     <li><a href="#parsing"><span class=secno>4.1. </span>Parsing and
      Serializing CSS Constructs</a>
      <ul class=toc>
       <li><a href="#css-value"><span class=secno>4.1.1. </span>CSS Value
        Rules</a>
        <ul class=toc>
         <li><a href="#examples0"><span class=secno>4.1.1.1. </span>Examples
          of the CSS Value Serializing Algorithm </a>
        </ul>

       <li><a href="#selectors"><span class=secno>4.1.2. </span>Selectors
        Rules</a>

       <li><a href="#css-page"><span class=secno>4.1.3. </span>CSS Page
        Selectors Rules</a>

       <li><a href="#processing"><span class=secno>4.1.4. </span>Processing
        CSS Statements</a>
      </ul>

     <li><a href="#the-cssstylesheet"><span class=secno>4.2. </span>The <code
      title="">CSSStyleSheet</code> Interface</a>

     <li><a href="#the-cssrulelist"><span class=secno>4.3. </span>The <code
      title="">CSSRuleList</code> Interface</a>

     <li><a href="#interfaces"><span class=secno>4.4. </span>Interfaces for
      CSS Statements</a>
      <ul class=toc>
       <li><a href="#the-cssrule"><span class=secno>4.4.1. </span>The <code
        title="">CSSRule</code> Interface</a>
        <ul class=toc>
         <li><a href="#extensibility"><span class=secno>4.4.1.1.
          </span>Extensibility</a>
        </ul>

       <li><a href="#the-cssstylerule"><span class=secno>4.4.2. </span>The
        <code title="">CSSStyleRule</code> Interface</a>

       <li><a href="#the-cssimportrule"><span class=secno>4.4.3. </span>The
        <code title="">CSSImportRule</code> Interface</a>

       <li><a href="#the-cssmediarule"><span class=secno>4.4.4. </span>The
        <code title="">CSSMediaRule</code> Interface</a>

       <li><a href="#the-cssfontfacerule"><span class=secno>4.4.5. </span>The
        <code title="">CSSFontFaceRule</code> Interface</a>

       <li><a href="#the-csspagerule"><span class=secno>4.4.6. </span>The
        <code title="">CSSPageRule</code> Interface</a>

       <li><a href="#the-cssnamespacerule"><span class=secno>4.4.7.
        </span>The <code title="">CSSNamespaceRule</code> Interface</a>
      </ul>

     <li><a href="#accessing0"><span class=secno>4.5. </span>Accessing
      declaration blocks</a>
      <ul class=toc>
       <li><a href="#introduction0"><span class=secno>4.5.1.
        </span>Introduction</a>

       <li><a href="#the-elementcssinlinestyle"><span class=secno>4.5.2.
        </span>The <code>ElementCSSInlineStyle</code> Interface</a>

       <li><a href="#the-viewcss"><span class=secno>4.5.3. </span>The <code
        title="">ViewCSS</code> Interface</a>

       <li><a href="#the-documentcss"><span class=secno>4.5.4. </span>The
        <code title="">DocumentCSS</code> Interface</a>
      </ul>

     <li><a href="#css-declaration-blocks"><span class=secno>4.6. </span>CSS
      Declaration Blocks</a>
      <ul class=toc>
       <li><a href="#the-cssstyledeclaration"><span class=secno>4.6.1.
        </span>The <code title="">CSSStyleDeclaration</code> Interface</a>

       <li><a href="#the-css2properties"><span class=secno>4.6.2. </span>The
        <code title="">CSS2Properties</code> Interface</a>
      </ul>
    </ul>

   <li><a href="#canon"><span class=secno>5. </span>Canonicalization</a>
    <ul class=toc>
     <li><a href="#media0"><span class=secno>5.1. </span>Media queries</a>
      <ul class=toc>
       <li><a href="#examples1"><span class=secno>5.1.1. </span>Examples</a>
      </ul>
    </ul>

   <li class=no-num><a href="#references">References</a>

   <li class=no-num><a href="#acknowledgements">Acknowledgements</a>
  </ul>
  <!--end-toc-->

  <h2 id=introduction><span class=secno>1. </span>Introduction</h2>

  <p class=issue>...

  <h3 id=history><span class=secno>1.1. </span>History</h3>

  <p>Several interfaces from DOM Level 2 Style <a
   href="http://www.w3.org/mid/Pine.LNX.4.05.10310302134070.1173-100000@lanalana.inria.fr"
   title="[CSSOM] CSSValue and related interfaces (message from the CSS
   WG)">have been obsoleted</a> because they where thought to be too awkward
   for frequent use. This specification no longer contains those features.
   <code>DOMImplementationCSS</code> and <code>CSSCharsetRule</code> have
   been removed as well as they were not deemed necessary.

  <h2 id=conformance><span class=secno>2. </span>Conformance Requirements</h2>

  <p>Everything in this specification is normative except for diagrams,
   examples, notes and sections marked non-normative.

  <p>The key words <em class=ct>must</em>, <em class=ct>must not</em>, <em
   class=ct>required</em>, <em class=ct>shall</em>, <em class=ct>shall
   not</em>, <em class=ct>should</em>, <em class=ct>should not</em>, <em
   class=ct>recommended</em>, <em class=ct>may</em>, and <em
   class=ct>optional</em> in the normative parts of this document are to be
   interpreted as described in [<cite><a
   href="#ref-rfc2119">RFC2119</a></cite>].

  <p>The following conformance classes are defined (and considered) by this
   specification:

  <dl>
   <dt><dfn id=conforming-implementation>conforming implementation</dfn>

   <dd>A user agent that implements all interfaces described in this
    specification and follows all <em class=ct>must</em>-, <em
    class=ct>required</em>- and <em class=ct>shall</em>-level of criteria in
    this specification.

   <dt><dfn id=conforming-document>conforming document</dfn>

   <dd>A document that follows all <em class=ct>must</em>-, <em
    class=ct>required</em>- and <em class=ct>shall</em>-level of criteria in
    this specification that apply to document authors.

   <dt><dfn id=conforming-authoring-tool>conforming authoring tool</dfn>

   <dd>One that produces conforming documents.
  </dl>

  <h3 id=terminology><span class=secno>2.1. </span>Terminology</h3>

  <p>A <dfn id=color>color component integer</dfn> is a base-ten integer in
   the range 0-255 using digits 0-9, U+0030 to U+0039, in the shortest form
   possible.

  <p>A <dfn id=color0>color component separator</dfn> is a literal U+002C
   COMMA followed by a U+0020 SPACE.

  <p>When this specification talks about object <code><var>A</var></code>
   where <code><var>A</var></code> is actually an interface, it generally
   means an object implementing interface <code><var>A</var></code>.</p>
  <!--
  <p>The term <dfn id="whitespace">whitespace</dfn> when  used in this
   specification refers to the U+0020 SPACE, U+0009 &lt;control>, U+000A
   &lt;control>, U+000D &lt;control> and U+000C &lt;control> (if
   applicable).</p>
  -->

  <p>The terms <dfn id=whitespace>whitespace</dfn> and <dfn
   id=style-sheet>style sheet</dfn> are used as defined in the <cite>CSS 2.1
   Specification</cite> [CSS21].

  <p>A <dfn id=css-style-sheet>CSS style sheet</dfn> is a <a
   href="#style-sheet">style sheet</a> that conforms to the CSS syntax rules.</p>
  <!-- XXX: "Cascading Style Sheet style sheet" is just a joke... -->

  <h2 id=style><span class=secno>3. </span>Style Sheets and the DOM</h2>

  <h3 id=style0><span class=secno>3.1. </span>Style Sheet</h3>

  <p>Each document has a collection of zero or more associated style sheets.
   A <dfn id=style-sheet>style sheet</dfn> is represented by an object that
   implements the <code><a href="#stylesheet">StyleSheet</a></code> interface
   (as described below) and has a number of properties that need to be set
   when a style sheet is created. These properties can be modified over time.

  <dl>
   <dt><dfn id=style-sheet-type>style sheet type</dfn>

   <dd>
    <p>A string that is the MIME type of the style sheet. [RFC2046].

   <dt><dfn id=style-sheet-location>style sheet location</dfn>

   <dd>
    <p>A string that is the URI of the style sheet's location or the
     <code>null</code> value if the style sheet was embedded within a
     document.

   <dt><dfn id=style-sheet-media>style sheet media</dfn>

   <dd>
    <p>A string with the media queries applicable to the style sheet. When
     the style sheet is created the <code>mediaText</code> attribute returned
     by the <code>media</code> attribute on the style sheet <em
     class=ct>must</em> be set to this string.

   <dt><dfn id=style-sheet-title>style sheet title</dfn>

   <dd>
    <p>A string that is the title of the style sheet. A style sheet is said
     to <dfn id=have-a>have a title</dfn> if this string is not the empty
     string.</p>

    <div class=example>
     <p>The following CSS style sheets have a style sheet title that is the
      empty string:</p>

     <pre>&lt;style title=""> body { background:lime } &lt;/style></pre>

     <pre>&lt;style> body { background:lime } &lt;/style></pre>
    </div>

   <dt><dfn id=style-sheet-alternate-flag>style sheet alternate flag</dfn>

   <dd>
    <p>...</p>

    <div class=example>
     <p>The following style sheets have their style sheet alternate flag set
      to <i>true</i>:</p>

     <pre>&lt;?xml-stylesheet alternate="yes" title="x" href="data:text/css,&hellip;"?></pre>

     <pre>&lt;link rel="alternate stylesheet" title="x" href="data:text/css,&hellip;"></pre>
    </div>

   <dt><dfn id=style2>style sheet disabled flag</dfn>

   <dd>
    <p>...</p>

    <p class=note>This flag is independent of whether the style sheet is
     actually applied. That depends on the style sheet media as well, for
     instance.</p>
  </dl>

  <p>Specifications <em class=ct>must not</em> allow the creation of <a
   href="#style-sheet" title="style sheet">style sheets</a> with the <a
   href="#style-sheet-alternate-flag">style sheet alternate flag</a> set to
   <i>true</i> and the <a href="#style-sheet-title">style sheet title</a> set
   to the empty string.

  <h4 id=the-stylesheet><span class=secno>3.1.1. </span>The <code
   title="">StyleSheet</code> Interface</h4>

  <pre class=idl>interface <dfn id=stylesheet>StyleSheet</dfn> {
  readonly attribute DOMString <a href="#stylesheet-type" title=stylesheet-type>type</a>;
           attribute boolean <a href="#stylesheet-disabled" title=stylesheet-disabled>disabled</a>;
  readonly attribute Node <a href="#stylesheet-ownernode" title=stylesheet-ownernode>ownerNode</a>;
  readonly attribute <a href="#stylesheet">StyleSheet</a> <a href="#stylesheet-parentstylesheet" title=stylesheet-parentstylesheet>parentStyleSheet</a>;
  readonly attribute DOMString <a href="#stylesheet-href" title=stylesheet-href>href</a>;
  readonly attribute DOMString <a href="#stylesheet-title" title=stylesheet-title>title</a>;
  [PutForwards=mediaText] readonly attribute <a href="#medialist">MediaList</a> <a href="#stylesheet-media" title=stylesheet-media>media</a>;
};</pre>

  <p class=note>CSS style sheets objects implement the <code><a
   href="#cssstylesheet">CSSStyleSheet</a></code> interface which inherits
   from the <code><a href="#stylesheet">StyleSheet</a></code> interface.

  <p>The <dfn id=stylesheet-type
   title=stylesheet-type><code>type</code></dfn> attribute, on getting, <em
   class=ct>must</em> return the <a href="#style-sheet-type">style sheet
   type</a>.

  <p>The <dfn id=stylesheet-disabled
   title=stylesheet-disabled><code>disabled</code></dfn> attribute, on
   getting, <em class=ct>must</em> return <code>true</code> when the <a
   href="#style2">style sheet disabled flag</a> is <i>true</i> and
   <code>false</code> if that flag is <i>false</i>. On setting, it <em
   class=ct>must</em> set the <a href="#style2">style sheet disabled flag</a>
   to <i>true</i> if set to <code>true</code>, and set the flag to
   <i>false</i> if set to <code>false</code>.

  <p>The <dfn id=stylesheet-ownernode
   title=stylesheet-ownernode><code>ownerNode</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the <code>Node</code> that
   associates the style sheet with the document or it <em class=ct>must</em>
   return <code>null</code> if there is no such <code>Node</code>.

  <p class=note>The aformentioned <code>Node</code> has implemented the
   <code><a href="#linkstyle">LinkStyle</a></code> interface.

  <p>The <dfn id=stylesheet-parentstylesheet
   title=stylesheet-parentstylesheet><code>parentStyleSheet</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the <code><a
   href="#stylesheet">StyleSheet</a></code> object that caused the inclusion
   of the current style sheet or <code>null</code> if there is no such
   object.

  <p>The <dfn id=stylesheet-href
   title=stylesheet-href><code>href</code></dfn> attribute, on getting, <em
   class=ct>must</em> return the <a href="#style-sheet-location">style sheet
   location</a>.

  <p>The <dfn id=stylesheet-title
   title=stylesheet-title><code>title</code></dfn> attribute, on getting, <em
   class=ct>must</em> return the <a href="#style-sheet-title">style sheet
   title</a>.

  <p>The <dfn id=stylesheet-media
   title=stylesheet-media><code>media</code></dfn> attribute, on getting, <em
   class=ct>must</em> return an object implementing the <code><a
   href="#medialist">MediaList</a></code> interface that represents the <a
   href="#style-sheet-media">style sheet media</a>.

  <h4 id=the-stylesheetlist><span class=secno>3.1.2. </span>The <code
   title="">StyleSheetList</code> Interface</h4>

  <p>The object implementing this interface represents an ordered collection
   of objects implementing the <code><a
   href="#stylesheet">StyleSheet</a></code> interface. Items in this
   collection are accessible through an integral index, starting from zero.

  <pre class=idl>interface <dfn id=stylesheetlist>StyleSheetList</dfn> {
  readonly attribute unsigned long <a href="#stylesheetlist-length" title=stylesheetlist-length>length</a>;
  [IndexGetter] <a href="#stylesheet">StyleSheet</a> <a href="#stylesheetlist-item" title=stylesheetlist-item>item</a>(in unsigned long <var title="">index</var>);
};</pre>

  <p>The <dfn id=stylesheetlist-length
   title=stylesheetlist-length><code>length</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the number of objects currently in
   the list.

  <p>The <dfn id=stylesheetlist-item
   title=stylesheetlist-item><code>item(<var
   title="">index</var>)</code></dfn> method, when invoked, <em
   class=ct>must</em> return the <code><a
   href="#stylesheet">StyleSheet</a></code> object in the list given by
   <var>index</var>. If <var>index</var> is less than zero or greater than or
   equal to the number of objects in the list then this method <em
   class=ct>must</em> raise an <code>INDEX_SIZE_ERR</code> exception.

  <h3 id=media><span class=secno>3.2. </span>Media Queries</h3>

  <p>creating a MediaList object?

  <p>parsing and serializing ...

  <h4 id=the-medialist><span class=secno>3.2.1. </span>The <code><a
   href="#medialist">MediaList</a></code> Interface</h4>

  <div class=issue>
   <p>There are several rules:</p>

   <ul>
    <li>No duplicates

    <li>Canonicalized on getting
   </ul>
  </div>

  <p>Objects implementing the <code><a href="#medialist">MediaList</a></code>
   interface represent an ordered collection of media queries. Items in this
   collection are accessible through an integral index, starting from zero.

  <pre class=idl>interface <dfn id=medialist>MediaList</dfn> {
           attribute DOMString <a href="#medialist-mediatext" title=medialist-mediatext>mediaText</a>;
  readonly attribute unsigned long <a href="#medialist-length" title=medialist-length>length</a>;
  [IndexGetter] DOMString <a href="#medialist-item" title=medialist-item>item</a>(in unsigned long <var title="">index</var>);
  void <a href="#medialist-appendmedium" title=medialist-appendmedium>appendMedium</a>(in DOMString <var title="">medium</var>)
  void <a href="#medialist-deletemedium" title=medialist-deletemedium>deleteMedium</a>(in DOMString <var title="">medium</var>)
};</pre>

  <p>In bindings that allow it, such as ECMAScript, <code><a
   href="#medialist">MediaList</a></code> objects <em class=ct>must</em>
   stringify to their <code title=medialist-mediatext><a
   href="#medialist-mediatext">mediaText</a></code> attribute's value.</p>
  <!-- XXX Web IDL ^^ -->

  <p>The <dfn id=medialist-mediatext
   title=medialist-mediatext><code>mediaText</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the results of <span>serializing a
   list of media queries</span>. On setting, the media queries currently in
   the collection <em class=ct>must</em> be replaced with the result of
   <span>parsing a list of media queries</span>.</p>
  <!-- XXX definitions -->

  <p>The <dfn id=medialist-length
   title=medialist-length><code>length</code></dfn> attribute, on getting,
   <em class=ct>must</em> return the number of items in the collection.

  <p>The <dfn id=medialist-item title=medialist-item><code>item(<var
   title="">index</var>)</code></dfn> method, when invoked, <em
   class=ct>must</em> return the item in the collection given by
   <var>index</var>. If <var>index</var> is less than zero or greater than or
   equal to the number of media queries currently in the collection then this
   method <em class=ct>must</em> raise an <code>INDEX_SIZE_ERR</code>
   exception.

  <p>The <dfn id=medialist-appendmedium
   title=medialist-appendmedium><code>appendMedium(<var
   title="">medium</var>)</code></dfn> method, when invoked, <span
   class=issue>...</span>.

  <p>The <dfn id=medialist-deletemedium
   title=medialist-deletemedium><code>deleteMedium(<var
   title="">medium</var>)</code></dfn> method, when invoked, <em
   class=ct>must</em> raise a <code>NOT_FOUND_ERR</code> exception when
   <var>medium</var> is not in the collection. Otherwise, <var>medium</var>
   <em class=ct>must</em> be removed from the collection.

  <h3 id=style1><span class=secno>3.3. </span>Style Sheet Types</h3>

  <p>Lets see, we have persistent style sheets, alternative style sheet sets,
   preferred style sheet sets

  <h3 id=accessing><span class=secno>3.4. </span>Accessing Style Sheets</h3>

  <h4 id=the-linkstyle><span class=secno>3.4.1. </span>The <code
   title="">LinkStyle</code> Interface</h4>

  <p>The <code><a href="#linkstyle">LinkStyle</a></code> interface provides a
   bridge between the node that takes care of the embedding or inclusion of a
   <a href="#style-sheet">style sheet</a> and the <code><a
   href="#stylesheet">StyleSheet</a></code> object representing the style
   sheet.

  <p class=note>The <code>style</code> content attribute found in various
   markup languages does not embed, or represent, a style sheet.

  <pre class=idl>interface <dfn id=linkstyle>LinkStyle</dfn> {
  readonly attribute <a href="#stylesheet">StyleSheet</a> <a href="#linkstyle-sheet" title=linkstyle-sheet>sheet</a>;
};</pre>

  <p>The <dfn id=linkstyle-sheet
   title=linkstyle-sheet><code>sheet</code></dfn> attribute, on getting, <em
   class=ct>must</em> return the associated <code><a
   href="#stylesheet">StyleSheet</a></code> object, or <code>null</code>, if
   there is no associated <code><a href="#stylesheet">StyleSheet</a></code>
   object.

  <div class=example>
   <p>In the following HTML snippet the first HTML <code>style</code> element
    has a <code>sheet</code> attribute that returns a <code><a
    href="#stylesheet">StyleSheet</a></code> object representing the CSS
    style sheet, but for the second <code>style</code> attribute it returns
    <code>null</code>. (Assuming the user agent supports CSS
    (<code>text/css</code>) and does not support ExampleSheets
    (<code>text/example-sheets</code>).</p>

   <pre>&lt;style type=text/css> body { background:lime } &lt;/style>
&lt;style type=text/example-sheets> $(body).background := lime &lt;/style></pre>
  </div>

  <p class=note>Whether or not the node refers to a style sheet is defined by
   the specification that defines the semantics of said node.

  <h5 id=requirements><span class=secno>3.4.1.1. </span>Requirements on
   specifications</h5>

  <p>Specifications introducing new ways of associating style sheets through
   the DOM <em class=ct>should</em> define which <code>Node</code>s implement
   the <code><a href="#linkstyle">LinkStyle</a></code> interface. These
   specifications <em class=ct>should</em> also define how the various
   properties of a <a href="#style-sheet">style sheet</a> are set when <code
   title=linkstyle-sheet><a href="#linkstyle-sheet">sheet</a></code> is not
   <code>null</code>.

  <p class=note>This specification defines it for SVG,
   <code>&lt;?xml-stylesheet?></code>, and the HTTP <code>Link</code> header
   for the time being.

  <h4 id=requirements0><span class=secno>3.4.2. </span>Requirements User
   Agents Implementing SVG</h4>

  <p><em>This section applies to user agents implementing SVG.</em>

  <p>SVG user agents <em class=ct>must</em> implement the <code><a
   href="#linkstyle">LinkStyle</a></code> interfaces on objects implementing
   the <code>SVGStyleElement</code> interface.

  <p class=issue>...

  <h4 id=requirements1><span class=secno>3.4.3. </span>Requirements on User
   Agents Implementing <code>&lt;?xml-stylesheet?></code></h4>

  <p><em>This section applies to user agents implementing
   <code>&lt;?xml-stylesheet?></code>.</em>

  <p>User agents supporting supporting <code>&lt;?xml-stylesheet?></code> <em
   class=ct>must</em> implement the <code><a
   href="#linkstyle">LinkStyle</a></code> on objects implementing
   <code>ProcessingInstruction</code>.

  <p>If the <code title="">target</code> DOM attribute of the
   <code>ProcessingInstruction</code> is not <code>xml-stylesheet</code> then
   the <code title=linkstyle-sheet><a
   href="#linkstyle-sheet">sheet</a></code> attribute of the node's <code><a
   href="#linkstyle">LinkStyle</a></code> interface <em class=ct>must</em>
   return <code>null</code>.

  <p>Else, if the <code title="">target</code> DOM attribute is
   <code>xml-stylesheet</code> but the specified resource has not completed
   downloading, or is not a supported style sheet language the <code
   title=linkstyle-sheet><a href="#linkstyle-sheet">sheet</a></code>
   attribute of the node's <code><a href="#linkstyle">LinkStyle</a></code>
   interface <em class=ct>must</em> return <code>null</code>.

  <p>Otherwise, a new <a href="#style-sheet">style sheet</a> <em
   class=ct>must</em> be created with <a href="#style-sheet-type">style sheet
   type</a> set to the canonical type, <a href="#style-sheet-location">style
   sheet location</a> to the location of the style sheet, <a
   href="#style-sheet-title">style sheet title</a> to the value of the <code
   title="">title</code> pseudo-attribute, <a href="#style-sheet-media">style
   sheet media</a> to the value of the <code title="">media</code>
   pseudo-attribute, the <a href="#style-sheet-alternate-flag">style sheet
   alternate flag</a> to <i>true</i> if the <code title="">alternate</code>
   pseudo-attribute is "<code>yes</code>" and <i>false</i> otherwise, and the
   <a href="#style2">style sheet disabled flag</a> to <i>false</i>.

  <h4 id=requirements2><span class=secno>3.4.4. </span>Requirements on User
   Agents Implementing the HTTP <code title="">Link</code> Header</h4>

  <p class=issue>...

  <h4 id=the-documentstyle><span class=secno>3.4.5. </span>The <code
   title="">DocumentStyle</code> Interface</h4>

  <p>Any object implementing the <code>Document</code> interface <em
   class=ct>must</em> also implement the <code><a
   href="#documentstyle">DocumentStyle</a></code> interface.</p>
  <!-- https://bugzilla.mozilla.org/show_bug.cgi?id=200930 (FIXED) -->

  <pre class=idl>interface <dfn id=documentstyle>DocumentStyle</dfn> {
  readonly attribute <a href="#stylesheetlist">StyleSheetList</a> <a href="#documentstyle-stylesheets">styleSheets</a>;
           attribute DOMString <a href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a>;
  readonly attribute DOMString <a href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a>;
  readonly attribute DOMString <a href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a>;
  readonly attribute DOMStringList <a href="#documentstyle-styleSheetSets">styleSheetSets</a>;
  void <a href="#documentstyle-enablestylesheetsforset" title=documentstyle-enablestylesheetsforset>enableStylesheetsForSet</a>(in DOMString <var>name</var>);
};</pre>
  <!-- XXX Web IDL \/ -->

  <p>For this interface, the <code>DOMString</code> values <code>null</code>
   and "the empty string" are distinct and <em class=ct>must</em> not be
   considered equivalent.

  <dl class=members>
   <dt><dfn id=documentstyle-stylesheets><code>styleSheets</code></dfn> of
    type <code><a href="#stylesheetlist">StyleSheetList</a></code>

   <dd>
    <p>This attribute <em class=ct>must</em> be a <code><a
     href="#stylesheetlist">StyleSheetList</a></code> object containing a
     collection of all <code><a href="#stylesheet">StyleSheet</a></code>
     objects in document order (those returned by <code
     title=linkstyle-sheet><a href="#linkstyle-sheet">sheet</a></code>
     attribute on objects implementing the <code><a
     href="#linkstyle">LinkStyle</a></code> interface) preceded by style
     sheets introduced through the HTTP <code>Link</code> header.

   <dt><dfn
    id=documentstyle-selectedStyleSheetSet><code>selectedStyleSheetSet</code></dfn>
    of type <code>DOMString</code>

   <dd>
    <p>This attribute indicates which <span>style sheet set</span> is in use.
     This attribute is <span>live</span>; changing the <code
     title=stylesheet-disabled><a
     href="#stylesheet-disabled">disabled</a></code> attribute on style
     sheets directly will change the value of this attribute.</p>

    <p>If all the sheets that are enabled and <a href="#have-a">have a
     title</a> have the <em>same</em> title (by <span>case-sensitive</span>
     comparisons) then the value of this attribute <em class=ct>must</em> be
     exactly equal to the title of the first enabled style sheet with a title
     in the <code><a href="#documentstyle-stylesheets">styleSheets</a></code>
     list. Otherwise, if style sheets from different sets are enabled, then
     the return value <em class=ct>must</em> be <code>null</code> (there is
     no way to determine what the currently selected style sheet set is in
     those conditions). Otherwise, either all style sheets that <a
     href="#have-a">have a title</a> are disabled, or there are no
     alternative style sheets, and <code><a
     href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
     <em class=ct>must</em> return the empty string.</p>

    <p>Setting this attribute to the <code>null</code> value <em
     class=ct>must</em> have no effect.</p>

    <p>Setting this attribute to a non-<code>null</code> value <em
     class=ct>must</em> call <code
     title=documentstyle-enablestylesheetsforset><a
     href="#documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</a></code>
     with that value as the method's argument, and set <code><a
     href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code> to
     that value.</p>

    <p>From the DOM's perspective, all views have the same <code><a
     href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>.
     If a user agent supports multiple views with different selected
     alternative style sheets, then this attribute (and the <code><a
     href="#stylesheet">StyleSheet</a></code> interface's
     <code>disabled</code> attribute) <em class=ct>must</em> return and set
     the value for the default view.</p>

   <dt><dfn
    id=documentstyle-lastStyleSheetSet><code>lastStyleSheetSet</code></dfn>
    of type <code>DOMString</code>, readonly

   <dd>
    <p>This attribute <em class=ct>must</em> initially have the value
     <code>null</code>. Its value changes when the <code><a
     href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
     attribute is set.</p>

   <dt><dfn
    id=documentstyle-preferredStyleSheetSet><code>preferredStyleSheetSet</code></dfn>
    of type <code>DOMString</code>, readonly

   <dd>
    <p>This attribute <em class=ct>must</em> be the preferred style sheet set
     as set by the author. It is determined from the order of style sheet
     declarations and the <code>Default-Style</code> HTTP headers. If there
     is no preferred style sheet set, this attribute <em class=ct>must</em>
     be the empty string. The case of this attribute <em class=ct>must</em>
     exactly match the case given by the author where the preferred style
     sheet is specified or implied. This attribute <em class=ct>must</em>
     never be <code>null</code>.</p>

   <dt><dfn id=documentstyle-styleSheetSets><code>styleSheetSets</code></dfn>
    of type <code>DOMStringList</code>, readonly

   <dd>
    <p>This <em class=ct>must</em> be a <span>live</span> list of the
     currently available <span>style sheet sets</span>. This list is
     constructed by enumerating all the style sheets for this document
     available to the implementation, in the order they are listed in the
     <code><a href="#documentstyle-stylesheets">styleSheets</a></code>
     attribute, adding the title of each style sheet <a href="#have-a"
     title="have a title">with a title</a> to the list, avoiding duplicates
     by dropping titles that match (<span>case-sensitively</span>) titles
     that have already been added to the list.</p>

   <dt><dfn id=documentstyle-enablestylesheetsforset
    title=documentstyle-enablestylesheetsforset><code>enableStylesheetsForSet(<var
    title="">name</var>)</code></dfn>, method

   <dd>
    <p>Invoking this method <em class=ct>must</em> change the <code
     title=stylesheet-disabled><a
     href="#stylesheet-disabled">disabled</a></code> attribute on each
     <code><a href="#stylesheet">StyleSheet</a></code> object <a
     href="#have-a" title="have a title">with a title</a> in the <code><a
     href="#documentstyle-stylesheets">styleSheets</a></code> attribute, so
     that all those whose title matches the <var title="">name</var> argument
     are enabled, and all others are disabled. Title matches <em
     class=ct>must</em> be <span>case-sensitive</span>.</p>

    <p>Invoking this method with the empty string value <em
     class=ct>must</em> disable all alternative and preferred style sheets
     (but does not change the state of persistent style sheets).</p>

    <p>Invoking this method with the <code>null</code> value <em
     class=ct>must</em> have no effect.</p>
    <!-- fact: -->
    <p>Style sheets that do not <a href="#have-a">have a title</a> are never
     affected by this method. This method does not change the values of the
     <code><a
     href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code> or
     <code><a
     href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
     attributes.</p>
  </dl>

  <h3 id=dynamically><span class=secno>3.5. </span>Dynamically adding new
   style sheets</h3>

  <p>If new style sheets <a href="#have-a" title="have a title">with
   titles</a> are added to the document, the user agent <em
   class=ct>must</em> decide whether or not the style sheets should be
   initially enabled or not. How this happens depends on the exact state of
   the document at the time the style sheet is added, as follows.

  <h4 id=adding><span class=secno>3.5.1. </span>Adding style sheets</h4>

  <p>First, if the style sheet is a preferred style sheet (it <a
   href="#have-a" title="have a title">has a title</a>, but is not marked as
   alternative), and there is no current preferred style sheet (the <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   attribute is equal to the empty string) then the <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   attribute is set to the exact value of this style sheet's title. (This
   changes the preferred style sheet set, which causes further changes
   &mdash; see below.)

  <p>Then, for all sheets, if any of the following is true, then the style
   sheet <em class=ct>must</em> be enabled:

  <ul>
   <li>The style sheet has an empty title.

   <li>The <code><a
    href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code> is
    <code>null</code>, and the style sheet's title matches (by
    <span>case-sensitive</span> match) the value of the <code><a
    href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
    attribute.

   <li>The style sheet's title matches (by <span>case-sensitive</span> match)
    the value of the <code><a
    href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
    attribute.
  </ul>

  <p>Otherwise, the style sheet <em class=ct>must</em> be disabled.

  <h4 id=changing><span class=secno>3.5.2. </span>Changing the preferred
   style sheet set</h4>

  <p>The first time the <span>preferred style sheet</span> set is set, which
   is either before any alternative style sheets are seen (e.g. using a
   <code>Default-Style</code> HTTP header), or is the first time a titled,
   non-alternative style sheet is seen (in the absence of information to the
   contrary, the first titled non-alternative sheet sets the name of the
   preferred set), the <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   attribute's value <em class=ct>must</em> be set to the name of that
   preferred style sheet set. This does not change the <code><a
   href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
   attribute.

  <p>If the user agent has the preferred style sheet set changed, for example
   if it receives a <code>Default-Style</code> HTTP header after it receives
   HTTP <code>Link</code> headers implying another preferred style sheet,
   then the <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   attribute's value <em class=ct>must</em> be changed appropriately, and, if
   the <code><a
   href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code> is
   <code>null</code>, the <code
   title=documentstyle-enablestylesheetsforset><a
   href="#documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</a></code>
   method <em class=ct>must</em> be called with the new <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   value. (The <code><a
   href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
   attribute is, again, not changed.)

  <h4 id=examples><span class=secno>3.5.3. </span>Examples</h4>

  <div class=example>
   <p>Thus, in the following HTML snippet:</p>

   <pre>&lt;link rel="alternate stylesheet" title="foo" href="a"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="b"&gt;
&lt;script&gt;

  document.selectedStyleSheetSet = 'foo';
  document.styleSheets[1].disabled = false;
&lt;/script&gt;
&lt;link rel="alternate stylesheet" title="foo" href="c"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="d"&gt;</pre>

   <p>...the style sheets that end up enabled are style sheets "a", "b", and
    "c", the <code><a
    href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
    attribute would return null, <code><a
    href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
    would return "foo", and <code><a
    href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
    would return "".</p>

   <p>Similarly, in the following HTML snippet:</p>

   <pre>&lt;link rel="alternate stylesheet" title="foo" href="a"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="b"&gt;
&lt;script&gt;
  var before = document.preferredStyleSheetSet;
  document.styleSheets[1].disabled = false;
&lt;/script&gt;
&lt;link rel="stylesheet" title="foo" href="c"&gt;

&lt;link rel="alternate stylesheet" title="bar" href="d"&gt;
&lt;script&gt;
  var after = document.preferredStyleSheetSet;
&lt;/script&gt;</pre>

   <p>...the "before" variable will be equal to the empty string, the "after"
    variable will be equal to "foo", and style sheets "a" and "c" will be
    enabled. This is the case even though the first script block sets style
    sheet "b" to be enabled, because upon parsing the following
    <code>&lt;link&gt;</code> element, the <code><a
    href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
    is set and the <code title=documentstyle-enablestylesheetsforset><a
    href="#documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</a></code>
    method is called (since <code><a
    href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
    was never set explicitly, leaving <code><a
    href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code> at
    <code>null</code> throughout), which changes which style sheets are
    enabled and which are not.</p>
  </div>

  <h3 id=interaction><span class=secno>3.6. </span>Interaction with the User
   Interface</h3>

  <p>The user interface of Web browsers that support style sheets <em
   class=ct>should</em> list the style sheet titles given in the <code><a
   href="#documentstyle-styleSheetSets">styleSheetSets</a></code> list,
   showing the <code><a
   href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
   as the selected style sheet set, leaving none selected if it is
   <code>null</code> or the empty string, and selecting an extra option
   "Basic Page Style" (or similar) if it is the empty string and the <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   is the empty string as well.

  <p>Selecting a style sheet from this list should set the <code><a
   href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
   attribute. This (by definition) affects the <code><a
   href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
   attribute.

  <h4 id=persisting><span class=secno>3.6.1. </span>Persisting the selected
   style sheet set</h4>

  <p>If UAs persist the selected style sheet set, they should use the value
   of the <code><a
   href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
   attribute, or if that is <code>null</code>, the <code><a
   href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
   attribute, when leaving the page (or at some other time) to determine the
   set name to store. If that is <code>null</code> then the style sheet set
   should not be persisted.

  <p>When re-setting the style sheet set to the persisted value (which can
   happen at any time, typically at the first time the style sheets are
   needed for styling the document, after the <code>&lt;head&gt;</code> of
   the document has been parsed, after any scripts that are not dependent on
   computed style have executed), the style sheet set should be set by
   setting the <code><a
   href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
   attribute as if the user had selected the set manually.

  <p class=note>This specification does not give any suggestions on how UAs
   should decide to persist the style sheet set or whether or how to persist
   the selected set across pages.

  <h3 id=forward><span class=secno>3.7. </span>Forward compatibility</h3>

  <p>Future versions of CSS may introduce ways of having alternative style
   sheets declared at levels lower than the top level, i.e. embedded within
   other style sheets. Implementations of this specification that also
   support this proposed declaration of alternative style sheets are expected
   to perform depth-first traversals of the <code><a
   href="#documentstyle-stylesheets">styleSheets</a></code> list, not simply
   enumerations of the <code><a
   href="#documentstyle-stylesheets">styleSheets</a></code> list that only
   contains the top level.

  <p class=issue>Would that actually work?!

  <h2 id=cascading><span class=secno>4. </span>Cascading Style Sheets APIs</h2>

  <p><em>This section (and its subsections) are only applicable to user
   agents implementing CSS.</em>

  <p>The previous section provided a way of getting access to style sheets in
   a generic way. This section provides a way for getting access to the
   individual style rules within a Cascading Style Sheet as defined by the
   CSS specifications. [CSS]

  <h3 id=parsing><span class=secno>4.1. </span>Parsing and Serializing CSS
   Constructs</h3>
  <!--
   statement "[S|CDO|CDC]* [ import [S|CDO|CDC]* ]* [ [ ruleset | media | page ] [S|CDO|CDC]* ]*" ??

   selectors "*"
   page selectors "S* pseudo_page? S*"

   declaration "S* declaration" (properties, property values, property priority)

   property value "S* expr"
  -->

  <p>This section (and its subsections) define rules for parsing and
   serialization of CSS constructs.

  <h4 id=css-value><span class=secno>4.1.1. </span>CSS Value Rules</h4>

  <p>The rules for <dfn id=parsing0 title="CSS value parsing">parsing a CSS
   value</dfn> for a given <var title="">property</var> are as given in the
   following algorithm. The result is either a CSS value or "null" if the
   operation failed.

  <ol>
   <li>Parse the value using the <code>S* expr</code> production in
    combination with the allowed values for the given <var
    title="">property</var>. If this fails return "null". Otherwise return
    the parsed value.
  </ol>

  <p>The aforementioned production is defined in the CSS 2.1 specification.
   [CSS]

  <p>The rules for <dfn id=serializing title="CSS value
   serializing">serializing a CSS value</dfn> are as given in the following
   algorithm:

  <ol>
   <li>
    <p>Relative lengths (<code>em</code>, <code>ex</code>, <code>px</code>,
     all the font-size keywords and <code>%</code>) do not have their units
     changed. However, absolute lengths must be given in millimeters. For
     example, the canonical version of <code>+012.0pt</code> is
     <code>4.2333mm</code> (give or take a few significant figures). <span
     class=note><em>Computed</em> values may well be in different units than
     the specified value. User agents are to use <code>px</code> as their
     final units for computed length values.</span>

   <li>
    <p>When a <code>&lt;length></code> of zero is given, then any specified
     units <em class=ct>must</em> be removed.
   </li>
   <!-- apparently "0px" is better for interop -->

   <li>
    <p>A <code>&lt;color></code> value is canonicalized as follows:</p>

    <dl>
     <dt>It is a system color

     <dd>See below (you use the representation given in the specification
      that defines the keyword).

     <dt>Alpha component is equal to 1.0

     <dd>The color is an uppercase six-digit hexadecimal value, prefixed with
      a <code>#</code> character (U+0023 NUMBER SIGN), with the first two
      digits representing the red component, the next two digits representing
      the green component, and the last two digits representing the blue
      component, the digits being in the range 0-9 A-F (U+0030 to U+0039 and
      U+0041 to U+0046).

     <dt>Alpha component is less than 1.0

     <dd>The color is in the CSS <code>rgba()</code> functional-notation
      format: the literal string <code>rgba</code> (U+0072 U+0067 U+0062
      U+0061) followed by a U+0028 LEFT PARENTHESIS, a <a href="#color">color
      component integer</a> representing the red component, a <a
      href="#color0">color component separator</a>, a <a href="#color">color
      component integer</a> for the green component, a <a
      href="#color0">color component separator</a>, a <a href="#color">color
      component integer</a> for the blue component, another <a
      href="#color0">color component separator</a> a U+0030 DIGIT ZERO, a
      U+002E FULL STOP (representing the decimal point), one or more digits
      in the range 0-9 (U+0030 to U+0039) representing the fractional part of
      the alpha value, and finally a U+0029 RIGHT PARENTHESIS.

     <dt>The keyword <code>transparent</code> is used

     <dd>The color is <code>rgba(0, 0, 0, 0)</code>.
    </dl>

   <li>
    <p>Angles are canonicalized to <code>deg</code> and normalized to the
     range of their property. For example, <code>azimuth: 700grad</code>
     would be canonicalized to <code>azimuth: 270deg</code>. This also
     applies to angle keywords as used in the <code>elevation</code> and
     <code>azimuth</code> properties, they are canonicalized to their value
     in degrees.

   <li>
    <p>Times are canonicalized to seconds (<code>s</code>).

   <li>
    <p>Frequencies are canonicalized to Hertz (<code>Hz</code>).

   <li>
    <p>For all integers and real numbers, including those with units, these
     canonicalization steps <em class=ct>must</em> be followed: If the number
     is <code>0</code>, the canonical result is the literal string
     <code>0</code> plus any units (for lengths, the unit identifier will
     have been removed before this step). Otherwise, leading
     <!--and trailing -->zeros <em class=ct>must</em> be omitted, any leading
     <code>+</code> <em class=ct>must</em> be omitted, the decimal point in a
     real number <em class=ct>must</em> be omitted unless there is a
     fractional part, and if the number is in the range <code>-1 &lt;
     <var>x</var> &lt; 1</code>, then one leading <code>0</code> <em
     class=ct>must</em> be inserted before the decimal point. The number of
     given significant figures is completely user agent dependent.

   <li>
    <p>Where multiple values may appear in any order without changing the
     meaning of the value (typically represented by a double bar
     <code>||</code> in the value syntax), user agents are to use the
     canonical order as given in the syntax (e.g. <code>&lt;border-width>
     &lt;border-style> &lt;color></code> for the <code>border</code>
     short-hand property).

   <li>
    <p>When repeated values may be omitted without changing the meaning of
     the value (e.g. as in the <code>margin</code> and <code>padding</code>
     properties), then the fewest number of values should be given.

   <li>
    <p>If whitespace may be removed without changing the meaning of the value
     it is to be removed.

   <li>
    <p><code>&lt;specific-voice></code> and <code>&lt;family-name</code>
     values are to be quoted.

   <li>
    <p>Double quotes (rather than single quotes) <em class=ct>shall</em> be
     used for string quotation. (When changing from single quotes to double
     quotes, double quotes already in the string are escaped.)

   <li>
    <p>The quotes in the <code>&lt;uri></code> form should be removed.
     (Parenthesises that were in the string, along with any other characters
     not legal when the string is not quoted (such as commas), must be
     escaped.)

   <li>
    <p>Unnecessary escapes should be removed. (For example, <code>\z</code>
     should be represented as <code>z</code>. This extends to unescaping
     UNICODE escapes, except, of course, if the encoding cannot contain those
     characters!)

   <li>
    <p>Where components of the value may be dropped without changing the
     meaning of the value (for example, initial values in shorthand
     properties), then they should be removed. If this would remove all the
     values, then the first allowed value must be given (For example, for
     <code>background</code> that would be <code>rgba(0, 0, 0, 0)</code>
     since <code>background-color</code> is the first component of the value;
     for <code>border</code> it would be <code>0</code> since the first
     component of that value is <code>border-width</code>).

   <li>
    <p>A single space should be added after each comma that is not part of a
     string, except where that would change the meaning of the value. For
     example:</p>

    <pre>foo,bar,baz</pre>

    <p>should become:</p>

    <pre>foo, bar, baz</pre>

   <li>
    <p>Whenever case is insensitive, for example in property or counter
     names, the text should be changed to the canonical case as given in the
     syntax definition. For example, the canonical value of:</p>

    <pre>COUNTER( PAR-NUM,UPPER-ROMAN ) DISC</pre>

    <p>is:</p>

    <pre>counter(par-num, upper-roman) disc</pre>

    <p>but the color <code>WINDOWTEXT</code> becomes <code>WindowText</code>.</p>
  </ol>

  <h5 id=examples0><span class=secno>4.1.1.1. </span>Examples of the CSS
   Value Serializing Algorithm</h5>

  <p>The steps above should guarantee that there is no data loss, from a CSS
   point of
   view<!--, other than for color values on systems with colors stored
  with more than 32 bits-->.
   Here are some examples of before and after results on specified values.
   The before column could be what the author wrote in a stylesheet, while
   the after column shows what querying the DOM would return.

  <div class=example>
   <table>
    <thead>
     <tr>
      <th>Before

      <th>After

    <tbody>
     <tr>
      <td><code>background: none</code>

      <td><code>background: rgba(0, 0, 0, 0)</code>

     <tr>
      <td><code>outline: none</code>

      <td><code>outline: invert</code>

     <tr>
      <td><code>border: none</code>

      <td><code>border: medium</code>

     <tr>
      <td><code>list-style: none</code>

      <td><code>list-style: disc</code>

     <tr>
      <td><code>margin: 0px 1px 1px 1px</code>

      <td><code>margin: 0 1px 1px</code>

     <tr>
      <td><code>azimuth: behind left</code>

      <td><code>azimuth: 220deg</code>

     <tr>
      <td><code>font-family: a, 'b"', serif</code>

      <td><code>font-family: "a", "b\"", serif</code>

     <tr>
      <td><code>content: url('h)i') '\[\]'</code>

      <td><code>content: url(h\)i) "[]"</code>

     <tr>
      <td><code>azimuth: leftwards</code>

      <td><code>azimuth: leftwards</code>

     <tr>
      <td><code>color: rgb(18, 52, 86)</code>

      <td><code>color: #123456</code>

     <tr>
      <td><code>color: rgba(000001, 0, 0, 1)</code>

      <td><code>color: #000000</code>
   </table>
  </div>

  <h4 id=selectors><span class=secno>4.1.2. </span>Selectors Rules</h4>

  <p>The rules for <dfn id=parsing1 title=selectors-parsing>parsing a group
   of selectors</dfn> are as given in the following algorithm. The return
   value is either a group of selectors or "null" (if parsing failed).

  <ol>
   <li>Parse the value using the <code>selectors_group</code> production. If
    this fails return "null". Otherwise return the parsed value.
  </ol>

  <p>The aforementioned production is defined in the Selectors specification.
   [Selectors]

  <p>The rules for <dfn id=serializing0 title="selectors
   serializing">serializing a group of selectors</dfn> are as given in the
   following algorithm. The input is a a non-normalized group of selectors
   and the output is a normalized group of selectors.

  <ol>
   <li>
    <p>Replace one or more consecutive <a href="#whitespace">whitespace</a>
     characters with a single U+0020 character.

   <li>
    <p>Remove leading and trailing <a href="#whitespace">whitespace</a>.

   <li>
    <p>Make sure combinators other than the descendant combinator are
     preceded and followed by a single U+0020 character (and not more).

   <li>
    <p>Make sure each U+002C (<code>,</code>) character is followed by a
     single U+0020 character (and not more).

   <li>
    <p>Convert pseudo-classes and pseudo-elements to their canonical form as
     given in the specification. <span class=note><code>:HOver</code> becomes
     <code>:hover</code> and <code>:befoRe</code> becomes
     <code>::before</code> for example.</span>

   <li>
    <p class=issue>Hmm, what about pseudo-classes taking arguments? Attribute
     selectors? Namespace prefixes?
  </ol>

  <h4 id=css-page><span class=secno>4.1.3. </span>CSS Page Selectors Rules</h4>

  <p class=issue>Need to define the rules for <dfn id=parsing2 title="CSS
   page selector parsing">parsing a CSS page selector</dfn> and <dfn
   id=serializing1 title="CSS page selector serializing">serializing a CSS
   page selector</dfn>.

  <h4 id=processing><span class=secno>4.1.4. </span>Processing CSS Statements</h4>

  <p class=issue>Need to split this up in parsing and common algorithms.

  <p>The rules for <dfn id=inserting title="insert a statement">inserting a
   statement</dfn> are as given in the following algorithm. The variables
   <var>rule</var>, <var>rule list</var> and <var>index</var> are to be
   considered equivalent to the identically named variables used when
   invoking this algorithm. If an exception is raised the algorithm is to be
   aborted. The steps <em class=ct>must</em> be followed in order, as
   follows:

  <ol>
   <li>
    <p>If <var>index</var> is negative or greater than the length of the
     <var>rule list</var> an <code>INDEX_SIZE_ERR</code> exception <em
     class=ct>must</em> be raised.

   <li>
    <p>Parse <var>rule</var> as a CSS statement. If the <var>rule</var> is
     ignored by the CSS parser abort this algorithm (don't raise an
     exception). Otherwise, create an object that implements one of the
     inherited interfaces of <code>CSSStyle</code> appropriate for the parsed
     <var>rule</var>. Let <var>object</var> be the newly created object.

   <li>
    <p>If <var>object</var> can't be inserted within the <var>rule list</var>
     at the given <var>index</var> because that's not allowed per the CSS
     specification a <code>HIERARCHY_REQUEST_ERR</code> exception <em
     class=ct>must</em> be raised.

   <li>
    <p>Insert <var>object</var> at the given <var>index</var> within the
     <var>rule list</var>.
  </ol>

  <p>The rules for <dfn id=removing title="remove a statement">removing a
   statement</dfn> are as given in the following algorithm. The variables
   <var>index</var> and <var>rule list</var> are to be considered equivalent
   to the identically named variables used when invoking this algorithm. If
   an exception is raised this algorithm is to be aborted. The steps <em
   class=ct>must</em> be followed in order, as follows:

  <ol>
   <li>
    <p>If <var>index</var> is negative or greater than the length of the
     <var>rule list</var> an <code>INDEX_SIZE_ERR</code> exception <em
     class=ct>must</em> be raised.

   <li>
    <p>Remove the object at <var>index</var> from <var>rule list</var>.
  </ol>

  <p>The rules for <dfn id=replacing title="replace a statement">replacing a
   statement</dfn> are as given in the following algorithm. The variable
   <var>rule</var> and <var>old object</var> are to be considered equivalent
   to the identically named variables used when invoking this algorithm. If
   an exception is raised this algorithm is to be aborted. The steps <em
   class=ct>must</em> be followed in order, as follows:

  <ol>
   <li>
    <p>Parse <var>rule</var> as a CSS statement. If the <var>rule</var> is
     ignored by the CSS parser abort this algorithm (don't raise an
     exception). Otherwise, create an object that implements one of the
     inherited interfaces of <code>CSSStyle</code> appropriate for the parsed
     <var>rule</var>. Let <var>object</var> be the newly created object.

   <li>
    <p>If the <code title=cssrule-type><a
     href="#cssrule-type">type</a></code> of <var>object</var> does not match
     the <code title=cssrule-type><a href="#cssrule-type">type</a></code> of
     <var>old object</var> it will replace user agents <em class=ct>must</em>
     raise an <code>INVALID_MODIFICATION_ERR</code> exception.

   <li>
    <p>Replace <var>old object</var> with <var>object</var>.
  </ol>

  <h3 id=the-cssstylesheet><span class=secno>4.2. </span>The <code
   title="">CSSStyleSheet</code> Interface</h3>

  <p>The <code><a href="#cssstylesheet">CSSStyleSheet</a></code> interface
   represents a <a href="#css-style-sheet">CSS style sheet</a>.</p>
  <!--
   IE exposes:
   owningElement, pages, id, type, href, disabled, cssText, readOnly, title,
   parentStyleSheet, imports, rules, media
  -->

  <pre
   class=idl>interface <dfn id=cssstylesheet>CSSStyleSheet</dfn> : <a href="#stylesheet">StyleSheet</a> {
  readonly attribute <a href="#cssrule">CSSRule</a> <a href="#cssstylesheet-ownerrule">ownerRule</a>;
  readonly attribute <a href="#cssrulelist">CSSRuleList</a> <a href="#cssstylesheet-cssrules" title=cssstylesheet-cssrules>cssRules</a>;
  unsigned long <a href="#cssstylesheet-insertrule" title=cssstylesheet-insertrule>insertRule</a>(in DOMString <var>rule</var>, in unsigned long <var>index</var>);
  void <a href="#cssstylesheet-deleterule" title=cssstylesheet-deleterule>deleteRule</a>(in unsigned long <var>index</var>);
};</pre>

  <p>The <dfn id=cssstylesheet-ownerrule><code>ownerRule</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the <code><a
   href="#cssimportrule">CSSImportRule</a></code> that caused this style
   sheet to be imported (if any). Otherwise, if no <code><a
   href="#cssimportrule">CSSImportRule</a></code> caused it to be imported
   the attribute <em class=ct>must</em> return <code>null</code>.

  <p>The <dfn id=cssstylesheet-cssrules
   title=cssstylesheet-cssrules><code>cssRules</code></dfn> attribute, on
   getting, <em class=ct>must</em> return a <code><a
   href="#cssrulelist">CSSRuleList</a></code> object consisting of a list of
   statements in order they were found in the <a href="#css-style-sheet">CSS
   style sheet</a>.

  <p class=note>Statements that were dropped during parsing can not be found
   using these APIs.

  <p>The <dfn id=cssstylesheet-insertrule
   title=cssstylesheet-insertrule><code>insertRule(<var title="">rule</var>,
   <var title="">index</var>)</code></dfn> method, when invoked, <em
   class=ct>must</em> <a href="#inserting">insert a statement</a> where
   <var>rule</var> is <var>rule</var>, <var>index</var> is <var>index</var>
   and <var>rule list</var> is <code title=cssstylesheet-cssrules><a
   href="#cssstylesheet-cssrules">cssRules</a></code>.

  <p>The <dfn id=cssstylesheet-deleterule
   title=cssstylesheet-deleterule><code>deleteRule(<var
   title="">index</var>)</code></dfn> method, when invoked, <em
   class=ct>must</em> <a href="#removing">remove a statement</a> where
   <var>index</var> is <var>index</var> and <var>rule list</var> is <code
   title=cssmediarule-cssrules><a
   href="#cssmediarule-cssrules">cssRules</a></code>.

  <h3 id=the-cssrulelist><span class=secno>4.3. </span>The <code
   title="">CSSRuleList</code> Interface</h3>

  <p>The <code><a href="#cssrulelist">CSSRuleList</a></code> object
   represents an (ordered) list of statements.

  <pre class=idl>interface <dfn id=cssrulelist>CSSRuleList</dfn> {
  readonly attribute unsigned long <a href="#cssrulelist-length" title=cssrulelist-length>length</a>;
  <a href="#cssrule">CSSRule</a> <a href="#cssrulelist-item" title=cssrulelist-item>item</a>(in unsigned long <var title="">index</var>);
};</pre>

  <p>The <dfn id=cssrulelist-length
   title=cssrulelist-length><code>length</code></dfn> attribute, on getting,
   <em class=ct>must</em> return the number of items associated with the
   object.

  <p>The <dfn id=cssrulelist-item title=cssrulelist-item><code>item(<var
   title="">index</var>)</code></dfn> method, when invoked, if <var
   title="">index</var> is equal or greater than the <code
   title=cssrulelist-length><a href="#cssrulelist-length">length</a></code>
   this method <em class=ct>must</em> return <code>null</code>. Otherwise,
   this method <em class=ct>must</em> return the <code><a
   href="#cssrule">CSSRule</a></code> in the list given by <var
   title="">index</var>. <!-- negative numbers -->

  <h3 id=interfaces><span class=secno>4.4. </span>Interfaces for CSS
   Statements</h3>

  <p>This section defines several specific interfaces for different types of
   CSS statements and one generic from which the more specific inherit.

  <h4 id=the-cssrule><span class=secno>4.4.1. </span>The <code
   title="">CSSRule</code> Interface</h4>

  <p>The <code><a href="#cssrule">CSSRule</a></code> interface is the base
   interface from which all other CSS statement interfaces inherit.

  <pre class=idl>interface <dfn id=cssrule>CSSRule</dfn> {
  // CSS statement type
  const unsigned short <a href="#cssrule-style-rule">STYLE_RULE</a> = 1;
  const unsigned short <a href="#cssrule-import-rule">IMPORT_RULE</a> = 3;
  const unsigned short <a href="#cssrule-media-rule">MEDIA_RULE</a> = 4;
  const unsigned short <a href="#cssrule-font-face-rule">FONT_FACE_RULE</a> = 5;
  const unsigned short <a href="#cssrule-page-rule">PAGE_RULE</a> = 6;
  const unsigned short <a href="#cssrule-namespace-rule">NAMESPACE_RULE</a> = 7;
  readonly attribute unsigned short <a href="#cssrule-type" title=cssrule-type>type</a>;

  // Textual representation
           attribute DOMString <a href="#cssrule-csstext" title=cssrule-csstext>cssText</a>;
  
  // Context information
  readonly attribute <a href="#cssrule">CSSRule</a> <a href="#cssrule-parentrule" title=cssrule-parentrule>parentRule</a>;
  readonly attribute <a href="#cssstylesheet">CSSStyleSheet</a> <a href="#cssrule-parentstylesheet" title=cssrule-parentstylesheet>parentStyleSheet</a>;
};</pre>

  <p>The <dfn id=cssrule-type title=cssrule-type><code>type</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the CSS statement
   type as detailed for each specific type.

  <p>The <dfn id=cssrule-csstext
   title=cssrule-csstext><code>cssText</code></dfn> attribute allows for
   replacing a CSS statement or getting a textual representation. On setting,
   user agents <em class=ct>must</em> <a href="#replacing">replace a
   statement</a> where <var>rule</var> is the value being set and <var>old
   object</var> is the object of which this attribute is set.

  <p>On getting the <code title=cssrule-csstext><a
   href="#cssrule-csstext">cssText</a></code> attribute, <span
   class=issue>...</span>.

  <p>The <dfn id=cssrule-parentrule
   title=cssrule-parentrule><code>parentRule</code></dfn> attribute <em
   class=ct>must</em> return the nearest enclosing rule of the current rule
   or <code>null</code> if there is no enclosing rule. For example, an <code
   title="">@media</code> block enclosing the current rule.

  <p>The <dfn id=cssrule-parentstylesheet
   title=cssrule-parentstylesheet><code>parentStyleSheet</code></dfn>
   attribute <em class=ct>must</em> return the <code><a
   href="#cssstylesheet">CSSStyleSheet</a></code> object that contains the
   the current rule.

  <h5 id=extensibility><span class=secno>4.4.1.1. </span>Extensibility</h5>

  <p>The constant values 0-1000 are reserved for future use by the CSS WG.

  <p>Vendors are encouraged to use reasonably unique values outside this
   range so that they do not clash with extensions from other vendors. For
   example, the first value for Mozilla could be
   <code>0x0<strong>8EC0</strong>001</code> and
   <code>0x<strong>09E8A</strong>001</code> could be the first for Opera.

  <p>Vendors are encouraged to prefix the new interface names with a vendor
   specific prefix. For example, "Example company" could have an interface
   called "ExampleCSSTestRule".

  <p>In general, vendors are encouraged to discuss extensions on a public
   forum, such as <code>www-style@w3.org</code>.

  <h4 id=the-cssstylerule><span class=secno>4.4.2. </span>The <code
   title="">CSSStyleRule</code> Interface</h4>

  <p>The <code><a href="#cssstylerule">CSSStyleRule</a></code> object
   represents a ruleset specified (if any) in a <a
   href="#css-style-sheet">CSS style sheet</a>. It provides access to a
   declaration block as well as to the associated group of selectors.

  <p>Objects implementing the <code><a
   href="#cssstylerule">CSSStyleRule</a></code> interface can be identified
   by the <dfn id=cssrule-style-rule><code>STYLE_RULE</code></dfn> constant.
   On these objects the <code title=cssrule-type><a
   href="#cssrule-type">type</a></code> attribute <em class=ct>must</em>
   return the value of that constant.

  <pre
   class=idl>interface <dfn id=cssstylerule>CSSStyleRule</dfn> : <a href="#cssrule">CSSRule</a> {
           attribute DOMString <a href="#cssstylerule-selectortext" title=cssstylerule-selectortext>selectorText</a>;
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <a href="#cssstylerule-style" title=cssstylerule-style>style</a>;
};</pre>

  <p>The <dfn id=cssstylerule-selectortext
   title=cssstylerule-selectortext><code>selectorText</code></dfn> attribute
   allows for manipulation of the associated group of selectors or getting a
   textual representation of them. On setting, user agents <em
   class=ct>must</em> parse the given string as a group of selectors. If the
   given string is ignored user agents <em class=ct>must</em> act as if
   setting did not occur. Otherwise, set the attribute to the parsed string
   and re-apply the style rules stored in the <code
   title=cssstylerule-style><a href="#cssstylerule-style">style</a></code>
   attribute.

  <p>When getting the <code title=cssstylerule-selectortext><a
   href="#cssstylerule-selectortext">selectorText</a></code> attribute it <em
   class=ct>must</em> return a <span title=canon-selectors>textual
   representation of the group of selectors</span>.

  <p>The <dfn id=cssstylerule-style
   title=cssstylerule-style><code>style</code></dfn> attribute <em
   class=ct>must</em> return a live <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> object for the
   ruleset.

  <h4 id=the-cssimportrule><span class=secno>4.4.3. </span>The <code
   title="">CSSImportRule</code> Interface</h4>

  <p>Objects implementing the <code><a
   href="#cssimportrule">CSSImportRule</a></code> interface can be identified
   by the <dfn id=cssrule-import-rule><code>IMPORT_RULE</code></dfn>
   constant. On these objects the <code title=cssrule-type><a
   href="#cssrule-type">type</a></code> attribute <em class=ct>must</em>
   return the value of that constant.

  <p>The <code><a href="#cssimportrule">CSSImportRule</a></code> object
   represents an <code>@import</code> rule specified (if any) in a <a
   href="#css-style-sheet">CSS style sheet</a>.

  <pre
   class=idl>interface <dfn id=cssimportrule>CSSImportRule</dfn> : <a href="#cssrule">CSSRule</a> {
  readonly attribute DOMString <a href="#cssimportrule-href" title=cssimportrule-href>href</a>;
  readonly attribute <a href="#medialist">MediaList</a> <a href="#cssimportrule-media" title=cssimportrule-media>media</a>;
  readonly attribute <a href="#cssstylesheet">CSSStyleSheet</a> <a href="#cssimportrule-stylesheet" title=cssimportrule-stylesheet>styleSheet</a>;
};</pre>

  <p>The <dfn id=cssimportrule-href
   title=cssimportrule-href><code>href</code></dfn> attribute, on getting,
   <em class=ct>must</em> return the <em>specified</em> URI of the style
   sheet referenced by the <code>@import</code> rule.

  <p>The <dfn id=cssimportrule-media
   title=cssimportrule-media><code>media</code></dfn> attribute, on getting,
   <em class=ct>must</em> return a live <code><a
   href="#medialist">MediaList</a></code> object containing a list of media
   queries applicable to the imported style sheet as specified by the
   <code>@import</code> rule.

  <p>The <dfn id=cssimportrule-stylesheet
   title=cssimportrule-stylesheet><code>styleSheet</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the <code><a
   href="#cssstylesheet">CSSStyleSheet</a></code> object that represents the
   referenced (parsed) style sheet from the <code>@import</code> rule.

  <p class=note>If loading of the style sheet fails its <code
   title=cssstylesheet-cssrules><a
   href="#cssstylesheet-cssrules">cssRules</a></code> list is simply empty.

  <h4 id=the-cssmediarule><span class=secno>4.4.4. </span>The <code
   title="">CSSMediaRule</code> Interface</h4>

  <p>Objects implementing the <code><a
   href="#cssmediarule">CSSMediaRule</a></code> interface can be identified
   by the <dfn id=cssrule-media-rule><code>MEDIA_RULE</code></dfn> constant.
   On these objects the <code title=cssrule-type><a
   href="#cssrule-type">type</a></code> attribute <em class=ct>must</em>
   return the value of that constant.

  <p>The <code><a href="#cssmediarule">CSSMediaRule</a></code> object
   represents an <code title="">@media</code> rule specified (if any) in a <a
   href="#css-style-sheet">CSS style sheet</a>. It is a single statement that
   contains zero or more rulesets which are contrained by one or more media
   queries (unless one happens to be <code>all</code>).

  <pre
   class=idl>interface <dfn id=cssmediarule>CSSMediaRule</dfn> : <a href="#cssrule">CSSRule</a> {
  readonly attribute <a href="#medialist">MediaList</a> <a href="#cssmediarule-media" title=cssmediarule-media>media</a>;
  readonly attribute <a href="#cssrulelist">CSSRuleList</a> <a href="#cssmediarule-cssrules" title=cssmediarule-cssrules>cssRules</a>;
  unsigned long <a href="#cssmediarule-insertrule" title=cssmediarule-insertrule>insertRule</a>(in DOMString <var>rule</var>, in unsigned long <var>index</var>);
  void <a href="#cssmediarule-deleterule" title=cssmediarule-deleterule>deleteRule</a>(in unsigned long <var>index</var>);
};</pre>

  <p>The <dfn id=cssmediarule-media
   title=cssmediarule-media><code>media</code></dfn> attribute, on getting,
   <em class=ct>must</em> return a <code><a
   href="#medialist">MediaList</a></code> object containing a list of media
   queries specified with the <code title="">@media</code> rule.

  <p>The <dfn id=cssmediarule-cssrules
   title=cssmediarule-cssrules><code>cssRules</code></dfn> attribute, on
   getting, <em class=ct>must</em> return a <code><a
   href="#cssrulelist">CSSRuleList</a></code> object containing a list of all
   the rulesets specified within the <code title="">@media</code> rule.

  <p>The <dfn id=cssmediarule-insertrule
   title=cssmediarule-insertrule><code>insertRule(<var title="">rule</var>,
   <var title="">index</var>)</code></dfn> method, when invoked, <em
   class=ct>must</em> <a href="#inserting">insert a statement</a> where
   <var>rule</var> is <var>rule</var>, <var>index</var> is <var>index</var>
   and <var>rule list</var> is <code title=cssmediarule-cssrules><a
   href="#cssmediarule-cssrules">cssRules</a></code>.

  <p>The <dfn id=cssmediarule-deleterule
   title=cssmediarule-deleterule><code>deleteRule(<var
   title="">index</var>)</code></dfn> method, when invoked, <em
   class=ct>must</em> <a href="#removing">remove a statement</a> where
   <var>index</var> is <var>index</var> and <var>rule list</var> is <code
   title=cssmediarule-cssrules><a
   href="#cssmediarule-cssrules">cssRules</a></code>.

  <h4 id=the-cssfontfacerule><span class=secno>4.4.5. </span>The <code
   title="">CSSFontFaceRule</code> Interface</h4>

  <p>Objects implementing the <code><a
   href="#cssfontfacerule">CSSFontFaceRule</a></code> interface can be
   identified by the <dfn
   id=cssrule-font-face-rule><code>FONT_FACE_RULE</code></dfn> constant. On
   these objects the <code title=cssrule-type><a
   href="#cssrule-type">type</a></code> attribute <em class=ct>must</em>
   return the value of that constant.

  <p>The <code><a href="#cssfontfacerule">CSSFontFaceRule</a></code> object
   represents an <code>@font-face</code> rule specified (if any) in a <a
   href="#css-style-sheet">CSS style sheet</a>.

  <pre
   class=idl>interface <dfn id=cssfontfacerule>CSSFontFaceRule</dfn> : <a href="#cssrule">CSSRule</a> {
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <a href="#cssfontfacerule-style" title=cssfontfacerule-style>style</a>;
};</pre>

  <p>The <dfn id=cssfontfacerule-style
   title=cssfontfacerule-style><code>style</code></dfn> attribute <em
   class=ct>must</em> return a <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> block that
   contains the property declarations specified within the
   <code>@font-face</code> rule.

  <h4 id=the-csspagerule><span class=secno>4.4.6. </span>The <code
   title="">CSSPageRule</code> Interface</h4>

  <p>Objects implementing the <code><a
   href="#csspagerule">CSSPageRule</a></code> interface can be identified by
   the <dfn id=cssrule-page-rule><code>PAGE_RULE</code></dfn> constant. On
   these objects the <code title=cssrule-type><a
   href="#cssrule-type">type</a></code> attribute <em class=ct>must</em>
   return the value of that constant.

  <p>The <code><a href="#csspagerule">CSSPageRule</a></code> object
   represents an <code>@page</code> rule specified (if any) in a <a
   href="#css-style-sheet">CSS style sheet</a>.

  <pre
   class=idl>interface <dfn id=csspagerule>CSSPageRule</dfn> : <a href="#cssrule">CSSRule</a> {
           attribute DOMString <a href="#csspagerule-selectortext" title=csspagerule-selectortext>selectorText</a>;
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <a href="#csspagerule-style" title=csspagerule-style>style</a>;
};</pre>

  <p>The <dfn id=csspagerule-selectortext
   title=csspagerule-selectortext><code>selectorText</code></dfn> allows for
   setting a new page selector or getting the textual representation of the
   current one. On setting, user agents <em class=ct>must</em> parse the
   given string as a page selector. If the given string is ignored user
   agents <em class=ct>must</em> act as if setting did not occur. Otherwise,
   the attribute <em class=ct>must</em> be set to the parsed string and the
   styles <em class=ct>must</em> be re-applied.

  <p>When getting the <code title=csspagerule-selectortext><a
   href="#csspagerule-selectortext">selectorText</a></code> attribute it <em
   class=ct>must</em> return a textual representation of the page selector
   for the rule.

  <p class=issue>We need to define normalization...

  <p>The <dfn id=csspagerule-style
   title=csspagerule-style><code>style</code></dfn> attribute, on getting,
   <em class=ct>must</em> return a <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> that contains
   the specified property declarations within the <code>@page</code> rule.

  <h4 id=the-cssnamespacerule><span class=secno>4.4.7. </span>The <code
   title="">CSSNamespaceRule</code> Interface</h4>

  <p>Objects implementing the <code><a
   href="#cssnamespacerule">CSSNamespaceRule</a></code> interface can be
   identified by the <dfn
   id=cssrule-namespace-rule><code>NAMESPACE_RULE</code></dfn> constant. On
   these objects the <code title=cssrule-type><a
   href="#cssrule-type">type</a></code> attribute <em class=ct>must</em>
   return the value of that constant.

  <p>The <code><a href="#cssnamespacerule">CSSNamespaceRule</a></code> object
   represents an <code>@namespace</code> rule specified (if any) in a <a
   href="#css-style-sheet">CSS style sheet</a> that consists of a prefix and
   namespace.

  <pre
   class=idl>interface <dfn id=cssnamespacerule>CSSNamespaceRule</dfn> : <a href="#cssrule">CSSRule</a> {
  readonly attribute DOMString <a href="#cssnamespacerule-namespaceuri">namespaceURI</a>;
  readonly attribute DOMString <a href="#cssnamespacerule-prefix">prefix</a>;
};</pre>

  <p>The <dfn
   id=cssnamespacerule-namespaceuri><code>namespaceURI</code></dfn>
   attribute, on getting, <em class=ct>must</em> return specified namespace
   IRI from the <code>@namespace</code> rule.

  <p>The <dfn id=cssnamespacerule-prefix><code>prefix</code></dfn> attribute,
   on getting, <em class=ct>must</em> return the specified prefix from the
   <code>@namespace</code> rule or the empty string if there is no prefix.</p>
  <!-- XXX lowercased? -->

  <h3 id=accessing0><span class=secno>4.5. </span>Accessing declaration
   blocks</h3>

  <p>This section provides various way to get to declaration blocks which you
   can then manipulate.

  <h4 id=introduction0><span class=secno>4.5.1. </span>Introduction</h4>

  <p class=issue>...

  <h4 id=the-elementcssinlinestyle><span class=secno>4.5.2. </span>The
   <code><a href="#elementcssinlinestyle">ElementCSSInlineStyle</a></code>
   Interface</h4>

  <pre
   class=idl>interface <dfn id=elementcssinlinestyle>ElementCSSInlineStyle</dfn> {
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <span>style</span>;
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <a href="#elementcssinlinestyle-currentstyle" title=elementcssinlinestyle-currentstyle>currentStyle</a>;
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <span>runtimeStyle</span>;
};</pre>

  <p class=issue>...

  <p>The <dfn id=elementcssinlinestyle-currentstyle
   title=elementcssinlinestyle-currentstyle><code>currentStyle</code></dfn>
   attribute, when called, <em class=ct>must</em> return a <a
   href="#readonly" title="readonly declaration">readonly
   <code>CSSStyleDeclaration</code></a> object which represents the computed
   style for the element on which it was called.

  <p class=issue>Serialization of the <code>style</code> attribute is not
   guaranteed to work.

  <h4 id=the-viewcss><span class=secno>4.5.3. </span>The <code
   title="">ViewCSS</code> Interface</h4>

  <p>Objects implementing the <code>Window</code> interface <em
   class=ct>must</em> also implement the <code><a
   href="#viewcss">ViewCSS</a></code> interface.</p>
  <!-- XXX wtf!? -->

  <p>Since a computed style is related to an <code>Element</code> node, if
   this element is removed from the document, the associated <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> is no longer
   valid.

  <pre class=idl>interface <dfn id=viewcss>ViewCSS</dfn> {
  <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <a href="#viewcss-getcomputedstyle">getComputedStyle</a>(in Element <var title="">elt</var>);
  <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <a href="#viewcss-getcomputedstyle">getComputedStyle</a>(in Element <var title="">elt</var>, in DOMString <var title="">pseudoElt</var>);
};</pre>

  <p>The <dfn id=viewcss-getcomputedstyle><code>getComputedStyle</code></dfn>
   method <em class=ct>must</em> return a live <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> object that
   contains the computed style declaration block for <var title="">elt</var>,
   when the <var title="">pseudoElt</var> argument is <code>null</code>, the
   empty string or omitted. Otherwise, for the pseudo-element <var
   title="">pseudoElt</var> of <var title="">elt</var>. [CSS]

  <p>If <var title="">pseudoElt</var> is not a recognized CSS pseudo-element
   the invocation the method <em class=ct>must</em> return <span
   class=issue>...</span>.

  <h4 id=the-documentcss><span class=secno>4.5.4. </span>The <code
   title="">DocumentCSS</code> Interface</h4>

  <p class=issue><code>runtimeStyle</code> is way better than this feature.

  <p>This interface represents a document with a CSS view.</p>
  <!--
    so this is how this all comes together:

    UA style sheet
    User style sheet
    Author style sheet
    Override ("temporary") style sheet
    Author !important styles
    Override !important styles
    User !important styles

    on getting you actually don't create an override style sheet you just read
    the computed style of a certain property. this should be clear.

    that's what runtimeStyle should do more or less. removeAttribute() allows
    you to remove the current style... removeAttribute is such an ugly name

    currentStyle works sort of like this
  -->

  <p>The <code><a
   href="#documentcss-getoverridestyle">getOverrideStyle</a></code> method
   provides a mechanism through which a DOM author could effect immediate
   change to the style of an element without modifying the explicitly linked
   style sheets of a document or the inline style of elements in the style
   sheets. This style sheet comes after the author style sheet in the cascade
   algorithm and is called override style sheet. The override style sheet
   takes precedence over author style sheets. An <code>!important</code>
   declaration in an author style sheet still takes precedence over a normal
   declaration in an author style sheet. Override, author and user style
   sheets may all contain <code>!important</code> declarations. User
   <code>!important</code> rules take precedence over both override and
   author <code>!important</code> rules, and override <code>!important</code>
   rules take precedence over author <code>!important</code> rules.

  <p>The expectation is that an instance of the <code><a
   href="#documentcss">DocumentCSS</a></code> interface can be obtained by
   using binding-specific casting methods on an instance of the
   <code>Document</code> interface.

  <pre
   class=idl>interface <dfn id=documentcss>DocumentCSS</dfn> : <a href="#documentstyle">DocumentStyle</a> {
  <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <a href="#documentcss-getoverridestyle">getOverrideStyle</a>(in Element <var>elt</var>, in DOMString <var>pseudoElt</var>);
};</pre>

  <p>The <dfn
   id=documentcss-getoverridestyle><code>getOverrideStyle</code></dfn> method
   <em class=ct>must</em> return the override style declaration for the
   <code>Element</code> <var>elt</var> (when <var title="">pseudoElt</var> is
   <code>null</code>) or for the pseudo-element <var>pseudoElt</var> of
   <code>Element</code> <var title="">elt</var>.

  <p>For language bindings that support optional arguments invoking <code><a
   href="#documentcss-getoverridestyle">getOverrideStyle</a></code> without
   the <var>pseudoElt</var> argument <em class=ct>must</em> be identical to
   invoking the method with that argument being <code>null</code>.

  <h3 id=css-declaration-blocks><span class=secno>4.6. </span>CSS Declaration
   Blocks</h3>

  <p>The interfaces described in this section provide generic and convenient
   attributes for manipulating CSS declaration blocks.

  <h4 id=the-cssstyledeclaration><span class=secno>4.6.1. </span>The <code
   title="">CSSStyleDeclaration</code> Interface</h4>

  <p>The <code><a href="#cssstyledeclaration">CSSStyleDeclaration</a></code>
   interface gives access to read and manipulate CSS properties and their
   values within a declaration block.

  <p>If an attribute or method returns an object implementing the <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> interface (and
   related interfaces) and says the object is <dfn id=readonly
   title="readonly declaration">readonly</dfn> user agents <em
   class=ct>must</em> raise a <code>NO_MODIFICATION_ALLOWED_ERR</code>
   exception on an attempt to modify the object.

  <p class=note>Invoking <code title=cssstyledeclaration-removeproperty><a
   href="#cssstyledeclaration-removeproperty">removeProperty</a></code> or
   setting <code title=cssstyledeclaration-csstext><a
   href="#cssstyledeclaration-csstext">cssText</a></code> would be examples
   of that.</p>
  <!-- XXX Or do we need to specify this independently for each attribute and
  method? -->

  <p class=issue><code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> can represent
   computed values and used values. (This also goes for interfaces
   implemented on top of <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> objects
   obviously.)

  <p class=issue>This object stringifies to its cssText attribute. Or not?

  <pre
   class=idl>interface <dfn id=cssstyledeclaration>CSSStyleDeclaration</dfn> {
           attribute DOMString <a href="#cssstyledeclaration-csstext" title=cssstyledeclaration-csstext>cssText</a>;
  DOMString <a href="#cssstyledeclaration-getpropertyvalue" title=cssstyledeclaration-getpropertyvalue>getPropertyValue</a>(in DOMString <var title="">property</var>);
  DOMString <a href="#cssstyledeclaration-getpropertypriority" title=cssstyledeclaration-getpropertypriority>getPropertyPriority</a>(in DOMString <var title="">property</var>);
  DOMString <a href="#cssstyledeclaration-removeproperty" title=cssstyledeclaration-removeproperty>removeProperty</a>(in DOMString <var title="">property</var>);
  void <a href="#cssstyledeclaration-setproperty" title=cssstyledeclaration-setproperty>setProperty</a>(in DOMString <var title="">property</var>, in DOMString <var title="">value</var>);
  void <a href="#cssstyledeclaration-setproperty" title=cssstyledeclaration-setproperty>setProperty</a>(in DOMString <var title="">property</var>, in DOMString <var title="">value</var>, in DOMString <var title="">priority</var>);
  readonly attribute unsigned long <a href="#cssstyledeclaration-length" title=cssstyledeclaration-length>length</a>;
  DOMString <a href="#cssstyledeclaration-item" title=cssstyledeclaration-item>item</a>(in unsigned long <var title="">index</var>);
  readonly attribute <a href="#cssrule">CSSRule</a> <a href="#cssstyledeclaration-parentrule" title=cssstyledeclaration-parentrule>parentRule</a>;
};</pre>

  <p>The <dfn id=cssstyledeclaration-csstext
   title=cssstyledeclaration-csstext><code>cssText</code></dfn> attribute, on
   getting, <span class=issue>...</span>.

  <p>On setting the <code title="">cssText</code> attribute, user agents <em
   class=ct>must</em> remove all properties currently set on the object and
   then parse the given string as the contents of a declaration block and set
   each property / value pair that is not ignored on the <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> block. [CSS]

  <p>The <dfn id=cssstyledeclaration-getpropertyvalue
   title=cssstyledeclaration-getpropertyvalue><code>getPropertyValue(<var
   title="">property</var>)</code></dfn> method, when invoked, <span
   class=issue>...</span>.</p>
  <!-- Once we have defined how everything will be canonicalized we can start
  thinking about this... -->

  <p>The <dfn id=cssstyledeclaration-getpropertypriority
   title=cssstyledeclaration-getpropertypriority><code>getPropertyPriority(<var
   title="">property</var>)</code></dfn> method, when invoked, if <var
   title="">property</var> case-insensitively matches a specified property
   that has a priority user agents <em class=ct>must</em> return the
   canonical priority of that property as given in the syntax definition.
   Otherwise, the empty string <em class=ct>must</em> be returned.

  <p class=note>For <code>background-color:lime !IMPORTANT</code> the return
   value would be <code>important</code>.

  <p>The <dfn id=cssstyledeclaration-removeproperty
   title=cssstyledeclaration-removeproperty><code>removeProperty(<var
   title="">property</var>)</code></dfn> method, when invoked, if <var
   title="">property</var> case-insensitively matches a specified property
   user agents <em class=ct>must</em> remove that property declaration.

  <p>The <dfn id=cssstyledeclaration-setproperty
   title=cssstyledeclaration-setproperty><code>setProperty(<var
   title="">property</var>, <var title="">value</var>, <var
   title="">priority</var>)</code></dfn> method gives a way to set a
   declaration. When invoked, user agents <em class=ct>must</em> run the
   following steps:

  <ol>
   <li>
    <p>If <var title="">property</var> does not case-insensitively match a
     supported property abort this algorithm.

   <li>
    <p>If <var title="">value</var> is <code>null</code> or the empty string
     invoke <code title=cssstyledeclaration-removeproperty><a
     href="#cssstyledeclaration-removeproperty">removeProperty</a></code>
     with <var title="">property</var> as argument and abort this algorithm.

   <li>
    <p>If the <var title="">priority</var> argument has been omitted let <var
     title="">priority</var> be <code>null</code>.

   <li>
    <p>If <var title="">priority</var> is neither a valid priority nor
     <code>null</code> or the empty string abort this algorithm.

   <li>
    <p>If <a href="#parsing0" title="CSS value parsing">parsing the <var
     title="">value</var></a> returns "null" abort this algorithm.</p>

    <p class=note><var title="">value</var> can not include
     <code>!important</code>.</p>

   <li>
    <p>Finally, set <var title="">property</var> to <var title="">value</var>
     with priority <var title="">priority</var> when <var
     title="">priority</var> is not <code>null</code> or the empty string.
     Otherwise set <var title="">property</var> to <var title="">value</var>.
  </ol>

  <p>The <dfn id=cssstyledeclaration-length
   title=cssstyledeclaration-length><code>length</code></dfn> attribute <em
   class=ct>must</em> be the number of setted properties.

  <p>The <dfn id=cssstyledeclaration-item
   title=cssstyledeclaration-item><code>item(<var
   title="">index</var>)</code></dfn> method, when invoked, <span
   class=issue>...</span>.</p>
  <!-- returns the value of property x stored at position item. -->

  <p>The <dfn id=cssstyledeclaration-parentrule
   title=cssstyledeclaration-parentrule><code>parentRule</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the <code><a
   href="#cssrule">CSSrule</a></code> object the <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> is object is
   associated with or <code>null</code> if it is not associated with a
   <code><a href="#cssrule">CSSrule</a></code> object.</p>
  <!--
  <h4>CSS Properties</h4>

  <p>The DOM attribute name of a CSS property can be found by using the
  following algorithm:</p>

  <ol>
   <li>Let <var title="">r</var> be the CSS property to be
   converted.</li>

   <li>Uppercase the first character after every U+002D (<code>-</code>) in
   <var title="">r</var>.</li>

   <li>Remove every U+002D (<code>-</code>) in <var title="">r</var>.</li>

   <li>Return <var title="">r</var>.</li>
  </ol>

  <p class="note">This means that
  <code>-<var title="">vendor</var>-<var title="">property</var></code>
  becomes
  <code><var title=""><strong>V</strong>endor</var><var title=""><strong>P</strong>roperty</var></code>
  for instance.</p>
-->

  <h4 id=the-css2properties><span class=secno>4.6.2. </span>The <code
   title="">CSS2Properties</code> Interface</h4>

  <p class=issue>...

  <h2 id=canon><span class=secno>5. </span>Canonicalization</h2>

  <p class=issue>This section will be integrated with the Cascading Style
   Sheets APIs section in due course.

  <p>This section defines canonicalization of the various objects you
   typically encounter in <span>CSS style sheets</span>.

  <p>The definitions from this section are used later to define attribute
   values, et cetera.

  <h3 id=media0><span class=secno>5.1. </span>Media queries</h3>

  <p>The <dfn id=canon-media title=canon-media>canonicalization of a media
   query</dfn> can be determined as follows:

  <ol>
   <li>Convert each part of the media query to the case specified in the
    syntax. For example, <code>MaX-width</code> becomes
    <code>max-width</code>.

   <li>Replace one or more consecutive <a href="#whitespace">whitespace</a>
    characters with a U+0020 SPACE.

   <li>Remove leading and trailing <a href="#whitespace">whitespace</a>.

   <li>Remove <a href="#whitespace">whitespace</a> between the media feature
    and the U+003A COLON.

   <li>Remove <a href="#whitespace">whitespace</a> between the media feature
    and the U+0028 LEFT PARENTHESIS.

   <li>Remove <a href="#whitespace">whitespace</a> between the media feature
    value and the U+0029 RIGHT PARENTHESIS.

   <li>Make sure there's exactly one U+0020 SPACE after the U+003A COLON
    which is then followed by its value.

   <li>Sort the media features alphabetically ([a-z]).
  </ol>

  <p class=issue>Did I miss anything?

  <p class=issue>duplicate features?

  <h4 id=examples1><span class=secno>5.1.1. </span>Examples</h4>

  <div class=example>
   <p>The canonical form of the following query:</p>

   <pre>not screen and (min-width:5px) and   (max-width:40px  ) </pre>

   <p>would be:</p>

   <pre>not screen and (max-width: 40px) and (min-width: 5px)</pre>
  </div>

  <h2 class=no-num id=references>References</h2>

  <p class=issue>This section will be done when going to Last Call. Before
   that state please ask the author whenever a reference is unclear.

  <h2 class=no-num id=acknowledgements>Acknowledgements</h2>

  <p>The editor would like to thank Alexey Feldgendler, Bjrn Hhrmann,
   David Baron, Hallvord R. M. Steen, Ian Hickson, Lachlan Hunt, Morten
   Stenshorne, Robert O'Callahan, Sjoerd Visscher, Simon Pieters, and Tarquin
   Wilton-Jones for contributing to this specification.

  <p>Even more thanks to Ian Hickson for writing up the the initial version
   of the alternative style sheets API and canonicalization rules for CSS
   values.</p>
  <!-- XXX NOTES

  <style type=text/css;charset=utf-8> does create a StyleSheet in Firefox
  and Opera, but does not create a StyleSheet in IE. I prefer IE.

  <style type=TEXT/CSS> sets the style sheet type to text/css in Firefox and
  TEXT/CSS in Opera and IE. I prefer Firefox.

  <style> sets the style sheet location to the document location Firefox,
  the empty string in IE, and null in Opera. I prefer Opera

  <style media="x"> invokes .sheet.media.mediaText = "x"

  <style title=""> does not "have" a title
  -->
