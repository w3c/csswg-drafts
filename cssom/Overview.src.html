<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!--
 ISSUES
 - This list is not complete
 - The specification is pretty vague and more importantly inconsistent about
   liveness
-->
<html lang="en-US">
 <head>
  <title>Cascading Style Sheets Object Model (CSSOM)</title>

  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   dfn { font-weight:bold; font-style:normal }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   div.example table code { color:inherit }
   td, th { padding:.1em }
   .proposal { padding:.5em; border:solid blue }
   p.note {  margin-left:2em; color:green; font-style:italic; font-weight:bold }
   p.note::before { content:"Note: " }
   .issue { padding:.5em; border:solid red }
   .issue::before { content:"Issue: " }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
   .members dt { margin:.5em 0 }
   .members dd p:first-child { margin-top:0 }
   .members dd p:last-child { margin-bottom:0 }
  </style>

  <link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/base">
 </head>

 <body class="draft">
  <div class="head">
   <h1 id="cssom">Cascading Style Sheets Object Model (<abbr>CSSOM</abbr>)</h1>

   <h2 class="no-num no-toc" id="">Editor's draft <!--W3C Working Draft--> [DATE: 3 August 2002]</h2>

   <dl>

    <dt>This version:</dt>

    <!--
    <dd><a href="[VERSION]/">http://www.w3.org/TR/[YEAR]/WD-cssom-[CDATE]/</a></dd>
    -->
    <dd>...</dd>

    <dt>Latest version:</dt>

    <!--
    <dd><a href="http://www.w3.org/TR/cssom/">http://www.w3.org/TR/cssom/</a></dd>
    -->
    <dd>...</dd>

    <dt>Previous versions:</dt>

    <dd><a href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/">http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/</a></dd>

    <dt>Editor:</dt>

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a>
    (<a href="http://www.opera.com/">Opera Software ASA</a>)
    &lt;<a href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;</dd>

   </dl>
  </div>

  <h2 class="no-num no-toc" id="abstract">Abstract</h2>

  <p>The Cascading Style Sheets Object Model defines enables developers to
  find style sheets associated with a <code>Document</code>, to query and
  modify rules within a CSS style sheet (through an object model) and to find
  out layout related information from objects within a
  <code>Document</code>.</p>

  <h2 class="no-num no-toc" id="sotd">Status of this Document</h2>

  <p class="issue">This document is in its very early stages. The intention is
  that this specification will in due course supercede DOM Level 2 Style.</p>

  <h2 class="no-num no-toc" id="toc">Table of Contents</h2>
  <!--toc-->

  <h2 id="introduction">Introduction</h2>

  <p class="issue">...</p>

  <h3 id="history">History</h3>

  <p><em>This section is non normative.</em></p>

  <p>Several interfaces from DOM Level 2 Style
  <a href="http://www.w3.org/mid/Pine.LNX.4.05.10310302134070.1173-100000@lanalana.inria.fr" title="[CSSOM] CSSValue and related interfaces (message from the CSS WG)">have
  been obsoleted</a> because they where thought to be too akward for frequent
  use. This specification no longer contains those features.
  <code>DOMImplementationCSS</code> has been removed as well.</p>

  <h3 id="conformance">Conformance Requirements</h3>

  <p>Everything in this specification is normative except for diagrams,
  examples, notes and sections marked non-normative.</p>

  <p>The key words <em class="ct">must</em>, <em class="ct">must not</em>,
  <em class="ct">required</em>, <em class="ct">shall</em>, <em class="ct">shall
  not</em>, <em class="ct">should</em>, <em class="ct">should not</em>,
  <em class="ct">recommended</em>, <em class="ct">may</em>, and
  <em class="ct">optional</em> in the normative parts of this document are to be
  interpreted as described in
  [<cite><a href="#ref-rfc2119">RFC2119</a></cite>].</p>

  <p>The following conformance classes are defined (and considered) by this
  specification:</p>

  <dl>
   <dt><dfn id="conforming-implementation">conforming implementation</dfn></dt>

   <dd>A user agent that implements all interfaces described in this
   specification and follows all <em class="ct">must</em>-,
   <em class="ct">required</em>- and <em class="ct">shall</em>-level of critera
   in this specification.</dd>

   <dt><dfn id="conforming document">conforming document</dfn></dt>

   <dd>A document that follows all <em class="ct">must</em>-,
   <em class="ct">required</em>- and <em class="ct">shall</em>-level of critera
   in this specification that apply to document authors.</dd>

   <dt><dfn id="conforming-authoring-tool">conforming authoring tool</dfn></dt>

   <dd>One that produces conforming documents.</dd>
  </dl>

  <h4 id="terminology">Terminology and Conventions</h4>

  <p>A <dfn>color component integer</dfn> is a base-ten integer in the range
  0-255 using digits 0-9, U+0030 to U+0039, in the shortest form possible.</p>

  <p>A <dfn>color component separator</dfn> is a literal U+002C COMMA followed
  by a U+0020 SPACE.</p>

  <p>When this specification talks about object <code><var>A</var></code>
  where <code><var>A</var></code> is actually an interface, it generally means
  an object implementing interface <code><var>A</var></code>.</p>

  <!--
  <p>The term <dfn id="whitespace">whitespace</dfn> when  used in this
   specification refers to the U+0020 SPACE, U+0009 &lt;control>, U+000A
   &lt;control>, U+000D &lt;control> and U+000C &lt;control> (if
   applicable).</p>
  -->

  <p>The terms <dfn id="whitespace">whitespace</dfn> and
  <dfn id="style-sheet">style sheet</dfn> are used as defined in the <cite>CSS
  2.1 Specification</cite> [CSS21].</p>

  <p>A <dfn id="css-style-sheet">CSS style sheet</dfn> is a <span>style
  sheet</span> that conforms to the CSS syntax rules.</p>

  <!-- XXX: "Cascading Style Sheet style sheet" is just a joke... -->

  <h4>DOM feature strings</h4>
  <!-- Thanks to Hixie. This is from HTML5. -->

  <p>DOM Level 3 Core defines mechanisms for checking for interface support,
  and for obtaining implementations of interfaces, using <a
  href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures">feature
  strings</a>. <a>[DOM3CORE]</a></p>

  <p>A DOM application can use the <code>hasFeature(<var title="">feature</var>,
  <var title="">version</var>)</code> method of the
  <code>DOMImplementation</code> interface with parameter values
  "<code title="">StyleSheets</code>" and "<code>3.0</code>" (respectively)
  to determine whether or not "Accessing style sheets through the DOM" is
  supported by the implementation. The feature string
  "<code title="">CSS</code>" (with version string "<code>3.0</code>") can
  be used to check if the implementation supports "Cascading Style Sheets APIs"
  and "<code title="">Layout</code>" (with version string "<code>3.0</code>")
  can be used to check if the implementation supports "Layout APIs". User agents
  <em class="ct">should</em> respond with a <code>true</code> value when the
  <code>hasFeature</code> method is queried with these values. Authors are
  cautioned, however, that user agents returning <code>true</code> might not be
  perfectly compliant, and that user agents returning <code>false</code> might
  well have support for features in this specification; in general, therefore,
  use of this method is discouraged.</p>

  <p>The values "<code title="">StyleSheets</code>", "<code title="">CSS</code>"
  and "<code title="">Layout</code>" (all with version "<code>3.0</code>")
  <em class="ct">should</em> also be supported in the context of the
  <code>getFeature()</code> and <code>isSupported()</code> methods, as defined
  by DOM Level 3 Core.</p>

  <p class="note">The interfaces defined in this specification are not
  always supersets of the interfaces defined in DOM Level 2 Style; some features
  that were formerly deprecated, poorly supported, rarely used or considered
  unnecessary have been removed. Therefore it is not guarenteed that an
  implementation that supports "<code title="">CSS</code>" "<code>3.0</code>"
  also supports "<code title="">CSS</code>" "<code>2.0</code>".</p>

  <h2>Accessing style sheets through the DOM</h2>

  <p>Each style sheet is represented by a <code>StyleSheet</code> object.
  These objects can be accessed through the <code>LinkStyle</code> interface
  implemented on individual <code>Node</code> objects or through the
  <code>DocumentStyle</code> interface implemented on the
  <code>Document</code> object. The <code>DocumentStyle</code> interface also
  provides an interface for enabling alternative style sheets and manipulating
  style sheet sets.</p>

  <h3>Terminology</h3>

  <p>Each style sheet can have a title. A <span>style sheet</span> is said to
  <dfn id="style-sheet-title" title="have a title">have a title</dfn> if the
  <code>title</code> attribute on the <code>StyleSheet</code> object is
  neither <code>null</code> nor the empty string.</p>

  <p><dfn title="persistent style sheet">Persistent style sheets</dfn> are
  style sheets <span title="have a title">without a title</span>.</p>

  <p>One or more style sheets <span title="have a title">with the same
  title</span> (case-sensitive) form a <dfn title="style sheet set">style
  sheet set</dfn>.</p>

  <h3>The <code>LinkStyle</code> Interface</h3>

  <p>Nodes within the DOM causing the association of a style sheet
  <em class="ct">must</em> implement the <code>LinkStyle</code> interface.</p>

  <pre class="idl">interface <dfn>LinkStyle</dfn> {
  readonly attribute <span>StyleSheet</span>       <span title="linkstyle-sheet">sheet</span>;
};</pre>

  <dl class="members">

   <dt><dfn id="linkstyle-sheet" title="linkstyle-sheet"><code>sheet</code></dfn>
   of type <code>StyleSheet</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be the <code>StyleSheet</code>
   the node is referring to or <code>null</code> if the node is not referring to
   a <code>StyleSheet</code> (for example, all <code>link</code> elements in
   HTML implement this interface, but not all <code>link</code> elements are
   used for style sheets).</dd>

  </dl>

  <p class="note">Whether or not the node refers to a style sheet is defined
  by the specification that defines the semantics of said node.</p>

  <h4>Requirements on specifications</h4>

  <p>Specifications introducing new ways of associating style sheets through
  the DOM <em class="ct">should</em> define which objects implement the
  <code>LinkStyle</code> interface. In addition, these specifications
  <em class="ct">should</em> define how these objects affect the potentially
  associated <code>StyleSheet</code> object (when
  <code title="linkstyle-sheet">sheet</code> is non-<code>null</code>).</p>

  <h4>Requirements on SVG user agents</h4>
  <!-- Not needed for HTML. -->

  <p><em>This section applies to user agents supporting SVG.</em></p>
  
  <p>SVG user agents <em class="ct">must</em> implement <code>LinkStyle</code>
  on objects implementing the <code>SVGStyleElement</code> interface.</p>

  <p class="issue">Should SVG define this instead?</p>

  <h4><code>&lt;?xml-stylesheet?></code> processing instruction</h4>

  <p>User agents supporting supporting <code>&lt;?xml-stylesheet?></code>
  <em class="ct">must</em> implement the <code>LinkStyle</code> on objects
  implementing <code>ProcessingInstruction</code>.</p>

  <p>If the <code title="">target</code> DOM attribute of the
  <code>ProcessingInstruction</code> is not <code>xml-stylesheet</code> or if
  the <code>href</code> pseudo-attribute of the processing instruction does
  not point to an external resource or does point to an external resource that
  has not yet been downloaded the <code title="linkstyle-sheet">sheet</code>
  attribute <em class="ct">must</em> be <code>null</code>. Otherwise, if the
  <code title="">target</code> DOM attribute is <code>xml-stylesheet</code>,
  the resource has been downloaded and the determined type is a supported
  style sheet language the <code title="linkstyle-sheet">sheet</code>
  attribute <em class="ct">must</em> be a <code>StyleSheet</code> object with
  the members implemented as follows:</p>

  <dl>
   <dt><code title="stylesheet-type">type</code></dt>

   <dd>This <em class="ct">must</em> be the determined type.</dd>

   <dt><code title="stylesheet-href">href</code></dt>

   <dd>This <em class="ct">must</em> be the value of the <code>href</code>
   pseudo-attribute.</dd>

   <dt><code title="stylesheet-media">media</code></dt>

   <dd>This <em class="ct">must</em> be the value of the <code>media</code>
   pseudo-attribute.</dd>

   <dt><code title="stylesheet-title">title</code></dt>

   <dd>This <em class="ct">must</em> be the value of the <code>title</code>
   pseudo-attribute.</dd>
  </dl>

  <h3>The <code>DocumentStyle</code> Interface</h3>

  <p>Any object implementing the <code>Document</code> interface
  <em class="ct">must</em> also implement the <code>DocumentStyle</code>
  interface.</p>

  <!-- https://bugzilla.mozilla.org/show_bug.cgi?id=200930 (FIXED) -->
  <pre class="idl">interface <dfn>DocumentStyle</dfn> {
  readonly attribute <span>StyleSheetList</span>   <span>styleSheets</span>;
           attribute DOMString        <span>selectedStyleSheetSet</span>;
  readonly attribute DOMString        <span>lastStyleSheetSet</span>;
  readonly attribute DOMString        <span>preferredStyleSheetSet</span>;
  readonly attribute DOMStringList    <span>styleSheetSets</span>;
  void               <span title="documentstyle-enablestylesheetsforset">enableStylesheetsForSet</span>(in DOMString <var>name</var>);
};</pre>

  <p>For this interface, the <code>DOMString</code> values <code>null</code>
  and "the empty string" are distinct and <em class="ct">must</em> not be
  considered equivalent.</p>

  <p>The members are defined as follows:</p>

  <dl class="members">

   <dt><dfn id="documentstyle-stylesheets"><code>styleSheets</code></dfn> of
   type <code>StyleSheetList</code></dt>

   <dd><p>This attribute <em class="ct">must</em> be a
   <code>StyleSheetList</code> object containing a collection of all
   <code>LinkStyle</code> objects with a non-<code>null</code>
   preceded by style sheets introduced through HTTP headers.</p></dd>
   <code title="linkstyle-sheet">sheet</code> attribute in document order

   <dt><dfn id="documentstyle-selectedStyleSheetSet"><code>selectedStyleSheetSet</code></dfn>
   of type <code>DOMString</code></dt>

   <dd>
    <p>This attribute indicates which <span>style sheet set</span> is in use.
    This attribute is <span>live</span>; changing the
    <code title="stylesheet-disabled">disabled</code> attribute on style sheets
    directly will change the value of this attribute.</p>

    <p>If all the sheets that are enabled and <span>have a title</span> have the
    <em>same</em> title (by <span>case-sensitive</span> comparisons) then the
    value of this attribute <em class="ct">must</em> be exactly equal to the
    title of the first enabled style sheet with a title in the
    <code>styleSheets</code> list. Otherwise, if style sheets from different
    sets are enabled, then the return value <em class="ct">must</em> be
    <code>null</code> (there is no way to determine what the currently selected
    style sheet set is in those conditions). Otherwise, either all style sheets
    that <span>have a title</span> are disabled, or there are no alternative style
    sheets, and <code>selectedStyleSheetSet</code> <em class="ct">must</em>
    return the empty string.</p>

    <p>Setting this attribute to the <code>null</code> value
    <em class="ct">must</em> have no effect.</p>

    <p>Setting this attribute to a non-<code>null</code> value
    <em class="ct">must</em> call
    <code title="documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</code>
    with that value as the method's argument, and set
    <code>lastStyleSheetSet</code> to that value.</p>

    <p>From the DOM's perspective, all views have the same
    <code>selectedStyleSheetSet</code>. If a user agent supports multiple views
    with different selected alternative style sheets, then this attribute (and the
    <code>StyleSheet</code> interface's <code>disabled</code> attribute)
    <em class="ct">must</em> return and set the value for the default view.</p>
   </dd>

   <dt><dfn id="documentstyle-lastStyleSheetSet"><code>lastStyleSheetSet</code></dfn>
   of type <code>DOMString</code>, readonly</dt>

   <dd>
    <p>This attribute <em class="ct">must</em> initially have the value
    <code>null</code>. Its value changes when the
    <code>selectedStyleSheetSet</code> attribute is set.</p>
   </dd>

   <dt><dfn id="documentstyle-preferredStyleSheetSet"><code>preferredStyleSheetSet</code></dfn>
   of type <code>DOMString</code>, readonly</dt>

   <dd>
    <p>This attribute <em class="ct">must</em> be the preferred style
    sheet set as set by the author. It is determined from the order of
    style sheet declarations and the <code>Default-Style</code> HTTP headers.
    If there is no preferred style sheet set, this attribute
    <em class="ct">must</em> be the empty string. The case of this attribute
    <em class="ct">must</em> exactly match the case given by the author where
    the preferred style sheet is specified or implied. This attribute
    <em class="ct">must</em> never be <code>null</code>.</p>
   </dd>

   <dt><dfn id="documentstyle-styleSheetSets"><code>styleSheetSets</code></dfn>
   of type <code>DOMStringList</code>, readonly</dt>

   <dd>
    <p>This <em class="ct">must</em> be a <span>live</span> list of the
    currently available <span>style sheet sets</span>. This list is constructed
    by enumerating all the style sheets for this document available to the
    implementation, in the order they are listed in the <code>styleSheets</code>
    attribute, adding the title of each style sheet
    <span title="have a title">with a title</span> to the list, avoiding
    duplicates by dropping titles that match (<span>case-sensitively</span>)
    titles that have already been added to the list.</p>
   </dd>

   <dt><dfn id="documentstyle-enablestylesheetsforset" title="documentstyle-enablestylesheetsforset"><code>enableStylesheetsForSet(<var title="">name</var>)</code></dfn>,
    method</dt>

   <dd>
    <p>Invoking this method <em class="ct">must</em> change the
    <code title="stylesheet-disabled">disabled</code> attribute on each
    <code>StyleSheet</code> object
    <span title="have a title">with a title</span> in the
    <code>styleSheets</code> attribute, so that all those whose title matches
    the <var title="">name</var> argument are enabled, and all others are
    disabled. Title matches <em class="ct">must</em> be
    <span>case-sensitive</span>.</p>

    <p>Invoking this method with the empty string value <em class="ct">must</em>
    disable all alternative and preferred style sheets (but does not change the
    state of persistent style sheets).</p>

    <p>Invoking this method with the <code>null</code> value
    <em class="ct">must</em> have no effect.</p>

    <!-- fact: -->
    <p>Style sheets that do not <span>have a title</span> are never affected by
    this method. This method does not change the values of the
    <code>lastStyleSheetSet</code> or <code>preferredStyleSheetSet</code>
    attributes.</p>
   </dd>
  </dl>

  <h3>The <code>StyleSheetList</code> Interface</h3>

  <p>The object implementing this interface represents a live collection of
  <code>StyleSheet</code> objects.</p>

  <p>In bindings that allow it, enumerating a <code>StyleSheetList</code> object
  <em class="ct">must</em> enumerate through the currently stored and
  accessible items in the list the object is associated with. This ensures
  <code>document.styleSheets[1].<var>x</var></code> is possible from ECMAScript
  for example.</p>

  <pre class="idl">interface <dfn>StyleSheetList</dfn> {
  readonly attribute unsigned long    <span title="stylesheetlist-length">length</span>;
  <span>StyleSheet</span>         <span title="stylesheetlist-item">item</span>(in unsigned long <var title="">index</var>);
};</pre>

  <p>The members of the <code>StyleSheetList</code> object are defined as
   follows:</p>

  <dl class="members">

   <dt><dfn id="stylesheetlist-length" title="stylesheetlist-length"><code>length</code></dfn>,
   of type <code>unsigned long</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be the number of
   <code>StyleSheet</code> objects currently in the list.</dd>

   <dt><dfn id="stylesheetlist-item" title="stylesheetlist-item"><code>item(<var title="">index</var>)</code></dfn>,
   method</dt>

   <dd>When invoked, this method <em class="ct">must</em> return the
   <code>StyleSheet</code> in the list given by <var>index</var>. If
   <var>index</var> is less than zero then this method <em class="ct">must</em>
   raise an <code>INDEX_SIZE_ERR</code> exception. If <var>index</var> is
   greater than or equal to the number of style sheets currently in the list
   this method <em class="ct">must</em> return <code>null</code>.</dd>
   <!-- Internet Explorer throws an exception for [largevalue] as well. -->
  </dl>

  <h3>Dynamically adding new style sheets</h3>

  <p>If new style sheets <span title="have a title">with titles</span> are added
  to the document, the user agent <em class="ct">must</em> decide whether or not
  the style sheets should be initially enabled or not. How this happens depends
  on the exact state of the document at the time the style sheet is added, as
  follows.</p>

  <h4>Adding style sheets</h4>

  <p>First, if the style sheet is a preferred style sheet (it
  <span title="have a title">has a title</span>, but is not marked as
  alternative), and there is no
  current preferred style sheet (the <code>preferredStyleSheetSet</code>
  attribute is equal to the empty string) then the
  <code>preferredStyleSheetSet</code> attribute is set to the exact value of
  this style sheet's title. (This changes the preferred style sheet set, which
  causes further changes &mdash; see below.)</p>

  <p>Then, for all sheets, if any of the following is true, then the style sheet
  <em class="ct">must</em> be enabled:</p>

  <ul>
   <li>The style sheet has an empty title.</li>

   <li>The <code>lastStyleSheetSet</code> is <code>null</code>, and the style
   sheet's title matches (by <span>case-sensitive</span> match) the value of
   the <code>preferredStyleSheetSet</code> attribute.</li>

   <li>The style sheet's title matches (by <span>case-sensitive</span> match)
   the value of the <code>lastStyleSheetSet</code> attribute.</li>
  </ul>

  <p>Otherwise, the style sheet <em class="ct">must</em> be disabled.</p>

  <h4>Changing the preferred style sheet set</h4>

  <p>The first time the <span>preferred style sheet</span> set is set, which is
  either before any alternative style sheets are seen (e.g. using a
  <code>Default-Style</code> HTTP header), or is the first time a titled,
  non-altenrative style sheet is seen (in the absence of information to
  the contrary, the first titled non-alternative sheet sets the name of
  the preferred set), the <code>preferredStyleSheetSet</code> attribute's value
  <em class="ct">must</em> be set to the name of that preferred style sheet
  set. This does not change the <code>lastStyleSheetSet</code> attribute.</p>

  <p>If the user agent has the preferred style sheet set changed, for example
  if it receives a <code>Default-Style</code> HTTP header after it receives HTTP
  <code>Link</code> headers implying another preferred style sheet, then the
  <code>preferredStyleSheetSet</code> attribute's value
  <em class="ct">must</em> be changed appropriately, and, if the
  <code>lastStyleSheetSet</code> is <code>null</code>, the
  <code title="documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</code>
  method <em class="ct">must</em> be called with the new
  <code>preferredStyleSheetSet</code> value. (The
  <code>lastStyleSheetSet</code> attribute is, again, not changed.)</p>

  <h4>Examples</h4>

  <div class="example">
   <p>Thus, in the following HTML snippet:</p>

   <pre>&lt;link rel="alternate stylesheet" title="foo" href="a"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="b"&gt;
&lt;script&gt;

  document.selectedStyleSheetSet = 'foo';
  document.styleSheets[1].disabled = false;
&lt;/script&gt;
&lt;link rel="alternate stylesheet" title="foo" href="c"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="d"&gt;</pre>

   <p>...the style sheets that end up enabled are style sheets "a", "b",
   and "c", the <code>selectedStyleSheetSet</code> attribute would
   return null, <code>lastStyleSheetSet</code> would return "foo", and
   <code>preferredStyleSheetSet</code> would return "".</p>

   <p>Similarly, in the following HTML snippet:</p>

   <pre>&lt;link rel="alternate stylesheet" title="foo" href="a"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="b"&gt;
&lt;script&gt;
  var before = document.preferredStyleSheetSet;
  document.styleSheets[1].disabled = false;
&lt;/script&gt;
&lt;link rel="stylesheet" title="foo" href="c"&gt;

&lt;link rel="alternate stylesheet" title="bar" href="d"&gt;
&lt;script&gt;
  var after = document.preferredStyleSheetSet;
&lt;/script&gt;</pre>

   <p>...the "before" variable will be equal to the empty string, the
   "after" variable will be equal to "foo", and style sheets "a" and "c"
   will be enabled. This is the case even though the first script block
   sets style sheet "b" to be enabled, because upon parsing the
   following <code>&lt;link&gt;</code> element, the
   <code>preferredStyleSheetSet</code> is set and the
   <code title="documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</code>
   method is called (since <code>selectedStyleSheetSet</code> was never set
   explicitly, leaving <code>lastStyleSheetSet</code> at <code>null</code>
   throughout), which changes which style sheets are enabled and which are
   not.</p>
  </div>

  <h3>Interaction with the User Interface</h3>

  <p>The user interface of Web browsers that support style sheets
  <em class="ct">should</em> list the style sheet titles given in the
  <code>styleSheetSets</code> list, showing the
  <code>selectedStyleSheetSet</code> as the selected style sheet set,
  leaving none selected if it is <code>null</code> or the empty string, and
  selecting an extra option "Basic Page Style" (or similar) if it is
  the empty string and the <code>preferredStyleSheetSet</code> is the
  empty string as well.</p>

  <p>Selecting a style sheet from this list should set the
  <code>selectedStyleSheetSet</code> attribute. This (by definition)
  affects the <code>lastStyleSheetSet</code> attribute.</p>

  <h4>Persisting the selected style sheet set</h4>

  <p>If UAs persist the selected style sheet set, they should use the
  value of the <code>selectedStyleSheetSet</code> attribute, or if
  that is <code>null</code>, the <code>lastStyleSheetSet</code> attribute, when
  leaving the page (or at some other time) to determine the set name
  to store. If that is <code>null</code> then the style sheet set should not be
  persisted.</p>

  <p>When re-setting the style sheet set to the persisted value (which can
  happen at any time, typically at the first time the style sheets are
  needed for styling the document, after the <code>&lt;head&gt;</code> of the document has
  been parsed, after any scripts that are not dependent on computed
  style have executed), the style sheet set should be set by setting the
  <code>selectedStyleSheetSet</code> attribute as if the user had selected the set
  manually.</p>

  <p class="note">This specification does not give any suggestions on
  how UAs should decide to persist the style sheet set or whether or
  how to persist the selected set across pages.</p>

  <h3>Forward compatibility</h3>

  <p>Future versions of CSS may introduce ways of having alternative style sheets
  declared at levels lower than the top level, i.e. embedded within other style
  sheets. Implementations of this specification that also support this proposed
  declaration of alternative style sheets are expected to perform depth-first
  traversals of the <code>styleSheets</code> list, not simply enumerations of
  the <code>styleSheets</code> list that only contains the top level.</p>

  <p class="issue">Would that actually work?!</p>

  <h3>The <code>StyleSheet</code> Interface</h3>

  <p>Each style sheet is represented by a <code>StyleSheet</code> object.</p>

  <pre class="idl">interface <dfn>StyleSheet</dfn> {
  readonly attribute DOMString        <span title="stylesheet-type">type</span>;
           attribute boolean          <span title="stylesheet-disabled">disabled</span>;
  readonly attribute Node             <span title="stylesheet-ownernode">ownerNode</span>;
  readonly attribute <span>StyleSheet</span>       <span title="stylesheet-parentstylesheet">parentStyleSheet</span>;
  readonly attribute DOMString        <span title="stylesheet-href">href</span>;
  readonly attribute DOMString        <span title="stylesheet-title">title</span>;
  readonly attribute <span>MediaList</span>        <span title="stylesheet-media">media</span>;
};</pre>

  <dl class="members">

   <dt><dfn id="stylesheet-type" title="stylesheet-type"><code>type</code></dfn>
   of type <code>DOMString</code>, readonly</dt>

   <dd>
    <p>This attribute indicates the MIME type of the style sheet. It's set by
    objects which cause a <code>StyleSheet</code> object to be created, such
    as <code>LinkStyle</code>.</p>
   </dd>

   <dt><dfn id="stylesheet-disabled" title="stylesheet-disabled"><code>disabled</code></dfn>
   of type <code>boolean</code></dt>

   <dd>
    <p>On getting, this attribute <em class="ct">must</em> be <code>true</code>
    when the style sheet is disabled and <code>false</code> otherwise.</p>

    <p>On setting, a value of <code>true</code> <em class="ct">must</em> disable
    the style sheet and a value of <code>false</code> enable it.</p>
   </dd>

   <dt><dfn id="stylesheet-ownernode" title="stylesheet-ownernode"><code>ownerNode</code></dfn>
    of type <code>Node</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be the <code>Node</code> that
   associates the style sheet with the document or <code>null</code>
   otherwise. This <code>Node</code> has implemented the
   <code>LinkStyle</code> interface.</dd>

   <dt><dfn id="stylesheet-parentstylesheet" title="stylesheet-parentstylesheet"><code>parentStyleSheet</code></dfn>
   of type <code>StyleSheet</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be the <code>StyleSheet</code>
   object that caused the inclusion of the current style sheet or
   <code>null</code> if there is no such object.</dd>

   <dt><dfn id="stylesheet-href" title="stylesheet-href"><code>href</code></dfn>
   of type <code>DOMString</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be an IRI pointing to the
   location of the standalone style sheet or <code>null</code> otherwise (when
   it's inside a <code>style</code> element for example).</dd>
   <!-- XXX: ready for IRI-hell? -->

   <dt><dfn id="stylesheet-title" title="stylesheet-title"><code>title</code></dfn>
   of type <code>DOMString</code></dt>

   <dd>This attribute <em class="ct">must</em> be the
   <span title="have a title">title</span> of the style sheet. In HTML this can
   obtained from the <code>HTMLLinkElement</code> or
   <code>HTMLStyleElement</code> for example.</dd>

   <dt><dfn id="stylesheet-media" title="stylesheet-media"><code>media</code></dfn>
   of type <code>MediaList</code>, readonly</dt>

   <dd>
    <p>This attribute <em class="ct">must</em> be a <code>MediaList</code>
    object.</p>

    <p>In binding languages that support setting to a readonly attribute setting
    <code title="stylesheet-media">media</code> to a string
    <em class="ct">must</em> set the value of
    <code title="medialist-mediatext">mediaText</code> on the
    <code>MediaList</code> object.</p>
    <!-- XXX -->
   </dd>

  </dl>

  <h3>The <code>MediaList</code> Interface</h3>

  <p class="issue">This interface depends on the Media Queries specification
  which still has some issues.</p>

  <p>The <code>MediaList</code> object represents a collection of media
  queries. It provides various ways to manipulate this collection.</p>

  <p>In bindings that allow it, enumerating a <code>MediaList</code> object
  <em class="ct">must</em> enumerate through the current collection of media
  queries.</p>

  <!--
  <p>The items in the <code>MediaList</code> <em class="ct">must</em> be
   accessible via an integral index, starting from 0.</p>
  -->

  <p>In bindings that allow it, such as ECMAScript, <code>MediaList</code>
  objects <em class="ct">must</em> stringify to their
  <code title="medialist-mediatext">mediaText</code> attribute's value.</p>

  <pre class="idl">interface <dfn>MediaList</dfn> {
           attribute DOMString        <span title="medialist-mediatext">mediaText</span>;
  readonly attribute unsigned long    <span title="medialist-length">length</span>;
  DOMString          <span title="medialist-item">item</span>(in unsigned long <var title="">index</var>);
  void               <span title="medialist-appendmedium">appendMedium</span>(in DOMString <var title="">medium</var>)
  void               <span title="medialist-deletemedium">deleteMedium</span>(in DOMString <var title="">medium</var>)
};</pre>

  <dl class="members">

   <dt><dfn id="medialist-mediatext" title="medialist-mediatext"><code>mediaText</code></dfn>
   of type <code>DOMString</code></dt>

   <dd>
    <p>On getting this attribute <em class="ct">must</em> be a comma-separated
    list of <span title="canon-media">normalized media queries</span> or the
    empty string otherwise.</p>

    <p>On setting <span class="issue">...</span>.</p>
    <!-- XXX Media Queries need to define parsing of media queries more
    accurately. -->
   </dd>

   <dt><dfn id="medialist-length" title="medialist-length"><code>length</code></dfn>
   of type <code>unsigned long</code></dt>

   <dd>This attribute <em class="ct">must</em> be the number of media in the
   list.</dd>

   <dt><dfn id="medialist-item" title="medialist-item"><code>item(<var title="">index</var>)</code></dfn>,
   method</dt>

   <dd>When invoked, this method <em class="ct">must</em> return the media
   query in the collection given by <var>index</var>. If <var>index</var> is
   less than zero then this method <em class="ct">must</em> raise an
   <code>INDEX_SIZE_ERR</code> exception. If <var>index</var> is greater than or
   equal to the number of media queries currently in the collection this method
   <em class="ct">must</em> return <code>null</code>.</dd>

   <dt><dfn id="medialist-appendmedium" title="medialist-appendmedium"><code>appendMedium(<var title="">medium</var>)</code></dfn>,
   method</dt>

   <dd>When invoked, <span class="issue">...</span>.
   <!--
   XXX see above, Media Queries need to define parsing of media queries.

   otherwise it <em class="ct">must</em> act as if
   <code>deleteMedium</code> was invoked with <var>newMedium</var> as argument
   (if it was in the list) and add <var>newMedium</var> to the end of the
   list.
   --></dd>

   <dt><dfn id="medialist-deletemedium" title="medialist-deletemedium"><code>deleteMedium(<var title="">medium</var>)</code></dfn>,
   method</dt>

   <dd>This method, when invoked, <em class="ct">must</em> raise a
   <code>NOT_FOUND_ERR</code> exception when <var>medium</var> is not in the
   collection. Otherwise, <var>medium</var> <em class="ct">must</em> be removed
   from the collection.</dd>

  </dl>

  <h2>Cascading Style Sheets APIs</h2>

  <p><em>This section (and its subsections) are only applicable to user agents
  implementing CSS.</em></p>

  <p>The previous section provided a way of getting access to style sheets in a
  generic way. This section provides a way for getting access to the individual
  style rules within a Cascading Style Sheet as defined by the CSS
  specifications. [CSS21]</p>

  <h3>Processing CSS Statements</h3>

  <p>The rules for <dfn title="insert a statement">inserting a statement</dfn>
  are as given in the following algorithm. The variables <var>rule</var>,
  <var>rule list</var> and <var>index</var> are to be considered equivalent to
  the identically named variables used when invoking this algorithm. If an
  exception is raised the algorithm is to be aborted. The steps
  <em class="ct">must</em> be followed in order, as follows:</p>

  <ol>
   <li>If <var>index</var> is negative or greater than the length of the
   <var>rule list</var> an <code>INDEX_SIZE_ERR</code> exception
   <em class="ct">must</em> be raised.</li>

   <li>Parse <var>rule</var> as a CSS statement. If the <var>rule</var> is
   ignored by the CSS parser abort this algorithm (don't raise an exception).
   Otherwise, create an object that implements one of the inherited interfaces
   of <code>CSSStyle</code> appropriate for the parsed <var>rule</var>. Let
   <var>object</var> be the newly created object.</li>

   <li>If <var>object</var> can't be inserted within the <var>rule list</var>
   at the given <var>index</var> because that's not allowed per the CSS
   specification a <code>HIERARCHY_REQUEST_ERR</code> exception
   <em class="ct">must</em> be raised.</li>

   <li>Insert <var>object</var> at the given <var>index</var> within the
   <var>rule list</var>.</li>
  </ol>

  <p>The rules for <dfn title="remove a statement">removing a statement</dfn>
  are as given in the following algorithm. The variables <var>index</var> and
  <var>rule list</var> are to be considered equivalent to the identically
  named variables used when invoking this algorithm. If an exception is raised
  this algorithm is to be aborted. The steps <em class="ct">must</em> be
  followed in order, as follows:</p>

  <ol>
   <li>If <var>index</var> is negative or greater than the length of the
   <var>rule list</var> an <code>INDEX_SIZE_ERR</code> exception
   <em class="ct">must</em> be raised.</li>

   <li>Remove the object at <var>index</var> from <var>rule list</var>.</li>
  </ol>

  <p>The rules for <dfn title="replace a statement">replacing a
  statement</dfn> are as given in the following algorithm. The variable
  <var>rule</var> and <var>old object</var> are to be considered equivalent to
  the identically named variables used when invoking this algorithm. If an
  exception is raised this algorithm is to be aborted. The steps
  <em class="ct">must</em> be followed in order, as follows:</p>

  <ol>
   <li>Parse <var>rule</var> as a CSS statement. If the <var>rule</var> is
   ignored by the CSS parser abort this algorithm (don't raise an exception).
   Otherwise, create an object that implements one of the inherited interfaces
   of <code>CSSStyle</code> appropriate for the parsed <var>rule</var>. Let
   <var>object</var> be the newly created object.</li>

   <li>If the <code title="cssrule-type">type</code> of <var>object</var> does
   not match the <code title="cssrule-type">type</code> of <var>old
   object</var> it will replace user agents <em class="ct">must</em> raise an
   <code>INVALID_MODIFICATION_ERR</code> exception.</li>

   <li>Replace <var>old object</var> with <var>object</var>.</li>
  </ol>

  <!-- XXX we should probably also detail how a CSSStyleRule is properly done
  et cetera. -->

  <h3>The <code>CSSStyleSheet</code> Interface</h3>

  <p>The <code>CSSStyleSheet</code> interface represents a <span>CSS style
  sheet</span>.</p>

  <!--
   IE exposes:

   owningElement
   pages
   id
   type
   href
   disabled
   cssText
   readOnly
   title
   parentStyleSheet
   imports
   rules
   media
  -->

  <pre class="idl">interface <dfn>CSSStyleSheet</dfn> : <span>StyleSheet</span> {
  readonly attribute <span>CSSRule</span>          <span>ownerRule</span>;
  readonly attribute <span>CSSRuleList</span>      <span title="cssstylesheet-cssrules">cssRules</span>;
  unsigned long      <span title="cssstylesheet-insertrule">insertRule</span>(in DOMString <var>rule</var>, in unsigned long <var>index</var>);
  void               <span title="cssstylesheet-deleterule">deleteRule</span>(in unsigned long <var>index</var>);
};</pre>

  <dl class="members">

   <dt><dfn id="cssstylesheet-ownerrule"><code>ownerRule</code></dfn> of type
   <code>CSSRule</code>, readonly</dt>

   <dd>If the style sheet was loaded due to an <code>@import</code> rule this
   attribute <em class="ct">must</em> be the <code>CSSImportRule</code> that
   caused this style sheet to be imported. Otherwise it <em class="ct">must</em>
   be <code>null</code>.</dd>

   <dt><dfn id="cssstylesheet-cssrules" title="cssstylesheet-cssrules"><code>cssRules</code></dfn>
   of type <code>CSSRuleList</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be a live
   <code>CSSRuleList</code> consisting of an ordered list of statements
   (statements are either rulesets or at-rules).</dd>

   <dt><dfn id="cssstylesheet-insertrule" title="cssstylesheet-insertrule"><code>insertRule(<var title="">rule</var>,
   <var title="">index</var>)</code></dfn>, method</dt>

   <dd>When invoked, user agents <em class="ct">must</em> <span>insert a
   statement</span> where <var>rule</var> is <var>rule</var>, <var>index</var>
   is <var>index</var> and <var>rule list</var> is
   <code title="cssstylesheet-cssrules">cssRules</code>.
   </dd>

   <dt><dfn id="cssstylesheet-deleterule" title="cssstylesheet-deleterule"><code>deleteRule(<var title="">index</var>)</code></dfn>,
    method</dt>

   <dd>When invoked, user agents <em class="ct">must</em> <span>remove a
   statement</span> where <var>index</var> is <var>index</var> and <var>rule
   list</var> is
   <code title="cssmediarule-cssrules">cssRules</code>.</dd>
  </dl>

  <h3>The <code>CSSRuleList</code> Interface</h3>

  <p>The <code>CSSRuleList</code> interface represents an ordered list of
  statements.</p>

  <p>In bindings that allow it, enumerating a <code>CSSRuleList</code> object
  <em class="ct">must</em> enumerate through the currently stored items in the
  list the object is associated with.</p>

  <pre class="idl">interface <dfn>CSSRuleList</dfn> {
  readonly attribute unsigned long    <span title="cssrulelist-length">length</span>;
  <span>CSSRule</span>            <span title="cssrulelist-item">item</span>(in unsigned long <var title="">index</var>);
};</pre>

  <dl class="members">
   <dt><dfn id="cssrulelist-length" title="cssrulelist-length"><code>length</code></dfn>
   of type <code>unsigned long</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be the number of items associated
   with the object.</dd>

   <dt><dfn id="cssrulelist-item" title="cssrulelist-item"><code>item(<var title="">index</var>)</code></dfn>,
   method</dt>

   <dd>When invoked, if <var title="">index</var> is equal or greater than the
   <code title="cssrulelist-length">length</code> this method
   <em class="ct">must</em> return <code>null</code>. Otherwise, this method
   <em class="ct">must</em> return the <code>CSSRule</code> in the list given by
   <var title="">index</var>.</dd>
   <!-- XXX: Negative numbers are supposedly dealt with by the binding
   language. -->
  </dl>

  <h3>Interfaces for CSS Statements</h3>

  <p>This section defines several specific interfaces and one generic (from
  which the more specific inherit) for different types of CSS statements.</p>

  <h4>The <code>CSSRule</code> Interface</h4>

  <pre class="idl">interface <dfn>CSSRule</dfn> {
  const unsigned short      <span>STYLE_RULE</span>                     = 1;
  const unsigned short      <span>CHARSET_RULE</span>                   = 2;
  const unsigned short      <span>IMPORT_RULE</span>                    = 3;
  const unsigned short      <span>MEDIA_RULE</span>                     = 4;
  const unsigned short      <span>FONT_FACE_RULE</span>                 = 5;
  const unsigned short      <span>PAGE_RULE</span>                      = 6;
  const unsigned short      <span>NAMESPACE_RULE</span>                 = 7;

  readonly attribute unsigned short   <span title="cssrule-type">type</span>;
           attribute DOMString        <span title="cssrule-csstext">cssText</span>;
  readonly attribute <span>CSSRule</span>          <span title="cssrule-parentrule">parentRule</span>;
  readonly attribute <span>CSSStyleSheet</span>    <span title="cssrule-parentstylesheet">parentStyleSheet</span>;
};</pre>

  <p>The <dfn id="cssrule-style-rule"><code>STYLE_RULE</code></dfn>,
  <dfn id="cssrule-charset-rule"><code>CHARSET_RULE</code></dfn>,
  <dfn id="cssrule-import-rule"><code>IMPORT_RULE</code></dfn>,
  <dfn id="cssrule-media-rule"><code>MEDIA_RULE</code></dfn>,
  <dfn id="cssrule-font-face-rule"><code>FONT_FACE_RULE</code></dfn>,
  <dfn id="cssrule-page-rule"><code>PAGE_RULE</code></dfn> and
  <dfn id="cssrule-namespace-rule"><code>NAMESPACE_RULE</code></dfn>
  contants indicate if you have a  <code>CSSStyleRule</code>,
  <code>CSSCharsetRule</code>, <code>CSSImportRule</code>,
  <code>CSSMediaRule</code>, <code>CSSFontFaceRule</code>,
  <code>CSSPageRule</code> or <code>CSSNamespaceRule</code> rule type
  respectively.</p>

  <dl class="members">
   <dt><dfn id="cssrule-type" title="cssrule-type"><code>type</code></dfn> of
   type <code>unsigned short</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be one of the defined
   constants.</dd>

   <dt><dfn id="cssrule-csstext" title="cssrule-csstext"><code>cssText</code></dfn>
   of type <code>DOMString</code></dt>

   <dd>
    <p>On setting, user agents <em class="ct">must</em> <span>replace a
    statement</span> where <var>rule</var> is the value being set and <var>old
    object</var> is the object of which this attribute is set.</p>

    <p>On getting, <span class="issue">...</span>.</p>
   </dd>

   <dt><dfn id="cssrule-parentrule" title="cssrule-parentrule"><code>parentRule</code></dfn>
   of type <code>CSSRule</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be the nearest enclosing rule
   of the current rule. For example, an <code>@media</code> block enclosing
   the current rule.</dd>

   <dt><dfn id="cssrule-parentstylesheet" title="cssrule-parentstylesheet"><code>parentStyleSheet</code></dfn>
   of type <code>CSSStyleSheet</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> point to the style sheet that
   contains the current rule.</dd>
  </dl>

  <h5>Extensibility</h5>

  <p>The values 0-1000 are reserved for future use by the CSS WG.</p>

  <p>Vendors are suggested to use values outside this range and are reasonable
  unique so that they don't clash with extensions from other vendors. For
  example, the first value for Mozilla could be
  <code>0x0<strong>8EC0</strong>001</code> and
  <code>0x<strong>09E8A</strong>001</code> could be the first for Opera.</p>

  <h4>The <code>CSSStyleRule</code> Interface</h4>

  <p>The <code>CSSStyleRule</code> object represents a ruleset. It provides
  access to a declaration block as well as to the group of selectors.</p>

  <pre class="idl">interface <dfn>CSSStyleRule</dfn> : <span>CSSRule</span> {
           attribute DOMString        <span title="cssstylerule-selectortext">selectorText</span>;
  readonly attribute <span>CSSStyleDeclaration</span>  <span title="cssstylerule-style">style</span>;
};</pre>

  <dl class="members">

   <dt><dfn id="cssstylerule-selectortext" title="cssstylerule-selectortext"><code>selectorText</code></dfn>
   of type <code>DOMString</code></dt>

   <dd>
    <p>On setting, user agents <em class="ct">must</em> parse the given string
    as a group of selectors. If the given string is ignored user agents
    <em class="ct">must</em> act as if setting didn't occur. Otherwise, set
    the attribute to the parsed string.</p>

    <p>On getting, this attribute <em class="ct">must</em> return a
    <span title="canon-selectors">textual representation of the group of
    selectors</span>.</p>
   </dd>

   <dt><dfn id="cssstylerule-style" title="cssstylerule-style"><code>style</code></dfn>
    of type <code>CSSStyleDeclaration</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be a live instance of the
   <code>CSSStyleDeclaration</code> for the current ruleset.</dd>
  </dl>

  <h4>The <code>CSSCharsetRule</code> Interface</h4>

  <p><code>@charset</code> can (only) be used at the very start of a <span>CSS
   style sheet</span> to indicate the encoding of the file ([CSS21], section
   4.4).</p>

  <pre class="idl">interface <dfn>CSSCharsetRule</dfn> : <span>CSSRule</span> {
  readonly attribute DOMString        <span>encoding</span>;
};</pre>

  <dl class="members">
   <dt><dfn id="csscharsetrule-encoding"><code>encoding</code></dfn> of type
   <code>DOMString</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be the specified encoding.</p>
  </dl>

  <h4>The <code>CSSImportRule</code> Interface</h4>

  <p>The <code>@import</code> at rule as described in the <cite>CSS 2.1
   Specification</cite> ([CSS21], section 6.3).</p>

  <pre class="idl">interface <dfn>CSSImportRule</dfn> : <span>CSSRule</span> {
  readonly attribute DOMString        <span title="cssimportrule-href">href</span>;
  readonly attribute <span>MediaList</span>        <span title="cssimportrule-media">media</span>;
  readonly attribute <span>CSSStyleSheet</span>    <span title="cssimportrule-stylesheet">styleSheet</span>;
};</pre>

  <dl class="members">
   <dt><dfn id="cssimportrule-href" title="cssimportrule-href"><code>href</code></dfn>
   of type <code>DOMString</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be the <em>resolved</em> URI of
   the style sheet to be included.</dd>

   <dt><dfn id="cssimportrule-media" title="cssimportrule-media"><code>media</code></dfn>
   of type <code>MediaList</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be a live <code>MediaList</code>
   containing a list of media queries applicable to the imported style
   sheet.</dd>

   <dt><dfn id="cssimportrule-stylesheet" title="cssimportrule-stylesheet"><code>styleSheet</code></dfn>
   of type <code>CSSStyleSheet</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be a <code>CSSStyleSheet</code>
   object.</dd>
   <!-- If loading fails or anything the object's cssRules list is simply
   empty. -->
  </dl>

  <h4>The <code>CSSMediaRule</code> Interface</h4>

  <p>The <code>@media</code> at-rule is represented as a single statement in
  the CSS style sheet that contains zero or more rulesets which are contrained
  by one or more media (unless one happens to be <code>all</code>).</p>

  <pre class="idl">interface <dfn>CSSMediaRule</dfn> : <span>CSSRule</span> {
  readonly attribute <span>MediaList</span>        <span title="cssmediarule-media">media</span>;
  readonly attribute <span>CSSRuleList</span>      <span title="cssmediarule-cssrules">cssRules</span>;
  unsigned long      <span title="cssmediarule-insertrule">insertRule</span>(in DOMString <var>rule</var>, in unsigned long <var>index</var>);
  void               <span title="cssmediarule-deleterule">deleteRule</span>(in unsigned long <var>index</var>);
};</pre>

  <dl class="members">
   <dt><dfn id="cssmediarule-media" title="cssmediarule-media"><code>media</code></dfn>
   of type <code>MediaList</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be a <code>MediaList</code>
   containing a list of media types for which the contained rulesets  may be
   used.</dd>

   <dt><dfn id="cssmediarule-cssrules" title="cssmediarule-cssrules"><code>cssRules</code></dfn>
   of type <code>CSSRuleList</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be a <code>CSSRuleList</code>
   containing a list of all the rulesets.</dd>

   <dt><dfn id="cssmediarule-insertrule" title="cssmediarule-insertrule"><code>insertRule(<var title="">rule</var>,
   <var title="">index</var>)</code></dfn>, method</dt>

   <dd>When invoked, user agents <em class="ct">must</em> <span>insert a
   statement</span> where <var>rule</var> is <var>rule</var>, <var>index</var>
   is <var>index</var> and <var>rule list</var> is
   <code title="cssmediarule-cssrules">cssRules</code>.</dd>

   <dt><dfn id="cssmediarule-deleterule" title="cssmediarule-deleterule"><code>deleteRule(<var title="">index</var>)</code></dfn>,
    method</dt>

   <dd>When invoked, user agents <em class="ct">must</em> <span>remove a
   statement</span> where <var>index</var> is <var>index</var> and <var>rule
   list</var> is <code title="cssmediarule-cssrules">cssRules</code>.</dd>
  </dl>

  <h4>The <code>CSSFontFaceRule</code> Interface</h4>

  <p><code>@font-face</code> is used for grouping a single declaration block
   related to font settings for the page.</p>

  <pre class="idl">interface <dfn>CSSFontFaceRule</dfn> : <span>CSSRule</span> {
  readonly attribute <span>CSSStyleDeclaration</span>  <span title="cssfontfacerule-style">style</span>;
};</pre>

  <dl class="members">

   <dt><dfn id="cssfontfacerule-style" title="cssfontfacerule-style"><code>style</code></dfn>
    of type <code>CSSStyleDeclaration</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be a live reference to the
    declaration block for this rule.</dd>

  </dl>

  <p class="issue">Currently <code>@font-face</code> is more or less
   obsolete.</p>

  <h4>The <code>CSSPageRule</code> Interface</h4>

  <p>An @page</code> at-rule consists of a declaration block with an associated
   selector.</p>

  <pre class="idl">interface <dfn>CSSPageRule</dfn> : <span>CSSRule</span> {
           attribute DOMString        <span title="csspagerule-selectortext">selectorText</span>;
  readonly attribute <span>CSSStyleDeclaration</span>  <span title="csspagerule-style">style</span>;
};</pre>

  <dl class="members">

   <dt><dfn id="csspagerule-selectortext" title="csspagerule-selectortext"><code>selectorText</code></dfn>
    of type <code>DOMString</code></dt>

   <dd>
    <p>On setting, user agents <em class="ct">must</em> parse the given string
    as a page selector. If the given string is ignored user agents
    <em class="ct">must</em> act as if setting didn't occur. Otherwise, set
    the attribute to the parsed string.</p>

    <p>On getting, this attribute <em class="ct">must</em> contain a live
    textual representation of the page selector for the rule.</p>

    <p class="issue">We need to define normalization...</p>
   </dd>

   <dt><dfn id="csspagerule-style" title="csspagerule-style"><code>style</code></dfn>
    of type <code>CSSStyleDeclaration</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be a live reference to the
    declaration block for the current ruleset.</p>
  </dl>

  <h4>The <code>CSSNamespaceRule</code> Interface</h4>

  <p>An <code>@namespace</code> at-rule consists of a token, being the prefix,
   and a URI, being the namespace.</p>

  <pre class="idl">interface <dfn>CSSNamespaceRule</dfn> : <span>CSSRule</span> {
  readonly attribute DOMString        <span>namespaceURI</span>;
  readonly attribute DOMString        <span>prefix</span>;
};</pre>

  <dl class="members">
   <dt><dfn id="cssnamespacerule-namespaceuri"><code>namespaceURI</code></dfn>
   of type <code>DOMString</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be the specified namespace
   IRI.</dd>

   <dt><dfn id="cssnamespacerule-prefix"><code>prefix</code></dfn>
    of type <code>DOMString</code>, readonly</dt>

   <dd>This attribute <em class="ct">must</em> be the specified prefix or the
   empty string if there is no prefix.</dd><!-- XXX lowercased? -->
  </dl>

  <h3>Accessing declaration blocks</h3>

  <p>This section provides various way to get to declaration blocks which you
   can then manipulate.</p>

  <h4>Introduction</h4>

  <p class="issue">...</p>

  <h4>The <code>ElementCSSInlineStyle</code> Interface</h4>

  <pre class="idl">interface <dfn>ElementCSSInlineStyle</dfn> {
  readonly attribute <span>CSSStyleDeclaration</span>  <span>style</span>;
  readonly attribute <span>CSSStyleDeclaration</span>  <span>currentStyle</span>;
  readonly attribute <span>CSSStyleDeclaration</span>  <span>runtimeStyle</span>;
};</pre>

  <p class="issue">Serialization of the <code>style</code> attribute is not
   guarenteed to work.</p>

  <h4>The <code>ViewCSS</code> Interface</h4>

  <p>This interface represents a CSS view. The <span>getComputedStyle</span>
  method provides a <em>read only access</em> to the computed values of an
  element.</p>

  <p>The expectation is that an instance of the <code>ViewCSS</code> interface
  can be obtained by using binding-specific casting methods on an instance of
  the <code>AbstractView</code> interface.</p>

  <p>Since a computed style is related to an <code>Element</code> node, if this
   element is removed from the document, the associated
   <code>CSSStyleDeclaration</code> is no longer valid.</p>

  <pre class="idl">interface <dfn>ViewCSS</dfn> : AbstractView {
  <span>CSSStyleDeclaration</span> <span>getComputedStyle</span>(in Element <var title="">elt</var>, in DOMString <var title="">pseudoElt</var>);
};</pre>

  <p>The
  <dfn id="viewcss-getcomputedstyle"><code>getComputedStyle</code></dfn>
  method <em class="ct">must</em> return a live
  <code>CSSStyleDeclaration</code> object representing the computed style for
  <var title="">elt</var> (when <var title="">pseudoElt</var> is
  <code>null</code>) or for the pseudo-element <var title="">pseudoElt</var>
  of <var title="">elt</var>. [CSS21]</p>

  <p>If <var title="">pseudoElt</var> is not a recognized CSS pseudo-element
  the invocation the method <em class="ct">must</em> return
  <span class="issue">...</span>.</p>

  <p>For language bindings that support optional arguments invoking
  <code>getComputedStyle</code> without the <var title="">pseudoElt</var>
  argument <em class="ct">must</em> be identical to invoking the method with
  that argument being <code>null</code>.</p>

  <h4>The <code>DocumentCSS</code> Interface</h4>

  <p class="issue">I think I'll drop this soon!</p>
  
  <p>This interface represents a document with a CSS view.</p>

  <!--
   so this is how this all comes together:

     UA style sheet
     Author style sheet
     Override ("temporary") style sheet
     User style sheet
       Author !important styles
       Override !important styles
       User !important styles
       UA !important styles (fwiw) - or does this come before user?!

    on getting you actually don't create an override style sheet you just read
    the computed style of a certain property. this should be clear.

    that's what runtimeStyle should do more or less. removeAttribute() allows
    you to remove the current style... removeAttribute is such an ugly name

    currentStyle works sort of like this
  -->

  <p>The <code>getOverrideStyle</code>
   method provides a mechanism through which a DOM author could effect
   immediate change to the style of an element without modifying the explicitly
   linked style sheets of a document or the inline style of elements in the
   style sheets. This style sheet comes after the author style sheet in the
   cascade algorithm and is called override style sheet. The override style
   sheet takes precedence over author style sheets. An <code>!important</code>
   declaration in an author style sheet still takes precedence over a normal
   declaration in an author style sheet. Override, author and user style sheets
   may all contain <code>!important</code> declarations. User
   <code>!important</code> rules take precedence over both override and author
   <code>!important</code> rules, and override <code>!important</code> rules
   take precedence over author <code>!important</code> rules.</p>
  <p>The expectation is that an instance of the <code>DocumentCSS</code>
   interface can be obtained by using binding-specific casting methods on an
   instance of the <code>Document</code> interface.</p>

  <pre class="idl">interface <dfn>DocumentCSS</dfn> : <span>DocumentStyle</span> {
  <span>CSSStyleDeclaration</span> <span>getOverrideStyle</span>(in Element <var>elt</var>, in DOMString <var>pseudoElt</var>);
};</pre>

  <p>The
  <dfn id="documentcss-getoverridestyle"><code>getOverrideStyle</code></dfn>
  method <em class="ct">must</em> return the override style declaration for
  the <code>Element</code> <var>elt</var> (when
  <var title="">pseudoElt</var> is <code>null</code>) or for the
  pseudo-element <var>pseudoElt</var> of <code>Element</code>
  <var title="">elt</var>.</p>

  <p>For language bindings that support optional arguments invoking
  <code>getOverrideStyle</code> without the <var>pseudoElt</var> argument
  <em class="ct">must</em> be identical to invoking the method with that
  argument being <code>null</code>.</p>

  <h3>Declaration blocks</h3>

  <h4>Parsing property values</h4>

  <p>When the steps below require the user agent to
  <dfn title="CSS value parsing">parse a CSS value</dfn> for a given property
  the user agent <em class="ct">must</em> use the <code>S* expr</code>
  production in combination with the property to determine whether it is a valid
  value and return that or return "null" in case of an error. [CSS]</p>


  <h4>The <code>CSSStyleDeclaration</code> Interface</h4>

  <p>The <code>CSSStyleDeclaration</code> interface gives access to read and
  manipulate CSS properties and their values within a declaration block.</p>

  <p>If an attribute or method returns an object implementing the
  <code>CSSStyleDeclaration</code> interface (and related interfaces) and says
  the object is <dfn title="readonly declaration">readonly</dfn> user agents
  <em class="ct">must</em> raise a <code>NO_MODIFICATION_ALLOWED_ERR</code>
  exception on an attempt to modify the object.</p>

  <p class="note">Invoking
  <code title="cssstyledeclaration-removeproperty">removeProperty</code> or
  setting <code title="cssstyledeclaration-csstext">cssText</code> would be
  examples of that.</p>

  <!-- XXX Or do we need to specify this independently for each attribute and
  method? -->

  <p class="issue"><code>CSSStyleDeclaration</code> can represent computed
  values and used values. (This also goes for interfaces implemented on top
  of <code>CSSStyleDeclaration</code> objects obviously.)</p>

  <p class="issue">This object stringifies to its cssText attribute. Or
  not?</p>

  <pre class="idl">interface <dfn>CSSStyleDeclaration</dfn> {
           attribute DOMString <span title="cssstyledeclaration-csstext">cssText</span>;
  DOMString <span title="cssstyledeclaration-getpropertyvalue">getPropertyValue</span>(in DOMString <var title="">property</var>);
  DOMString <span title="cssstyledeclaration-getpropertypriority">getPropertyPriority</span>(in DOMString <var title="">property</var>);
  DOMString <span title="cssstyledeclaration-removeproperty">removeProperty</span>(in DOMString <var title="">property</var>);
  void <span title="cssstyledeclaration-setproperty">setProperty</span>(in DOMString <var title="">property</var>, in DOMString <var title="">value</var>);
  void <span title="cssstyledeclaration-setproperty">setProperty</span>(in DOMString <var title="">property</var>, in DOMString <var title="">value</var>, in DOMString <var title="">priority</var>);
  readonly attribute unsigned long <span title="cssstyledeclaration-length">length</span>;
  DOMString <span title="cssstyledeclaration-item">item</span>(in unsigned long <var title="">index</var>);
  readonly attribute <span>CSSRule</span> <span title="cssstyledeclaration-parentrule">parentRule</span>;
};</pre>

  <p>The
  <dfn id="cssstyledeclaration-csstext" title="cssstyledeclaration-csstext"><code>cssText</code></dfn>
  attribute, on getting, <span class="issue">...</span>.</p>
  
  <p>On setting the <code title="">cssText</code> attribute, user agents
  <em class="ct">must</em> remove all properties currently set on the object and
  then parse the given string as the contents of a declaration block and set
  each property / value pair that is not ignored on the
  <code>CSSStyleDeclaration</code> block. [CSS]</p>

  <p>The
  <dfn id="cssstyledeclaration-getpropertyvalue" title="cssstyledeclaration-getpropertyvalue"><code>getPropertyValue(<var title="">property</var>)</code></dfn>
  method, when invoked, <span class="issue">...</span>.</p>
  <!-- Once we have defined how everything will be canonicalized we can start
  thinking about this... --></p>

  <p>The
  <dfn id="cssstyledeclaration-getpropertypriority" title="cssstyledeclaration-getpropertypriority"><code>getPropertyPriority(<var title="">property</var>)</code></dfn>
  method, when invoked, if <var title="">property</var> case-insensitively
  matches a specified property that has a priority user agents
  <em class="ct">must</em> return the canonical priority of that property as
  given in the syntax definition. Otherwise, the empty string
  <em class="ct">must</em> be returned.</p>

  <p class="note">For <code>background-color:lime !IMPORTANT</code> the return
  value would be <code>important</code>.</p>

  <p>The
  <dfn id="cssstyledeclaration-removeproperty" title="cssstyledeclaration-removeproperty"><code>removeProperty(<var title="">property</var>)</code></dfn>
  method, when invoked, if <var title="">property</var> case-insensitively
  matches a specified property user agents <em class="ct">must</em> remove that
  property declaration.</p>

  <p>The
  <dfn id="cssstyledeclaration-setproperty" title="cssstyledeclaration-setproperty"><code>setProperty(<var title="">property</var>,
  <var title="">value</var>, <var title="">priority</var>)</code></dfn> method
  gives a way to set a declaration. When invoked, user agents
  <em class="ct">must</em> run the following steps:</p>

  <ol>
   <li><p>If <var title="">property</var> does not case-insensitively match a
   supported property abort this algorithm.</p></li>

   <li><p>If <var title="">value</var> is <code>null</code> or the empty string
   invoke <code title="cssstyledeclaration-removeproperty">removeProperty</code>
   with <var title="">property</var> as argument and abort this
   algorithm.</p></li>

   <li><p>If the <var title="">priority</var> argument has been omitted let
   <var title="">priority</var> be <code>null</code>.</p></li>

   <li><p>If <var title="">priority</var> is neither a valid priority nor
   <code>null</code> or the empty string abort this algorithm.</p></li>

   <li>
    <p>If <span title="CSS value parsing">parsing the
    <var title="">value</var></span> returns "null" abort this algorithm.</p>

    <p class="note"><var title="">value</var> can not include
    <code>!important</code>.</p>
   </li>

   <li><p>Finally, set <var title="">property</var> to <var title="">value</var>
   with priority <var title="">priority</var> when <var title="">priority</var>
   is not <code>null</code> or the empty string. Otherwise set
   <var title="">property</var> to <var title="">value</var>.</p></li>
  </ol>
  
  <p>The
  <dfn id="cssstyledeclaration-length" title="cssstyledeclaration-length"><code>length</code></dfn>
  attribute <em class="ct">must</em> be the number of setted properties.</p>

  <p>The
  <dfn id="cssstyledeclaration-item" title="cssstyledeclaration-item"><code>item(<var title="">index</var>)</code></dfn>
  method, when invoked, <span class="issue">...</span>.</p>
  <!-- returns the value of property x stored at position item. -->

  <p>The
  <dfn id="cssstyledeclaration-parentrule" title="cssstyledeclaration-parentrule"><code>parentRule</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the
  <code>CSSrule</code> object the <code>CSSStyleDeclaration</code> is object is
  associated with or <code>null</code> if it is not associated with a
  <code>CSSrule</code> object.</p>


  <h4>CSS Properties</h4>

  <p>The DOM attribute name of a CSS property can be found by using the
  following algorithm:</p>

  <ol>
   <li>Let <var title="">r</var> be the CSS property to be
   converted.</li>

   <li>Uppercase the first character after every U+002D (<code>-</code>) in
   <var title="">r</var>.</li>

   <li>Remove every U+002D (<code>-</code>) in <var title="">r</var>.</li>

   <li>Return <var title="">r</var>.</li>
  </ol>

  <p class="note">This means that
  <code>-<var title="">vendor</var>-<var title="">property</var></code>
  becomes
  <code><var title=""><strong>V</strong>endor</var><var title=""><strong>P</strong>roperty</var></code>
  for instance.</p>

  <h5>The <code>CSS2Properties</code> Interface</h5>

  <p class="issue">If we have all the properties on
  <code>CSSStyleDeclarationProperties</code> do we still need this
  interface?</p>

  <h5>The <code>CSSStyleDeclarationProperties</code> Interface</h5>

  <p class="issue">Need to work out how to deal with properties that take one
  or more values. Such as the "newstyle" 'background-image' etc. Suggestions
  welcome.</p>

  <p>Objects implementing the <code>CSSStyleDeclaration</code> interface
  <em class="ct">must</em> also implement the
  <code>CSSStyleDeclarationProperties</code> interface.</p>

  <p class="note">The <code>CSSStyleDeclarationProperties</code> interface can
  never be considered stable. This means that in languages where stable
  interfaces are important you have to use some kind of versioning
  mechanism.</p>

  <pre class="idl">interface <dfn>CSSStyleDeclarationProperties</dfn> {
           // This interface will be updated when more CSS property related
           // specifications become stable (for instance, W3C Recommendation).
           attribute CSSBaseValue     azimuth;
           attribute CSSColorValue    backgroundColor;
           attribute CSSURLValue      backgroundImage;
           attribute CSSBaseValue     backgroundPosition;
           attribute CSSBaseValue     borderSpacing;
           attribute CSSColorValue    borderTopColor;
           attribute CSSColorValue    borderRightColor;
           attribute CSSColorValue    borderBottomColor;
           attribute CSSColorValue    borderLeftColor;
           attribute CSSLengthValue   borderTopWidth;
           attribute CSSLengthValue   borderRightWidth;
           attribute CSSLengthValue   borderBottomWidth;
           attribute CSSLengthValue   borderLeftWidth;
           attribute CSSPercentageLengthValue  bottom;
           attribute CSSBaseValue     clip;
           attribute CSSColorValue    color;
           attribute CSSBaseValue     content;
           attribute CSSURLValue      cueAfter;
           attribute CSSURLValue      cueBefore;
           attribute CSSURLValue      cursor;
           attribute CSSAngleValue    elevation;
           attribute CSSPercentageLengthValue  fontSize;
           attribute CSSBaseValue     fontWeight;
           attribute CSSPercentageLengthValue  height;
           attribute CSSPercentageLengthValue  left;
           attribute CSSLengthValue   letterSpacing;
           attribute CSSBaseValue     lineHeight;
           attribute CSSURLValue      listStyleImage;
           attribute CSSPercentageLengthValue  marginTop;
           attribute CSSPercentageLengthValue  marginRight;
           attribute CSSPercentageLengthValue  marginBottom;
           attribute CSSPercentageLengthValue  marginLeft;
           attribute CSSPercentageLengthValue  maxHeight;
           attribute CSSPercentageLengthValue  maxWidth;
           attribute CSSPercentageLengthValue  minHeight;
           attribute CSSPercentageLengthValue  minWidth;
           attribute CSSBaseValue     orphans;
           attribute CSSColorValue    outlineColor;
           attribute CSSLengthValue   outlineWidth;
           attribute CSSPercentageLengthValue  paddingTop;
           attribute CSSPercentageLengthValue  paddingRight;
           attribute CSSPercentageLengthValue  paddingBottom;
           attribute CSSPercentageLengthValue  paddingLeft;
           attribute CSSBaseValue     pauseAfter;
           attribute CSSBaseValue     pauseBefore;
           attribute CSSBaseValue     pitchRange;
           attribute CSSBaseValue     pitch;
           attribute CSSURLValue      playDuring;
           attribute CSSBaseValue     richness;
           attribute CSSPercentageLengthValue  right;
           attribute CSSBaseValue     speechRate;
           attribute CSSBaseValue     stress;
           attribute CSSPercentageLengthValue  textIndent;
           attribute CSSPercentageLengthValue  top;
           attribute CSSPercentageLengthValue  verticalAlign;
           attribute CSSPercentageLengthValue  width;
           attribute CSSBaseValue     volume;
           attribute CSSBaseValue     widows;
           attribute CSSLengthValue   wordSpacing;
           attribute CSSBaseValue     zIndex;
};</pre>

  <h3>CSS value related interfaces</h3>

  <p>The specific interfaces for CSS value allow for "easy" script
  manipulation of CSS property declarations.</p>

  <div class="example">
   <p>For instance, to increase the pixel value of the <code>width</code>
   property of object <var>obj</var> by <code>300</code> one could write:</p>

   <pre><code><var>obj</var>.style.width.px += 300</code></pre>
  </div>

  <h4>The <code>CSSBaseValue</code> Interface</h4>

  <p>The <code>CSSBaseValue</code> interface acts as the base interface for
  all specific CSS value interfaces.</p>

  <p>In binding that allow it, objects implementing the
  <code>CSSBaseValue</code> interface must stringify to the object's
  underlying string representation.</p>

  <p><code>CSSBaseValue</code> inherits from DOMString, so in bindings where
  strings have attributes or methods, those attributes and methods will also
  operate on <code>CSSBaseValue</code> objects.</p>

  <!-- XXX: the above was found problematic in HTML5 ... See DOMTokenString
  message from Maciej. On the other hand, discussion on #webapi showed that it
  might just work for the CSSOM although there are some issues to be sorted
  out.  -->

  <pre class="idl">interface <dfn>CSSBaseValue</dfn> : DOMString {
           attribute DOMString        <span title="cssbasevalue-csstext">cssText</span>;
};</pre>

  <dl class="members">
   <dt><dfn id="cssbasevalue-csstext" title="cssbasevalue-csstext"><code>cssText</code></dfn>
   of type <code>DOMString</code></dt>

   <dd>
    <p>On setting, user agents <em class="ct">must</em> parse the given string
    as a value for the associated property (the attribute from which this
    object was obtained). If the given string was ignored user agents
    <em class="ct">must</em> act as if setting didn't occur. Otherwise, set
    the attribute to the parsed string.</p>

    <p>On getting, <span class="issue">...</span>.</p>
   </dd>
  </dl>

  <h4>The <code>CSSColorValue</code> Interface</h4>

  <pre class="idl">interface <dfn>CSSColorValue</dfn> : <span>CSSBaseValue</span> {
           attribute unsigned short   red;
           attribute float            redPercent; // 100% = 255
           attribute unsigned short   green;
           attribute float            greenPercent; // 100% = 255
           attribute unsigned short   blue;
           attribute float            bluePercent; // 100% = 255
           attribute float            alpha; // float in range 0.0..1.0
           attribute unsigned short   hue; // integer in range 0..360
           attribute float            saturation; // percentage
           attribute float            lightness; // percentage
           attribute unsigned long    hex3;
           attribute unsigned long    hex6;
};</pre>

  <h4>The <code>CSSUrlValue</code> Interface</h4>

  <pre class="idl">interface <dfn>CSSUrlValue</dfn> : <span>CSSBaseValue</span> {
           attribute DOMString        <span title="cssurlvalue-url">url</span>;
  readonly attribute DOMString        <span title="cssurlvalue-absoluteurl">absoluteUrl</span>;
};</pre>

  <h4>The <code>CSSLengthValue</code> Interface</h4>

  <pre class="idl">interface <dfn>CSSLengthValue</dfn> : <span>CSSBaseValue</span> {
           attribute float            em;
           attribute float            ex;
           attribute float            px;
           attribute float            cm;
           attribute float            mm;
           attribute float            pt;
           attribute float            pc;
};</pre>

  <p class="issue">How to express non-negative lengths?</p>

  <h4>The <code>CSSPercentageLengthValue</code> Interface</h4>

  <pre class="idl">interface <dfn>CSSPercentageLengthValue</dfn> : <span>CSSLengthValue</span> {
           attribute float            percent;
};</pre>
  <!--
- number?
- color
- url
- length
- unsigned length
- percentageLength
- unsigned percentageLength
- numberPercentageLength
- unsigned numberPercentageLength
  -->

  <p class="issue">... some exception for when conversion isn't
   possible.</p>

  <h2>Layout APIs</h2>

  <!-- Also need EventLayout -->

  <p><em>This section and its subsections apply to visual user agents
  only.</em></p>

  <h3>The <code>WindowLayout</code> Interface</h3>

  <p>The <code>WindowLayout</code> interface <em class="ct">must</em> be
  implemented on objects implementing the <code>Window</code> interface.
  [Window]</p>

  <p>The term <dfn>browsing context</dfn> is used as defined by the Window
  Object 1.0 specification. [Window]</p>

  <p>Some of the terminology used in this section and its subsection is that of
  Media Queries. [MQ]</p>

  <p>This interface represents rendering information about the current browsing
  context.</p>

  <pre class="idl">interface <dfn>WindowLayout</dfn> {
  readonly attribute float            <span title="windowlayout-innerwidth">innerWidth</span>;
  readonly attribute float            <span title="windowlayout-innerheight">innerHeight</span>;
  readonly attribute float            <span title="windowlayout-outerheight">outerWidth</span>;
  readonly attribute float            <span title="windowlayout-outerheight">outerHeight</span>;
  readonly attribute float            <span title="windowlayout-pagexoffset">pageXOffset</span>;
  readonly attribute float            <span title="windowlayout-pageyoffset">pageYOffset</span>;
  readonly attribute float            <span title="windowlayout-screenx">screenX</span>;
  readonly attribute float            <span title="windowlayout-screeny">screenY</span>;
  readonly attribute <span>Screen</span>           <span title="windowlayout-screen">screen</span>;
};</pre>
  <!-- XXX float? -->

  <dl>
   <dt><dfn id="windowlayout-innerwidth" title="windowlayout-innerwidth"><code>innerWidth</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>
    <p>This attribute <em class="ct">must</em> be the viewport width in
    pixels.</p>

    <p class="note">This is including, if rendered, the vertical scrollbar.</p>
   </dd>

   <dt><dfn id="windowlayout-innerheight" title="windowlayout-innerheight"><code>innerHeight</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>
    <p>This attribute <em class="ct">must</em> be the viewport height in
    pixels.</p>

    <p class="note">This is including, if rendered, the horizontal
    scrollbar.</p>
   </dd>

   <dt><dfn id="windowlayout-outerwidth" title="windowlayout-outerwidth"><code>outerWidth</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>In web browsers, this attribute <em class="ct">must</em> be the width of
   the browser window in pixels. Otherwise, this <em class="ct">must</em> be
   <code>0</code>.</dd>

   <dt><dfn id="windowlayout-outerheight" title="windowlayout-outerheight"><code>outerHeight</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>In web browsers, this attribute <em class="ct">must</em> be the height of
   the browser window in pixels. Otherwise, this <em class="ct">must</em> be
   <code>0</code>.</dd>

   <dt><dfn id="windowlayout-pagexoffset" title="windowlayout-pagexoffset"><code>pageXOffset</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>This attribute <em class="ct">must</em> be the number of pixels the user
   has scrolled to the right.</dd>

   <dt><dfn id="windowlayout-pageyoffset" title="windowlayout-pageyoffset"><code>pageYOffset</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>This attribute <em class="ct">must</em> be the number of pixels the user
   has scrolled to the bottom.</dd>

   <dt><dfn id="windowlayout-screenx" title="windowlayout-screenx"><code>screenX</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>In web browsers, this attribute <em class="ct">must</em> be the amount of
   of pixels to the left of the browser window offsetted against the screen of
   the output device. Otherwise, this <em class="ct">must</em> be
   <code>0</code>.</dd>

   <dt><dfn id="windowlayout-screeny" title="windowlayout-screeny"><code>screenY</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>In web browsers, this attribute <em class="ct">must</em> be the amount of
   of pixels to the top of the browser window offsetted against the screen of
   the output device. Otherwise, this <em class="ct">must</em> be
   <code>0</code>.</dd>

   <dt><dfn id="windowlayout-screen" title="windowlayout-screen"><code>screen</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>This attribute <em class="ct">must</em> hold a <code>Screen</code>
   object.</dd>
  </dl>

  <p>If the user agent supports multiple views and the current view does not
  have a notion of an output device the above attributes with the exception of
  <code title="windowlayout-screen">screen</code> <em class="ct">must</em> be
  <code>0</code>. [DOM2View]</p>

  <h4>The <code>Screen</code> Interface</h4>

  <p>This interface represents information about the screen of the output
  device.</p>

  <pre class="idl">interface <dfn>Screen</dfn> {
  readonly attribute float            <span title="screen-availwidth">availWidth</span>;
  readonly attribute float            <span title="screen-height">availHeight</span>;
  readonly attribute float            <span title="screen-width">width</span>;
  readonly attribute float            <span title="screen-height">height</span>;
  readonly attribute float            <span title="screen-colordepth">colorDepth</span>;
  readonly attribute float            <span title="screen-pixeldepth">pixelDepth</span>;
};</pre>
  <!-- XXX float? -->

  <dl class="members">
   <dt><dfn id="screen-availwidth" title="screen-availwidth"><code>availWidth</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>This attribute <em class="ct">must</em> be the available width for
   rendering surface of the output device in pixels.</dd>

   <dt><dfn id="screen-availheight" title="screen-availheight"><code>availHeight</code>
   of type <code>float</code>, readonly</dfn></dt>

   <dd>This attribute <em class="ct">must</em> be the available height for
   rendering surface of the output device in pixels.</dd>

   <dt><dfn id="screen-width" title="screen-width"><code>width</code> of type
   <code>float</code>, readonly</dfn></dt>

   <dd>This attribute <em class="ct">must</em> be the width  of the output
   device in pixels.</dd>

   <dt><dfn id="screen-height" title="screen-height"><code>height</code> of
   type <code>float</code>, readonly</dfn></dt>

   <dd>This attribute <em class="ct">must</em> be the height of the output
   device in pixels.</dd>

   <dt><dfn id="screen-colordepth" title="screen-colordepth"><code>colorDepth</code>
   of type <code>float</code>, readonly</dfn></dt>
   <dt><dfn id="screen-pixeldepth" title="screen-pixeldepth"><code>pixelDepth</code>
   of type <code>float</code>, readonly</dfn></dt>
   <!-- pixelDepth is not supported by Internet Explorer 7 -->

   <dd>These attributes <em class="ct">must</em> be the number of bits per color
   from the output device.</dd>
  </dl>

  <p>If the user agent supports multiple views and the current view does not
  have a notion of an output device the above attributes
  <em class="ct">must</em> be <code>0</code>. [DOM2View]</p>


  <h3>The <code>DocumentLayout</code> Interface</h3>

  <p>Objects implementing the <code>Document</code> interface
  <em class="ct">must</em> also implement the <code>DocumentLayout</code>
  interface. [DOM3Core]</p>
  
  <pre class="idl">interface <dfn>DocumentLayout</dfn> {
  Element <span title="documentlayout-elementfrompoint">elementFromPoint</span>(in unsigned long <var title="">x</var>, in unsigned long <var title="">y</var>);
};</pre>

  <p>The
  <dfn id="documentlayout-elementfrompoint" title="documentlayout-elementfrompoint"><code>elementFromPoint(<var title="">x</var>,
  <var title="">y</var>)</code></dfn> method <em class="ct">must</em> return the
  element for the given position. The element to be returned is determined
  through <span class="issue">hit testing</span>. If either argument is negative
  or if there is no element under the given position the method
  <em class="ct">must</em> return <code>null</code>.</p>


  <h3>The <code>ElementLayout</code> Interface</h3>

  <p>Objects implementing the <code>Element</code> interface
  <em class="ct">must</em> also implement the <code>ElementLayout</code>
  interface. [DOM3Core]</p>

  <pre class="idl">interface <dfn>ElementLayout</dfn> {
  <span>TextRectangleList</span> <span>getClientRects</span>();
  <span>TextRectangle</span> <span>getBoundingClientRect</span>();

  readonly attribute float <span>offsetTop</span>;
  readonly attribute float <span>offsetLeft</span>;
  readonly attribute float <span>offsetWidth</span>;
  readonly attribute float <span>offsetHeight</span>;
  readonly attribute HTMLElement <span>offsetParent</span>; // HTMLElement

           attribute float <span>scrollTop</span>;    // scroll on setting
           attribute float <span>scrollLeft</span>;   // scroll on setting
  readonly attribute float <span>scrollWidth</span>;
  readonly attribute float <span>scrollHeight</span>;

  readonly attribute float <span>clientTop</span>;
  readonly attribute float <span>clientLeft</span>;
  readonly attribute float <span>clientWidth</span>;
  readonly attribute float <span>clientHeight</span>;
};</pre>

  <h4>The <code>getClientRects()</code> and <code>getBoundingClientRect</code>
  methods</h4>

<!-- XXX On block level elements TextRectangleList.length is mostly 1 (except I
 guess for printing or so or multicol perhaps and for inline elements with
 multiple boxes it's the amount of boxes. -->

  <p>The
  <dfn id="elementlayout-getclientrects"><code>getClientRects()</code></dfn>
  method <em class="ct">must</em>, when invoked, return a
  <code>TextRectangleList</code> object containing a list of
  <code>TextRectangle</code> objects describing the border boxes for the element
  on which it was invoked.</p>

  <p>The
  <dfn id="elementlayout-getboundingclientrect"><code>getBoundingClientRect()</code></dfn>
  method <em class="ct">must</em>, when invoked, return a union of the
  rectangles returned by <code>getClientRects()</code> in a single
  <code>TextRectangle</code> object for the element on which it was invoked.</p>

  <p>The values of the attributes of the <code>TextRectAngle</code> object
  <em class="ct">must</em> all be expressed in CSS pixels. They are all relative
  to the top left corner of the canvas (0, 0) and calculated as if nothing has
  been scrolled. If the element is a descendent of an
  <code>svg:foreignObject</code> element the dimensions are measured relative to
  the origin of the nearest <code>svg:foreignObject</code> ancestor, in the
  <code>svg:foreignObject</code> subtree's CSS coordinate system.</p>

  <p class="issue">...</p>

  <!--
   XXX

   - The returned rectangles do not include the bounds of any child elements
   that might happen to overflow (ok, this was not ambiguous in the above
   definition, it's just a note)

   - For HTML AREA elements, SVG elements that do not render anything
   themselves, display:none elements, and generally any elements that are not
   directly rendered, we return an empty list or a (0,0,0,0) rect (arguably this
   also follows from the definition)

   - for getClientRects we return rectangles even for CSS boxes that have empty
   border-boxes. The left, top, right and bottom coordinates can still be
   meaningful.

   - for getBoundingClientRect, we completely ignore CSS boxes that have empty
   border-boxes. If all the element's CSS boxs' border-boxes are empty, then we
   return a rectangle whose width and height are zero and whose top and left are
   the top-left of the border-box for the first (content order) CSS box for the
   element.
  -->

  <h5>The <code>TextRectangleList</code> Interface</h5>
  
  <p>The <code>TextRectangleList</code> object consists of an ordered list of
  <code>TextRectAngle</code> objects.</p>

  <pre class="idl">interface <dfn>TextRectangleList</dfn> {
  readonly attribute unsigned long <span title="textrectanglelist-length">length</span>;
  <span>TextRectangle</span> <span title="textrectanglelist-item">item</span>(in unsigned long <var title="">index</var>);
};</pre>

  <p>The
  <dfn id="textrectanglelist-length" title="textrectanglelist-length"><code>length</code></dfn>
  attribute <em class="ct">must</em> return the number of
  <code>TextRectangle</code> objects associated with the object.</p>

  <p>The
  <dfn id="textrectanglelist-item" title="textrectanglelist-item"><code>item(<var title="">index</var>)</code></dfn>
  method, when invoked, <em class="ct">must</em> raise an
  <code>INDEX_SIZE_ERR</code> exception when <var title="">index</var> is
  negative or greater than the number of <code>TextRectangle</code> objects
  associated with the object. Otherwise, the <code>TextRectangle</code> object
  at <var title="">index</var> <em class="ct">must</em> be returned.</p>

  <p>In ECMAScript implementations, objects that implement the
  <code>TextRectangleList</code> interface <em class="ct">must</em> also have a
  <code>[[Get]]</code> method that, when invoked with a number, acts like the
  <code title="textrectanglelist-item">item()</code> method would when invoked
  with that argument.</p>

  <h5>The <code>TextRectangle</code> Interface</h5>
  
  <p>Objects implementing the <code>TextRectangle</code> interface represent a
  rectangular layout box.</p>

  <pre class="idl">interface <dfn>TextRectangle</dfn> {
  readonly attribute float <span title="textrectangle-top">top</span>;
  readonly attribute float <span title="textrectangle-right">right</span>;
  readonly attribute float <span title="textrectangle-bottom">bottom</span>;
  readonly attribute float <span title="textrectangle-left">left</span>;
};</pre>
  
  <p>The
  <dfn id="textrectangle-top" title="textrectangle-top"><code>top</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the distance between
  the top of the viewport and the top of the rectangle box.</p>

  <p>The
  <dfn id="textrectangle-right" title="textrectangle-right"><code>right</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the distance between
  the left of the viewport and the right of the rectangle box.</p>
  
  <p>The
  <dfn id="textrectangle-bottom" title="textrectangle-bottom"><code>bottom</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the distance between
  the top of the viewport and the bottom of the rectangle box.</p>


  <p>The
  <dfn id="textrectangle-left" title="textrectangle-left"><code>left</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the distance between
  the left of the viewport and the left of the rectangle box.</p>



  <h4>The <code title="">offset<var title="">*</var></code> attributes</h4>

  <p>The <dfn id="elementlayout-offsetparent"><code>offsetParent</code></dfn>
  attribute, when called on element <var title="">A</var>,
  <em class="ct">must</em> return the element determined by the following
  algorithm:</p>
  
  <ol>
   <li>
    <p>If any of the following holds true return <code>null</code> and stop this
    algorithm:</p>
    
    <ul>
     <li><var title="">A</var> is the root element.</li>

     <li><var title="">A</var> is the <code>body</code> element. [HTML5]</li>

     <li>The computed value of the <code>position</code> property for element
     <var title="">A</var> is <code>fixed</code>.</li>
    </ul>
   </li>

   <li><p>If <var title="">A</var> is an <code>area</code> element in the
   <code>http://www.w3.org/1999/xhtml</code> namespace which has a
   <code>map</code> element somewhere in the ancestor chain return the nearest
   ancestor <code>map</code> element and stop this algorithm.</p></li>

   <li>
    <p>Return the nearest ancestor element of <var title="">A</var> for which at
    least one of the following is true and stop this algorithm if such an
    ancestor is found:</p>
    
    <ul>
     <li>The computed value of the <code>position</code> property is not
     <code>static</code>.</li>

     <li>It is the <code>body</code> element. [HTML5]</li>

     <li>The computed value of the <code>position</code> property of
     <var title="">A</var> is <code>static</code> and the ancestor is one of the
     following elements in the <code>http://www.w3.org/1999/xhtml</code>
     namespace: <code>td</code>, <code>th</code> or <code>table</code>.</li>
    </ul>
   </li>

   <li><p>Return <code>null</code>.</p></li>
  </ol>

  <!--XXX add something about the assumption that nothing is scrolled here?-->

  <p>The <dfn id="elementlayout-offsettop"><code>offsetTop</code></dfn>
  attribute, when called on element <var title="">A</var>,
  <em class="ct">must</em> return the value that is the result of the following
  algorithm:</p>
  
  <ol>
   <li><p>If element <var title="">A</var> is the <code>body</code> element, its
   computed value of the <code>display</code> propery is <code>none</code> or it
   does not have an associated CSS layout box return zero and stop this
   algorithm. [HTML5]</p></li>

   <li><p>If the <code>offsetParent</code> of element <var title="">A</var> is
   <code>null</code> or the <code>body</code> element return the distance in CSS
   pixels as float between the top border edge of element <var title="">A</var>
   and the top of the initial containing block and stop this algorithm.
   [HTML5]</p></li>

   <li><p>Return the distance in CSS pixels as float between the top border edge
   of the <code>offsetParent</code> of element <var title="">A</var>  and the
   top border edge of element <var title="">A</var>.</p></li>
  </ol>

  <p>The <dfn id="elementlayout-offsetleft"><code>offsetLeft</code></dfn>
  attribute, when caled on element <var title="">A</var>,
  <em class="ct">must</em> return the value that is the result of the following
  algorithm:</p>

  <ol>
   <li><p>If element <var title="">A</var> is the <code>body</code> element, its
   computed value of the <code>display</code> propery is <code>none</code> or it
   does not have an associated CSS layout box return zero and stop this
   algorithm. [HTML5]</p></li>

   <li><p>If the <code>offsetParent</code> of element <var title="">A</var> is
   <code>null</code> or the <code>body</code> element return the distance in CSS
   pixels as float between the left border edge of element <var title="">A</var>
   and the left of the initial containing block and stop this algorithm.
   [HTML5]</p></li>

   <li><p>Return the distance in CSS pixels as float between the left border
   edge of the <code>offsetParent</code> of element <var title="">A</var> and
   the left border edge of element <var title="">A</var>.</p></li>
  </ol>

  <p class="issue">See source code for some remarks on <code>html:area</code>
  elements.</p>
  <!--
   When html:area has an html:map and that has an associated html:img

   The shape attribute is set to default
     offsetLeft and offsetTop are 0.
   The shape attribute is set to circle
     offsetLeft is the center-x value minus the radius and offsetTop is the center-y value minus the radius.
   The shape attribute is set to rect
   The shape attribute is set to poly
     offsetLeft is the minimum of all x values and offsetTop is the minimum of all y values.
   -->

  <p>The <dfn id="elementlayout-offsetwidth"><code>offsetWidth</code></dfn>
  attribute, when called on element <var title="">A</var>,
  <em class="ct">must</em> return value that is the result of the following
  algorithm:</p>
  
  <ol>
   <li><p>If element <var title="">A</var> does not have an associated CSS
   layout box return zero and stop this algorithm.</p></li>

   <li><p>If element <var title="">A</var> is the <code>body</code> or root
   element return the width of the initial containing block in CSS pixels and
   stop this algorithm. [HTML5]</p></li>

   <li><p>Return the number of CSS pixels of the border box width of element
   <var title="">A</var>.</p></li>
  </ol>
  <!-- XXX currently quirks mode is different -->

  <p>The <dfn id="elementlayout-offsetheight"><code>offsetHeight</code></dfn>
  attribute, when called on element <var title="">A</var>,
  <em class="ct">must</em> return value that is the result of the following
  algorithm:</p>
  
  <ol>
   <li><p>If element <var title="">A</var> does not have an associated CSS
   layout box return zero and stop this algorithm.</p></li>

   <li><p>If element <var title="">A</var> is the <code>body</code> or root
   element return the height of the initial containing block in CSS pixels and
   stop this algorithm. [HTML5]</p></li>

   <li><p>Return the number of CSS pixels of the border box height of element
   <var title="">A</var>.</p>
  </ol>
  <!-- XXX currently quirks mode is different -->



  <h4>The <code>scroll<var>*</var></code> attributes</h4>
  
  <p>The <dfn id="elementlayout-scrolltop"><code>scrollTop</code></dfn>
  attribute, when called on element <var title="">A</var>,
  <em class="ct">must</em> return the value that is the result of running the
  following algorithm:</p>
  
  <ol>
   <li><p>If element <var title="">A</var> does not have an associated CSS
   layout box return zero and stop this algorithm.</p></li>
   
   <li><p class="issue">...</p></li>
  </ol>
  
  <p>When setting the <code>scrollTop</code> attribute to <var title="">y</var>
  on element <var title="">A</var> user agents <em class="ct">must</em> run the
  following algorithm:</p>

  <ol>
   <li><p>If element <var title="">A</var> does not have vertical overflow stop
   this algorithm.</p></li>

   <li><p>If <var title="">y</var> is negative act as if it was zero.</p></li>
   
   <li><p class="issue">...</p></li>
  </ol>
  <!-- XXX need to figure out right terminology -->

  <p>The <dfn id="elementlayout-scrollleft"><code>scrollLeft</code></dfn>
  attribute, when called on element <var title="">A</var>,
  <em class="ct">must</em> return the value that is the result of running the
  following algorithm:</p>

  <ol>
   <li><p>If element <var title="">A</var> does not have an associated CSS
   layout box return zero and stop this algorithm.</p></li>

   <li><p class="issue">...</p></li>
  </ol>
  
  <p>When setting the <code>scrollLeft</code> attribute to <var title="">x</var>
  on element <var title="">A</var> user agents <em class="ct">must</em> run the
  following algorithm:</p>
  
  <ol>
   <li><p>If element <var title="">A</var> does not have horizontal overflow
   stop this algorithm.</p></li>

   <li><p>If <var title="">y</var> is negative act as if it was zero.</p></li>
   
   <li><p class="issue">...</p></li>
  </ol>
  <!-- XXX need to figure out right terminology -->

  <!--
  <p>The <dfn id="elementlayout-scrollWidth"><code>scrollWidth</code></dfn>
  -->
  
  <p class="issue">It seems scrollWidth and scrollHeight are defined by the
  boxes they contain plus any the surrounding padding area. How about principle
  box width/height + padding edge width. For inline boxes they are identical to
  offsetWidth/offsetHeight it seems.</p>


  <h4>The <code>client<var>*</var></code> attributes</h4>

  <p>The <dfn id="elementlayout-clienttop"><code>clientTop</code></dfn>
  attribute, when called on element <var title="">A</var>,
  <em class="ct">must</em> return the result of the following algorithm:</p>

  <ol>
   <li><p>If element <var title="">A</var> does not have an associated CSS
   layout box or if it is an inline box return zero and stop this
   algorithm.</p></li>

   <li><p>Return the computed value of the <code>border-top-width</code>
   property in CSS pixels plus the width of any scrollbar rendered between the
   top padding box and top border box in CSS pixels as number of CSS
   pixels.</p></li>
  </ol>

  <p>The <dfn id="elementlayout-clientleft"><code>clientLeft</code></dfn>
  attribute, when called on element <var title="">A</var>,
  <em class="ct">must</em> return the result of the following algorithm:</p>

  <ol>
   <li><p>If element <var title="">A</var> does not have an associated CSS
   layout box or if it is an inline box return zero and stop this
   algorithm.</p></li>

   <li><p>Return the computed value of the <code>border-left-width</code>
   property in CSS pixels plus the width of any scrollbar rendered between the
   left padding box and left border box in CSS pixels as number of CSS
   pixels.</p></li>
  </ol>

  <p>The <dfn id="elementlayout-clientwidth"><code>clientWidth</code></dfn>
  attribute, when called on element <var title="">A</var>,
  <em class="ct">must</em> return the result of the following algorithm:</p>

  <ol>
   <li><p>If element <var title="">A</var> does not have an associated CSS
   layout box or if it is an inline box return zero and stop this
   algorithm.</p></li>

   <li><p>If element <var title="">A</var> is the <code>body</code> or root
   element return the width of the initial containing block in CSS pixels as
   number of CSS pixels and stop this algorithm.</p></li>

   <li><p>Return the width of the padding box (excluding the width of any
   rendered scrollbar between the padding and border box) in CSS pixels as
   number of CSS pixels.</p></li>
  </ol>

  <p>The <dfn id="elementlayout-clientheight"><code>clientHeight</code></dfn>
  attribute, when called on element <var title="">A</var>,
  <em class="ct">must</em> return the result of the following algorithm:</p>
  
  <ol>
   <li><p>If element <var title="">A</var> does not have an associated CSS
   layout box or if it is an inline box return zero and stop this
   algorithm.</p></li>

   <li><p>If element <var title="">A</var> is the <code>body</code> or root
   element return the height of the initial containing block in CSS pixels as
   number of CSS pixels and stop this algorithm.</p></li>
   
   <li><p>Return the height of the padding box (excluding the width of any
   rendered scrollbar between the padding and border box) in CSS pixels as
   number of CSS pixels.</p></li>
  </ol>

  <!--
   In strict mode clientWidth and clientHeight of the root element are the
   initial containing block width and height.

   In quirks mode clientWidth and clientHeight of the BODY element are the
   initial containing block width and height. clientWidth and clientHeight of
   the root element are the initial containing block width and root element
   padding height??
  -->

<!--
  <h3>The <code>EventLayout</code> Interface</h3>

  <pre class="idl">interface <dfn>EventLayout</dfn> {
  readonly attribute float            ...;
};</pre>
-->

  <h2 id="canon" >Canonicalization</h4>

  <p class="issue">This section will be integrated with the Cascading Style
  Sheets APIs section in due course.</p>

  <p>This section defines canonicalization of the various objects you typically
  encounter in <span>CSS style sheets</span>.</p>

  <p>The definitions from this section are used later to define attribute
  values, et cetera.</p>

  <h3>Selectors</h3>

  <p>The <dfn id="canon-selectors">canonicalization of a group of
   selectors</dfn> can be determined as follows:</p>

  <ol>
   <li><span title="canon-selector">Normalize the individual
   selectors</span>.</li>

   <li>Separate those selectors by a literal U+002C COMMA and U+0020
   SPACE.</li>
  </ol>

  <p>The <dfn title="canon-selector">canonicalization of a selector</dfn> can be
  determined as follows:</p>

  <ol>
   <li>Take the literal input.</li>
   <li>Replace one or more consecutive <span>whitespace</span> characters with
    a U+0020 SPACE.</li>
   <li>Remove leading and trailing <span>whitespace</span>.</li>
   <li>Make sure combinators other than the descendant combinator are
    preceded and followed by a U+0020 SPACE. (So only insert it when it's not
    there already.)</li>
   <li>Pseudo-classes and pseudo-elements are to be converted to their
    canonical form. <code>:HOver</code> becomes <code>:hover</code> and
    <code>:befoRe</code> becomes <code>::before</code> for example.</li>
  </ol>

  <p class="issue">Hmm, what about psuedo-classes taking arguments? Attribute
   selectors? Namespace prefixes?</p>

  <h3>Media queries</h3>

  <p>The <dfn id="canon-media" title="canon-media">canonicalization of a media
   query</dfn> can be determined as follows:</p>

  <ol>
   <li>Convert each part of the media query to the case specified in the
    syntax. For example, <code>MaX-width</code> becomes
    <code>max-width</code>.</li>
   <li>Replace one or more consecutive <span>whitespace</span> characters with a
    U+0020 SPACE.</li>
   <li>Remove leading and trailing <span>whitespace</span>.
   <li>Remove <span>whitespace</span> between the media feature and the U+003A
    COLON.</li>
   <li>Remove <span>whitespace</span> between the media feature and the U+0028
    LEFT PARENTHESIS.</li>
   <li>Remove <span>whitespace</span> between the media feature value and the
    U+0029 RIGHT PARENTHESIS.</li>
   <li>Make sure there's exactly one U+0020 SPACE after the U+003A COLON which
    is then followed by its value.</li>
   <li>Sort the media features alphabetically ([a-z]).</li>
  </ol>

  <p class="issue">Did I miss anything?</p>

  <p class="issue">duplicate features?</p>

  <h4>Examples</h4>

  <div class="example">
   <p>The canonical form of the following query:</p>
   <pre>not screen and (min-width:5px) and   (max-width:40px  ) </pre>
   <p>would be:</p>
   <pre>not screen and (max-width: 40px) and (min-width: 5px)</pre>
  </div>

  <h3>CSS Values</h3>

  <!-- XXX review this section on RFC2119 criteria -->
  <p>The <dfn id="canon-cssvalue">canonicalization of a CSS value</dfn> can be
   determined as follows:</p>

  <ol>
   <li>
    <p>Relative lengths (<code>em</code>, <code>ex</code>, <code>px</code>, all
     the font-size keywords and <code>%</code>) do not have their units changed.
     However, absolute lengths must be given in millimeters. For example, the
     canonical version of <code>+012.0pt</code> is <code>4.2333mm</code> (give
     or take a few significant figures).</p>
    <p class="note"><em>Computed</em> values may well be in different units than
     the specified value. UAs <em class="ct">should</em> use <code>px</code> or
     <code>mm</code> as their final units for computed length values.</p>
   </li>
   <li>When a <code>&lt;length></code> of zero is given, then any
    specified units <em class="ct">must</em> be removed.</li>
   <li>
    <p>A <code>&lt;color></code> value is canonicalized as follows:</p>

    <dl>

     <dt>It's a system color</dt>

     <dd>See below (you use the representation given in the specification that
     defines the keyword).</dd>

     <dt>Alpha component is equal to 1.0</dt>

     <dd>The color is an uppercase six-digit hexadecimal value, prefixed with a
      <code>#</code> character (U+0023 NUMBER SIGN), with the first two digits
      representing the red component, the next two digits representing the green
      component, and the last two digits representing the blue component, the
      digits being in the range 0-9 A-F (U+0030 to U+0039 and U+0041 to
      U+0046).</dd>

     <dt>Alpha component is less than 1.0</dt>

     <dd>The color is in the CSS <code>rgba()</code> functional-notation format:
      the literal string <code>rgba</code> (U+0072 U+0067 U+0062 U+0061)
      followed by a U+0028 LEFT PARENTHESIS, a <span>color component
      integer</span> representing the red component, a <span>color component
      separator</span>, a <span>color component integer</span> for the green
      component, a <span>color component separator</span>, a <span>color
      component integer</span> for the blue component, another <span>color
      component separator</span> a U+0030 DIGIT ZERO, a U+002E FULL STOP
      (representing the decimal point), one or more digits in the range 0-9
      (U+0030 to U+0039) representing the fractional part of the alpha value,
      and finally a U+0029 RIGHT PARENTHESIS.</dd>

     <dt>The keyword <code>transparent</code> is used</dt>

     <dd>The color is <code>rgba(0, 0, 0, 0)</code>.</dd>
    </dl>
   </li>
   <li>Angles are canonicalized to <code>deg</code> and normalized to the range
    of their property. For example, <code>azimuth: 700grad</code> would be
    canonicalized to <code>azimuth: 270deg</code>. This also applies to angle
    keywords as used in the <code>elevation</code> and <code>azimuth</code>
    properties, they are canonicalized to their value in degrees.</li>
   <li>Times are canonicalized to seconds (<code>s</code>).</li>
   <li>Frequencies are canonicalized to Hertz (<code>Hz</code>).</li>
   <li>For all integers and real numbers, including those with units, these
    canonicalization steps <em class="ct">must</em> be followed: If the number
    is <code>0</code>, the canonical result is the literal string <code>0</code>
    plus any units (for lengths, the unit identifier will have been removed
    before this step). Otherwise, leading <!--and trailing -->zeros
    <em class="ct">must</em> be omitted, any leading <code>+</code>
    <em class="ct">must</em> be omitted, the decimal point in a real number
    <em class="ct">must</em> be omitted unless there is a fractional part, and
    if the number is in the range <code>-1 &lt; <var>x</var> &lt; 1</code>, then
    one leading <code>0</code> <em class="ct">must</em> be inserted before the
    decimal point. The number of given significant figures is completely UA
    dependent.</li>
   <li>Where multiple values may appear in any order without changing the
    meaning of the value (typically represented by a double bar <code>||</code>
    in the value syntax), UAs are to use the canonical order as given in the
    syntax (e.g. <code>&lt;border-width> &lt;border-style> &lt;color></code> for
    the <code>border</code> short-hand property).</li>
   <li>When repeated values may be omitted without changing the meaning of the
    value (e.g. as in the <code>margin</code> and <code>padding</code>
    properties), then the fewest number of values should be given.</li>
   <li>If whitespace may be removed without changing the meaning of the value it
    is to be removed.</li>
   <li><code>&lt;specific-voice></code> and <code>&lt;family-name</code> values
    are to be quoted.</li>
   <li>Double quotes (rather than single quotes) <em class="ct">shall</em> be
    used for string quotation. (When changing from single quotes to double
    quotes, double quotes already in the string are escaped.)</li>
   <li>The quotes in the <code>&lt;uri></code> form should be removed.
    (Parenthesises that were in the string, along with any other characters not
    legal when the string is not quoted (such as commas), must be escaped.)</li>
   <li>Unnecessary escapes should be removed. (For example, <code>\z</code>
    should be represented as <code>z</code>. This extends to unescaping UNICODE
    escapes, except, of course, if the encoding cannot contain those
    characters!)</li>
   <li>Where components of the value may be dropped without changing the meaning
    of the value (for example, initial values in shorthand properties), then
    they should be removed. If this would remove all the values, then the first
    allowed value must be given (For example, for <code>background</code> that
    would be <code>rgba(0, 0, 0, 0)</code> since <code>background-color</code>
    is the first component of the value; for <code>border</code> it would be
    <code>0</code> since the first component of that value is
    <code>border-width</code>).</li>
   <li>
    <p>A single space should be added after each comma that is not part of a
     string, except where that would change the meaning of the value. For
     example:</p>
    <pre>foo,bar,baz</pre>
    <p>should become:</p>
    <pre>foo, bar, baz</pre>
   </li>
   <li>
    <p>Whenever case is insensitive, for example in property or counter names,
     the text should be changed to the canonical case as given in the syntax
     definition. For example, the canonical value of:</p>
    <pre>COUNTER( PAR-NUM,UPPER-ROMAN ) DISC</pre>
    <p>is:</p>
    <pre>counter(par-num, upper-roman) disc</pre>
    <p>but the color <code>WINDOWTEXT</code> becomes
     <code>WindowText</code>.</li>
  </ol>

  <h4>Examples</h4>

  <p>The steps above should guarantee that there is no data loss, from a CSS
   point of view<!--, other than for color values on systems with colors stored
   with more than 32 bits-->. Here are some examples of before and after results
   on specified values. The before column could be what the author wrote in a
   stylesheet, while the after column shows what querying the DOM would
   return.</p>

  <div class="example">
   <table>
    <thead>
     <tr><th>Before<th>After
    <tbody>
     <tr><td><code>background: none</code><td><code>background: rgba(0, 0, 0, 0)</code>
     <tr><td><code>outline: none</code><td><code>outline: invert</code>
     <tr><td><code>border: none</code><td><code>border: medium</code>
     <tr><td><code>list-style: none</code><td><code>list-style: disc</code>
     <tr><td><code>margin: 0px 1px 1px 1px</code><td><code>margin: 0 1px 1px</code>
     <tr><td><code>azimuth: behind left</code><td><code>azimuth: 220deg</code>
     <tr><td><code>font-family: a, 'b"', serif</code><td><code>font-family: "a", "b\"", serif</code>
     <tr><td><code>content: url('h)i') '\[\]'</code><td><code>content: url(h\)i) "[]"</code>
     <tr><td><code>azimuth: leftwards</code><td><code>azimuth: leftwards</code>
     <tr><td><code>color: rgb(18, 52, 86)</code><td><code>color: #123456</code>
     <tr><td><code>color: rgba(000001, 0, 0, 1)</code><td><code>color: #000000</code>
   </table>
  </div>

  <h2 class="no-num" id="references">References</h2>

  <p class="issue">Once this specification reaches a more stable state this
  section will be filled up.</p>

  <h2 class="no-num" id="acknowledgements">Acknowledgements</h2>

  <p>The editor would like to thank to the following people who have
  contributed to this specification (ordered by first name):</p>

  <ul>
   <li>Alexey Feldgendler</li>

   <li>Bjrn Hhrmann</li>

   <li>David Baron</li>

   <li>Hallvord R. M. Steen</li>

   <li>Ian Hickson</li>

   <li>Lachlan Hunt</li>

   <li>Morten Stenshorne</li>

   <li>Robert O'Callahan</li>

   <li>Sjoerd Visscher</li>

   <li>Simon Pieters</li>

   <li>Tarquin Wilton-Jones</li>
  </ul>

  <!-- Additional thanks to Ian Hickson for writing the initial version of the
  alternative style sheets API, canonicalization rules and proposals for
  "author-friendly" interfaces. -->
  <p>Also many thanks to the Windows Internet Explorer team for first shipping
  many of the features introduced on <code>ElementLayout</code> and
  <code>WindowLayout</code>.</p>
 </body>
</html>
