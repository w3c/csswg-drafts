<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html lang=en>
 <head><meta content="text/html;utf-8" http-equiv=Content-Type>

  <title>CSS Text Layout Module Level 3</title>
  <link href="../default.css" rel=stylesheet type="text/css">
  <link href="http://www.w3.org/StyleSheets/tr/W3C-ED.css" rel=stylesheet
  type="text/css">

  <style type="text/css">
    .data, .proptable {
      margin: 1em auto;
      border-collapse: collapse;
      border: solid #005A9B;
    }
    .data caption {
      width: 100%;
      text-align: center;
    }
    .data td, .data th,
    .proptable td, .proptable th {
      border: thin solid;
      padding: 0.2em;
      text-align: center;
    }
    .data thead th[scope="row"],
    .proptable thead th[scope="row"] {
      text-align: right;
      background: #A4C8E2;
      color: inherit;
    }
    .data thead,
    .proptable thead {
      background: #EEEEEE;
      color: inherit;
    }
    .data tbody th:first-child,
    .proptable tbody th:first-child {
      text-align: right;
      background: #EEEEEE;
      color: inherit;
    }
    .data thead,
    .data tbody,
    .data tfoot,
    .data colgroup {
      border: solid;
    }

    table.propdef {
      table-layout: auto;
    }
    .propdef th {
      font-style: italic;
      font-weight: normal;
      text-align: left;
      width: 3em;
    }
    dt dfn code {
      font-size: inherit;
    }
    .egbidiwsaA,.egbidiwsbB,.egbidiwsaB,.egbidiwsbC
      { white-space:pre;font-size:80%;font-family:monospace; vertical-align:2px; margin:1px }
    .egbidiwsaA { background:lime;padding:2px; }
    .egbidiwsbB { border:2px solid blue }
    .egbidiwsaB { background:yellow;border:2px dotted white }
    .egbidiwsbC { border:2px dotted red }
  </style>

 <body>
  <div class=head> <!--begin-logo-->
   <p><a href="http://www.w3.org/"><img alt=W3C height=48
    src="http://www.w3.org/Icons/w3c_home" width=72></a> <!--end-logo-->

   <h1 id=css-text>CSS Text Layout Module Level 3</h1>

   <h2 class="no-num no-toc" id=longstatus>Editor's Draft 8 October 2008</h2>

   <dl>
    <dt>This version:

    <dd><a
     href="http://dev.w3.org/csswg/css3-text-layout/">http://dev.w3.org/csswg/css3-text-layout/</a>
     

    <dt>Latest version:

    <dd><a
     href="http://www.w3.org/TR/css3-text-layout/">http://www.w3.org/TR/css3-text-layout/</a>

    <dt>Previous version:

    <dd><a
     href="http://www.w3.org/tr/2003/CR-css3-text-20030514/">http://www.w3.org/tr/2003/CR-css3-text-20030514/</a>

    <dt>Editors:

    <dd><a href="mailto:paulnel@microsoft.com">Paul Nelson</a> (<a
     href="http://www.microsoft.com/">Microsoft</a>)

    <dd><a href="http://fantasai.inkedblade.net/contact">Elika J. Etemad</a>

    <dt>Previous Editor:

    <dd><a href="mailto:michelsu@microsoft.com">Michel Suignard</a> (<a
     href="http://www.microsoft.com/">Microsoft</a>)
   </dl>
   <!--begin-copyright-->
   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright"
    rel=license>Copyright</a> &copy; 2008 <a
    href="http://www.w3.org/"><acronym title="World Wide Web
    Consortium">W3C</acronym></a><sup>&reg;</sup> (<a
    href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute
    of Technology">MIT</acronym></a>, <a
    href="http://www.ercim.org/"><acronym title="European Research Consortium
    for Informatics and Mathematics">ERCIM</acronym></a>, <a
    href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
   <!--end-copyright-->
   <hr title="Separator for header">
  </div>

  <h2 class="no-num no-toc" id=abstract>Abstract</h2>

  <p>This module specifies the text layout model in CSS and the properties
   that control it. It covers bidirectionality, vertical text, grid layout,
   and other special inline text layout effects.

  <h2 class="no-num no-toc" id=status>Status of this document</h2>
  <!--begin-status-->

  <p>This is a public copy of the editors' draft. It is provided for
   discussion only and may change at any moment. Its publication here does
   not imply endorsement of its contents by W3C. Don't cite this document
   other than as work in progress.

  <p>The (<a
   href="http://lists.w3.org/Archives/Public/www-style/">archived</a>) public
   mailing list <a href="mailto:www-style@w3.org">www-style@w3.org</a> (see
   <a href="http://www.w3.org/Mail/Request">instructions</a>) is preferred
   for discussion of this specification. When sending e-mail, please put the
   text &#8220;css3-text&#8221; in the subject, preferably like this:
   &#8220;[<!---->css3-text<!---->] <em>&hellip;summary of
   comment&hellip;</em>&#8221;

  <p>This document was produced by the <a href="/Style/CSS/members">CSS
   Working Group</a> (part of the <a href="/Style/">Style Activity</a>).

  <p>This document was produced by a group operating under the <a
   href="/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent
   Policy</a>. W3C maintains a <a href="/2004/01/pp-impl/32061/status"
   rel=disclosure>public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also includes
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a
   href="/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a
   href="/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the
   W3C Patent Policy</a>.</p>
  <!--end-status-->

  <h2 class="no-num no-toc" id=Contents>Contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#intro"><span class=secno>1. </span>Text layout
    introduction</a>

   <li><a href="#text-flow"><span class=secno>2. </span>Text flow</a>
    <ul class=toc>
     <li><a href="#text-direction"><span class=secno>2.1
      </span>Bidirectionality</a>

     <li><a href="#direction"><span class=secno>2.2 </span>Specifying
      Directionality: the &lsquo;<code class=property>direction</code>&rsquo;
      property</a>

     <li><a href="#unicode-bidi"><span class=secno>2.3 </span>Embeddings and
      Overrides: the &lsquo;<code class=property>uncode-bidi</code>&rsquo;
      property</a>

     <li><a href="#bidi-example"><span class=secno>2.4 </span>Example of
      Bidirectional Text</a>

     <li><a href="#block-progression"><span class=secno>2.5 </span>Block
      progression direction: the &lsquo;<code
      class=property>block-flow</code>&rsquo; property</a>

     <li><a href="#details"><span class=secno>2.6 </span>Details</a>

     <li><a href="#example"><span class=secno>2.7 </span>Example</a>

     <li><a href="#writing-mode"><span class=secno>2.8 </span>Text flow short
      cut: the &lsquo;<code class=property>writing-mode</code>&rsquo;
      property</a>

     <li><a href="#writing-mode-mixed"><span class=secno>2.9 </span> Mixing
      the &lsquo;<code class=property>writing-mode</code>&rsquo; in normal
      usage</a>
    </ul>

   <li><a href="#document-grid"><span class=secno>3. </span>Document grid</a>
    
    <ul class=toc>
     <li><a href="#grid-introduction"><span class=secno>3.1 </span>Document
      grid introduction</a>

     <li><a href="#line-grid-mode"><span class=secno>3.2 </span>Line grid
      mode: the &lsquo;<code class=property>line-grid-mode</code>&rsquo;
      property</a>

     <li><a href="#line-grid-progression"><span class=secno>3.3 </span>Line
      grid progression: the &lsquo;<code
      class=property>line-grid-progression</code>&rsquo; property</a>

     <li><a href="#line-grid"><span class=secno>3.4 </span>Line grid: the
      &lsquo;<code class=property>line-grid</code>&rsquo; shorthand
      property</a>
    </ul>
  </ul>
  <!--end-toc-->

  <h2 id=intro><span class=secno>1. </span>Text layout introduction</h2>

  <p>This section describes the text layout features supported by CSS, which
   includes support for various international writing directions, such as
   left-to-right (e.g., Latin scripts), right-to-left (e.g., Hebrew or
   Arabic), bidirectional (e.g., mixing Latin with Arabic) and vertical
   (e.g., Asian scripts). In addition, this section defines a set of
   properties that provide for a document grid layout system that is commonly
   used with East Asian text layout.

  <h2 id=text-flow><span class=secno>2. </span>Text flow</h2>

  <p>Text flow is defined in terms of inline progression and block
   progression. Inline progression is the way elements flow on the line and
   defines on which end of the line the "start" and "end" are located. The
   <span class=property> <a href="#direction">&lsquo;<code
   class=property>direction</code>&rsquo;</a></span> and <span
   class=property> <a href="#unicode-bidi">&lsquo;<code
   class=property>unicode-bidi</code>&rsquo;</a></span> properties determine
   the inline-progression and bidirectional layout. The <span class=property>
   <a href="#block-progression">&lsquo;<code
   class=property>block-progression</code>&rsquo;</a></span> property
   determines the line progression, or way lines stack, in a block. The <span
   class=property><a href="#writing-mode">&lsquo;<code
   class=property>writing-mode</code>&rsquo;</a></span> shorthand combines
   inline and block progression together.

  <p>Some examples of text flow are:

  <ul>
   <li>Latin scripts are typically written using a left to right inline
    progression with a top to bottom block progression.

   <li>Mongolian script languages are typically written using a top to bottom
    inline progression with a left to right block progression.

   <li>Japanese is commonly written using both a left to right inline
    progression with a top to bottom block progression, <strong>and</strong>
    a top to bottom inline progression with a right to left block
    progression. Many magazines and newspapers will mix these two text flows
    on the same page.
  </ul>

  <h3 id=text-direction><span class=secno>2.1 </span>Bidirectionality</h3>

  <p><a href="conform.html#conformance">Conforming</a> user agents that do
   not support bidirectional text may ignore the <span
   class=propinst-direction>&lsquo;<code class=property><a
   href="#direction0">direction</a></code>&rsquo;</span> and <span
   class=propinst-unicode-bidi>&lsquo;<code class=property><a
   href="#unicode-bidi0">unicode-bidi</a></code>&rsquo;</span> properties
   described in this section. This exception includes UAs that render
   right-to-left characters simply because a font on the system contains them
   but do not support the concept of right-to-left text direction.

  <p>The characters in certain scripts are written from right to left. In
   some documents, in particular those written with the Arabic or Hebrew
   script, and in some mixed-language contexts, text in a single (visually
   displayed) block may appear with mixed directionality. This phenomenon is
   called <span class=index-def id=bidirectionality title="bidirectionality
   (bidi)"><dfn id=bidirectionality0>bidirectionality</dfn></span>, or "bidi"
   for short.

  <p>The Unicode standard (<a
   href="http://www.unicode.org/reports/tr9/">Unicode Standard Annex #9</a>)
   defines a complex algorithm for determining the proper directionality of
   text. The algorithm consists of an implicit part based on character
   properties, as well as explicit controls for embeddings and overrides. CSS
   relies on this algorithm to achieve proper bidirectional rendering. The
   <span class=propinst-direction>&lsquo;<code class=property><a
   href="#direction0">direction</a></code>&rsquo;</span> and <span
   class=propinst-unicode-bidi>&lsquo;<code class=property><a
   href="#unicode-bidi0">unicode-bidi</a></code>&rsquo;</span> properties
   allow authors to specify how the elements and attributes of a document
   language map to this algorithm.

  <p>User agents that support bidirectional text must apply the Unicode
   bidirectional algorithm to every sequence of inline boxes uninterrupted by
   a forced line break or block boundary. This sequence forms the "paragraph"
   unit in the bidirectional algorithm. The paragraph embedding level is set
   according to the value of the <span class=propinst-direction>&lsquo;<code
   class=property><a href="#direction0">direction</a></code>&rsquo;</span>
   property of the containing block rather than by the heuristic given in
   steps P2 and P3 of the Unicode algorithm.

  <p>Because the directionality of a text depends on the structure and
   semantics of the document language, these properties should in most cases
   be used only by designers of document type descriptions (Dtds), or authors
   of special documents. If a default style sheet specifies these properties,
   authors and users should not specify rules to override them.

  <p>The HTML 4 specification ([HTML4], section 8.2) defines bidirectionality
   behavior for HTML elements. The style sheet rules that would achieve the
   bidi behaviors specified in [[HTML4]] are given below. The HTML 4
   specification also contains more information on bidirectionality issues.

  <pre>
*[dir="ltr"]    { direction: ltr; unicode-bidi: embed; }
*[dir="rtl"]    { direction: rtl; unicode-bidi: embed; }

bdo[dir="ltr"]  { direction: ltr; unicode-bidi: bidi-override; }
bdo[dir="rtl"]  { direction: rtl; unicode-bidi: bidi-override; }
  </pre>

  <p class=note>Because HTML UAs can turn off CSS styling, we advise HTML
   authors to use the HTML &lsquo;<code class=property>dir</code>&rsquo;
   property and &lt;bdo&gt; element to ensure correct bidirectional layout in
   the absence of a style sheet.

  <h3 id=direction><span class=secno>2.2 </span>Specifying Directionality:
   the &lsquo;<code class=property><a
   href="#direction0">direction</a></code>&rsquo; property</h3>

  <table class=propdef id=namedirection>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=direction0>direction</dfn>

    <tr>
     <th>Value:

     <td>ltr | rtl

    <tr>
     <th>Initial:

     <td>ltr

    <tr>
     <th>Applies to:

     <td>all elements

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed&#160;value:

     <td>specified value
  </table>

  <p>This property specifies the inline progression of text and elements on a
   line, and the direction of embeddings and overrides (see <span
   class=propinst-unicode-bidi>&lsquo;<code class=property><a
   href="#unicode-bidi0">unicode-bidi</a></code>&rsquo;</span>) for the
   Unicode bidirectional algorithm. In addition, it specifies the direction
   of <a
   href="http://www.w3.org/TR/2006/WD-CSS21-20060411/tables.html">table</a>
   column layout, the direction of horizontal <a
   href="http://www.w3.org/TR/2006/WD-CSS21-20060411/visufx.html#overflow">overflow</a>,
   and the position of an incomplete last line in a block in case of
   &lsquo;<code class=css>text-align: justify</code>&rsquo;.

  <p>Values for this property have the following meanings:

  <dl>
   <dt><strong>ltr</strong>

   <dd>Left-to-right direction.

   <dt><strong>rtl</strong>

   <dd> Right-to-left direction.
  </dl>

  <p>For the <span class=propinst-direction>&lsquo;<code class=property><a
   href="#direction0">direction</a></code>&rsquo;</span> property to affect
   reordering in inline-level elements, the <span
   class=propinst-unicode-bidi>&lsquo;<code class=property><a
   href="#unicode-bidi0">unicode-bidi</a></code>&rsquo;</span> property's
   value must be &lsquo;<code class=property>embed</code>&rsquo; or
   &lsquo;<code class=property>override</code>&rsquo;.

  <p class=note>The <span class=propinst-direction>&lsquo;<code
   class=property><a href="#direction0">direction</a></code>&rsquo;</span>
   property, when specified for table column elements, is not inherited by
   cells in the column since columns are not the ancestors of the cells in
   the document tree. Thus, CSS cannot easily capture the "dir" attribute
   inheritance rules described in [[HTML4]], section 11.3.2.1.

  <h3 id=unicode-bidi><span class=secno>2.3 </span>Embeddings and Overrides:
   the &lsquo;<code class=property>uncode-bidi</code>&rsquo; property</h3>

  <table class=propdef id=nameunicode-bidi>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=unicode-bidi0>unicode-bidi</dfn>

    <tr>
     <th>Value:

     <td>normal | embed | bidi-override

    <tr>
     <th>Initial:

     <td>normal

    <tr>
     <th>Applies to:

     <td>all elements, but see prose

    <tr>
     <th>Inherited:

     <td>no

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed&#160;value:

     <td>specified value
  </table>

  <p>Values for this property have the following meanings:

  <dl>
   <dt><strong>normal</strong>

   <dd>The element does not open an additional level of embedding with
    respect to the bidirectional algorithm. For inline-level elements,
    implicit reordering works across element boundaries.

   <dt><strong>embed</strong>

   <dd>If the element is inline-level, this value opens an additional level
    of embedding with respect to the bidirectional algorithm. The direction
    of this embedding level is given by the <span
    class=propinst-direction>&lsquo;<code class=property><a
    href="#direction0">direction</a></code>&rsquo;</span> property. Inside
    the element, reordering is done implicitly. This corresponds to adding a
    LRE (U+202A; for &lsquo;<code class=css>direction: ltr</code>&rsquo;) or
    RLE (U+202B; for &lsquo;<code class=css>direction: rtl</code>&rsquo;) at
    the start of the element and a PDF (U+202C) at the end of the element.

   <dt><strong>bidi-override</strong>

   <dd>For inline-level elements this creates an override. For block-level,
    table-cell, table-caption, or inline-block elements this creates an
    override for inline-level descendents not within another block-level,
    table-cell, table-caption, or inline-block element. This means that
    inside the element, reordering is strictly in sequence according to the
    <span class=propinst-direction>&lsquo;<code class=property><a
    href="#direction0">direction</a></code>&rsquo;</span> property; the
    implicit part of the bidirectional algorithm is ignored. This corresponds
    to adding a LRO (U+202D; for &lsquo;<code class=css>direction:
    ltr</code>&rsquo;) or RLO (U+202E; for &lsquo;<code class=css>direction:
    rtl</code>&rsquo;) at the start of the element and a PDF (U+202C) at the
    end of the element.
  </dl>

  <p>The final order of characters in each block-level element is the same as
   if the bidi control codes had been added as described above, markup had
   been stripped, and the resulting character sequence had been passed to an
   implementation of the Unicode bidirectional algorithm for plain text that
   produced the same line-breaks as the styled text. In this process,
   non-textual entities such as images are treated as neutral characters,
   unless their <span class=propinst-unicode-bidi>&lsquo;<code
   class=property><a
   href="#unicode-bidi0">unicode-bidi</a></code>&rsquo;</span> property has a
   value other than &lsquo;<code class=property>normal</code>&rsquo;, in
   which case they are treated as strong characters in the <span
   class=propinst-direction>&lsquo;<code class=property><a
   href="#direction0">direction</a></code>&rsquo;</span> specified for the
   element.

  <p>Please note that in order to be able to flow inline boxes in a uniform
   direction (either entirely left-to-right or entirely right-to-left), more
   inline boxes (including anonymous inline boxes) may have to be created,
   and some inline boxes may have to be split up and reordered before
   flowing.

  <p>Because the Unicode algorithm has a limit of <em title="According to
   unicode 3.0, chapter 3, section 12, definition BD2. Specifically, page 58
   here: http://www.unicode.org/unicode/uni2book/ch03.pdf"> 61 levels</em> of
   embedding, care should be taken not to use <span
   class=propinst-unicode-bidi>&lsquo;<code class=property><a
   href="#unicode-bidi0">unicode-bidi</a></code>&rsquo;</span> with a value
   other than &lsquo;<code class=property>normal</code>&rsquo; unless
   appropriate. In particular, a value of &lsquo;<code
   class=property>inherit</code>&rsquo; should be used with extreme caution.
   However, for elements that are, in general, intended to be displayed as
   blocks, a setting of &lsquo;<code class=css>unicode-bidi:
   embed</code>&rsquo; is preferred to keep the element together in case
   display is changed to inline (see example below).

  <p>The following example shows an XML document with bidirectional text. It
   illustrates an important design principle: <span class=index-inst id=dtd
   title=Dtd>Dtd</span> designers should take bidi into account both in the
   language proper (elements and attributes) and in any accompanying style
   sheets. The style sheets should be designed so that bidi rules are
   separate from other style rules. The bidi rules should not be overridden
   by other style sheets so that the document language's or Dtd's bidi
   behavior is preserved.

  <h3 id=bidi-example><span class=secno>2.4 </span>Example of Bidirectional
   Text</h3>

  <div class=example>
   <p>In this example, lowercase letters stand for inherently left-to-right
    characters and uppercase letters represent inherently right-to-left
    characters. The text stream is shown in logical backing store order.</p>

   <pre class=xml-example><code class=xml>
&lt;HEBREW&gt;
  &lt;PAR&gt;HEBREW1 HEBREW2 english3 HEBREW4 HEBREW5&lt;/PAR&gt;
  &lt;PAR&gt;HEBREW6 &lt;EMPH&gt;HEBREW7&lt;/EMPH&gt; HEBREW8&lt;/PAR&gt;
&lt;/HEBREW&gt;
&lt;ENGLISH&gt;
  &lt;PAR&gt;english9 english10 english11 HEBREW12 HEBREW13&lt;/PAR&gt;
  &lt;PAR&gt;english14 english15 english16&lt;/PAR&gt;
  &lt;PAR&gt;english17 &lt;HE-QUO&gt;HEBREW18 english19 HEBREW20&lt;/HE-QUO&gt;&lt;/PAR&gt;
&lt;/ENGLISH&gt;
    </code></pre>

   <p>Since this is XML, the style sheet is responsible for setting the
    writing direction. This is the style sheet:</p>

   <pre class=example>
/* Rules for bidi */
HEBREW, HE-QUO  {direction: rtl; unicode-bidi: embed;}
ENGLISH         {direction: ltr; unicode-bidi: embed;} 

/* Rules for presentation */
HEBREW, ENGLISH, PAR  {display: block;}
EMPH                  {font-weight: bold;}
    </pre>

   <p>The HEBREW element is a block with a right-to-left base direction, the
    ENGLISH element is a block with a left-to-right base direction. The PARs
    are blocks that inherit the base direction from their parents. Thus, the
    first two PARs are read starting at the top right, the final three are
    read starting at the top left. Please note that HEBREW and ENGLISH are
    chosen as element names for explicitness only; in general, element names
    should convey structure without reference to language.</p>

   <p>The EMPH element is inline-level, and since its value for <span
    class=propinst-unicode-bidi>&lsquo;<code class=property><a
    href="#unicode-bidi0">unicode-bidi</a></code>&rsquo;</span> is
    &lsquo;<code class=property>normal</code>&rsquo; (the initial value), it
    has no effect on the ordering of the text. The HE-QUO element, on the
    other hand, creates an embedding.</p>

   <p>The formatting of this text might look like this if the line length is
    long:</p>

   <pre class=ascii-art>
               5WERBEH 4WERBEH english3 2WERBEH 1WERBEH

                                8WERBEH <b>7WERBEH</b> 6WERBEH

english9 english10 english11 13WERBEH 12WERBEH

english14 english15 english16

english17 20WERBEH english19 18WERBEH
    </pre>

   <p>Note that the HE-QUO embedding causes HEBREW18 to be to the right of
    english19.</p>

   <p>If lines have to be broken, it might be more like this:</p>

   <pre class=ascii-art>
       2WERBEH 1WERBEH
  -EH 4WERBEH english3
                 5WERB

   -EH <b>7WERBEH</b> 6WERBEH
                 8WERB

english9 english10 en-
glish11 12WERBEH
13WERBEH

english14 english15
english16

english17 18WERBEH
20WERBEH english19
    </pre>

   <p>Because HEBREW18 must be read before english19, it is on the line above
    english19. Just breaking the long line from the earlier formatting would
    not have worked. Note also that the first syllable from english19 might
    have fit on the previous line, but hyphenation of left-to-right words in
    a right-to-left context, and vice versa, is usually suppressed to avoid
    having to display a hyphen in the middle of a line.</p>
  </div>
  <!-- example -->

  <h3 id=block-progression><span class=secno>2.5 </span>Block progression
   direction: the &lsquo;<code class=property><a
   href="#block-flow">block-flow</a></code>&rsquo; property</h3>

  <table class=propdef id=nameblock-flow>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=block-flow>block-flow</dfn>

    <tr>
     <th>Value:

     <td>tb | rl | lr

    <tr>
     <th>Initial:

     <td>tb

    <tr>
     <th>Applies to:

     <td><span class=issue>??</span>

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed&#160;value:

     <td>specified value
  </table>

  <p class=issue>Should we change the name to something more understandable?
   "block-flow"? "block-direction"? We need to make sure terminology for
   inline progression and block progression ("layout" vs "flow" vs
   "orientation" vs "direction", "horizontal" vs "vertical") is consistent
   throughout the document as well.)

  <p>This property sets the block-progression value and the layout
   orientation. Possible values:

  <dl>
   <dt>tb

   <dd>Top-to-bottom block flow. The layout orientation is horizontal.

   <dt>rl

   <dd>Right-to-left block flow. The layout orientation is vertical.

   <dt>lr

   <dd>Left-to-right block flow. The layout orientation is vertical.
  </dl>

  <p>An inline-level element that has a different &lsquo;<code
   class=property><a href="#block-flow">block-flow</a></code>&rsquo; from its
   containing block becomes an &lsquo;<code
   class=property>inline-block</code>&rsquo; element <a href="#CSS3-box"
   rel=biblioentry>[CSS3-box]</a>. <span class=issue>switch to CSS2.1</span>

  <h3 id=details><span class=secno>2.6 </span>Details</h3>

  <p>Box layout in vertical orientations is exactly analogous to layout in
   the horizontal orientation.

  <ul>
   <li>Calculations that refer to &lsquo;<code
    class=property>width</code>&rsquo; use &lsquo;<code
    class=property>height</code>&rsquo; instead, and vice versa.

   <li>Calculations that refer to the &lsquo;<code
    class=css>*-left</code>&rsquo; and &lsquo;<code
    class=css>*-right</code>&rsquo; box properties (border, margin, padding,
    outline) use &lsquo;<code class=css>*-top</code>&rsquo; and &lsquo;<code
    class=css>*-bottom</code>&rsquo; instead, and vice versa. In RL layout
    &lsquo;<code class=css>*-right</code>&rsquo; is analogous to TB's
    &lsquo;<code class=css>*-top</code>&rsquo;; in LR layout &lsquo;<code
    class=css>*-left</code>&rsquo; is analogous to TB's &lsquo;<code
    class=css>*-top</code>&rsquo;. The logic for this is clear if you lock an
    arrow representing the TB block flow to a compass of the four directions
    and rotate it to represent RL and LR flow.

   <li>Layout effects that depend on the directionality to choose between
    left and right (e.g. overflow, overconstraint resolution, &lsquo;<code
    class=property>start</code>&rsquo; values for &lsquo;<code
    class=property>text-align</code>&rsquo; and other properties, table
    column ordering) depend instead on the effective physical directionality
    (top-to-bottom or bottom-to-top) to choose between top and bottom.
  </ul>

  <p>When an element has a different &lsquo;<code
   class=property>block-progression</code>&rsquo; from its containing block
   two cases are possible:

  <p><em class=issue>These descriptions need work</em>

  <ul>
   <li>The two block-progressions are perpendicular to each other. (For
    example, &lsquo;<code class=property>tb</code>&rsquo; and &lsquo;<code
    class=property>lr</code>&rsquo;). In such cases, <span class=issue>detail
    calculation of width/height and determination of containing block
    dim</span>

   <li>The two block-progressions are parallel to each other. (For example,
    &lsquo;<code class=property>rl</code>&rsquo; and &lsquo;<code
    class=property>lr</code>&rsquo;).
  </ul>

  <h3 id=example><span class=secno>2.7 </span>Example</h3>

  <div class=example>
   <p>In the following example, two blocks elements (1 and 3) separated by an
    image (2) are presented in various flow orientations.</p>

   <p>Here is a diagram of horizontal layout (<code>block-progression:
    tb</code>):</p>

   <p><img alt="Diagram of horizontal layout: blocks 1, 2, and 3 are stacked
    top-to-bottom" height=300 src=horizontal.png width=219></p>

   <p>Here is a diagram for the right-to-left vertical layout commonly used
    in East Asia (<code>block-progression: rl</code>):</p>

   <p><img alt="Diagram of a right-to-left vertical layout: blocks 1, 2, and
    3 are arranged side by side from right to left" height=191
    src=vertical-rl.png width=297></p>

   <p>And finally, here is a diagram for the left-to-right vertical layout
    used for Uighur and Mongolian (<code>block-progression: lr</code>):</p>

   <p><img alt="Diagram of left-to-right vertical layout: blocks 1, 2, and 3
    are arranged side by side from left to right" height=191
    src=vertical-lr.png width=300></p>
  </div>

  <h3 id=writing-mode><span class=secno>2.8 </span>Text flow short cut: the
   &lsquo;<code class=property><a
   href="#writing-mode">writing-mode</a></code>&rsquo; property</h3>

  <table class=propdef id=name->
   <tbody>
    <tr>
     <td><em>Name:</em>

     <td><dfn id=writing-mode>writing-mode</dfn>

    <tr>
     <td><em>Value:</em>

     <td>lr-tb | rl-tb | tb-rl | bt-rl | tb-lr | bt-lr

    <tr>
     <td><em>Initial:</em>

     <td>not defined for shorthand properties

    <tr>
     <td><em>Applies to:</em>

     <td>all elements and generated content

    <tr>
     <td><em>Inherited:</em>

     <td>yes

    <tr>
     <td><em>Percentages:</em>

     <td>N/A

    <tr>
     <td><em>Media:</em>

     <td>visual

    <tr>
     <td><em>Computed value:</em>

     <td>see individual properties
  </table>

  <p>The <span class=property><a href="#writing-mode">&lsquo;<code
   class=property>writing-mode</code>&rsquo;</a></span> property is a
   shorthand property for the <span class=property><a
   href="#direction">&lsquo;<code
   class=property>direction</code>&rsquo;</a></span> property and the <span
   class=property> <a href="#block-progression">&lsquo;<code
   class=property>block-progression</code>&rsquo;</a></span> property.
   Although strictly speaking, the property has no initial value, it is
   equivalent to &lsquo;<code class=property>lr-tb</code>&rsquo;. The
   definition of the property values are established by the following table,
   which shows the setting of the constituent properties and example of
   common usage.

  <div class=figure>
   <table border=1 cellpadding=0 cellspacing=0 style="border-collapse:
    collapse" width="100%">
    <tbody>
     <tr>
      <th>writing-mode:

      <th>direction:

      <th>block-progression:

      <th>Common Usage:

     <tr>
      <td>lr-tb

      <td>ltr

      <td>tb

      <td>Latin-based, Greek, Cyrillic writing systems (and many others)

     <tr>
      <td>rl-tb

      <td>rtl

      <td>tb

      <td>Arabic, Hebrew writing systems

     <tr>
      <td>tb-rl

      <td>ltr

      <td>rl

      <td>East Asian writing systems in vertical mode

     <tr>
      <td>bt-rl

      <td>ltr

      <td>rl

      <td>Arabic script block quote embedded in East Asian vertical text

     <tr>
      <td>tb-lr

      <td>ltr

      <td>lr

      <td>Mongolian script writing system

     <tr>
      <td>bt-lr

      <td>rtl

      <td>lr

      <td>Arabic script block quote embedded in Mongolian script document
   </table>
  </div>

  <h3 id=writing-mode-mixed><span class=secno>2.9 </span> Mixing the
   &lsquo;<code class=property><a
   href="#writing-mode">writing-mode</a></code>&rsquo; in normal usage</h3>

  <p>In East Asian documents, it is often preferred to display certain
   Latin-based strings, such as numerals in a year, always in a horizontal
   layout orientation regardless of the flow orientation of the line of text
   these strings appear in, as in:

  <div class=figure>
   <p><img alt="Diagram of Tate Naka Yoko, showing a group of glyphs
    appearing horizontally in a vertical column of text" class=example
    height=170 src=lf-tny.gif width=90> <img alt="Example of Tate Naka Yoko,
    showing the year 1996 appearing horizontally in a column of vertical
    text" class=example height=132 src=tny.gif width=37>

   <p>Horizontal in vertical ("<span lang=ja>Tate-chu-yoko</span>")
  </div>

  <p>In Japanese, this effect is known as <a href="#tatechuyoko"
   lang=ja>"Tate-chu-yoko"</a>. In order to achieve it in a CSS document, the
   Latin string should be enclosed in an inline element with a horizontal
   layout orientation, as in:

  <pre>.date {block-progression: tb;}
<!--    -->&lt;span class=&quot;date&quot;&gt;1996&lt;/span&gt;</pre>

  <h2 id=document-grid><span class=secno>3. </span>Document grid</h2>

  <h3 id=grid-introduction><span class=secno>3.1 </span>Document grid
   introduction</h3>

  <p>Documents written in East Asian languages, such as Chinese or Japanese,
   are commonly laid out on the page according to a specified one- or
   two-dimensional grid. The concept of grid can also be used with other
   non-ideographic contexts such as Braille script or monospaced layout.

  <p>The diagram below represents a fragment of horizontal text on a page
   with mixed wide-cell and narrow-cell glyphs that a Japanese content author
   intended to be laid out on a grid system that has 9 glyphs per line. Gray
   grid lines are shown for clarity):

  <div class=figure>
   <p><img alt="Example of strict grid layout (genko) applied to mixed
    Japanese and English in horizontal layout." class=example height=89
    src=lg-s-ex.gif width=274> <br>
    '<span lang=ja>Genko</span>' grid applied to mixed text</p>
  </div>

  <p>The grid behavior can be set on the inline-progression, on the
   block-progression or both. The grid on the block-progression dimension is
   determined by the following properties:

  <ul>
   <li>&lsquo;<code class=property>line-stacking-strategy</code>&rsquo; <a
    href="http://www.w3.org/tr/2003/CR-css3-text-20030514/#CSS3-line"
    rel=biblioentry>[CSS3-line]</a> set to the &lsquo;<code
    class=property>grid-height</code>&rsquo; value,

   <li>&lsquo;<code class=property>line-height</code>&rsquo; <a
    href="http://www.w3.org/tr/2003/CR-css3-text-20030514/#CSS3-line"
    rel=biblioentry>[CSS3-line]</a> of the block element set to the desired
    grid block-progression value,

   <li>&lsquo;<code class=property>text-height</code>&rsquo; <a
    href="http://www.w3.org/tr/2003/CR-css3-text-20030514/#CSS3-line"
    rel=biblioentry>[CSS3-line]</a> which defines the block-progression value
    for inline boxes. Depending on the content size, one or a multiple of
    &lsquo;<code class=property>line-height</code>&rsquo; will be necessary
    to accommodate a given inline box.
  </ul>

  <p>The block-progression grid is not described in this section as it can be
   achieved simply by using the properties mentioned above and described in
   the CSS3 Line module.

  <p>The grid on the inline-progression dimension is obtained by altering the
   glyphs advance width (or inline-progression value) of inline elements.
   There are several modes:

  <ul>
   <li>Adding extra space between each grapheme cluster by using the <span
    class=property><a
    href="http://www.w3.org/tr/2003/CR-css3-text-20030514/#letter-spacing">&lsquo;<code
    class=property>letter-spacing</code>&rsquo;</a></span> property. This is
    sometimes called "loose" grid.

   <li>Giving a fixed advance width to ideograph grapheme clusters only.
    Other grapheme clusters are spaced normally. This is called "<span
    lang=ja>genko</span>" in Japanese typography.

   <li>Giving a fixed advance width to all grapheme clusters, excepted
    connected glyphs (like Arabic).
  </ul>

  <p>Two properties control this advance width modification: <span
   class=property><a href="#line-grid-mode">&lsquo;<code
   class=property>line-grid-mode</code>&rsquo;</a></span> enables it and
   <span class=property><a href="#line-grid-progression">&lsquo;<code
   class=property>line-grid-progression</code>&rsquo;</a></span> determines
   its value. The shorthand <span class=property><a
   href="#line-grid">&lsquo;<code
   class=property>line-grid</code>&rsquo;</a></span> allows setting both
   together.

  <h3 id=line-grid-mode><span class=secno>3.2 </span>Line grid mode: the
   &lsquo;<code class=property><a
   href="#line-grid-mode0">line-grid-mode</a></code>&rsquo; property</h3>

  <table class=propdef id=name-0>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=line-grid-mode0>line-grid-mode</dfn>

    <tr>
     <th>Value:

     <td>none | ideograph | all

    <tr>
     <th>Initial:

     <td>none

    <tr>
     <th>Applies to:

     <td>block-level and inline-block elements

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed value:

     <td>specified value
  </table>

  <p>Specifies the line grid behavior. Each line grid mode value entails a
   different set of rules for rendering inline contents (the term
   &lsquo;<code class=property>horizontal</code>&rsquo; is used in the
   following description to indicate the inline-progression dimension).
   Possible values:

  <dl>
   <dt>none

   <dd>
    <p>No line grid. Standard text alignments apply to the block element.</p>

   <dt>ideograph

   <dd>Content is divided into units that we will call strips. Each strip is
    horizontally centered within the smallest number of grid spaces that
    contain the strip. The width of the grid space is determined by the <span
    class=property><a href="#line-grid-progression">&lsquo;<code
    class=property>line-grid-progression</code>&rsquo;</a></span> setting.
    <p>Each grapheme cluster with a wide base character is a strip. Each
     grapheme cluster with a narrow <a
     href="http://www.w3.org/tr/2003/CR-css3-text-20030514/#g-kana"><span
     lang=ja>kana</span></a> character as its base is a strip. Each
     non-breakable object (e.g. an image) is a strip. Other grapheme clusters
     are treated as a single strip bounded by the strips described prior.
     That single strip may be decomposed in several strips if line breaking
     occurs within it.</p>

    <p>The strips are arranged in the grid as follows:

    <p>

    <ul>
     <li>Each strip corresponding to wide base character (as well as narrow
      <a href="http://www.w3.org/tr/2003/CR-css3-text-20030514/#g-kana"><span
      lang=ja>kana</span></a> character) that can fit within a single grid
      space is rendered in the horizontal center of the grid space.

     <li>Each strip corresponding to other characters are placed in the
      center of the smallest number of grid spaces necessary for it to fit.
      If a line break occurs within such a strip, the strip is treated as two
      or more separate strips whose individual placement follows the same
      rules as those for a single strip.

     <li>Strips corresponding to non-breakable objects and strips
      corresponding to wide base character (as well as narrow <a
      href="http://www.w3.org/tr/2003/CR-css3-text-20030514/#g-kana"><span
      lang=ja>kana</span></a> character) that are wider than a single grid
      space, are each centered within the smallest number of grid cells
      necessary for them to fit.
    </ul>

    <div class=figure>
     <p><img alt="Mixed glyph layout in strict grid" class=example height=69
      src=lg-s.gif width=282>

     <p>Mixed glyph layout in strict grid</p>
    </div>

    <div class=figure>
     <p><img alt="Object layout in strict grid. Large rectangular object
      is&#10;centered horizontally within 2 grid spaces" class=example
      height=67 src=lg-s2.gif width=282>

     <p>Object layout in strict grid</p>
    </div>

    <p>The &lsquo;<code class=property>ideograph</code>&rsquo; mode disables
     all special text justification and glyph width adjustment normally
     applied to the contents of the block element.</p>

    <p>If a line break opportunity cannot be found in a text run going over
     the line boundary, then that text run will be pushed down to the next
     line and the last part of the previous line will be left blank.</p>

    <div class=example>
     <p>Here is an example of mixed text in &lsquo;<code
      class=property>ideograph</code>&rsquo; grid mode:

     <div class=figure>
      <p><img alt="Example of strict grid applied to mixed Japanese and
       English&#10;text in horizontal layout" class=example height=89
       src=lg-s-ex.gif width=274>

      <p>Strict grid applied to mixed text</p>
     </div>
    </div>

   <dt>all

   <dd>This type of grid can be used to achieve mono-spaced layout. As with
    &lsquo;<code class=property>ideograph</code>&rsquo;, content is divided
    into strips and each strip is horizontally centered within the smallest
    number of grid spaces that can contain the grid. The rules for
    determining strips differs.
    <p>Each grapheme cluster with a non-joining base character is a strip.
     Each non-breakable object (e.g. an image) is a strip. Each run of
     grapheme clusters with joining base characters that join to each other
     is a strip.</p>

    <div class=figure>
     <p><img alt="Layout in fixed grid mode. All glyphs equally spread out."
      class=example height=68 src=lg-f.gif width=336>

     <p>Mixed glyph layout in fixed grid</p>
    </div>

    <div class=example>
     <p>For example:</p>

     <div class=figure>
      <p><img alt="Example of fixed grid mode in mixed Japanese and English
       text in&#10;horizontal layout" class=example height=89 src=lg-f-ex.gif
       width=274>

      <p>Fixed grid applied to mixed text</p>
     </div>
    </div>
  </dl>

  <p>The <span class=property><a
   href="http://www.w3.org/tr/2003/CR-css3-text-20030514/#letter-spacing">&lsquo;<code
   class=property>letter-spacing</code>&rsquo;</a></span> property does not
   apply to characters in a grid but does apply for all characters not in the
   grid (i.e. all characters for &lsquo;<code class=css>line-grid-mode:
   none</code>&rsquo;, non-ideographs for &lsquo;<code
   class=css>line-grid-mode: ideograph</code>&rsquo; and all non-connected
   glyphs for &lsquo;<code class=css>line-grid-mode: all</code>&rsquo;).

  <h3 id=line-grid-progression><span class=secno>3.3 </span>Line grid
   progression: the &lsquo;<code class=property><a
   href="#line-grid-progression">line-grid-progression</a></code>&rsquo;
   property</h3>

  <table class=propdef id=name-1>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=line-grid-progression>line-grid-progression</dfn>

    <tr>
     <th>Value:

     <td>text-height | line-height | &lt;length&gt;

    <tr>
     <th>Initial:

     <td>text-height

    <tr>
     <th>Applies to:

     <td>block-level and inline-block elements

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed value:

     <td>&lt;length&gt;
  </table>

  <p>This property affects the inline-progression dimension of characters
   which are subject to the fixed advance width as determined by the <span
   class=property><a href="#line-grid-mode">&lsquo;<code
   class=property>line-grid-mode</code>&rsquo;</a></span> property.

  <p>Possible values:

  <dl>
   <dt>text-height

   <dd>The computed value of the block element &lsquo;<code
    class=property>text-height</code>&rsquo; <a
    href="http://www.w3.org/tr/2003/CR-css3-text-20030514/#CSS3-line"
    rel=biblioentry>[CSS3-line]</a> is used.

   <dt>line-height

   <dd>The computed value of the block element &lsquo;<code
    class=property>line-height</code>&rsquo; <a
    href="http://www.w3.org/tr/2003/CR-css3-text-20030514/#CSS3-line"
    rel=biblioentry>[CSS3-line]</a> is used.

   <dt>&lt;length&gt;

   <dd>inline-progression dimension of the line grid's unit space.
  </dl>

  <div class=example>
   <p>For example:</p>

   <pre>div.section1 { line-grid-progression: .5in }</pre>

   <p>The rule set above would make grid spaces 0.5 inches long in a
    <samp>div</samp> element in the section1 class. If the element has
    horizontal flow, it would like the following (without the grid lines,
    which are shown for clarity).</p>

   <div class=figure>
    <p><img alt="Example of a line-grid-char setting applied to mixed
     Japanese&#10;and English text in horizontal layout" class=example
     height=122 src=lgc-exh.gif width=233>

    <p>Enlarged grid applied to mixed text in horizontal layout</p>
   </div>

   <p>If the element has vertical flow, then 0.5in is the vertical measure of
    each grid space:</p>

   <div class=figure>
    <p><img alt="Example of a line-grid-char setting applied to mixed
     Japanese&#10;and English text in vertical-ideographic layout"
     class=example height=233 src=lgc-exvi.gif width=122>

    <p>Enlarged grid applied to mixed text in vertical-ideographic layout</p>
   </div>
  </div>

  <h3 id=line-grid><span class=secno>3.4 </span>Line grid: the &lsquo;<code
   class=property><a href="#line-grid0">line-grid</a></code>&rsquo; shorthand
   property</h3>

  <table class=propdef id=name-2>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=line-grid0>line-grid</dfn>

    <tr>
     <th>Value:

     <td>&lt;<span class=property><a href="#line-grid-mode">&lsquo;<code
      class=property>line-grid-mode</code>&rsquo;</a></span>&gt; || &lt;<span
      class=property><a href="#line-grid-progression">&lsquo;<code
      class=property>line-grid-progression</code>&rsquo;</a></span>&gt;

    <tr>
     <th>Initial:

     <td>see individual properties

    <tr>
     <th>Applies to:

     <td>block-level and inline-block elements

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed value:

     <td>see individual properties
  </table>

  <p>The <span class=property><a href="#line-grid">&lsquo;<code
   class=property>line-grid</code>&rsquo;</a></span> property is a shorthand
   property for setting <span class=property><a
   href="#line-grid-mode">&lsquo;<code
   class=property>line-grid-mode</code>&rsquo;</a></span> and <span
   class=property><a href="#line-grid-progression">&lsquo;<code
   class=property>line-grid-progression</code>&rsquo;</a></span>.

  <div class=example>
   <p>The following is an example of setting the grid in both progressions:</p>

   <pre>div.grid { line-height:20pt;
          text-height: max-size;
          line-stacking-strategy: grid-height;
          line-grid: ideograph line-height; }</pre>

   <p>This sets for the <code>div</code> element a grid with 20pt inline and
    block-progression dimensions. All ideographs will be set in cells sized
    in multiple of 20pt in both directions.</p>
  </div>
