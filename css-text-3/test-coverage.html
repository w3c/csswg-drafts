<!doctype html>
<meta charset=utf-8>
<title>CSS Text 3 test coverage report</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../default.css" rel="stylesheet" type="text/css">

<div class=head>
	<h1 id=title>CSS Text 3 test coverage report</h1>
	<h2 class=subtitle>2020-12-15</h2>
	<dl>
		<dt class="editor">Prepared by:
		<dd class="editor p-author h-card vcard" data-editor-id="43241"><a class="p-name fn u-url url" href="https://florian.rivoal.net">Florian Rivoal</a> (<span class="p-org org">Invited Expert</span>)
	</dl>
	<hr title="Separator for header">
</div>

<div class="p-summary">
	<h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>

	<p>
		This report evaluates the test coverage of the <a href="https://drafts.csswg.org/css-text-3/">CSS Text Module Level 3</a>
		as it was on 2020-12-15
		when the latest commit was <a href="https://github.com/w3c/csswg-drafts/blob/1249132ba62c61b4414e11fefadacc2c962d1567/css-text-3/Overview.bs">1249132ba62c61b4414e11fefadacc2c962d1567</a>.
		It is provided for discussion only and may change at any moment.
		Its publication here does not imply endorsement of its contents by W3C,
		or the CSS-Working Group.
		Don’t cite this document other than as work in progress.

	<p>
		It takes into account tests in:

	<ul>
		<li><a href="https://github.com/web-platform-tests/wpt/tree/master/css/css-text/">wpt/css/css-text/</a> and subdirectories
		<li>All tests in <a href="https://github.com/web-platform-tests/wpt/tree/master/css/CSS2/">wpt/css/CSS2/</a> and subdirectories that relate to this specification.
		<li><a href="https://github.com/web-platform-tests/wpt/tree/master/css/vendor-imports/mozilla/mozilla-central-reftests/text3">wpt/css/vendor-imports/mozilla/mozilla-central-reftests/text3/</a>
	</ul>

</div>

<p>
	The following sections mirror
	the outline of the specification itself,
	and each section links to the corresponding one in he specification.

<div class=issue>Issue:
	<p>Problems other than missing spec coverage are highlighted the same as this paragraph is.
</div>

<hr>

<h2 id=overall>Throughout the spec</h2>

<p>Tests for <a href=https://github.com/w3c/csswg-drafts/issues/5303>distinguishing between applying to inlines and applying to text</a> should be added.

<h2 id="introduction">1 <a href="https://drafts.csswg.org/css-text-3/#intro">Introduction</a></h2>

<p>Tests not needed.

<h3 id="module-interactions">1.1 <a href="https://drafts.csswg.org/css-text-3/#placement">Module Interactions</a></h3>

<p>Tests not needed.

<h3 id="values">1.2 <a href="https://drafts.csswg.org/css-text-3/#values">Values</a></h3>

<p>Tests not really needed.

<p>Possible addition:

<ul>
	<li>Check that the css-wide keywords work on every property.
</ul>

<h3 id="languages-and-typesetting">1.3 <a href="https://drafts.csswg.org/css-text-3/#languages">Languages and Typesetting</a></h3>

<p>Tests not really needed: these are definitions, they get tested through their applications, not standalone.

<h3 id="characters-and-letters">1.4 <a href="https://drafts.csswg.org/css-text-3/#characters">Characters and Letters</a></h3>

<p>For the most part, tests not really needed:
these are definitions, they get tested through their applications, not standalone.
The few testable assertions that are made have coverage.

<p>Possible addition:

<ul>
	<li>turning the content of example 1 into tests (first, check that it’s not already done)
</ul>

<h3 id="text-processing">1.5 <a href="https://drafts.csswg.org/css-text-3/#text-encoding">Text Processing</a></h3>

<p>Adequate coverage.

<p>Exhaustive coverage unrealistic, since this section is effectively a dependency on all of Unicode.
Some tests nonetheless provided for sanity checking
(such as the effect of certain control characters on Arabic shaping).

<h2 id="transforming-text">2 <a href="https://drafts.csswg.org/css-text-3/#transforming">Transforming Text</a></h2>

<p>Test only needed in subsection.

<h3 id="case-transforms-the-text-transform-property">2.1 <a href="https://drafts.csswg.org/css-text-3/#text-transform-property"> Case Transforms: the text-transform property</a></h3>

<p>Overall good coverage. Very good i18n coverage.

<p>Missing:

<ul>
	<li>No test of Animation type.
</ul>

<p>Possible addition:
<ul>
	<li>An automated test for plain text copy&amp;paste not applying transforms. Not clear such an <em>automated</em> test is possible, but it would be nice to have one if it were.
</ul>

<h2 id="white-space-and-wrapping-the-white-space-property">3 <a href="https://drafts.csswg.org/css-text-3/#white-space-property">White Space and Wrapping: the white-space property</a></h2>

<p>Good overall coverage through section 4 (white space processing details) and subsections.

<p>Missing tests:

<ul>
	<li>No test of Animation type.
	<li>intrinsic (min and max) sizing tests for 'normal' and 'no-wrap'
</ul>

<h2 id="white-space-processing-details">4 <a href="https://drafts.csswg.org/css-text-3/#white-space-processing">White Space Processing Details</a></h2>

<p>Partial coverage.

<p>Missing tests:

<ul>
	<li>As required by [UNICODE], unsupported Default_ignorable characters must be ignored for rendering.
</ul>

<h3 id="the-white-space-processing-rules">4.1 <a href="https://drafts.csswg.org/css-text-3/#white-space-rules">The White Space Processing Rules</a></h3>

<p>Sufficient coverage. All parts of this section are well exercised.

<p>Most tests to be found in subsections.

<h4 id="phase-i-collapsing-and-transformation">4.1.1 <a href="https://drafts.csswg.org/css-text-3/#white-space-phase-1">Phase I: Collapsing and Transformation</a></h4>

<p>Sufficient coverage. All parts of this section are well exercised.

<h4 id="phase-ii-trimming-and-positioning">4.1.2 <a href="https://drafts.csswg.org/css-text-3/#white-space-phase-2">Phase II: Trimming and Positioning</a></h4>

<p>Almost sufficient coverage. Most parts of this section are well exercised.

<p>Missing tests:

<ul>
	<li>See [UAX9] for rules on how U+0009 tabulation interacts with bidi.
</ul>

<h4 id="segment-break-transformation-rules">4.1.3 <a href="https://drafts.csswg.org/css-text-3/#line-break-transform">Segment Break Transformation Rules</a></h4>

<p>Partial coverage.

<p>Indirectly tested, no dedicated tests:

<ul>
	<li>When 'white-space' is ''break-spaces'' segment breaks are not collapsible and are instead transformed into a preserved line feed (U+000A).
</ul>

<p>Missing tests:

<ul>
	<li>First, any collapsible <a>segment break</a> immediately following another collapsible <a>segment break</a>
</ul>

<div class=note>
	We have quite a few tentative tests for this section,
	based on an earlier draft.
	We have since then decided to deffer this topic to level 4
</div>

<h3 id="tab-character-size-the-tab-size-property">4.2 <a href="https://drafts.csswg.org/css-text-3/#tab-size-property">Tab Character Size: the tab-size property</a></h3>

<p>Good coverage.

<h2 id="line-breaking-and-word-boundaries">5 <a href="https://drafts.csswg.org/css-text-3/#line-breaking">Line Breaking and Word Boundaries</a></h2>

<p>Tests not really needed: these are definitions, they get tested through their applications, not standalone.

<p>Can be a good section to host tests for i18n requirements not covered in detail by the spec.

<p>Possible Additions:

<ul>
	<li>Basic line breaking tests for any language mentioned (Thai, Lao, Khmer, Javanese, Balinese, Yi…)
</ul>

<h3 id="line-breaking-details">5.1 <a href="https://drafts.csswg.org/css-text-3/#line-break-details">Line Breaking Details</a></h3>

<p>Partial Coverage.

<p>Missing tests:

<ul>
	<li>“Regardless of the white-space value […] the BK, NL […] classes […] must be honored”
	<li>For soft wrap opportunities before the first or after the last character of a box, the break occurs immediately before/after the box (at its margin edge) rather than breaking the box between its content edge and the content.
	<li>Test for <a href="https://github.com/w3c/csswg-drafts/issues/4284">https://github.com/w3c/csswg-drafts/issues/4284</a>
</ul>

<p>Untestable(?):

<ul>
	<li>UAs that allow wrapping at punctuation other than spaces should prioritize breakpoints. […]
</ul>

<h3 id="breaking-rules-for-letters-the-word-break-property">5.2 <a href="https://drafts.csswg.org/css-text-3/#word-break-property">Breaking Rules for Letters: the word-break property</a></h3>

<p>Partial Coverage.

<p>Missing tests:

<ul>
	<li>No test of Animation type.
	<li>affects intrinsic sizing (tested for word-break:break-word)
	<li>treating non-letter typographic character units belonging to the NU, AL, AI, or ID Unicode line breaking classes [UAX14]
	<li>any typographic character units resolving to the any typographic letter units (and any typographic character units resolving to the <code>NU</code> (“numeric”), <code>AL</code> (“alphabetic”), or <code>SA</code> (“Southeast Asian”) line breaking classes
	<li>effect of word-break:keep-all on NU and AI classes
	<li>Symbols that line-break the same way as letters of a particular category are affected the same way as those letters.
	<li>does not suppress <code>&lt;wbr></code>
	<li>Tests for <a href="https://github.com/w3c/csswg-drafts/issues/4765">https://github.com/w3c/csswg-drafts/issues/4765</a>
</ul>

<p>Covered, but could have more:

<ul>
	<li>It does not affect rules governing the soft wrap opportunities created around punctuation
</ul>

<h3 id="line-breaking-strictness-the-line-break-property">5.3 <a href="https://drafts.csswg.org/css-text-3/#line-break-property">Line Breaking Strictness: the line-break property</a></h3>

<p>Extensive CJK coverage.

<p>Missing tests:

<ul>
	<li>applies to inlines
	<li>No test of Animation type.
	<li>affects intrinsic sizing
</ul>

<p>Untestable(?):

<ul>
	<li>behavior of “auto”
</ul>

<h3 id="hyphenation-the-hyphens-property">5.4 <a href="https://drafts.csswg.org/css-text-3/#hyphenation">Hyphenation: the hyphens property</a></h3>

<p>Spotty coverage.

<p>Covered, but insufficiently:
<ul>
	<li>manual value
</ul>

<p>Missing tests:

<ul>
	<li>No test of Animation type.
	<li>Affects intrinsic sizing
	<li>Automatic hyphenation opportunities within a word must be ignored if the word contains a conditional hyphen (&shy; or U+00AD), in favor of the conditional hyphen(s)
	<li>However, if, even after breaking at such opportunities, a portion of that word is still too long to fit on one line, an automatic hyphenation opportunity may be used.
</ul>

<h3 id="overflow-wrapping-the-overflow-wrapword-wrap-property">5.5 <a href="https://drafts.csswg.org/css-text-3/#overflow-wrap-property">Overflow Wrapping: the overflow-wrap/word-wrap property</a></h3>

<p>Partial coverage.

<p>Missing tests:

<ul>
	<li>No test of Animation type.
</ul>

<h3 id="shaping-across-intra-word-breaks">5.6 <a href="https://drafts.csswg.org/css-text-3/#word-break-shaping">Shaping Across Intra-word Breaks</a></h3>

<p>Good Coverage.

<h2 id="alignment-and-justification">6 <a href="https://drafts.csswg.org/css-text-3/#justification">Alignment and Justification</a></h2>

<p>Test only needed in subsection.

<h3 id="text-alignment-the-text-align-shorthand">6.1 <a href="https://drafts.csswg.org/css-text-3/#text-align-property">Text Alignment: the text-align shorthand</a></h3>

<p>Partial Coverage.

<p>Missing tests:

<ul>
	<li>If (after justification, if any) the inline contents of a line box are too long to fit within it, then the contents are start-aligned: any content that doesn’t fit overflows the line box’s end edge.
	<li>If the UA chooses to adjust the text, then it must ensure that tab stops continue to line up
	<li>“Values other than justify-all or match-parent are assigned to text-align-all and reset text-align-last to auto.”, and being a shorthand in general
</ul>

<h3 id="default-text-alignment-the-text-align-all-property">6.2 <a href="https://drafts.csswg.org/css-text-3/#text-align-all-property">Default Text Alignment: the text-align-all property</a></h3>

<p>No Tests.

<h3 id="last-line-alignment-the-text-align-last-property">6.3 <a href="https://drafts.csswg.org/css-text-3/#text-align-last-property">Last Line Alignment: the text-align-last property</a></h3>

<p>Almost no automated tests.

<h3 id="justification-method-the-text-justify-property">6.4 <a href="https://drafts.csswg.org/css-text-3/#text-justify-property">Justification Method: the text-justify property</a></h3>

<p>Light coverage.

<p>Note: all values (other than auto) are tested, but the tests are minimal. Not sure we can do better though.

<p>Missing tests:

<ul>
	<li>No test of Animation type.
</ul>

<p>Untestable(?):

<ul>
	<li>behavior of “auto”
</ul>

<h4 id="expanding-and-compressing-text">6.4.1 <a href="https://drafts.csswg.org/css-text-3/#expanding-text">Expanding and Compressing Text</a></h4>

<p>No tests.

<p>Missing tests:

<ul>
	<li>whether a typographic character unit provides a justification opportunity is controlled by the text-justify value of its parent;
	<li>whether a justification opportunity exists between two consecutive typographic character units is determined by the text-justify value of their nearest common ancestor.
	<li>UAs must not break required ligatures or otherwise disable features required to correctly shape complex scripts
	<li>… and maybe more
</ul>

<h4 id="handling-symbols-and-punctuation">6.4.2 <a href="https://drafts.csswg.org/css-text-3/#justify-symbols">Handling Symbols and Punctuation</a></h4>

<p>No tests.

<p>Not sure what is testable though

<h4 id="unexpandable-text">6.4.3 <a href="https://drafts.csswg.org/css-text-3/#justify-limits">Unexpandable Text</a></h4>

<p>Basic coverage.
<p>Missing tests:

<ul>
	<li>Values of text-align-last other than justify
	<li>A broader range of non-stretchable content that just an empty span with padding
</ul>

<h4 id="cursive-scripts">6.4.4 <a href="https://drafts.csswg.org/css-text-3/#justify-cursive">Cursive Scripts</a></h4>

<p>No automated tests.

<h4 id="minimum-requirements-for-auto-justification">6.4.5 <a href="https://drafts.csswg.org/css-text-3/#justify-algos">Minimum Requirements for auto Justification</a></h4>

<p>No Tests

<h2 id="spacing">7. <a href="https://drafts.csswg.org/css-text-3/#spacing">Spacing</a></h2>

<p>Test only needed in subsections.

<h3 id="word-spacing-the-word-spacing-property">7.1 <a href="https://drafts.csswg.org/css-text-3/#word-spacing-property">Word Spacing: the word-spacing property</a></h3>

<p>Few tests.

<p>Missing tests:

<ul>
	<li>inherit lengths as absolute
	<li> values may be negative
	<li>computed / resolved value of normal
	<li> should be applied half on each side of the character unless otherwise dictated by typographic tradition.
	<li>doesn’t do anything between words defined by text analysis like in Thai, only on actual word separators
	<li>works on  the Ethiopic word space (U+1361), the Aegean word separators (U+10100,U+10101), the Ugaritic word divider (U+1039F), and the Phoenician Word Separator (U+1091F).
	<li>word-spacing and bidi
</ul>

<p>Problematic test
<ul>
	<li>text-word-spacing-001.html is wrong, the property no longer takes percentages
</ul>

<h3 id="tracking-the-letter-spacing-property">7.2 <a href="https://drafts.csswg.org/css-text-3/#letter-spacing-property">Tracking: the letter-spacing property</a></h3>

<p>Incomplete Coverage.

<p>Missing tests:

<div class=issue>Issue:
	Due to <a href="https://github.com/w3c/csswg-drafts/issues/1518">issue 1518</a>,
	some/many tests in this section should be converted
	from MUST to SHOULD.
</div>

<ul>
	<li>inherit lengths as absolute
	<li>For legacy reasons, a computed letter-spacing of zero yields a resolved value (getComputedStyle() return value) of normal.
	<li>When the effective spacing between two characters is not zero (due to either justification or a non-zero value of letter-spacing), user agents should not apply optional ligatures
	<li>However, ligatures and other font features specified via the low-level font-feature-settings property take precedence over this rule
</ul>

<h4 id="cursive-scripts">7.2.1 <a href="https://drafts.csswg.org/css-text-3/#cursive-tracking">Cursive Scripts</a></h4>

<p>No Tests.

<p>Not sure this can be tested automatically.

<h3 id="shaping-across-element-boundaries">7.3 <a href="https://drafts.csswg.org/css-text-3/#boundary-shaping">Shaping Across Element Boundaries</a></h3>

<p>Good Coverage.

<h2 id="edge-effects">8 <a href="https://drafts.csswg.org/css-text-3/#edge-effects">Edge Effects</a></h2>

<p>Test only needed in subsection.

<h3 id="first-line-indentation-the-text-indent-property">8.1 <a href="https://drafts.csswg.org/css-text-3/#text-indent-property">First Line Indentation: the text-indent property</a></h3>

<p>Partial Coverage.

<p>Missing tests:

<ul>
	<li>hanging keyword
	<li>each-line keyword
</ul>

<h3 id="hanging">8.2 <a href="https://drafts.csswg.org/css-text-3/#hanging">Hanging Glyphs</a></h3>

<p>Coverage TBD. Partly tested through 8.2, partly through white-space.

<h4 id="hanging-punctuation-the-hanging-punctuation-property">8.2.1 <a href="https://drafts.csswg.org/css-text-3/#hanging-punctuation-property">Hanging Punctuation: the hanging-punctuation property</a></h3>

<p>Spotty Coverage.

<p>All values tested.

<p>Missing tests:

<ul>
	<li>No test of Animation type.
	<li>Affects intrinsic sizing
	<li>each value has a test, and checks with some characters, but there isn’t a test for every relevant unicode character
	<li>it is not considered when measuring the line’s contents for […] alignment
	<li>it is not considered when measuring the line’s contents for […] justification
	<li>Non-zero inline-axis borders or padding between a hangable mark and the edge of the line prevent the mark from hanging
	<li>At most one punctuation character may hang at each edge of the line.
	<li>should be treated as ink overflow
</ul>

<h3 id="bidirectionality-and-line-boxes">8.3 <a href="https://drafts.csswg.org/css-text-3/#bidi-linebox">Bidirectionality and Line Boxes</a></h3>

<p>No tests.

<p>Missing tests:

<ul>
	<li>if its containing block has unicode-bidi: plaintext [CSS-WRITING-MODES-3], the line box’s inline base direction must be determined by the inline base direction of the bidi paragraph to which it belongs
	<li>An empty line box (i.e. one that contains no atomic inlines or characters other than the line-breaking character, if any) or one whose <a>bidi paragraph</a> has no strong directionality (contains only weak or neutral characters), takes its inline base direction from the preceding line box (if any), or, if this is the first line box in the containing block, then from the direction property of the containing block.
</ul>

<h2 id="appendix-a-text-processing-order-of-operations"><a href="https://drafts.csswg.org/css-text-3/#order">Appendix A: Text Processing Order of Operations</a></h2>

<p>Tests probably not needed.

<h2 id="appendix-b-conversion-to-plaintext"><a href="https://drafts.csswg.org/css-text-3/#plaintext">Appendix B: Conversion to Plaintext</a></h2>

<p>No Tests.

<p>Missing tests:

<ul>
	<li>§4.1.1 Phase I: Collapsing and Transformation is applied and any sequence of collapsible spaces at the beginning of a block or immediately following a forced line break is removed.
</ul>

<h2 id="appendix-c-default-ua-stylesheet"><a href="https://drafts.csswg.org/css-text-3/#default-stylesheet">Appendix C: Default UA Stylesheet</a></h2>

<p>Tests not needed.

<h2 id="appendix-d-scripts-and-spacing"><a href="https://drafts.csswg.org/css-text-3/#script-groups">Appendix D: Scripts and Spacing</a></h2>

<p>Tests not needed?

<h2 id="appendix-e-characters-and-properties"><a href="https://drafts.csswg.org/css-text-3/#character-properties">Appendix E: Characters and Properties</a></h2>

<p>No Tests.

<p>Missing tests:

<ul>
	<li>For the purposes of CSS Text, the properties of a typographic character unit are given by the base character of its first grapheme cluster—except in two cases:
	<li>Grapheme clusters formed with an Enclosing Mark (Me) of the Common script are considered to be Other Symbols (So) in the Common script. They are assumed to have the same Unicode properties as the Replacement Character U+FFFD.
	<li>Grapheme clusters formed with a Space Separator (Zs) as the base are considered to be Modifier Symbols (Sk). They are assumed to have the same East Asian Width property as the base, but take their other properties from the first combining character in the sequence.
</ul>

<p>To be completed, depending on the same criteria as <a href="#segment-break-transformation-rules">4.1.3</a>

<h2 id="appendix-g-tagging-content-by-writing-system"><a href="https://drafts.csswg.org/css-text-3/#script-tagging">Appendix F. Tagging Content by Writing System</a></h2>

<p>Partial Coverage.

<p>Each of the diverse properties that take the content language into account is tested, except tested on text-justification:auto, but probably not testable anyway.

<p>Missing tests:

<ul>
	<li>if the writing system to specified to be one of the Hant, Hans, Hani, Hanb, or Bopo [ISO15924] codes, then the writing system is Chinese.
	<li>if the writing system to specified to be one of the Jpan, Hira [ISO15924] codes, then the writing system is Japanese.
	<li>if the writing system to specified to be one of the Kore, Hang, or Jamo [ISO15924] codes, then the writing system is Korean.
</ul>

<h2 id="appendix-h-small-kana-mappings"><a href="https://drafts.csswg.org/css-text-3/#small-kana">Appendix G. Small Kana Mappings</a></h2>

<p>Adequate Coverage.

<p>Tested via the text-transform property.
