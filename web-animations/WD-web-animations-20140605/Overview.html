<!DOCTYPE html>
<html lang="en" dir="ltr">
<head><script src='MathJax/MathJax.js?config=MML_SVGorMML,local/local' type='text/javascript'></script>
    <title>Web Animations 1.0</title>
    <meta charset="utf-8">
  <link href="respec/respec.css" rel="stylesheet" type="text/css"><link href="web-animations.css" rel="stylesheet" type="text/css"><link href="http://www.w3.org/StyleSheets/TR/W3C-WD" rel="stylesheet" type="text/css"></head>
  <body style="display: inherit;"><div class="head"><p><a href="http://www.w3.org/"><img width="72" height="48" src="http://www.w3.org/Icons/w3c_home" alt="W3C"></a></p><h1 class="title" id="title">Web Animations 1.0</h1><h2 id="w3c-working-draft-05-june-2014"><abbr title="World Wide Web Consortium">W3C</abbr> Working Draft 5 June 2014</h2><dl><dt>This version:</dt><dd><a href="http://www.w3.org/TR/2014/WD-web-animations-20140605/">http://www.w3.org/TR/2014/WD-web-animations-20140605/</a></dd><dt>Latest published version:</dt><dd><a href="http://www.w3.org/TR/web-animations/">http://www.w3.org/TR/web-animations/</a></dd><dt>Latest editor's draft:</dt><dd><a href="http://dev.w3.org/fxtf/web-animations/">http://dev.w3.org/fxtf/web-animations/</a></dd><dt>Previous version:</dt><dd><a href="http://www.w3.org/TR/2013/WD-web-animations-20130625/">http://www.w3.org/TR/2013/WD-web-animations-20130625/</a></dd><dt>Editors:</dt><dd><span>Brian Birtles</span>, <a href="http://www.mozilla.jp/">Mozilla Japan</a>,  <span class="ed_mailto"><a href="mailto:bbirtles@mozilla.com">bbirtles@mozilla.com</a></span> </dd>
<dd><span>Shane Stephens</span>, <a href="http://www.google.com/">Google, Inc</a>,  <span class="ed_mailto"><a href="mailto:shans@google.com">shans@google.com</a></span> </dd>
<dd><span>Alex Danilo</span>, <a href="http://www.google.com/">Google, Inc</a>,  <span class="ed_mailto"><a href="mailto:adanilo@google.com">adanilo@google.com</a></span> </dd>
<dd><span>Tab Atkins</span>, <a href="http://www.google.com/">Google, Inc</a>,  <span class="ed_mailto"><a href="mailto:jackalmage@gmail.com">jackalmage@gmail.com</a></span> </dd>
</dl><p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> &#xa9; 2014 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>&#xae;</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>), All Rights Reserved. <abbr title="World Wide Web Consortium">W3C</abbr> <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p><hr></div>
    <section id="abstract" class="introductory"><h2>Abstract</h2><p>
      This specification defines a model for synchronization and timing of
      changes to the presentation of a Web page.
      This specification also defines an application programming interface for
      interacting with this model and it is expected that further specifications
      will define declarative means for exposing these features.
    </p></section><section id="sotd" class="introductory"><h2>Status of This Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at http://www.w3.org/TR/.</em></p><p>This document was published by the <a href="http://www.w3.org/Style/CSS/members">CSS Working Group</a> (part of the <a href="http://www.w3.org/Style/Activity">Style Activity</a>) and <a href="http://www.w3.org/Graphics/SVG/WG">SVG Working Group</a> (part of the <a href="http://www.w3.org/Graphics/Activity">Graphics Activity</a>) as a Working Draft. This document is intended to become a <abbr title="World Wide Web Consortium">W3C</abbr> Recommendation. If you wish to make comments regarding this document, please send them to <a href="mailto:public-fx@w3.org">public-fx@w3.org</a> (<a href="mailto:public-fx-request@w3.org?subject=subscribe">subscribe</a>, <a href="http://lists.w3.org/Archives/Public/public-fx/">archives</a>). All feedback is welcome.</p><p>Publication as a Working Draft does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership. This is a draft document and may be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite this document as other than work in progress.</p><p>This document was produced by groups operating under the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of each group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.</p></section><section id="toc"><h2 class="introductory">Table of Contents</h2><ul class="toc"><li class="tocline"><a href="#introduction" class="tocxref"><span class="secno">1. </span>Introduction</a><ul class="toc"><li class="tocline"><a href="#use-cases" class="tocxref"><span class="secno">1.1 </span>Use cases</a></li><li class="tocline"><a href="#relationship-to-other-specifications" class="tocxref"><span class="secno">1.2 </span>Relationship to other specifications</a></li><li class="tocline"><a href="#overview-of-this-specification" class="tocxref"><span class="secno">1.3 </span>Overview of this specification</a></li></ul></li><li class="tocline"><a href="#web-animations-model-overview" class="tocxref"><span class="secno">2. </span>Web Animations model overview</a></li><li class="tocline"><a href="#timing-model" class="tocxref"><span class="secno">3. </span>Timing model</a><ul class="toc"><li class="tocline"><a href="#the-timing-model-at-a-glance" class="tocxref"><span class="secno">3.1 </span>The timing model at a glance</a><ul class="toc"><li class="tocline"><a href="#stateless" class="tocxref"><span class="secno">3.1.1 </span>Stateless</a></li><li class="tocline"><a href="#hierarchical" class="tocxref"><span class="secno">3.1.2 </span>Hierarchical</a></li></ul></li><li class="tocline"><a href="#timing-model-concepts" class="tocxref"><span class="secno">3.2 </span>Timing model concepts</a></li><li class="tocline"><a href="#the-global-clock" class="tocxref"><span class="secno">3.3 </span>The global clock</a></li><li class="tocline"><a href="#timelines" class="tocxref"><span class="secno">3.4 </span>Timelines</a><ul class="toc"><li class="tocline"><a href="#the-document-timeline" class="tocxref"><span class="secno">3.4.1 </span>The document timeline</a></li></ul></li><li class="tocline"><a href="#players" class="tocxref"><span class="secno">3.5 </span>Players</a><ul class="toc"><li class="tocline"><a href="#the-current-time-of-a-player" class="tocxref"><span class="secno">3.5.1 </span>The current time of a player</a></li><li class="tocline"><a href="#seeking--pausing-and-limiting" class="tocxref"><span class="secno">3.5.2 </span>Seeking, pausing and limiting</a><ul class="toc"><li class="tocline"><a href="#introduction-to-seeking" class="tocxref"><span class="secno">3.5.2.1 </span>Introduction to seeking</a></li><li class="tocline"><a href="#introduction-to-pausing" class="tocxref"><span class="secno">3.5.2.2 </span>Introduction to pausing</a></li><li class="tocline"><a href="#limiting-the-current-time" class="tocxref"><span class="secno">3.5.2.3 </span>Limiting the current time</a></li><li class="tocline"><a href="#seeking--pausing-and-limiting-properties" class="tocxref"><span class="secno">3.5.2.4 </span>Seeking, pausing and limiting properties</a></li><li class="tocline"><a href="#calculating-the-player-start-time" class="tocxref"><span class="secno">3.5.2.5 </span>Calculating the player start time</a></li><li class="tocline"><a href="#updating-the-player-start-time" class="tocxref"><span class="secno">3.5.2.6 </span>Updating the player start time</a></li><li class="tocline"><a href="#automatically-updating-the-hold-time" class="tocxref"><span class="secno">3.5.2.7 </span>Automatically updating the hold time</a></li><li class="tocline"><a href="#updating-the-paused-state" class="tocxref"><span class="secno">3.5.2.8 </span>Updating the paused state</a></li><li class="tocline"><a href="#performing-a-seek" class="tocxref"><span class="secno">3.5.2.9 </span>Performing a seek</a></li><li class="tocline"><a href="#limited-players" class="tocxref"><span class="secno">3.5.2.10 </span>Limited players</a></li></ul></li><li class="tocline"><a href="#speed-control" class="tocxref"><span class="secno">3.5.3 </span>Speed control</a><ul class="toc"><li class="tocline"><a href="#updating-the-playback-rate" class="tocxref"><span class="secno">3.5.3.1 </span>Updating the playback rate</a></li></ul></li><li class="tocline"><a href="#player-events" class="tocxref"><span class="secno">3.5.4 </span>Player events</a><ul class="toc"><li class="tocline"><a href="#types-of-player-events" class="tocxref"><span class="secno">3.5.4.1 </span>Types of player events</a></li><li class="tocline"><a href="#event-parameters" class="tocxref"><span class="secno">3.5.4.2 </span>Event parameters</a></li><li class="tocline"><a href="#propagation-path" class="tocxref"><span class="secno">3.5.4.3 </span>Propagation path</a></li><li class="tocline"><a href="#sequence-of-events" class="tocxref"><span class="secno">3.5.4.4 </span>Sequence of events</a></li><li class="tocline"><a href="#event-dispatch" class="tocxref"><span class="secno">3.5.4.5 </span>Event dispatch</a></li></ul></li></ul></li><li class="tocline"><a href="#animation-nodes" class="tocxref"><span class="secno">3.6 </span>Animation nodes</a><ul class="toc"><li class="tocline"><a href="#relationship-between-animation-nodes-and-players" class="tocxref"><span class="secno">3.6.1 </span>Relationship between animation nodes and players</a></li><li class="tocline"><a href="#types-of-animation-nodes" class="tocxref"><span class="secno">3.6.2 </span>Types of animation nodes</a></li><li class="tocline"><a href="#the-active-interval" class="tocxref"><span class="secno">3.6.3 </span>The active interval</a></li><li class="tocline"><a href="#local-time-and-inherited-time" class="tocxref"><span class="secno">3.6.4 </span>Local time and inherited time</a></li><li class="tocline"><a href="#animation-node-phases-and-states" class="tocxref"><span class="secno">3.6.5 </span>Animation node phases and states</a></li></ul></li><li class="tocline"><a href="#fill-behavior" class="tocxref"><span class="secno">3.7 </span>Fill behavior</a><ul class="toc"><li class="tocline"><a href="#fill-modes" class="tocxref"><span class="secno">3.7.1 </span>Fill modes</a></li></ul></li><li class="tocline"><a href="#repeating" class="tocxref"><span class="secno">3.8 </span>Repeating</a><ul class="toc"><li class="tocline"><a href="#iteration-intervals" class="tocxref"><span class="secno">3.8.1 </span>Iteration intervals</a></li><li class="tocline"><a href="#controlling-iteration" class="tocxref"><span class="secno">3.8.2 </span>Controlling iteration</a></li><li class="tocline"><a href="#iteration-time-space" class="tocxref"><span class="secno">3.8.3 </span>Iteration time space</a></li><li class="tocline"><a href="#interval-timing" class="tocxref"><span class="secno">3.8.4 </span>Interval timing</a></li></ul></li><li class="tocline"><a href="#animation-node-speed-control" class="tocxref"><span class="secno">3.9 </span>Animation node speed control</a></li><li class="tocline"><a href="#core-animation-node-calculations" class="tocxref"><span class="secno">3.10 </span>Core animation node calculations</a><ul class="toc"><li class="tocline"><a href="#overview" class="tocxref"><span class="secno">3.10.1 </span>Overview</a></li><li class="tocline"><a href="#calculating-the-active-duration" class="tocxref"><span class="secno">3.10.2 </span>Calculating the active duration</a></li><li class="tocline"><a href="#transforming-the-local-time" class="tocxref"><span class="secno">3.10.3 </span>Transforming the local time</a><ul class="toc"><li class="tocline"><a href="#calculating-the-active-time" class="tocxref"><span class="secno">3.10.3.1 </span>Calculating the active time</a></li><li class="tocline"><a href="#calculating-the-scaled-active-time" class="tocxref"><span class="secno">3.10.3.2 </span>Calculating the scaled active time</a></li><li class="tocline"><a href="#calculating-the-iteration-time" class="tocxref"><span class="secno">3.10.3.3 </span>Calculating the iteration time</a></li></ul></li><li class="tocline"><a href="#calculating-the-current-iteration" class="tocxref"><span class="secno">3.10.4 </span>Calculating the current iteration</a></li></ul></li><li class="tocline"><a href="#direction-control" class="tocxref"><span class="secno">3.11 </span>Direction control</a><ul class="toc"><li class="tocline"><a href="#calculating-the-directed-time" class="tocxref"><span class="secno">3.11.1 </span>Calculating the directed time</a></li></ul></li><li class="tocline"><a href="#time-transformations" class="tocxref"><span class="secno">3.12 </span>Time transformations</a><ul class="toc"><li class="tocline"><a href="#scaling-the-time" class="tocxref"><span class="secno">3.12.1 </span>Scaling the time</a></li><li class="tocline"><a href="#timing-functions" class="tocxref"><span class="secno">3.12.2 </span>Timing functions</a></li><li class="tocline"><a href="#scaling-using-a-cubic-b-zier-curve" class="tocxref"><span class="secno">3.12.3 </span>Scaling using a cubic B&#xe9;zier curve</a></li><li class="tocline"><a href="#timing-in-discrete-steps" class="tocxref"><span class="secno">3.12.4 </span>Timing in discrete steps</a></li><li class="tocline"><a href="#calculating-the-transformed-time" class="tocxref"><span class="secno">3.12.5 </span>Calculating the transformed time</a></li></ul></li><li class="tocline"><a href="#grouping-and-synchronization" class="tocxref"><span class="secno">3.13 </span>Grouping and synchronization</a><ul class="toc"><li class="tocline"><a href="#relationship-of-group-time-to-child-time" class="tocxref"><span class="secno">3.13.1 </span>Relationship of group time to child time</a></li><li class="tocline"><a href="#the-start-time-of-children-of-an-animation-group" class="tocxref"><span class="secno">3.13.2 </span>The start time of children of an animation group</a></li><li class="tocline"><a href="#the-intrinsic-iteration-duration-of-an-animation-group" class="tocxref"><span class="secno">3.13.3 </span>The intrinsic iteration duration of an animation group</a></li><li class="tocline"><a href="#animation-sequences" class="tocxref"><span class="secno">3.13.4 </span>Animation sequences</a><ul class="toc"><li class="tocline"><a href="#the-start-time-of-children-of-an-animation-sequence" class="tocxref"><span class="secno">3.13.4.1 </span>The start time of children of an animation sequence</a></li><li class="tocline"><a href="#the-intrinsic-iteration-duration-of-an-animation-sequence" class="tocxref"><span class="secno">3.13.4.2 </span>The intrinsic iteration duration of an animation sequence</a></li></ul></li></ul></li><li class="tocline"><a href="#animations" class="tocxref"><span class="secno">3.14 </span>Animations</a><ul class="toc"><li class="tocline"><a href="#calculating-the-time-fraction" class="tocxref"><span class="secno">3.14.1 </span>Calculating the time fraction</a></li></ul></li></ul></li><li class="tocline"><a href="#animation-model" class="tocxref"><span class="secno">4. </span>Animation model</a><ul class="toc"><li class="tocline"><a href="#animation-effects" class="tocxref"><span class="secno">4.1 </span>Animation effects</a><ul class="toc"><li class="tocline"><a href="#target-properties" class="tocxref"><span class="secno">4.1.1 </span>Target properties</a></li><li class="tocline"><a href="#procedures-for-animating-properties" class="tocxref"><span class="secno">4.1.2 </span>Procedures for animating properties</a></li><li class="tocline"><a href="#specific-animation-behaviors" class="tocxref"><span class="secno">4.1.3 </span>Specific animation behaviors</a><ul class="toc"><li class="tocline"><a href="#not-animatable" class="tocxref"><span class="secno">4.1.3.1 </span>Not animatable</a></li><li class="tocline"><a href="#animatable-as-string" class="tocxref"><span class="secno">4.1.3.2 </span>Animatable as string</a></li><li class="tocline"><a href="#animatable-as-real-number" class="tocxref"><span class="secno">4.1.3.3 </span>Animatable as real number</a></li><li class="tocline"><a href="#animatable-as-length--percentage--or-calc" class="tocxref"><span class="secno">4.1.3.4 </span>Animatable as length, percentage, or calc</a></li><li class="tocline"><a href="#animatable-as-color" class="tocxref"><span class="secno">4.1.3.5 </span>Animatable as color</a></li><li class="tocline"><a href="#animatable-as-transform-list" class="tocxref"><span class="secno">4.1.3.6 </span>Animatable as transform list</a></li><li class="tocline"><a href="#other-animation-behaviors" class="tocxref"><span class="secno">4.1.3.7 </span>Other animation behaviors</a></li></ul></li><li class="tocline"><a href="#intermediate-animation-values" class="tocxref"><span class="secno">4.1.4 </span>Intermediate animation values</a></li></ul></li><li class="tocline"><a href="#combining-animations" class="tocxref"><span class="secno">4.2 </span>Combining animations</a><ul class="toc"><li class="tocline"><a href="#the-animation-stack" class="tocxref"><span class="secno">4.2.1 </span>The animation stack</a><ul class="toc"><li class="tocline"><a href="#the-custom-player-priority" class="tocxref"><span class="secno">4.2.1.1 </span>The custom player priority</a></li></ul></li><li class="tocline"><a href="#calculating-the-result-of-an-animation-stack" class="tocxref"><span class="secno">4.2.2 </span>Calculating the result of an animation stack</a></li><li class="tocline"><a href="#animation-composition" class="tocxref"><span class="secno">4.2.3 </span>Animation composition</a></li><li class="tocline"><a href="#applying-the-composited-result" class="tocxref"><span class="secno">4.2.4 </span>Applying the composited result</a><ul class="toc"><li class="tocline"><a href="#applying-the-result-to-a-css-property" class="tocxref"><span class="secno">4.2.4.1 </span>Applying the result to a CSS property</a></li><li class="tocline"><a href="#applying-the-composited-result-to-a-dom-attribute" class="tocxref"><span class="secno">4.2.4.2 </span>Applying the composited result to a DOM attribute</a></li></ul></li><li class="tocline"><a href="#animation-accumulation" class="tocxref"><span class="secno">4.2.5 </span>Animation accumulation</a></li></ul></li><li class="tocline"><a href="#keyframe-animation-effects" class="tocxref"><span class="secno">4.3 </span>Keyframe animation effects</a><ul class="toc"><li class="tocline"><a href="#spacing-keyframes" class="tocxref"><span class="secno">4.3.1 </span>Spacing keyframes</a><ul class="toc"><li class="tocline"><a href="#applying-spacing-to-keyframes" class="tocxref"><span class="secno">4.3.1.1 </span>Applying spacing to keyframes</a></li></ul></li><li class="tocline"><a href="#the-intermediate-animation-value-of-a-keyframe-animation-effect" class="tocxref"><span class="secno">4.3.2 </span>The intermediate animation value of a keyframe animation effect</a></li></ul></li><li class="tocline"><a href="#motion-path-animation-effects" class="tocxref"><span class="secno">4.4 </span>Motion path animation effects</a><ul class="toc"><li class="tocline"><a href="#distance-along-a-path" class="tocxref"><span class="secno">4.4.1 </span>Distance along a path</a></li><li class="tocline"><a href="#spacing-motion-paths" class="tocxref"><span class="secno">4.4.2 </span>Spacing motion paths</a><ul class="toc"><li class="tocline"><a href="#applying-spacing-to-motion-paths" class="tocxref"><span class="secno">4.4.2.1 </span>Applying spacing to motion paths</a></li></ul></li><li class="tocline"><a href="#determining-the-path-fraction" class="tocxref"><span class="secno">4.4.3 </span>Determining the path fraction</a></li><li class="tocline"><a href="#the-intermediate-animation-value-of-a-motion-path-animation-effect" class="tocxref"><span class="secno">4.4.4 </span>The intermediate animation value of a motion path animation effect</a></li></ul></li><li class="tocline"><a href="#custom-effects" class="tocxref"><span class="secno">4.5 </span>Custom effects</a><ul class="toc"><li class="tocline"><a href="#sampling-custom-effects" class="tocxref"><span class="secno">4.5.1 </span>Sampling custom effects</a></li><li class="tocline"><a href="#execution-order-of-custom-effects" class="tocxref"><span class="secno">4.5.2 </span>Execution order of custom effects</a></li></ul></li></ul></li><li class="tocline"><a href="#programming-interface" class="tocxref"><span class="secno">5. </span>Programming interface</a><ul class="toc"><li class="tocline"><a href="#the-animationtimeline-interface" class="tocxref"><span class="secno">5.1 </span>The <code>AnimationTimeline</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes" class="tocxref"><span class="secno">5.1.1 </span>Attributes</a></li><li class="tocline"><a href="#methods" class="tocxref"><span class="secno">5.1.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-animationplayer-interface" class="tocxref"><span class="secno">5.2 </span>The <code>AnimationPlayer</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-1" class="tocxref"><span class="secno">5.2.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-1" class="tocxref"><span class="secno">5.2.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-animationnode-interface" class="tocxref"><span class="secno">5.3 </span>The <code>AnimationNode</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-2" class="tocxref"><span class="secno">5.3.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-2" class="tocxref"><span class="secno">5.3.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-animationtiming-interface" class="tocxref"><span class="secno">5.4 </span>The <code>AnimationTiming</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-3" class="tocxref"><span class="secno">5.4.1 </span>Attributes</a></li></ul></li><li class="tocline"><a href="#the-animationtiminginput-dictionary" class="tocxref"><span class="secno">5.5 </span>The <code>AnimationTimingInput</code> dictionary</a><ul class="toc"><li class="tocline"><a href="#dictionary-animationtiminginput-members" class="tocxref"><span class="secno">5.5.1 </span>Dictionary <span class="idlType formerLink idlType"><code>AnimationTimingInput</code></span> Members</a></li><li class="tocline"><a href="#the-fillmode-enumeration" class="tocxref"><span class="secno">5.5.2 </span>The <code>FillMode</code> enumeration</a><ul class="toc"><li class="tocline"><a href="#values" class="tocxref"><span class="secno">5.5.2.1 </span>Values</a></li></ul></li><li class="tocline"><a href="#the-playbackdirection-enumeration" class="tocxref"><span class="secno">5.5.3 </span>The <code>PlaybackDirection</code> enumeration</a><ul class="toc"><li class="tocline"><a href="#values-1" class="tocxref"><span class="secno">5.5.3.1 </span>Values</a></li></ul></li></ul></li><li class="tocline"><a href="#the-animationgroup-interface" class="tocxref"><span class="secno">5.6 </span>The <code>AnimationGroup</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors" class="tocxref"><span class="secno">5.6.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-4" class="tocxref"><span class="secno">5.6.2 </span>Attributes</a></li><li class="tocline"><a href="#methods-3" class="tocxref"><span class="secno">5.6.3 </span>Methods</a></li><li class="tocline"><a href="#definitions-for-manipulating-hierarchies" class="tocxref"><span class="secno">5.6.4 </span>Definitions for manipulating hierarchies</a></li></ul></li><li class="tocline"><a href="#the-animationnodelist-interface" class="tocxref"><span class="secno">5.7 </span>The <code>AnimationNodeList</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-5" class="tocxref"><span class="secno">5.7.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-4" class="tocxref"><span class="secno">5.7.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-animationsequence-interface" class="tocxref"><span class="secno">5.8 </span>The <code>AnimationSequence</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-1" class="tocxref"><span class="secno">5.8.1 </span>Constructors</a></li><li class="tocline"><a href="#methods-5" class="tocxref"><span class="secno">5.8.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-animation-interface" class="tocxref"><span class="secno">5.9 </span>The <code>Animation</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-2" class="tocxref"><span class="secno">5.9.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-6" class="tocxref"><span class="secno">5.9.2 </span>Attributes</a></li><li class="tocline"><a href="#methods-6" class="tocxref"><span class="secno">5.9.3 </span>Methods</a></li><li class="tocline"><a href="#processing-the-effect-parameter" class="tocxref"><span class="secno">5.9.4 </span>Processing the <var>effect</var> parameter</a></li><li class="tocline"><a href="#creating-a-new-animation-object" class="tocxref"><span class="secno">5.9.5 </span>Creating a new <code>Animation</code> object</a></li></ul></li><li class="tocline"><a href="#the-animatable-interface" class="tocxref"><span class="secno">5.10 </span>The <code>Animatable</code> interface</a><ul class="toc"><li class="tocline"><a href="#methods-7" class="tocxref"><span class="secno">5.10.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-animationeffect-interface" class="tocxref"><span class="secno">5.11 </span>The <code>AnimationEffect</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-7" class="tocxref"><span class="secno">5.11.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-8" class="tocxref"><span class="secno">5.11.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#the-iterationcompositeoperation-enumeration" class="tocxref"><span class="secno">5.12 </span>The <code>IterationCompositeOperation</code> enumeration</a><ul class="toc"><li class="tocline"><a href="#values-2" class="tocxref"><span class="secno">5.12.1 </span>Values</a></li></ul></li><li class="tocline"><a href="#the-compositeoperation-enumeration" class="tocxref"><span class="secno">5.13 </span>The <code>CompositeOperation</code> enumeration</a><ul class="toc"><li class="tocline"><a href="#values-3" class="tocxref"><span class="secno">5.13.1 </span>Values</a></li></ul></li><li class="tocline"><a href="#the-keyframeeffect-interface" class="tocxref"><span class="secno">5.14 </span>The <code>KeyframeEffect</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-3" class="tocxref"><span class="secno">5.14.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-8" class="tocxref"><span class="secno">5.14.2 </span>Attributes</a></li><li class="tocline"><a href="#methods-9" class="tocxref"><span class="secno">5.14.3 </span>Methods</a></li><li class="tocline"><a href="#processing-a-sequence-of-keyframe-objects-or-a-single-item" class="tocxref"><span class="secno">5.14.4 </span>Processing a sequence of <code>Keyframe</code> objects or a single item</a></li><li class="tocline"><a href="#the-keyframeeffectoptions-dictionary" class="tocxref"><span class="secno">5.14.5 </span>The <code>KeyframeEffectOptions</code> dictionary</a><ul class="toc"><li class="tocline"><a href="#dictionary-keyframeeffectoptions-members" class="tocxref"><span class="secno">5.14.5.1 </span>Dictionary <span class="idlType formerLink idlType"><code>KeyframeEffectOptions</code></span> Members</a></li></ul></li><li class="tocline"><a href="#normalizing-a-sequence-of-keyframes" class="tocxref"><span class="secno">5.14.6 </span>Normalizing a sequence of keyframes</a></li></ul></li><li class="tocline"><a href="#the-keyframe-dictionary" class="tocxref"><span class="secno">5.15 </span>The <code>Keyframe</code> dictionary</a><ul class="toc"><li class="tocline"><a href="#dictionary-keyframe-members" class="tocxref"><span class="secno">5.15.1 </span>Dictionary <span class="idlType formerLink idlType"><code>Keyframe</code></span> Members</a></li><li class="tocline"><a href="#processing-a-keyframe-object" class="tocxref"><span class="secno">5.15.2 </span>Processing a <code>Keyframe</code> object</a></li></ul></li><li class="tocline"><a href="#the-computedkeyframe-dictionary" class="tocxref"><span class="secno">5.16 </span>The <code>ComputedKeyframe</code> dictionary</a><ul class="toc"><li class="tocline"><a href="#dictionary-computedkeyframe-members" class="tocxref"><span class="secno">5.16.1 </span>Dictionary <span class="idlType formerLink idlType"><code>ComputedKeyframe</code></span> Members</a></li></ul></li><li class="tocline"><a href="#the-motionpatheffect-interface" class="tocxref"><span class="secno">5.17 </span>The <code>MotionPathEffect</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-4" class="tocxref"><span class="secno">5.17.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-9" class="tocxref"><span class="secno">5.17.2 </span>Attributes</a></li><li class="tocline"><a href="#the-motionpatheffectoptions-dictionary" class="tocxref"><span class="secno">5.17.3 </span>The <code>MotionPathEffectOptions</code> dictionary</a><ul class="toc"><li class="tocline"><a href="#dictionary-motionpatheffectoptions-members" class="tocxref"><span class="secno">5.17.3.1 </span>Dictionary <span class="idlType formerLink idlType"><code>MotionPathEffectOptions</code></span> Members</a></li></ul></li><li class="tocline"><a href="#the-autorotationmode-enumeration" class="tocxref"><span class="secno">5.17.4 </span>The <code>AutoRotationMode</code> enumeration</a><ul class="toc"><li class="tocline"><a href="#values-4" class="tocxref"><span class="secno">5.17.4.1 </span>Values</a></li></ul></li></ul></li><li class="tocline"><a href="#the-effectcallback-callback-function" class="tocxref"><span class="secno">5.18 </span>The <code>EffectCallback</code> callback function</a></li><li class="tocline"><a href="#the-animationplayerevent-interface" class="tocxref"><span class="secno">5.19 </span>The <code>AnimationPlayerEvent</code> interface</a><ul class="toc"><li class="tocline"><a href="#constructors-5" class="tocxref"><span class="secno">5.19.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-10" class="tocxref"><span class="secno">5.19.2 </span>Attributes</a></li><li class="tocline"><a href="#dictionary-animationplayereventinit-members" class="tocxref"><span class="secno">5.19.3 </span>Dictionary <span class="idlType formerLink idlType"><code>AnimationPlayerEventInit</code></span> Members</a></li></ul></li><li class="tocline"><a href="#extensions-to-the-document-interface" class="tocxref"><span class="secno">5.20 </span>Extensions to the <code>Document</code> interface</a><ul class="toc"><li class="tocline"><a href="#attributes-11" class="tocxref"><span class="secno">5.20.1 </span>Attributes</a></li></ul></li><li class="tocline"><a href="#extensions-to-the-element-interface" class="tocxref"><span class="secno">5.21 </span>Extensions to the <code>Element</code> interface</a></li><li class="tocline"><a href="#extensions-to-the-pseudoelement-interface" class="tocxref"><span class="secno">5.22 </span>Extensions to the <code>PseudoElement</code> interface</a></li><li class="tocline"><a href="#script-execution-and-live-updates-to-the-model" class="tocxref"><span class="secno">5.23 </span>Script execution and live updates to the model</a></li></ul></li><li class="tocline"><a href="#integration-with-media-fragments" class="tocxref"><span class="secno">6. </span>Integration with Media Fragments</a></li><li class="tocline"><a href="#interaction-with-page-display" class="tocxref"><span class="secno">7. </span>Interaction with page display</a></li><li class="tocline"><a href="#implementation-requirements" class="tocxref"><span class="secno">8. </span>Implementation requirements</a><ul class="toc"><li class="tocline"><a href="#precision-of-time-values" class="tocxref"><span class="secno">8.1 </span>Precision of time values</a></li><li class="tocline"><a href="#conformance-criteria" class="tocxref"><span class="secno">8.2 </span>Conformance criteria</a></li></ul></li><li class="tocline"><a href="#webidl-ref" class="tocxref"><span class="secno">A. </span>Interface summary</a></li><li class="tocline"><a href="#acknowledgements" class="tocxref"><span class="secno">B. </span>Acknowledgements</a></li><li class="tocline"><a href="#changes-since-last-publication" class="tocxref"><span class="secno">C. </span>Changes since last publication</a></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">D. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">D.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">D.2 </span>Informative references</a></li></ul></li></ul></section>

    <section class="informative" id="introduction">
      <!--OddPage--><h2><span class="secno">1. </span>Introduction</h2><div class="informative-bg"><p><em>This section is non-normative.</em></p>
      <p>
        Web Animations defines a model for supporting animation and
        synchronization on the Web platform.
        It is intended that other specifications will build on this model and
        expose its features through declarative means.
        In addition, this specification also defines a programming interface to
        the model that may be implemented by user agents that provide support
        for scripting.
      </p>
      <section id="use-cases">
        <h3><span class="secno">1.1 </span>Use cases</h3>
        <p>
          The Web Animations model aims at two broad areas of application:
        </p>
        <dl>
          <dt>User interface effects</dt>
          <dd>
            <p>
              Animation can be used to give visual clues and feedback to make
              a user interface more readily comprehensible.
            </p>
            <p>
              For example, a user action results in a table row being
              removed to represent an item being removed from a shopping cart.
              In such a case, fading the row to transparent and then shifting
              the subsequent rows up to fill the space over a few hundred
              milliseconds provides the user with clear feedback as to the
              results of their action as opposed to instantly removing the row
              from the DOM.
            </p>
            <p>
              To support this scenario not only are the animated effects of
              fading and shifting required, but so is synchronization, both
              between the animations, and between animations and scripted
              actions (removing the table row from the DOM after the animations
              have completed).
            </p>
          </dd>
          <dt>Storytelling and visualisation</dt>
          <dd>
            <p>
              Another type of animation uses the animated effect to convey
              a story or represent some information.
              Unlike user interface effects which are largely a presentational
              adjunct to the content, these animations form an essential part of
              the content presented to the user.
            </p>
            <p>
              For example, in an animated cartoon two cats fly through space
              to another planet leaving a rainbow trail behind them.
              After arriving at the planet a change of scene occurs and the user
              should decide whether or not the cats enter a magic mountain by
              selecting one of two preset destinations in the scene.
            </p>
            <p>
              This scenario requires the following features:
            </p>
            <ul>
              <li>animated effects for moving characters along a path as well as
                  warping a path (the rainbow trail),
              </li><li>synchronization that allows some actions to happen
                  simultaneously (the two cats moving) and others in sequence
                  (the change of scene),
              </li><li>play control to allow rewinding the cartoon, or changing its
                  playback rate to accommodate particular learning or
                  accessibility needs,
              </li><li>the ability to trigger animations in response to user input
            </li></ul>
            <p>
              Similar use cases in this category include visualising physical
              phenomena such as spring motion for educational purposes,
              or visualising data such as the prevalence of a disease over
              a geographical space over a year whereby animation is used to
              present the time-based component of the data.
            </p>
          </dd>
        </dl>
      </section>
      <section id="relationship-to-other-specifications">
        <h3><span class="secno">1.2 </span>Relationship to other specifications</h3>
        <p>
          CSS Transitions [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>], CSS Animations 
          [<cite><a class="bibref" href="#bib-CSS3-ANIMATIONS">CSS3-ANIMATIONS</a></cite>], and SVG [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>] all provide mechanisms that
          generate animated content on a Web page.
          Although the three specifications provide many similar features,
          they are described in different terms.
          This specification proposes an abstract animation model that
          encompasses the common features of all three specifications.
          This model is backwards-compatible with the current behavior of these
          specifications such that they can be defined in terms of this model
          without any observable change.
        </p>
        <p>
          The animation features in SVG 1.1 are defined in terms of SMIL
          Animation [<cite><a class="bibref" href="#bib-SMIL-ANIMATION">SMIL-ANIMATION</a></cite>].
          It is intended that by defining SVG's animation features in terms of
          the Web Animations model, the dependency between SVG and SMIL
          Animation can be removed.
        </p>
        <p>
          As with Timing control for script-based animations (commonly referred
          to as &#x201c;requestAnimationFrame&#x201d;) [<cite><a class="bibref" href="#bib-RAF">RAF</a></cite>],
          the programming interface component of this specification allows
          animations to be created from script.
          The animations created using the interface defined in this
          specification, however, once created, are executed entirely by the
          user agent meaning they share the same performance characteristics as
          animations defined by markup.
          Using this interface it is possible to create animations
          from script in a simpler and more performant manner.
        </p>
        <p>
          The time values used within the programming interface
          correspond with those used in Timing control for script-based
          animations [<cite><a class="bibref" href="#bib-RAF">RAF</a></cite>] and their execution order to defined such that the
          two interfaces can be used simultaneously without conflict.
        </p>
        <p>
          The programming interface component of this specification makes
          some additions to interfaces defined in HTML5 [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
        </p>
      </section>
      <section id="overview-of-this-specification">
        <h3><span class="secno">1.3 </span>Overview of this specification</h3>
        <p>
          This specification begins by defining an abstract model for animation.
          This is followed by a programming interface defined in terms of the
          abstract model.
          The programming interface is defined in terms of the abstract model
          and is only relevant to user agents that provide scripting support.
        </p>
      </section>
    </div></section>

    <section class="informative" id="web-animations-model-overview">
      <!--OddPage--><h2><span class="secno">2. </span>Web Animations model overview</h2><div class="informative-bg"><p><em>This section is non-normative.</em></p>
      <p>
        At a glance, the Web Animations model consists of two largely
        independent pieces, a <em>timing model</em> and an <em>animation
        model</em>.  The role of these pieces is as follows:
      </p>
      <dl>
        <dt>Timing model</dt>
        <dd>
          Takes a moment in time and converts it to a proportional distance
          within a single iteration of an animation called the <em>time
          fraction</em>.
          An <em>iteration index</em> is also generated for animations
          that vary as they repeat.
        </dd>
        <dt>Animation model</dt>
        <dd>
          Takes the <em>time fractions</em> and <em>iteration indices</em>
          produced by the timing model and converts them into a series of values
          to apply to the target properties and attributes.
        </dd>
      </dl>
      <p>
        Graphically, this flow can be represented as follows:
      </p>
      <div class="figure">
        <img src="img/timing-and-animation-models.svg" width="600" alt="Overview of the operation of the Web Animations model.">
      </div>
      <p class="caption">
        Overview of the operation of the Web Animations model.<br>
        The current time is input to the timing model which produces a time
        fraction and an iteration index.<br>
        These parameters are used as input to the animation model which produces
        the values to apply.<br>
      </p>
      <p>
        For example, consider an animation that:
      </p>
      <ul>
        <li>starts after 3 seconds,</li>
        <li>runs twice,</li>
        <li>takes 2 seconds every time, and</li>
        <li>changes the width of a rectangle from 50 pixels to 100
            pixels.</li>
      </ul>
      <p>
        The first three points apply to the timing model.
        At a time of 6 seconds, it will calculate that the animation should be
        half-way through its second iteration and produces the result 0.5.
        The animation model then uses that information to calculate a width
        for the rectangle of 75.
      </p>
      <p>
        This specification begins with the timing model and then proceeds to
        the animation model.
      </p>
    </div></section>

    <section id="timing-model">
      <!--OddPage--><h2><span class="secno">3. </span>Timing model</h2>
      <p>
        This section describes and defines the behavior of the Web Animations
        timing model.
      </p>
    <section class="informative" id="the-timing-model-at-a-glance">
      <h3><span class="secno">3.1 </span>The timing model at a glance</h3><div class="informative-bg"><p><em>This section is non-normative.</em></p>
      <p>
        Two features characterise the Web Animations timing model: it is
        <em>stateless</em> and it is <em>hierarchical</em>.
      </p>
      <section id="stateless">
        <h4><span class="secno">3.1.1 </span>Stateless</h4>
        <p>
          The Web Animations timing model operates by taking an input time and
          producing an output time fraction.
          Since the output is based solely on the input time and is independent
          of previous inputs, the model may be described as stateless.
          This gives the model the following properties:
        </p>
        <dl>
          <dt>Frame-rate independent</dt>
          <dd>
            Since the output is independent of previous inputs, the rate at
            which the model is sampled will not affect its progress.
            Provided the input times are proportional to the progress of
            real-world time, animations will progress at an identical rate
            regardless of the capabilities of the device running them.
          </dd>
          <dt>Direction-agnostic</dt>
          <dd>
            Since the sequence of inputs is insignificant, the model is
            directionless.
            This means that the model can be sampled in reverse or even in
            a backwards and forwards pattern without requiring any specialized
            handling.
          </dd>
          <dt>Constant-time seeking</dt>
          <dd>
            Since each input is independent of the previous input, the
            processing required to perform a seek operation, even far into the
            future, is at least potentially constant.
          </dd>
        </dl>
        <p>
          There are a few exceptions to the stateless behavior of the timing
          model.
        </p>
        <p>
        </p>
        <p>
          Firstly, a number of methods defined in the <a href="#programming-interface">programming interface</a> to the model
          provide play control such as pausing an animation.
          These methods are defined in terms of the time at which they are
          called and are therefore stative.
          These methods are provided primarily for convenience and are not part
          of the core timing model but are layered on top.
        </p>
        <p>
          Likewise, <a href="#dfn-player-event" class="internalDFN">player events</a> are fired when the first sample occurs
          at the limit of the <a href="#dfn-source-content" class="internalDFN">source content</a>.
          This too is stative behavior but is part of the play control layered
          on top of the timing model.
        </p>
        <p>
          Similarly, the <a href="#limiting-the-current-time">limiting
          behavior</a> of players means that dynamic changes to the end time of
          the media (source content) of a player may produce a different result
          depending on when the change occurs.
          This behavior is somewhat unfortunate but has been deemed intuitive
          and consistent with HTML.
          As a result, the model can only truly be described as stateless
          <em>in the absence of dynamic changes to its timing properties</em>.
        </p>
        <p>
          Finally, each time the model is sampled, it can be considered to
          establish a temporary state.
          While this temporary state affects the values returned from the <a href="#programming-interface">programming interface</a>, it has no
          influence on the subsequent samples and hence does not conflict with
          the stateless qualities described above.
        </p>
      </section>
      <section id="hierarchical">
        <h4><span class="secno">3.1.2 </span>Hierarchical</h4>
        <p>
          The other characteristic feature of the Web Animations timing model is
          that time is inherited.
          Time begins with a monotonically increasing time source and cascades
          down a number of steps to each animation.
          At each step, time may be shifted backwards and forwards, scaled,
          reversed, paused, and repeated.
        </p>
        <div class="figure">
          <img src="img/time-hierarchy.svg" width="600" alt="A hierarchy of timing nodes">
        </div>
        <p class="caption">
          A hierarchy of timing nodes.
          Each node in the tree derives its time from its parent node.
          At the root of the tree is the global clock.
        </p>
        <p>
          A consequence of this hierarchical arrangement is that complex
          animation arrangements can be reversed, scheduled, accelerated and so
          on as a whole unit since the manipulations applied to the parent
          cascade down to its <a href="#dfn-descendant" class="internalDFN">descendants</a>.
          Furthermore, since time has a common source, it is easy to synchronize
          animations.
        </p>
      </section>
    </div></section>

    <section id="timing-model-concepts">
      <h3><span class="secno">3.2 </span>Timing model concepts</h3>
      <p>
        In Web Animations, timing is based on a hierarchy of time relationships
        between timing nodes.
        Parent nodes provide timing information to their child nodes in the form
        of <a href="#dfn-time-value" class="internalDFN">time values</a>.
        A <dfn id="dfn-time-value">time value</dfn> is a real number which nominally represents
        a number of milliseconds from some moment.
        The connection between <a href="#dfn-time-value" class="internalDFN">time values</a> and wall-clock milliseconds
        may be obscured by any number of transformations applied to the value as
        it passes through the time hierarchy.
      </p>
      <p class="annotation">
        In the future we may have timelines that are based on UI gestures in
        which case the connection between time values and milliseconds will be
        weakened even further.
      </p>
      <p>
        Periodically, the user agent will trigger an update to the timing model
        in a process called <dfn id="dfn-sampling">sampling</dfn>.
        On each <dfn id="dfn-sample">sample</dfn> the <a href="#dfn-time-value" class="internalDFN">time values</a> of each timing node are
        updated.
      </p>
      <p class="note">
        A more precise definition of when the model is updated when scripting is
        involved is provided in <a href="#script-execution-and-live-updates-to-the-model" class="sectionRef">section 5.23 Script execution and live updates to the model</a>.
      </p>
    </section>

    <section id="the-global-clock">
      <h3><span class="secno">3.3 </span>The global clock</h3>
      <p>
        At the root of the Web Animations timing hierarchy is the <a href="#dfn-global-clock" class="internalDFN">global
        clock</a>.
      </p>
      <p>
        The <dfn id="dfn-global-clock">global clock</dfn> is a source of monotonically increasing
        <a href="#dfn-time-value" class="internalDFN">time values</a> unaffected by adjustments to the system clock.
        The <a href="#dfn-time-value" class="internalDFN">time values</a> produced by the <a href="#dfn-global-clock" class="internalDFN">global clock</a> represent
        wall-clock milliseconds from an unspecified historical moment.
        Because the zero time of the <a href="#dfn-global-clock" class="internalDFN">global clock</a> is not specified,
        the absolute values of the <a href="#dfn-time-value" class="internalDFN">time values</a> produced by the <a href="#dfn-global-clock" class="internalDFN">global
        clock</a> are not significant, only their rate of change.
      </p>
      <p class="note">
        Note that the <a href="#dfn-global-clock" class="internalDFN">global clock</a> is not exposed in the <a href="#programming-interface">programming interface</a> and nor is it
        expected to be exposed by markup.
        As a result the moment from which <a href="#dfn-global-clock" class="internalDFN">global clock</a> <a href="#dfn-time-value" class="internalDFN">time values</a>
        are measured, that is, the zero time of the clock, is
        implementation-dependent.
        One user agent may measure the number of milliseconds since the the user
        agent was loaded whilst another may use the time when the device was
        started.
        Both approaches are acceptable and produce no observable difference
        in the output of the model.
      </p>
    </section>

    <section id="timelines">
      <h3><span class="secno">3.4 </span>Timelines</h3>
      <p>
        A <dfn id="dfn-timeline">timeline</dfn> provides a source of <a href="#dfn-time-value" class="internalDFN">time values</a> for the
        purpose of synchronization.
      </p>
      <p>
        Typically, a <a href="#dfn-timeline" class="internalDFN">timeline</a> is tied to the <a href="#dfn-global-clock" class="internalDFN">global clock</a> such
        that its absolute time is calculated as a fixed offset from the time of
        the <a href="#dfn-global-clock" class="internalDFN">global clock</a>.
        This offset is established by designating some moment as the timeline's
        <dfn id="dfn-zero-time">zero time</dfn> and recording the <a href="#dfn-time-value" class="internalDFN">time value</a> of the
        <a href="#dfn-global-clock" class="internalDFN">global clock</a> at that moment.
        At subsequent moments, the <a href="#dfn-time-value" class="internalDFN">time value</a> of the timeline is
        calculated as the difference between the current <a href="#dfn-time-value" class="internalDFN">time value</a> of
        the <a href="#dfn-global-clock" class="internalDFN">global clock</a> and the value recorded at the <a href="#dfn-zero-time" class="internalDFN">zero time</a>.
      </p>
      <p class="annotation">
        Note that we anticipate that other types of timelines may be introduced
        in the future that are not tied to the global clock.
        For example, a timeline whose time values are related to the progress of
        a UI gesture.
      </p>
      <p>
        Since a <a href="#dfn-timeline" class="internalDFN">timeline</a> may be defined relative to a moment that has yet
        to occur, it may not always be able to return a meaningful <a href="#dfn-time-value" class="internalDFN">time
        value</a>.
        A <a href="#dfn-timeline" class="internalDFN">timeline</a> is considered to be <dfn id="dfn-not-started">not started</dfn> when it is
        in such a state that it cannot produce a <a href="#dfn-time-value" class="internalDFN">time value</a>.
      </p>
      <p class="issue">
        Should this be renamed to something like &#x201c;inactive&#x201d; so we
        can accommodate possible future timelines that may, after starting,
        become unable to return a meaningful <a href="#dfn-time-value" class="internalDFN">time value</a>?
      </p>
      <section id="the-document-timeline">
        <h4><span class="secno">3.4.1 </span>The document timeline</h4>
        <p>
          Each document has a <a href="#dfn-timeline" class="internalDFN">timeline</a> called the <dfn id="dfn-document-timeline">document
          timeline</dfn>.
          The <a href="#dfn-time-value" class="internalDFN">time values</a> of the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> are calculated
          as a fixed offset from the <a href="#dfn-global-clock" class="internalDFN">global clock</a> such that the <a href="#dfn-zero-time" class="internalDFN">zero
          time</a> corresponds to
          the <a href="http://www.w3.org/TR/navigation-timing/#dom-performancetiming-navigationstart"><code>navigationStart</code></a>
          moment [<cite><a class="bibref" href="#bib-NAVIGATION-TIMING">NAVIGATION-TIMING</a></cite>].
          Prior to this moment, the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> is <a href="#dfn-not-started" class="internalDFN">not
          started</a>.
        </p>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            Since the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> is tied to the <a href="#dfn-global-clock" class="internalDFN">global
            clock</a> by a fixed offset, <a href="#dfn-time-value" class="internalDFN">time values</a> reported by the
            <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> increase monotonically.
            Furthermore, since no scaling is applied, these <a href="#dfn-time-value" class="internalDFN">time values</a>
            are proportional to wall-clock milliseconds.
          </p>
          <p>
            Since the <a href="#dfn-time-value" class="internalDFN">time values</a> of the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> are
            relative to the <code>navigationStart</code> time,
            <code>document.timeline.currentTime</code> will roughly correspond
            to
            <a href="http://www.w3.org/TR/hr-time/#dom-performance-now"><code>Performance.now()</code></a>
            [<cite><a class="bibref" href="#bib-HR-TIME">HR-TIME</a></cite>] with the exception that
            <code>document.timeline.currentTime</code> does not change within
            a script execution block as defined in <a href="#script-execution-and-live-updates-to-the-model" class="sectionRef">section 5.23 Script execution and live updates to the model</a>.
          </p>
        </div>
      </section>
    </section>

    <section id="players">
      <h3><span class="secno">3.5 </span>Players</h3>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          The children of a <a href="#dfn-timeline" class="internalDFN">timeline</a> are called <em>players</em>.
          A player takes an <a href="#dfn-animation-node" class="internalDFN">animation node</a> which is a static
          description of some timed behavior and binds it to a <a href="#dfn-timeline" class="internalDFN">timeline</a>
          so that it runs.
          A player also allows run-time control of the connection between the
          <a href="#dfn-animation-node" class="internalDFN">animation node</a> and its <a href="#dfn-timeline" class="internalDFN">timeline</a> by providing pausing,
          seeking, and speed control.
          The relationship between a player and an <a href="#dfn-animation-node" class="internalDFN">animation node</a> is
          analogous to that of a DVD player and a DVD.
        </p>
      </div>
      <p>
        A <dfn id="dfn-player">player</dfn> connects a single <a href="#dfn-animation-node" class="internalDFN">animation node</a>, called
        its <dfn id="dfn-source-content">source content</dfn>, to a <a href="#dfn-timeline" class="internalDFN">timeline</a> and provides
        playback control.
      </p>
      <p>
        A <a href="#dfn-player" class="internalDFN">player</a>'s <dfn title="player start time" id="dfn-player-start-time">start time</dfn> is the
        <a href="#dfn-time-value" class="internalDFN">time value</a> of its <a href="#dfn-timeline" class="internalDFN">timeline</a> when its <a href="#dfn-source-content" class="internalDFN">source content</a>
        is scheduled to begin playback.
      </p>
      <p>
        When a <a href="#dfn-player" class="internalDFN">player</a> is created, it is assigned a globally unique
        sequence number called the <dfn id="dfn-player-sequence-number">player sequence number</dfn>.
        This number is used to resolve the sort order of players for a variety
        of situations such as combining animations, queuing events, and
        returning the list of current players.
      </p>
      <section id="the-current-time-of-a-player">
        <h4><span class="secno">3.5.1 </span>The current time of a player</h4>
        <p>
          <a href="#dfn-player" class="internalDFN">Players</a> provide a <a href="#dfn-time-value" class="internalDFN">time value</a> to their <a href="#dfn-source-content" class="internalDFN">source
          content</a> called the player's <dfn id="dfn-current-time">current time</dfn>.
        </p>
        <p>
          The calculation of the <a href="#dfn-current-time" class="internalDFN">current time</a> is as follows:
        </p>
        <blockquote>
          <code><a href="#dfn-current-time" class="internalDFN">current time</a> =
          (<var>timeline time</var> - <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a>)
          &#xd7; <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a></code>
          <p>
            <em>unless</em> the <a href="#dfn-hold-time" class="internalDFN">hold time</a> is <em>not</em> null, in which
            case the <a href="#dfn-current-time" class="internalDFN">current time</a> is equal to the <a href="#dfn-hold-time" class="internalDFN">hold time</a>.
          </p>
        </blockquote>
        <p>
          Where:
        </p>
        <ul>
          <li><var>timeline time</var> is the current <a href="#dfn-time-value" class="internalDFN">time value</a> of the
              <a href="#dfn-timeline" class="internalDFN">timeline</a> with which this <a href="#dfn-player" class="internalDFN">player</a> is associated.
          </li><li><var>start time</var> is the player's <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a>.
          </li><li><var>playback rate</var> is the player's <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> value described in
              <a href="#speed-control" class="sectionRef">section 3.5.3 Speed control</a>.
          </li><li><a href="#dfn-hold-time" class="internalDFN">hold time</a> is the value described in 
              <a href="#seeking--pausing-and-limiting-properties" class="sectionRef">section 3.5.2.4 Seeking, pausing and limiting properties</a>.
        </li></ul>
        <p>
          The procedure for performing manual updates to the <a href="#dfn-current-time" class="internalDFN">current time</a>
          is defined in <a href="#performing-a-seek" class="sectionRef">section 3.5.2.9 Performing a seek</a>.
        </p>
        <p>
          If the <a href="#dfn-timeline" class="internalDFN">timeline</a> with which the <a href="#dfn-player" class="internalDFN">player</a> is associated is
          <a href="#dfn-not-started" class="internalDFN">not started</a>, then the <a href="#dfn-current-time" class="internalDFN">current time</a> is null.
        </p>
        <!--
          Delayed start:
        <p>
          Likewise, if the player's <a title="player start time">start time</a>
          is <a>not resolved</a>, then the <a>current time</a> is
          <code>null</code>.
        </p>
        -->
        <!--
          Delayed start:
          qualify the following with "or when the start time has not been
          resolved"?
          -->
        <p>
          It is often useful to manipulate the <a href="#dfn-current-time" class="internalDFN">current time</a> of a player
          even when its associated <a href="#dfn-timeline" class="internalDFN">timeline</a> is <a href="#dfn-not-started" class="internalDFN">not started</a>.
          For example, this is useful for pre-seeking a player.
          For this purpose, we have the following additional definitions:
        </p>
        <dl>
          <dt><dfn id="dfn-effective-timeline-time">effective timeline time</dfn></dt>
          <dd>
            The current <a href="#dfn-time-value" class="internalDFN">time value</a> of the <a href="#dfn-timeline" class="internalDFN">timeline</a> associated
            with a <a href="#dfn-player" class="internalDFN">player</a> unless the timeline is <a href="#dfn-not-started" class="internalDFN">not started</a>, in
            which case the <var>effective timeline time</var> is zero.
          </dd>
          <dt><dfn id="dfn-effective-current-time">effective current time</dfn></dt>
          <!--
            Delayed start:
            Or if the start time is <a>not resolved</a> use the current timeline
            time
            -->
          <dd>
            The result of evaluating the <a href="#dfn-current-time" class="internalDFN">current time</a> as above
            but substituting the <a href="#dfn-effective-timeline-time" class="internalDFN">effective timeline time</a> for the
            <var>timeline time</var>.
          </dd>
        </dl>
      </section>
      <section id="seeking--pausing-and-limiting">
        <h4><span class="secno">3.5.2 </span>Seeking, pausing and limiting</h4>
        <p>
          Seeking, pausing and limiting a player are closely related and are
          described here together.
        </p>
        <section class="informative" id="introduction-to-seeking">
          <h5><span class="secno">3.5.2.1 </span>Introduction to seeking</h5><div class="informative-bg"><p><em>This section is non-normative.</em></p>
          <p>
            Changing the current playback position of a player, that is, its
            <a href="#dfn-current-time" class="internalDFN">current time</a>, can be used to rewind its <a href="#dfn-source-content" class="internalDFN">source content</a>
            to its start point, fast-forward to a point in the future, or to
            provide ad-hoc synchronization between players.
          </p>
          <p>
            Changing the <a href="#dfn-current-time" class="internalDFN">current time</a> of a player has the side effect of
            shifting its <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a> as
            illustrated below.
          </p>
          <div class="figure">
            <img src="img/seeking.svg" width="600" alt="The effect of seeking a player.">
          </div>
          <p class="caption">
            At time <var>t</var>, a seek is performed on the player changing its
            <a href="#dfn-current-time" class="internalDFN">current time</a> from 1.5s to 2s.<br>
          </p>
          <p>
            It is possible to seek a player even if its <a href="#dfn-timeline" class="internalDFN">timeline</a> is
            <a href="#dfn-not-started" class="internalDFN">not started</a>.
            Once the timeline begins, the player will begin playback from the
            seeked time.
          </p>
        </div></section>
        <section class="informative" id="introduction-to-pausing">
          <h5><span class="secno">3.5.2.2 </span>Introduction to pausing</h5><div class="informative-bg"><p><em>This section is non-normative.</em></p>
          <p>
            Pausing can be used to temporarily suspend a <a href="#dfn-player" class="internalDFN">player</a>.
            Like seeking, pausing controls the <a href="#dfn-current-time" class="internalDFN">current time</a> of
            a player by updating its <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start
            time</a>.
            The result is illustrated below.
          </p>
          <div class="figure">
            <img src="img/pausing.svg" width="600" alt="The effect of pausing a player.">
          </div>
          <p class="caption">
            The effect of pausing a <a href="#dfn-player" class="internalDFN">player</a>.<br>
            Whether pausing before or after a <a href="#dfn-player" class="internalDFN">player</a>'s <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a>,
            the <a href="#dfn-player" class="internalDFN">player</a>'s <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a> is
            delayed by the duration of the interval during which it was paused.
          </p>
        </div></section>
        <section class="informative" id="limiting-the-current-time">
          <h5><span class="secno">3.5.2.3 </span>Limiting the current time</h5><div class="informative-bg"><p><em>This section is non-normative.</em></p>
          <p>
            Players in the real world such as DVD players or cassette players
            typically continue playing until they reach the end of their media
            at which point they stop.
            If such players are able to play in reverse, they typically stop
            playing when they reach the beginning of their media.
            In order to emulate this behavior and to provide consistency
            with HTML's <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-elements">media
            elements</a> [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>], the <a href="#dfn-current-time" class="internalDFN">current time</a> of Web Animations'
            players do not play forwards beyond the <a href="#dfn-end-time" class="internalDFN">end time</a> of their
            <a href="#dfn-source-content" class="internalDFN">source content</a> or play backwards past time zero.
            This behavior is called <em>limiting</em>.
          </p>
          <p>
            Graphically, the effect of limiting is shown below.
          </p>
          <div class="figure">
            <img src="img/limiting.svg" width="500" alt="The effect of pausing a player.">
          </div>
          <p class="caption">
            The effect of limiting on a <a href="#dfn-player" class="internalDFN">player</a> with a start time of 1s,
            a source content of length 3s, and a positive <a href="#dfn-player-playback-rate" class="internalDFN">player playback
            rate</a>.
            After the <a href="#dfn-current-time" class="internalDFN">current time</a> of the player reaches the end of the
            source content, it is capped at 3s.
          </p>
          <p>
            It is possible, however, to <em>seek</em> the <a href="#dfn-current-time" class="internalDFN">current time</a> of
            a <a href="#dfn-player" class="internalDFN">player</a> to a time past the end of the <a href="#dfn-source-content" class="internalDFN">source content</a>.
            When doing so, the <a href="#dfn-current-time" class="internalDFN">current time</a> will not progress but the
            player will act as if it had been paused at the seeked time.
          </p>
          <p>
            This allows, for example, seeking the <a href="#dfn-current-time" class="internalDFN">current time</a> of
            a player with <em>no</em> <a href="#dfn-source-content" class="internalDFN">source content</a> to 5s.
            If <a href="#dfn-source-content" class="internalDFN">source content</a> with an <a href="#dfn-end-time" class="internalDFN">end time</a> later than 5s is
            later associated with the player, playback will begin from the 5s
            mark.
          </p>
          <p>
            Similar behavior to the above scenarios may arise when the
            length of a player's <a href="#dfn-source-content" class="internalDFN">source content</a> changes.
          </p>
          <p>
            When the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> is negative, the <a href="#dfn-current-time" class="internalDFN">current
            time</a> does not progress past time zero although it may be seeked
            to a negative time.
          </p>
          <p>
            Limiting the <a href="#dfn-current-time" class="internalDFN">current time</a> acts like a sort of automatic
            pausing and is accomplished using the same machinery as pausing.
          </p>
        </div></section>
        <section id="seeking--pausing-and-limiting-properties">
          <h5><span class="secno">3.5.2.4 </span>Seeking, pausing and limiting properties</h5>
          <p>
            <a href="#dfn-player" class="internalDFN">Players</a> track two properties related to seeking,
            pausing and limiting.
          </p>
          <dl>
            <dt><dfn id="dfn-paused-state">paused state</dfn></dt>
            <dd>
              A boolean value that is true if the player is currently paused.
              The <a href="#dfn-paused-state" class="internalDFN">paused state</a> is initially false.
            </dd>
            <dt><dfn id="dfn-hold-time">hold time</dfn></dt>
            <dd>
              The <a href="#dfn-effective-current-time" class="internalDFN">effective current time</a> to maintain while the player is
              paused or effectively paused either because it has reached the end
              of its <a href="#dfn-source-content" class="internalDFN">source content</a> and is <a href="#dfn-limited" class="internalDFN">limited</a>, or because it
              has a zero <a>playback rate</a>.
              When none of these conditions apply, the <a href="#dfn-hold-time" class="internalDFN">hold time</a> is
              null.
              The <a href="#dfn-hold-time" class="internalDFN">hold time</a> is initially null.
            </dd>
          </dl>
          <p>
            In addition to these properties, implementations are required to
            keep track of the last calculated value of the <a href="#dfn-current-time" class="internalDFN">current time</a>
            in order to produce correct limiting behavior (see <a href="#automatically-updating-the-hold-time" class="sectionRef">section 3.5.2.7 Automatically updating the hold time</a>).
          </p>
        </section>
        <section id="calculating-the-player-start-time">
          <h5><span class="secno">3.5.2.5 </span>Calculating the player start time</h5>
          <p>
            The <a href="#dfn-player-start-time" class="internalDFN">player start time</a> value is both a stored and
            a calculated value.
            When a player is paused, the value is calculated from the <a href="#dfn-hold-time" class="internalDFN">hold
            time</a>.
            When a player is not paused, the stored value is used.
          </p>
          <p>
            The value of the <a href="#dfn-player-start-time" class="internalDFN">player start time</a> at a given moment is
            based on the <a href="#dfn-paused-state" class="internalDFN">paused state</a> as follows:
          </p>
          <dl class="switch">
            <dt>If the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is true,</dt>
            <dd>
              Return the result of evaluating
              <code><var>effective timeline time</var>
              - <a href="#dfn-hold-time" class="internalDFN">hold time</a> / <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a></code>.<br>
              If <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> is zero, return negative infinity.
            </dd>
            <dt>Otherwise,</dt>
            <dd>
              Return the stored value for the <a href="#dfn-player-start-time" class="internalDFN">player start time</a>.
            </dd>
          </dl>
        </section>
        <section id="updating-the-player-start-time">
          <h5><span class="secno">3.5.2.6 </span>Updating the player start time</h5>
          <p>
            The <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a> of a <a href="#dfn-player" class="internalDFN">player</a>
            is updated to a new time, <var>new start time</var>, as follows:
          </p>
          <dl class="switch">
            <dt>If the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is true,</dt>
            <dd>Let the <a href="#dfn-hold-time" class="internalDFN">hold time</a> be the result of evaluating
                <code><var>timeline time</var> - <var>new start time</var>
                &#xd7; <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a></code>.</dd>
            <dt>Otherwise,</dt>
            <dd>
              <ol>
                <li>Let the stored value of <a href="#dfn-player-start-time" class="internalDFN">player start time</a> be <var>new
                    start time</var>.
                </li><li>Set the <a href="#dfn-hold-time" class="internalDFN">hold time</a> to null.
              </li></ol>
            </dd>
          </dl>
        </section>
        <section id="automatically-updating-the-hold-time">
          <h5><span class="secno">3.5.2.7 </span>Automatically updating the hold time</h5>
          <p>
            The <a href="#dfn-hold-time" class="internalDFN">hold time</a> is updated prior to each time the <a href="#dfn-current-time" class="internalDFN">current
            time</a> is calculated when <em>all</em> of the following conditions
            are true:
          </p>
          <ul>
            <li>the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is false, and
            </li><li>the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> is not zero, and
            </li><li>the <a href="#dfn-timeline" class="internalDFN">timeline</a> is <a title="not started" href="#dfn-not-started" class="internalDFN">started</a>.
          </li></ul>
          <p>
            When all the above conditions are satisfied, the following steps are
            performed:
          </p>
          <ol>
            <li>Let the <dfn id="dfn-unlimited-current-time">unlimited current time</dfn> be the result of
                evaluating the <a href="#dfn-current-time" class="internalDFN">current time</a> using a <a href="#dfn-hold-time" class="internalDFN">hold time</a> of
                null.
            </li><li>Let the <dfn id="dfn-source-content-end">source content end</dfn> be the <a href="#dfn-end-time" class="internalDFN">end time</a>
                of the player's <a href="#dfn-source-content" class="internalDFN">source content</a>.
                If the player has no <a href="#dfn-source-content" class="internalDFN">source content</a>, let the
                <em>source content end</em> be zero.
            </li><li>The <a href="#dfn-hold-time" class="internalDFN">hold time</a> is updated using the first matching
                condition from below:
              <dl class="switch">
                <dt>If the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &lt; 0 and
                    the <a href="#dfn-unlimited-current-time" class="internalDFN">unlimited current time</a> &#x2264; 0,</dt>
                <dd>
                  Let the <a href="#dfn-hold-time" class="internalDFN">hold time</a> be zero.
                </dd>
                <dt>If the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &gt; 0 and
                    the <a href="#dfn-unlimited-current-time" class="internalDFN">unlimited current time</a> &#x2265; <a href="#dfn-source-content-end" class="internalDFN">source content
                    end</a>,</dt>
                <dd>
                  Let the <a href="#dfn-hold-time" class="internalDFN">hold time</a> be the maximum value of
                  the last calculated value of <a href="#dfn-current-time" class="internalDFN">current time</a>
                  and <a href="#dfn-source-content-end" class="internalDFN">source content end</a>.
                  If there is no previously calculated value of <a href="#dfn-current-time" class="internalDFN">current
                  time</a> or it is null,
                  let the <a href="#dfn-hold-time" class="internalDFN">hold time</a> be <a href="#dfn-source-content-end" class="internalDFN">source content end</a>.
                </dd>
                <dt>Otherwise,</dt>
                <dd>
                  <ol>
                    <li>If the <a href="#dfn-hold-time" class="internalDFN">hold time</a> is not null,
                        set the stored value of the <a href="#dfn-player-start-time" class="internalDFN">player start time</a>
                        to the result of evaluating <code><var>timeline
                        time</var> - <a href="#dfn-hold-time" class="internalDFN">hold time</a>
                        / <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a></code>.
                    </li><li>Let the <a href="#dfn-hold-time" class="internalDFN">hold time</a> be null.
                  </li></ol>
                </dd>
              </dl>
            </li>
          </ol>
        </section>
        <section id="updating-the-paused-state">
          <h5><span class="secno">3.5.2.8 </span>Updating the paused state</h5>
          <p>
            The procedure for updating the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is as
            follows:
          </p>
          <ol>
            <li>
              Let <var>new value</var> be the new paused state to set.
            </li>
            <li>
              If <var>new value</var> equals the current <a href="#dfn-paused-state" class="internalDFN">paused state</a>,
              abort this procedure.
            </li>
            <li>
              The next step depends on the current <a href="#dfn-paused-state" class="internalDFN">paused state</a> as
              follows,
              <dl class="switch">
                <dt>If <a href="#dfn-paused-state" class="internalDFN">paused state</a> is true and the <a href="#dfn-player" class="internalDFN">player</a> is not
                    <a href="#dfn-limited" class="internalDFN">limited</a>,</dt>
                <dd>
                  <ol>
                    <li>Set the <em>stored</em> value of <a href="#dfn-player-start-time" class="internalDFN">player start
                        time</a> to the <em>current calculated</em> value of
                        <a href="#dfn-player-start-time" class="internalDFN">player start time</a> as
                        defined in <a href="#calculating-the-player-start-time" class="sectionRef">section 3.5.2.5 Calculating the player start time</a>.
                    </li><li>Set the <a href="#dfn-hold-time" class="internalDFN">hold time</a> to null.
                  </li></ol>
                </dd>
                <dt>Otherwise if the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is false,</dt>
                <dd>
                  Record the current value of the <a href="#dfn-effective-current-time" class="internalDFN">effective current time</a>
                  as <a href="#dfn-hold-time" class="internalDFN">hold time</a>.
                </dd>
                <dt>Otherwise,</dt>
                <dd>
                  Do nothing.
                </dd>
              </dl>
            </li>
            <li>
              Update <a href="#dfn-paused-state" class="internalDFN">paused state</a> to <var>new value</var>.
            </li>
          </ol>
        </section>
        <section id="performing-a-seek">
          <h5><span class="secno">3.5.2.9 </span>Performing a seek</h5>
          <p>
            <dfn id="dfn-seeking">Seeking</dfn> is the process of updating a player's <a href="#dfn-current-time" class="internalDFN">current
            time</a> to a desired value.
            It is achieved using the following procedure:
          </p>
          <ol>
            <li>Let <var>seek time</var> be the desired <a href="#dfn-time-value" class="internalDFN">time value</a> for
                the player's <a href="#dfn-current-time" class="internalDFN">current time</a>.
            </li><li>If <em>any</em> of the following conditions are true:
              <ul>
                <li>the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is true, or
                </li><li>the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &gt; 0 and <var>seek
                    time</var> &#x2265; <a href="#dfn-source-content-end" class="internalDFN">source content end</a>
                    (as defined in <a href="#automatically-updating-the-hold-time" class="sectionRef">section 3.5.2.7 Automatically updating the hold time</a>), or
                </li><li>the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &lt; 0 and <var>seek
                    time</var> &#x2264; zero, or
                </li><li>the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> = 0
              </li></ul>
                then set <a href="#dfn-hold-time" class="internalDFN">hold time</a> to <var>seek time</var>.
           </li><li>If <em>all</em> of the following are true:
              <ul>
                <li>the <a href="#dfn-paused-state" class="internalDFN">paused state</a> is false, and
                </li><li>the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> is not zero
              </li></ul>
                then:
              <ol>
                <li>Reset the <a href="#dfn-hold-time" class="internalDFN">hold time</a> to null.
                </li><li>Set the stored value of <a href="#dfn-player-start-time" class="internalDFN">player start time</a>
                    to the result of evaluating <code><var>effective timeline
                    time</var> - <var>seek time</var> / <a href="#dfn-player-playback-rate" class="internalDFN">player
                    playback rate</a></code>.
                </li><li>Set the player's <a href="#dfn-finished-flag" class="internalDFN">finished flag</a> to false.
              </li></ol>
          </li></ol>
          <p>
            Since <a href="#dfn-seeking" class="internalDFN">seeking</a> effectively updates the player's <a href="#dfn-current-time" class="internalDFN">current
            time</a> it also causes the &#x201c;previously calculated value of
            <a href="#dfn-current-time" class="internalDFN">current time</a>&#x201d; as used by the procedure for updating the
            <a href="#dfn-hold-time" class="internalDFN">hold time</a> to be updated (see <a href="#automatically-updating-the-hold-time" class="sectionRef">section 3.5.2.7 Automatically updating the hold time</a>).
          </p>
        </section>
        <section id="limited-players">
          <h5><span class="secno">3.5.2.10 </span>Limited players</h5>
          <p>
            A <a href="#dfn-player" class="internalDFN">player</a> is said to be <dfn id="dfn-limited">limited</dfn> when either of the
            following conditions are true:
          </p>
          <ol>
            <li><a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &gt; 0 and <a href="#dfn-effective-current-time" class="internalDFN">effective current
                time</a> &#x2265; the player's <a href="#dfn-source-content-end" class="internalDFN">source content end</a>
                (as defined in <a href="#automatically-updating-the-hold-time" class="sectionRef">section 3.5.2.7 Automatically updating the hold time</a>), or
            </li><li><a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &lt; 0 and <a href="#dfn-effective-current-time" class="internalDFN">effective current
                time</a> &#x2264; zero.
          </li></ol>
        </section>
      </section>
      <section id="speed-control">
        <h4><span class="secno">3.5.3 </span>Speed control</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            The rate of play of a player can be controlled by setting its
            <em>playback rate</em>.
            For example, setting a playback rate of 2 will cause the player's
            <a href="#dfn-current-time" class="internalDFN">current time</a> to increase at twice the rate of its
            <a href="#dfn-timeline" class="internalDFN">timeline</a>.
            Similarly, a playback rate of -1 will cause the player's <a href="#dfn-current-time" class="internalDFN">current
            time</a> to decrease at the same rate as the <a href="#dfn-time-value" class="internalDFN">time values</a> from
            its <a href="#dfn-timeline" class="internalDFN">timeline</a> increase.
          </p>
          <p>
            Note that <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> also have a <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a> associated
            with them that behaves differently to that defined here.
          </p>
        </div>
        <p>
          <a href="#dfn-player" class="internalDFN">Players</a> have a <dfn title="player playback
          rate" id="dfn-player-playback-rate">playback rate</dfn> that provides a scaling factor from the rate
          of change of the associated <a href="#dfn-timeline" class="internalDFN">timeline</a>'s <a href="#dfn-time-value" class="internalDFN">time values</a> to
          the player's <a href="#dfn-current-time" class="internalDFN">current time</a>.
          The <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> is initially 1.
        </p>
        <p>
          Setting a player's <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a>
          to zero effectively pauses the player but without affecting the
          player's <a href="#dfn-paused-state" class="internalDFN">paused state</a>.
        </p>
        <section id="updating-the-playback-rate">
          <h5><span class="secno">3.5.3.1 </span>Updating the playback rate</h5>
          <p>
            Changes to the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a>
            trigger a compensatory seek so that that the player's
            <a href="#dfn-current-time" class="internalDFN">current time</a> is unaffected by the change to the playback
            rate.
          </p>
          <p>
            The procedure is as follows:
          </p>
          <ol>
            <li>Let <var>previous time</var> be the value of the <a href="#dfn-effective-current-time" class="internalDFN">effective
                current time</a> before updating the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a>.</li>
            <li>Update the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> to
                the new value.</li>
            <li>Seek to <var>previous time</var> using the procedure defined in
                <a href="#performing-a-seek" class="sectionRef">section 3.5.2.9 Performing a seek</a>.</li>
            <li>If the new value for the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> differs in sign
                to the previous non-zero playback rate, set the <a href="#dfn-finished-flag" class="internalDFN">finished
                flag</a> to false.
          </li></ol>
        </section>
      </section>
      <section id="player-events">
        <h4><span class="secno">3.5.4 </span>Player events</h4>
        <p>
          As <a href="#dfn-player" class="internalDFN">players</a> play they report changes to
          their status through <dfn title="player event" id="dfn-player-event">player events</dfn>.
        </p>
        <p>
          <a href="#dfn-player-event" class="internalDFN">Player events</a> are a property of the Web Animations timing
          model.
          As a result they are dispatched even when the <a href="#dfn-source-content" class="internalDFN">source content</a> of
          the player is absent or has no observable result.
        </p>
        <section id="types-of-player-events">
          <h5><span class="secno">3.5.4.1 </span>Types of player events</h5>
            <dl>
            <dt><dfn title="finish player event" id="dfn-finish-player-event">finish</dfn></dt>
            <dd>
              <p>
                Queued whenever a sample occurs that causes a <a href="#dfn-player" class="internalDFN">player</a>'s
                <a href="#dfn-finished-flag" class="internalDFN">finished flag</a> to be newly true.
              </p>
              <ul>
                <li>Bubbles: no</li>
                <li>Cancelable: no</li>
                <li>Context Info: currentTime, documentTime</li>
              </ul>
            </dd>
          </dl>
          <p>
            To assist dispatching <a title="finish player event" href="#dfn-finish-player-event" class="internalDFN">finish
            events</a>, <a href="#dfn-player" class="internalDFN">players</a> maintain a <dfn id="dfn-finished-flag">finished flag</dfn> that
            is initially false when the player is created.
          </p>
          <p>
            During each <a href="#dfn-sample" class="internalDFN">sample</a>, the <a href="#dfn-finished-flag" class="internalDFN">finished flag</a> is updated such
            that it is set to true if the player is <a href="#dfn-limited" class="internalDFN">limited</a> and false
            otherwise.
          </p>
        </section>
        <section id="event-parameters">
          <h5><span class="secno">3.5.4.2 </span>Event parameters</h5>
          <p>
            <a href="#dfn-player-event" class="internalDFN">Player events</a> have an associated <a href="#dfn-event-current-time" class="internalDFN">event
            current time</a> and <a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>.
          </p>
          <p>
            The <dfn id="dfn-event-current-time">event current time</dfn> is the <a href="#dfn-current-time" class="internalDFN">current time</a> of the
            <a href="#dfn-player" class="internalDFN">player</a> that generated the event at the moment the event is
            queued.
            This will be null if the <a href="#dfn-player" class="internalDFN">player</a> was not associated with
            a <a href="#dfn-timeline" class="internalDFN">timeline</a> at the time the event was generated.
          </p>
          <p>
            The <dfn id="dfn-event-timeline-time">event timeline time</dfn> is the <a href="#dfn-time-value" class="internalDFN">time value</a> of the
            <a href="#dfn-timeline" class="internalDFN">timeline</a> with which the <a href="#dfn-player" class="internalDFN">player</a> that generated the
            event is associated at the moment the event is queued.
            This will be null if the <a href="#dfn-player" class="internalDFN">player</a> was not associated with
            a <a href="#dfn-timeline" class="internalDFN">timeline</a> at the time the event was generated.
          </p>
        </section>
        <section id="propagation-path">
          <h5><span class="secno">3.5.4.3 </span>Propagation path</h5>
          <p>
            The <a href="http://www.w3.org/TR/DOM-Level-3-Events/#glossary-propagation-path">propagation
            path</a> for a <a href="#dfn-player-event" class="internalDFN">player event</a> generated by <var>player</var>,
            is simply <var>player</var> itself.
          </p>
        </section>
        <section id="sequence-of-events">
          <h5><span class="secno">3.5.4.4 </span>Sequence of events</h5>
          <p>
            The sequence in which <a href="#dfn-player-event" class="internalDFN">player events</a> are queued is in
            ascending order by <a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>.
            If two <a href="#dfn-player-event" class="internalDFN">player events</a> have the same <a>event document
            time</a>, the <a href="#dfn-player-event" class="internalDFN">player events</a> are queued in ascending order by
            <a href="#dfn-player-sequence-number" class="internalDFN">player sequence number</a> of the <a href="#dfn-player" class="internalDFN">players</a> that generated
            the events.
          </p>
        </section>
        <section id="event-dispatch">
          <h5><span class="secno">3.5.4.5 </span>Event dispatch</h5>
          <p>
            <dfn id="dfn-events-are-queued">Events are queued</dfn> whenever <a href="#dfn-sampling" class="internalDFN">sampling</a> regularly
            occurs (that is, <em>not</em> when the timing model is evaluated due
            to <a href="#dfn-seeking" class="internalDFN">seeking</a> or structural changes to the hierarchy of
            <a href="#dfn-animation-node" class="internalDFN">animation nodes</a>).
          </p>
          <p>
            As a result, <a href="#dfn-seeking" class="internalDFN">seeking</a> a <a href="#dfn-player" class="internalDFN">player</a> to the limit of its
            <a href="#dfn-source-content" class="internalDFN">source content</a> and back to a point within its <a href="#dfn-source-content" class="internalDFN">source
            content</a> within the same script execution block will <em>not</em>
            trigger a <a title="finish player event" href="#dfn-finish-player-event" class="internalDFN">finish</a> event.
          </p>
        </section>
      </section>
    </section>

    <section id="animation-nodes">
      <h3><span class="secno">3.6 </span>Animation nodes</h3>
      <p>
        An <dfn id="dfn-animation-node">animation node</dfn> is an abstract term referring to an item in
        the timing hierarchy.
      </p>
      <section id="relationship-between-animation-nodes-and-players">
        <h4><span class="secno">3.6.1 </span>Relationship between animation nodes and players</h4>
        <p>
          The <a href="#dfn-source-content" class="internalDFN">source content</a> of a <a href="#dfn-player" class="internalDFN">player</a>, if set, is a type of
          <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
          The <a href="#dfn-source-content" class="internalDFN">source content</a> of a <a href="#dfn-player" class="internalDFN">player</a> is said to be <dfn title="directly associated with a player" id="dfn-directly-associated-with-a-player">directly associated</dfn>
          with that player.
        </p>
        <p>
          <a href="#dfn-animation-node" class="internalDFN">Animation nodes</a> can be combined together into a hierarchy using
          <a href="#dfn-animation-group" class="internalDFN">animation groups</a> (see <a href="#grouping-and-synchronization" class="sectionRef">section 3.13 Grouping and synchronization</a>).
          Only the <a href="#dfn-root" class="internalDFN">root</a> <a href="#dfn-animation-node" class="internalDFN">animation node</a> of such a hierarchy can be
          <a href="#dfn-directly-associated-with-a-player" class="internalDFN">directly associated with a player</a>.
          If an <a href="#dfn-animation-node" class="internalDFN">animation node</a> that has a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>
          is designated as the <a href="#dfn-source-content" class="internalDFN">source content</a> of a <a href="#dfn-player" class="internalDFN">player</a>, the
          <a href="#dfn-animation-node" class="internalDFN">animation node</a> is removed from its <a href="#dfn-parent-animation-group" class="internalDFN">parent animation
          group</a> before being associated with the <a href="#dfn-player" class="internalDFN">player</a>.
        </p>
        <p>
          An <a href="#dfn-animation-node" class="internalDFN">animation node</a> is <dfn id="dfn-associated-with-a-player">associated with a player</dfn> if it
          is <a href="#dfn-directly-associated-with-a-player" class="internalDFN">directly associated with a player</a> or if it has an
          <a href="#dfn-ancestor" class="internalDFN">ancestor</a> <a href="#dfn-animation-group" class="internalDFN">animation group</a> that is <a href="#dfn-directly-associated-with-a-player" class="internalDFN">directly associated
          with a player</a>.
          At a given moment, an <a href="#dfn-animation-node" class="internalDFN">animation node</a> can be <a title="associated with a player" href="#dfn-associated-with-a-player" class="internalDFN">associated</a> with at most one
          <a href="#dfn-player" class="internalDFN">player</a>.
        </p>
        <p>
          An <a href="#dfn-animation-node" class="internalDFN">animation node</a>, <var>node</var>, is <dfn id="dfn-associated-with-a-timeline">associated with
          a timeline</dfn>, <var>timeline</var>, if <var>node</var> is
          <a href="#dfn-associated-with-a-player" class="internalDFN">associated with a player</a> which, in turn, is associated with
          <var>timeline</var>.
        </p>
      </section>
      <section id="types-of-animation-nodes">
        <h4><span class="secno">3.6.2 </span>Types of animation nodes</h4>
        <p>
          This specification defines two types of <a href="#dfn-animation-node" class="internalDFN">animation nodes</a>:
        </p>
        <ul>
          <li><a href="#dfn-animation" class="internalDFN">animations</a>, and</li>
          <li><a href="#dfn-animation-group" class="internalDFN">animation groups</a>.</li>
        </ul>
        <p>
          All types of <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> define a number of common
          properties which are described in the following sections.
        </p>
      </section>
      <section id="the-active-interval">
        <h4><span class="secno">3.6.3 </span>The active interval</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            The period that an <a href="#dfn-animation-node" class="internalDFN">animation node</a> is scheduled to run is
            called its <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            Each <a href="#dfn-animation-node" class="internalDFN">animation node</a> has only one such interval.
          </p>
          <p>
            The lower bound of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> is determined by the
            <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> of the
            <a href="#dfn-animation-node" class="internalDFN">animation node</a> but may be shifted by a <a href="#dfn-start-delay" class="internalDFN">start delay</a> on
            the <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
          </p>
          <p>
            The upper bound of the interval is determined by the <a href="#dfn-active-duration" class="internalDFN">active
            duration</a>.
          </p>
          <p>
            The relationship between the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a>, <a href="#dfn-start-delay" class="internalDFN">start
            delay</a>, and <a href="#dfn-active-duration" class="internalDFN">active duration</a> is illustrated below.
          </p>
          <div class="figure">
            <img src="img/active-interval-examples.svg" width="600" alt="Examples of the effect of the start delay on the endpoints
                    of the active interval">
          </div>
          <p class="caption">
            Examples of the effect of the <a href="#dfn-start-delay" class="internalDFN">start delay</a> on the endpoints of
            the <a href="#dfn-active-interval" class="internalDFN">active interval</a>.<br>
            (a) An animation node with no delay; the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> and beginning of
            the <a href="#dfn-active-interval" class="internalDFN">active interval</a> are coincident.<br>
            (b) An animation node with a positive delay; the beginning of the
            <a href="#dfn-active-interval" class="internalDFN">active interval</a> is deferred by the delay.<br>
            (c) An animation node with a negative delay; the beginning of the
            <a href="#dfn-active-interval" class="internalDFN">active interval</a> is brought forward by the delay.
          </p>
          <p>
            An <a href="#dfn-end-delay" class="internalDFN">end delay</a> may also be specified but is primarily only of
            use when sequencing animations such as by using a <a>sequence
            animation group</a>.
          </p>
        </div>
        <p>
          <a href="#dfn-animation-node" class="internalDFN">Animation nodes</a> define an <dfn id="dfn-active-interval">active interval</dfn> which is
          the period of time during which the node is scheduled to produce its
          effect with the exception of <a href="#dfn-fill-mode" class="internalDFN">fill modes</a> which apply outside the
          <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
        </p>
        <p>
          The lower bound of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> is defined by the
          combination of the animation node's <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> and <a href="#dfn-start-delay" class="internalDFN">start
          delay</a>.
        </p>
        <p>
          An <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <dfn title="animation node start time" id="dfn-animation-node-start-time">start time</dfn> is the moment at
          which the <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>,
          if any, has scheduled the <a href="#dfn-animation-node" class="internalDFN">animation node</a> to begin.
          It is expressed in <a href="#dfn-inherited-time" class="internalDFN">inherited time</a>.
          In most cases, including the case when the <a href="#dfn-animation-node" class="internalDFN">animation node</a> has
          no <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>,
          the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> is zero.
          The singular exception is <a>sequence animation groups</a> which set
          the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start times</a> of their
          children as described in <a href="#the-start-time-of-children-of-an-animation-sequence" class="sectionRef">section 3.13.4.1 The start time of children of an animation sequence</a>.
        </p>
        <p>
          In addition to the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start
          time</a>, an <a href="#dfn-animation-node" class="internalDFN">animation node</a> also has a <dfn id="dfn-start-delay">start delay</dfn>
          which is an offset from the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a>.
          Unlike the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> which
          is determined by the <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>, the <a href="#dfn-start-delay" class="internalDFN">start
          delay</a> is a property of the <a href="#dfn-animation-node" class="internalDFN">animation node</a> itself.
        </p>
        <p>
          The lower bound of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> of an <a href="#dfn-animation-node" class="internalDFN">animation
          node</a>, expressed in <a title="inherited time" href="#dfn-inherited-time" class="internalDFN">inherited time
          space</a>, is the sum of the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> and the <a href="#dfn-start-delay" class="internalDFN">start
          delay</a>.
        </p>
        <p>
          These definitions are incorporated in the calculation of the <a href="#dfn-local-time" class="internalDFN">local
          time</a> (see <a href="#local-time-and-inherited-time" class="sectionRef">section 3.6.4 Local time and inherited time</a>) and <a href="#dfn-active-time" class="internalDFN">active time</a>.
        </p>
        <p>
          The length of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> is called the <dfn id="dfn-active-duration">active
          duration</dfn>, the calculation of which is defined in <a href="#calculating-the-active-duration" class="sectionRef">section 3.10.2 Calculating the active duration</a>.
        </p>
        <p>
          Similar to the <a href="#dfn-start-delay" class="internalDFN">start delay</a>, an <a href="#dfn-animation-node" class="internalDFN">animation node</a> also has
          an <dfn id="dfn-end-delay">end delay</dfn> which may be used to delay the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> of the <a href="#dfn-next-sibling" class="internalDFN">next
          sibling</a> in a <a>sequence animation group</a>.
        </p>
      </section>
      <section id="local-time-and-inherited-time">
        <h4><span class="secno">3.6.4 </span>Local time and inherited time</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            In Web Animations all times are relative to some point of reference.
            These different points of reference produce different <em>time
            spaces</em>.
          </p>
          <p>
            This can be compared to coordinate spaces as used in computer
            graphics.
            The zero time of a time space is analogous to the origin of
            a coordinate space.
          </p>
          <p>
            Just as with coordinate spaces, time spaces can also be nested.
            <a href="#dfn-animation-group" class="internalDFN">Animation groups</a> typically perform some
            transformations on the <a href="#dfn-time-value" class="internalDFN">time values</a> they
            receive from their <a title="parent animation group" href="#dfn-parent-animation-group" class="internalDFN">parent</a> or
            <a href="#dfn-player" class="internalDFN">player</a> before passing on the transformed <a href="#dfn-time-value" class="internalDFN">time values</a>
            to their children.
            Child <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> then operate <em>within</em> that
            transformed time space.
          </p>
          <p>
            Children take the transformed time values from their
            parent&#x2014;called the <a href="#dfn-inherited-time" class="internalDFN">inherited time</a>&#x2014; and add their
            <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> to establish
            their own <a title="local time" href="#dfn-local-time" class="internalDFN">local time space</a> as illustrated
            below.
          </p>
          <div class="figure">
            <img src="img/local-time.svg" width="600" alt="Inherited time and local time.">
          </div>
          <p class="caption">
            Inherited time and local time.<br>
            At time <var>t</var>, the <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> is 2.5.<br>
            For <a href="#dfn-animation-node" class="internalDFN">animation node</a> (a) which has a <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> of 1, the
              <a href="#dfn-local-time" class="internalDFN">local time</a> is 1.5.<br>
            For <a href="#dfn-animation-node" class="internalDFN">animation node</a> (b) which has a <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> of 1
              and a <a href="#dfn-start-delay" class="internalDFN">start delay</a> of 1,
              the <a href="#dfn-local-time" class="internalDFN">local time</a> is also 1.5
              since <a href="#dfn-local-time" class="internalDFN">local time</a> is based on an <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s
              <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> only,
              and not on its <a href="#dfn-start-delay" class="internalDFN">start delay</a>.
          </p>
        </div>
        <p>
          For an <a href="#dfn-animation-node" class="internalDFN">animation node</a>, the <dfn id="dfn-inherited-time">inherited time</dfn> at
          a given moment is based on the first matching condition from the
          following:
        </p>
        <dl class="switch">
          <dt>If the <a href="#dfn-animation-node" class="internalDFN">animation node</a> has a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation
              group</a>,</dt>
          <dd>
            the inherited time is the <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>'s current
            <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>.
          </dd>
          <dt>If the <a href="#dfn-animation-node" class="internalDFN">animation node</a> is directly associated with
              a <a href="#dfn-player" class="internalDFN">player</a>,</dt>
          <dd>
            the inherited time is the <a href="#dfn-current-time" class="internalDFN">current time</a> of the
            <a href="#dfn-player" class="internalDFN">player</a>.
          </dd>
          <dt>Otherwise,</dt>
          <dd>
            the inherited time is <code>null</code>.
          </dd>
        </dl>
        <p>
          The <dfn id="dfn-local-time">local time</dfn> of an <a href="#dfn-animation-node" class="internalDFN">animation node</a> is the
          <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> minus its <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a>.
          If the <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> is <code>null</code> then the local time
          is also <code>null</code>.
        </p>
      </section>
      <section id="animation-node-phases-and-states">
        <h4><span class="secno">3.6.5 </span>Animation node phases and states</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            At a given moment, an <a href="#dfn-animation-node" class="internalDFN">animation node</a> may be in one of three
            possible <em>phases</em>.
            If an <a href="#dfn-animation-node" class="internalDFN">animation node</a> has a <code>null</code> <a href="#dfn-local-time" class="internalDFN">local
            time</a> it will not be in any phase.
          </p>
          <p>
            The different phases are illustrated below.
          </p>
          <div class="figure">
            <img src="img/animation-node-phases-and-states.svg" width="700" alt="An example of the different phases and states used to
                     describe an animation node.">
          </div>
          <p class="caption">
            An example of the different phases and states used to describe
            an <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
          </p>
          <p>
            The phases are as follows:
          </p>
          <dl>
            <dt><a href="#dfn-before-phase" class="internalDFN">before phase</a></dt>
            <dd>
              The <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> falls before the
              node's <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            </dd>
            <dt><a href="#dfn-active-phase" class="internalDFN">active phase</a></dt>
            <dd>
              The <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> falls inside the
              node's <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            </dd>
            <dt><a href="#dfn-after-phase" class="internalDFN">after phase</a></dt>
            <dd>
              The <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> falls after the
              node's <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            </dd>
          </dl>
          <p>
            In addition to these phases, an <a href="#dfn-animation-node" class="internalDFN">animation node</a> may also be
            described as being in one of several overlapping <em>states</em>.
            These states are only established for the duration of a single
            sample and are primarily a convenience for describing stative parts
            of the model.
          </p>
          <p>
            These states and their useage within the model are summarised as
            follows:
          </p>
          <dl>
            <dt><a href="#dfn-in-play" class="internalDFN">in play</a></dt>
            <dd>
              <p>
                Corresponds to an <a href="#dfn-animation-node" class="internalDFN">animation node</a> whose <a href="#dfn-active-time" class="internalDFN">active time</a>
                is changing on each sample.
                This occurs when the <a href="#dfn-animation-node" class="internalDFN">animation node</a> <em>and all its
                ancestors</em> are in the <a href="#dfn-active-phase" class="internalDFN">active phase</a>.
                <a href="#dfn-animation" class="internalDFN">Animations</a> only &#x201c;move&#x201d; when they are
                <a href="#dfn-in-play" class="internalDFN">in play</a>.
              </p>
              <p>
                It is possible for an <a href="#dfn-animation-node" class="internalDFN">animation node</a> to be in the
                <a href="#dfn-active-phase" class="internalDFN">active phase</a> but not <a href="#dfn-in-play" class="internalDFN">in play</a>.
                For example, if an <a href="#dfn-animation-node" class="internalDFN">animation node</a> has a <a href="#dfn-parent-animation-group" class="internalDFN">parent
                animation group</a> that causes the animation node's <a href="#dfn-active-interval" class="internalDFN">active
                interval</a> to be clipped and both parent and child apply the
                same <a href="#dfn-fill-mode" class="internalDFN">fill mode</a>, the child <a href="#dfn-animation-node" class="internalDFN">animation node</a> may be
                effectively be snapshotted within the <a href="#dfn-active-phase" class="internalDFN">active phase</a>
                despite no longer being <a href="#dfn-in-play" class="internalDFN">in play</a>.
              </p>
            </dd>
            <dt><a href="#dfn-current" class="internalDFN">current</a></dt>
            <dd>
              <p>
                Corresponds to an <a href="#dfn-animation-node" class="internalDFN">animation node</a> that is either <a href="#dfn-in-play" class="internalDFN">in
                play</a> or may become <a href="#dfn-in-play" class="internalDFN">in play</a> in the future.
                This will be the case if the <a href="#dfn-animation-node" class="internalDFN">animation node</a> is <a href="#dfn-in-play" class="internalDFN">in
                play</a> or in its <a href="#dfn-before-phase" class="internalDFN">before phase</a>, <em>or</em> it has an
                ancestor for which this is true thereby opening up the
                possibility that this <a href="#dfn-animation-node" class="internalDFN">animation node</a> might play again
                (e.g.  due to repeating).
              </p>
              <p>
                This state is used in the <a href="#programming-interface">programming interface</a> to
                identify all <a href="#dfn-animation" class="internalDFN">animations</a> and <a href="#dfn-player" class="internalDFN">players</a> that are
                likely to be of interest.
              </p>
              <p>
                Furthermore, the <a href="#dfn-current" class="internalDFN">current</a> state provides an important
                definition for managing the amount of memory required by
                implementations.
                Assuming a monotonically increasing <a href="#dfn-timeline" class="internalDFN">timeline</a> an
                implementation can safely discard all <a href="#dfn-animation-node" class="internalDFN">animation nodes</a>
                that are <em>not</em> <a href="#dfn-current" class="internalDFN">current</a> and not referenced
                elsewhere provided they take care to preserve any fill values.
                This is because such <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> will no longer have
                any dynamic effect.
              </p>
            </dd>
            <dt><a href="#dfn-in-effect" class="internalDFN">in effect</a></dt>
            <dd>
              Corresponds to an <a href="#dfn-animation-node" class="internalDFN">animation node</a> that has a resolved
              <a href="#dfn-active-time" class="internalDFN">active time</a>.
              This occurs when either the <a href="#dfn-animation-node" class="internalDFN">animation node</a> is in its
              <a href="#dfn-active-phase" class="internalDFN">active phase</a> or outside the <a href="#dfn-active-interval" class="internalDFN">active interval</a> but at
              a time where the node's <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> (see <a href="#fill-behavior" class="sectionRef">section 3.7 Fill behavior</a>) causes its
              <a href="#dfn-active-time" class="internalDFN">active time</a> to be resolved.
              Only <a href="#dfn-in-effect" class="internalDFN">in effect</a> <a href="#dfn-animation" class="internalDFN">animations</a> apply a result to
              their target.
            </dd>
          </dl>
          <p>
            The normative definition of each of these states follows.
          </p>
        </div>
        <p>
          An <a href="#dfn-animation-node" class="internalDFN">animation node</a> is in the <dfn id="dfn-before-phase">before phase</dfn> if the
          animation node's <a href="#dfn-local-time" class="internalDFN">local time</a> is not <code>null</code> and is
          less than the node's <a href="#dfn-start-delay" class="internalDFN">start delay</a>.
        </p>
        <p>
          An <a href="#dfn-animation-node" class="internalDFN">animation node</a> is in the <dfn id="dfn-active-phase">active phase</dfn> if
          <em>all</em> of the following conditions are met:
        </p>
        <ol>
          <li>the <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> is not
              <code>null</code>, and
          </li><li>the <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> is <em>greater than
              or equal</em> to its <a href="#dfn-start-delay" class="internalDFN">start delay</a>, and
          </li><li>the <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-local-time" class="internalDFN">local time</a> is <em>less
              than</em> the sum of its <a href="#dfn-start-delay" class="internalDFN">start delay</a> and <a href="#dfn-active-duration" class="internalDFN">active
              duration</a>.
        </li></ol>
        <p>
          An <a href="#dfn-animation-node" class="internalDFN">animation node</a> is in the <dfn id="dfn-after-phase">after phase</dfn> if the
          animation node's <a href="#dfn-local-time" class="internalDFN">local time</a> is not <code>null</code> and is
          <em>greater than or equal</em> to the sum of its <a href="#dfn-start-delay" class="internalDFN">start delay</a>
          and <a href="#dfn-active-duration" class="internalDFN">active duration</a>.
        </p>
        <p>
          An <a href="#dfn-animation-node" class="internalDFN">animation node</a> is <dfn id="dfn-in-play">in play</dfn> if <em>all</em>
          of the following conditions are met:
        </p>
        <ol>
          <li>the <a href="#dfn-animation-node" class="internalDFN">animation node</a> is in the <a href="#dfn-active-phase" class="internalDFN">active phase</a>, and
          </li><li>the <a href="#dfn-animation-node" class="internalDFN">animation node</a> has a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a> that
              is <a href="#dfn-in-play" class="internalDFN">in play</a> or else is <a href="#dfn-directly-associated-with-a-player" class="internalDFN">directly associated with
              a player</a> that is not <a href="#dfn-limited" class="internalDFN">limited</a>.
        </li></ol>
        <p>
          An animation node is <dfn id="dfn-current">current</dfn> if it <em>any</em> of the
          following conditions is true:
        </p>
        <ul>
          <li>it is in the <a href="#dfn-before-phase" class="internalDFN">before phase</a>, or
          </li><li>it is <a href="#dfn-in-play" class="internalDFN">in play</a>, or
          </li><li>it has a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a> and the
              <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a> is <a href="#dfn-current" class="internalDFN">current</a>.
        </li></ul>
        <p>
          An animation node is <dfn id="dfn-in-effect">in effect</dfn> if its <a href="#dfn-active-time" class="internalDFN">active time</a> as
          calculated according to the procedure in <a href="#calculating-the-active-time" class="sectionRef">section 3.10.3.1 Calculating the active time</a> is not
          <code>null</code>.
        </p>
      </section>
    </section>

    <section id="fill-behavior">
      <h3><span class="secno">3.7 </span>Fill behavior</h3>
      <p>
        The effect of an <a href="#dfn-animation-node" class="internalDFN">animation node</a> when it is not <a href="#dfn-in-play" class="internalDFN">in play</a> is
        determined by its <dfn id="dfn-fill-mode">fill mode</dfn>.
      </p>
      <p>
        The possible <a href="#dfn-fill-mode" class="internalDFN">fill modes</a> are:
      </p>
      <ul>
        <li>none,</li>
        <li>forwards,</li>
        <li>backwards, and</li>
        <li>both.</li>
      </ul>
      <p>
        The normative definition of these modes is incorporated in the
        calculation of the <a href="#dfn-active-time" class="internalDFN">active time</a> in <a href="#calculating-the-active-time" class="sectionRef">section 3.10.3.1 Calculating the active time</a>.
      </p>
      <section class="informative" id="fill-modes">
        <h4><span class="secno">3.7.1 </span>Fill modes</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          The effect of each <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> is as follows:
        </p>
        <dl>
          <dt>none</dt>
          <dd>
            The animation node has no effect when it is not <a href="#dfn-in-play" class="internalDFN">in play</a>.
          </dd>
          <dt>forwards</dt>
          <dd>
            When the animation node is in the <a href="#dfn-after-phase" class="internalDFN">after phase</a>,
            or when the animation node is in the <a href="#dfn-active-phase" class="internalDFN">active phase</a> but an
            <a href="#dfn-ancestor" class="internalDFN">ancestor</a> is in its <a href="#dfn-after-phase" class="internalDFN">after phase</a>,
            the animation node will produce the same <a title="transformed time" href="#dfn-transformed-time" class="internalDFN">transformed time value</a> as the last
            moment it is scheduled to be <a href="#dfn-in-play" class="internalDFN">in play</a>.

            For all other times that the animation node is not <a href="#dfn-in-play" class="internalDFN">in play</a>,
            it will have no effect.
          </dd>
          <dt>backwards</dt>
          <dd>
            When the animation node is in the <a href="#dfn-before-phase" class="internalDFN">before phase</a>,
            or when the animation node is in the <a href="#dfn-active-phase" class="internalDFN">active phase</a> but an
            <a href="#dfn-ancestor" class="internalDFN">ancestor</a> is in its <a href="#dfn-before-phase" class="internalDFN">before phase</a>,
            the animation node will produce the same <a title="transformed time" href="#dfn-transformed-time" class="internalDFN">transformed time value</a> as the earliest
            moment that it is scheduled to be <a href="#dfn-in-play" class="internalDFN">in play</a>.

            For all other times that the animation node is not <a href="#dfn-in-play" class="internalDFN">in play</a>,
            it will have no effect.
          </dd>
          <dt>both</dt>
          <dd>
            When the animation node or an <a href="#dfn-ancestor" class="internalDFN">ancestor</a> is in its <a href="#dfn-before-phase" class="internalDFN">before
            phase</a>, <span class="prop-value">backwards</span> fill behavior
            is used.

            When the animation node or an <a href="#dfn-ancestor" class="internalDFN">ancestor</a> is in its <a href="#dfn-after-phase" class="internalDFN">after
            phase</a>, <span class="prop-value">forwards</span> fill behavior is
            used.
          </dd>
        </dl>
        <p>
          Some examples of the these fill modes are illustrated below.
        </p>
        <div class="figure">
          <img src="img/animation-state-and-fill-behavior.svg" width="600" alt="Examples of various fill modes and the states produced.">
        </div>
        <p class="caption">
          Examples of various fill modes and the states produced.<br>
          (a) fill mode &#x2018;none&#x2019;. The animation node has no effect
              outside its active interval.<br>
          (b) fill mode &#x2018;forwards&#x2019;. After the active interval has
              finished, the timed value continues to maintain a fill value.<br>
          (c) fill mode &#x2018;backwards&#x2019;. The animation node produces
              a fill value until the start of the active interval.<br>
          (d) fill mode &#x2018;both&#x2019;. Both before and after the active
              interval the animation node produces a fill value.
        </p> 
        <p class="note">
          Note that setting a fill mode has no bearing on the endpoints of the
          <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          However, the fill mode <em>does</em> have an effect on various other
          properties of the timing model since the <a href="#dfn-active-time" class="internalDFN">active time</a> of an
          animation node is only defined (that is, not <code>null</code>) inside
          the <a href="#dfn-active-interval" class="internalDFN">active interval</a> <em>or</em> when a fill is applied.
        </p>
        <div class="issue">
          <p>
            Currently <a href="#dfn-timing-function" class="internalDFN">timing functions</a> that generate results outside the
            range [0, 1] will behave unexpectedly when applied to animation
            groups, as children will increase iterations or enter into fill mode
            rather than continuing to extrapolate along their defined behavior
            (which is what they would do if the timing function applied to them
            directly).
          </p>
          <p>
            To fix this it is possible we will wish to introduce 'overflow' fill
            modes that respond to time values larger than or smaller than the
            active time range by extrapolating rather than filling.
          </p>
          <p>
            See <a href="http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html">section
            15 (Overflowing fill) of minuted discussion from Tokyo 2013 F2F</a>.
          </p>
        </div>
      </div></section>
    </section>

    <section id="repeating">
      <h3><span class="secno">3.8 </span>Repeating</h3>
      <section id="iteration-intervals">
        <h4><span class="secno">3.8.1 </span>Iteration intervals</h4>
        <p>
          It is possible to specify that an animation node should repeat
          a fixed number of times or indefinitely.
          This repetition occurs <em>within</em> the <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          The span of time during which a single repetition takes place is
          called an <dfn id="dfn-iteration-interval">iteration interval</dfn>.
        </p>
        <p>
          Unlike the <a href="#dfn-active-interval" class="internalDFN">active interval</a>, an animation node can have multiple
          <a href="#dfn-iteration-interval" class="internalDFN">iteration intervals</a> although typically only the interval
          corresponding to the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> is of interest.
        </p>
        <p>
          The length of a single iteration is called the <dfn id="dfn-iteration-duration">iteration
          duration</dfn>.
          The initial <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of an animation node is simply
          its <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a>.
        </p>
        <p>
          The <dfn id="dfn-intrinsic-iteration-duration">intrinsic iteration duration</dfn> of an animation node is
          zero, however some specific types of animation node such as
          <a href="#dfn-animation-group" class="internalDFN">animation groups</a> override this behavior and provide an
          alternative intrinsic duration (see <a href="#the-intrinsic-iteration-duration-of-an-animation-group" class="sectionRef">section 3.13.3 The intrinsic iteration duration of an animation group</a> and <a href="#the-intrinsic-iteration-duration-of-an-animation-sequence" class="sectionRef">section 3.13.4.2 The intrinsic iteration duration of an animation sequence</a>).
        </p>
        <p>
          The <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of an <a href="#dfn-animation-node" class="internalDFN">animation node</a> may be set
          by the author to represent a value other than the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic
          iteration duration</a>.
        </p>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            Comparing the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> and the <a href="#dfn-active-duration" class="internalDFN">active
            duration</a> we have:
          </p>
          <dl>
            <dt>Iteration duration</dt>
            <dd>
              The time taken for a single iteration of the animation node to
              complete.
            </dd>
            <dt>Active duration</dt>
            <dd>
              The time taken for the entire animation node to complete,
              including repetitions.
              This may be longer or shorter than the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>.
            </dd>
          </dl>
          <p>
            The relationship between the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> and <a href="#dfn-active-duration" class="internalDFN">active
            duration</a> is illustrated below.
          </p>
          <div class="figure">
            <img src="img/iteration-intervals.svg" width="600" alt="Comparison of the iteration duration and active time.">
          </div>
          <p class="caption">
            A comparison of the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> and <a href="#dfn-active-duration" class="internalDFN">active
            duration</a> of an animation node with an <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> of
            2.5.
            Note that the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> for the final iteration does
            not change, it is simply cut-off by the <a href="#dfn-active-duration" class="internalDFN">active duration</a>.
          </p>
        </div>
      </section>
      <section id="controlling-iteration">
        <h4><span class="secno">3.8.2 </span>Controlling iteration</h4>
        <p>
          The number of times an <a href="#dfn-animation-node" class="internalDFN">animation node</a> repeats is called its
          <dfn id="dfn-iteration-count">iteration count</dfn>.
          The <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> is a real number greater than or equal to
          zero.
          The <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> may also be positive infinity to represent
          that the <a href="#dfn-animation-node" class="internalDFN">animation node</a> repeats indefinitely.
        </p>
        <p>
          In addition to the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a>, <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> also
          have an <dfn id="dfn-iteration-start">iteration start</dfn> property which specifies an offset
          into the series of iterations at which the <a href="#dfn-animation-node" class="internalDFN">animation node</a>
          should begin.
          The <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> is a finite real number greater than or
          equal to zero.
        </p>
        <p>
          The behavior of these parameters is defined in the calculations in <a href="#core-animation-node-calculations" class="sectionRef">section 3.10 Core animation node calculations</a>.
        </p>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            The effect of the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> and <a href="#dfn-iteration-start" class="internalDFN">iteration start</a>
            parameters is illustrated below.
          </p>
          <div class="figure">
            <img src="img/iteration-count-and-start.svg" width="600" alt="The effect of the iteration count and iteration start
                    parameters">
          </div>
          <p class="caption">
            The effect of the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> and <a href="#dfn-iteration-start" class="internalDFN">iteration start</a>
            parameters.<br>
            In the first case the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> is 2.5 resulting in the
            third iteration being cut-off half way through its <a href="#dfn-iteration-interval" class="internalDFN">iteration
            interval</a>.<br>
            The second case is the same but with an <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> of
            0.5.
            This causes the <a href="#dfn-animation-node" class="internalDFN">animation node</a> to begin half way through the
            first iteration.
          </p>
          <p>
            Unlike the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> parameter, the <a href="#dfn-iteration-start" class="internalDFN">iteration
            start</a> parameter does not effect the length of the <a href="#dfn-active-duration" class="internalDFN">active
            duration</a>.
          </p>
          <p>
            Note that values of <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> greater than or equal to
            one are generally not useful unless used in combination with an
            <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> that has an <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite
            operation</a> of 
            <a title="iteration composite operation accumulate" href="#dfn-iteration-composite-operation-accumulate" class="internalDFN">accumulate</a>.
          </p>
        </div>
      </section>
      <section class="informative" id="iteration-time-space">
        <h4><span class="secno">3.8.3 </span>Iteration time space</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          We have already encountered different time spaces in describing
          <a href="#dfn-local-time" class="internalDFN">local time</a> and <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> (see <a href="#local-time-and-inherited-time" class="sectionRef">section 3.6.4 Local time and inherited time</a>).
          Repetition introduces yet another time space: the iteration time
          space.
        </p>
        <p>
          <em>Iteration time space</em> is a time space whose zero time is the
          beginning of an animation node's current iteration.
        </p>
        <p>
          Within the Web Animations model we also refer to <a href="#dfn-active-time" class="internalDFN">active
          time</a> which is a time relative to the beginning of the active
          interval.
          This time space, however, is internal to the model and not exposed in
          the programming interface or in markup.
        </p>
        <p>
          These time spaces are illustrated below.
        </p>
        <div class="figure">
          <img src="img/time-spaces.svg" width="600" alt="A comparison of local time, active time, and iteration time.">
        </div>
        <p class="caption">
          A comparison of local time, active time, and iteration time for an
          animation with a iteration duration of 1s and an iteration count of
          2.5.
        </p>
        <p class="note">
          Note that while the time spaces themselves are not bounded, Web
          Animations defines <a href="#dfn-active-time" class="internalDFN">active time</a> and <a href="#dfn-iteration-time" class="internalDFN">iteration
          time</a> such that they are clamped to a set range as shown in the
          diagram.
          For example, whilst a time of -1 second is a valid time in
          <em>active time space</em>, the procedure for calculating the
          <a href="#dfn-active-time" class="internalDFN">active time</a> defined in <a href="#calculating-the-active-time" class="sectionRef">section 3.10.3.1 Calculating the active time</a> will
          never return a negative value.
        </p>
        <p>
          In addition to these time spaces we can also refer to the
          <em>document time space</em> which is time space of the <a href="#dfn-time-value" class="internalDFN">time
          values</a> of the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> of the <a href="http://www.w3.org/TR/html5/browsers.html#active-document">active
          document</a>.
        </p>
      </div></section>
      <section class="informative" id="interval-timing">
        <h4><span class="secno">3.8.4 </span>Interval timing</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          When an animation node repeats we must define the behavior at the
          iteration boundaries.
          For this and indeed for all interval-timing, Web Animations uses an
          endpoint-exclusive timing model.
          This means that whilst the begin time of an interval
          is included in the interval, the end time time is not.
          In interval notation this can written <code>[begin, end)</code>.
          This model provides sensible behavior when intervals are repeated and
          sequenced since there is no overlap between the intervals.
        </p>
        <p>
          In the examples below, for the repeated node, at local time 1s,
          the iteration time is 0.
          For the sequenced nodes, at inherited time 1s, only node B will be
          <a href="#dfn-in-play" class="internalDFN">in play</a>; there is no overlap.
        </p>
        <div class="figure">
          <img src="img/endpoint-exclusive-timing.svg" width="600" alt="Illustration of end-point exclusive timing.">
        </div>
        <p class="caption">
          Illustration of end-point exclusive timing. For both repeated and
          sequenced animation nodes there is no overlap at the boundaries
          between intervals.
        </p>
        <p>
          An exception to this behavior is that when performing a <a href="#fill-behavior">fill</a>, if the fill begins at an
          interval endpoint, the endpoint is used.
          This behavior falls out of the algorithm given in <a href="#calculating-the-iteration-time" class="sectionRef">section 3.10.3.3 Calculating the iteration time</a> and is illustrated below.
        </p>
        <div class="figure">
          <img src="img/endpoint-exclusive-timing-and-fill.svg" width="600" alt="Effect of iterations and fill on iteration time.">
        </div>
        <p class="caption">
          After one iteration, the iteration time is 0, but after two iterations
          (and thereonwards), the iteration time is equal to the iteration
          duration due to the special behavior defined when an animation node
          fills.
        </p>
      </div></section>
    </section>

    <section id="animation-node-speed-control">
      <h3><span class="secno">3.9 </span>Animation node speed control</h3>
      <p>
        Like <a href="#dfn-player" class="internalDFN">players</a>, <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> also have a <dfn title="animation node playback rate" id="dfn-animation-node-playback-rate">playback rate</dfn> parameter.
        The <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a> of
        an <a href="#dfn-animation-node" class="internalDFN">animation node</a> is a finite real number that acts as
        a multiplier when calculating the <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-transformed-time" class="internalDFN">transformed
        time</a> from its <a href="#dfn-local-time" class="internalDFN">local time</a>.
      </p>
      <p>
        The effect of setting the <a title="animation node playback
        rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a> of an <a href="#dfn-animation-node" class="internalDFN">animation node</a> differs from the
        setting the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> on
        a player.  Its behavior is defined in the timing calculations given in
        <a href="#core-animation-node-calculations" class="sectionRef">section 3.10 Core animation node calculations</a>.
      </p>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          In summary, the behavior of the <a title="animation node playback
          rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a> of an <a href="#dfn-animation-node" class="internalDFN">animation node</a> is as follows:
        </p>
        <ul>
          <li>
            The <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a> is
            applied only to the <a href="#dfn-active-interval" class="internalDFN">active interval</a> of an <a href="#dfn-animation-node" class="internalDFN">animation
            node</a> and not to the time while it is <a title="start delay" href="#dfn-start-delay" class="internalDFN">delayed</a> or <a title="fill mode" href="#dfn-fill-mode" class="internalDFN">filling</a>.
          </li>
          <li>
            Setting a negative <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback
            rate</a> on an <a href="#dfn-animation-node" class="internalDFN">animation node</a> causes the <a href="#dfn-animation-node" class="internalDFN">animation
            node</a> to begin at the end of its <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            This differs from the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback
            rate</a> on a <a href="#dfn-player" class="internalDFN">player</a>.
            Setting a <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> on
            a <a href="#dfn-player" class="internalDFN">player</a> to a negative value at a moment before the
            <a href="#dfn-player" class="internalDFN">player</a>'s source content has begun, will result in the
            <a href="#dfn-source-content" class="internalDFN">source content</a> never playing.
          </li>
          <li>
            Setting the <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback
            rate</a> of an <a href="#dfn-animation-node" class="internalDFN">animation node</a> affects the calculated value of
            the <a href="#dfn-active-duration" class="internalDFN">active duration</a> (see <a href="#calculating-the-active-duration" class="sectionRef">section 3.10.2 Calculating the active duration</a>).
          </li>
          <li>
            <p>
              Changing the <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback
              rate</a> of an <a href="#dfn-animation-node" class="internalDFN">animation node</a> whose <a href="#dfn-local-time" class="internalDFN">local time</a> is
              within its <a href="#dfn-active-interval" class="internalDFN">active interval</a> will cause it to jump.
              This is because the <a href="#dfn-active-duration" class="internalDFN">active duration</a> will be updated but the
              <a href="#dfn-local-time" class="internalDFN">local time</a> will not.
            </p>
            <p>
              Furthermore, if other <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> depend on the
              <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-active-duration" class="internalDFN">active duration</a>, such as sibling
              <a href="#dfn-animation-node" class="internalDFN">animation node</a> in a <a>sequence animation group</a>, they
              too may jump as a result of setting the <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a>.
            </p>
            <p>
              For runtime speed control the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> of the
              <a href="#dfn-player" class="internalDFN">player</a> should be used.
            </p>
          </li>
        </ul>
      </div>
    </section>

    <section id="core-animation-node-calculations">
      <h3><span class="secno">3.10 </span>Core animation node calculations</h3>
      <section class="informative" id="overview">
        <h4><span class="secno">3.10.1 </span>Overview</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          At the core of the Web Animations timing model is the process that
          takes an <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> value and converts it to an
          <a href="#dfn-iteration-time" class="internalDFN">iteration time</a>.
        </p>
        <p>
          Following this further transformations are applied before resulting at
          a final <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>.
        </p>
        <p>
          The first step in this process is to calculate the bounds of the
          <a href="#dfn-active-interval" class="internalDFN">active interval</a> which is determined by the <a href="#dfn-active-duration" class="internalDFN">active
          duration</a>.
        </p>
        <p>
          This process is illustrated below.
        </p>
        <div class="figure">
          <img src="img/active-duration-calculation.svg" width="650" alt="Calculation of the active duration.">
        </div>
        <p class="caption">
          Calculation of the <a href="#dfn-active-duration" class="internalDFN">active duration</a> is based on
          multiplying the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> by the <a href="#dfn-iteration-count" class="internalDFN">iteration
          count</a> and then dividing by the <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a>.
        </p>
        <p>
          The process for calculating the <a href="#dfn-active-duration" class="internalDFN">active duration</a> is normatively
          defined in <a href="#calculating-the-active-duration" class="sectionRef">section 3.10.2 Calculating the active duration</a>.
        </p>
        <p>
          Having established the <a href="#dfn-active-duration" class="internalDFN">active duration</a>, the process for
          transforming an <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> into its
          <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> is illustrated below.
        </p>
        <div class="figure">
          <img src="img/time-calculations.svg" width="650" alt="An overview of timing model calculations.">
        </div>
        <p class="caption">
          An overview of timing model calculations.<br>
          (1) The <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> is converted into a <a href="#dfn-local-time" class="internalDFN">local time</a> by
          incorporating the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start
          time</a>.<br>
          (2) The <a href="#dfn-local-time" class="internalDFN">local time</a> is converted into an <a href="#dfn-active-time" class="internalDFN">active time</a> by
          incorporating the <a href="#dfn-start-delay" class="internalDFN">start delay</a>.<br>
          (3) The <a>playback rate</a> and <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> properties are
          applied to the <a href="#dfn-active-time" class="internalDFN">active time</a> to produce the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active
          time</a>.<br>
          (4) The <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> is then converted to an offset
          within a single iteration: the <a href="#dfn-iteration-time" class="internalDFN">iteration time</a>.<br>
          (5) The <a href="#dfn-iteration-time" class="internalDFN">iteration time</a> is converted into a <a href="#dfn-directed-time" class="internalDFN">directed time</a>
          by incorporating the <a href="#dfn-playback-direction" class="internalDFN">playback direction</a>.<br>
          (6) Finally, a timing function is applied to the <a href="#dfn-directed-time" class="internalDFN">directed
          time</a> to produce the <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>.
        </p>
        <p>
          The first step, calculating the <a href="#dfn-local-time" class="internalDFN">local time</a> is described in <a href="#local-time-and-inherited-time" class="sectionRef">section 3.6.4 Local time and inherited time</a>.
          Steps 2 to 4 in the diagram are described in the following sections.
          Steps 5 and 6 are described in
          <a href="#calculating-the-directed-time" class="sectionRef">section 3.11.1 Calculating the directed time</a>
          and
          <a href="#calculating-the-transformed-time" class="sectionRef">section 3.12.5 Calculating the transformed time</a>
          respectively.
        </p>
      </div></section>
      <section id="calculating-the-active-duration">
        <h4><span class="secno">3.10.2 </span>Calculating the active duration</h4>
        <p>
          In order to calculate the <a href="#dfn-active-duration" class="internalDFN">active duration</a> we first define the
          <a href="#dfn-repeated-duration" class="internalDFN">repeated duration</a> as follows:
        </p>
        <blockquote>
          <dfn id="dfn-repeated-duration">repeated duration</dfn> =
            <code><a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> &#xd7;
                  <a href="#dfn-iteration-count" class="internalDFN">iteration count</a></code>
            <p>
              If either the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> or <a href="#dfn-iteration-count" class="internalDFN">iteration count</a>
              are zero, the <a href="#dfn-repeated-duration" class="internalDFN">repeated duration</a> is zero.
            </p>
            <p class="note">
              This clarification is needed since the result of infinity
              multiplied by zero is undefined according to IEEE 754-2008.
            </p>
        </blockquote>
        <p>
          The <a href="#dfn-active-duration" class="internalDFN">active duration</a> is calculated according to the following
          steps:
        </p>
        <ol>
          <li>
            If the <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a> is
            zero, return <code>Infinity</code>.
          </li>
          <li>
            Otherwise, return <code><a href="#dfn-repeated-duration" class="internalDFN">repeated duration</a> / abs(<a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a>)</code>.
          </li>
        </ol>
      </section>
      <section id="transforming-the-local-time">
        <h4><span class="secno">3.10.3 </span>Transforming the local time</h4>
        <section id="calculating-the-active-time">
          <h5><span class="secno">3.10.3.1 </span>Calculating the active time</h5>
          <p>
            The <dfn id="dfn-active-time">active time</dfn> is based on the <a href="#dfn-local-time" class="internalDFN">local time</a>
            and <a href="#dfn-start-delay" class="internalDFN">start delay</a>.
            However, it is only defined when the <a href="#dfn-animation-node" class="internalDFN">animation node</a> should
            produce an output and hence depends on its <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> and
            phase as well as the phase of its <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>, if
            any, as follows,
          </p>
          <dl class="switch">
            <dt>If the animation node is in the <a href="#dfn-before-phase" class="internalDFN">before phase</a>,</dt>
            <dd>
              The result depends on the first matching condition from the
              following,
              <dl class="switch">
                <dt>If the animation node has a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>
                    and that parent animation group is in the <a href="#dfn-after-phase" class="internalDFN">after
                    phase</a>,</dt>
                <dd>
                  Return <code>null</code>.
                </dd>
                <dt>If the <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> is <span class="prop-mode">backwards</span> or <span class="prop-mode">both</span>,</dt>
                <dd>Return zero.</dd>
                <dt>Otherwise,</dt>
                <dd>Return <code>null</code>.</dd> 
              </dl>
            </dd>
            <dt>If the animation node is in the <a href="#dfn-active-phase" class="internalDFN">active phase</a>,</dt>
            <dd>
              The result depends on the first matching condition from the
              following,
              <dl class="switch">
                <dt>If the animation node has a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>
                    and that parent animation group is in the <a href="#dfn-before-phase" class="internalDFN">before
                    phase</a>, and the <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> of this animation node
                    is <span class="prop-value">none</span> or <span class="prop-value">forwards,</span></dt>
                <dd>
                  Return <code>null</code>.
                </dd>
                <dt>If the animation node has a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>
                    and that parent animation group is in the <a href="#dfn-after-phase" class="internalDFN">after
                    phase</a>, and the <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> of this animation node
                    is <span class="prop-value">none</span> or <span class="prop-value">backwards,</span></dt>
                <dd>
                  Return <code>null</code>.
                </dd>
                <dt>Otherwise,</dt>
                <dd>
                  Return <code><a href="#dfn-local-time" class="internalDFN">local time</a> - <a href="#dfn-start-delay" class="internalDFN">start delay</a></code>.
                </dd>
              </dl>
            </dd>
            <dt>If the animation node is in the <a href="#dfn-after-phase" class="internalDFN">after phase</a>,</dt>
            <dd>
              The result depends on the first matching condition from the
              following,
              <dl class="switch">
                <dt>If the animation node has a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>
                    and that parent animation group is in the <a href="#dfn-before-phase" class="internalDFN">before
                    phase</a>,</dt>
                <dd>
                  Return <code>null</code>.
                </dd>
                <dt>If the <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> is <span class="prop-mode">forwards</span> or <span class="prop-mode">both</span>,</dt>
                <dd>Return the <a href="#dfn-active-duration" class="internalDFN">active duration</a>.</dd>
                <dt>Otherwise,</dt>
                <dd>Return <code>null</code>.</dd> 
              </dl>
            </dd>
            <dt>Otherwise (the <a href="#dfn-local-time" class="internalDFN">local time</a> is <code>null</code>),</dt>
            <dd>
              Return <code>null</code>.
            </dd>
          </dl>
        </section>
        <section id="calculating-the-scaled-active-time">
          <h5><span class="secno">3.10.3.2 </span>Calculating the scaled active time</h5>
          <p>
            Before the <a href="#dfn-active-time" class="internalDFN">active time</a> can be converted to an <a href="#dfn-iteration-time" class="internalDFN">iteration
            time</a> we must factor in the <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a> and
            <a href="#dfn-iteration-start" class="internalDFN">iteration start</a>.
            The result is called the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a>.
          </p>
          <p>
            In order to calculate the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> we first
            define the <a href="#dfn-start-offset" class="internalDFN">start offset</a> as follows:
          </p>
          <blockquote>
            <dfn id="dfn-start-offset">start offset</dfn> =
              <code><a href="#dfn-iteration-start" class="internalDFN">iteration start</a> &#xd7;
                    <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a></code>
              <p>
                If the <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> is zero, the <a href="#dfn-start-offset" class="internalDFN">start offset</a>
                is zero.
              </p>
              <p class="note">
                This clarification is needed since the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>
                may be infinity and the result of infinity multiplied by zero is
                undefined according to IEEE 754-2008.
              </p>
          </blockquote>
          <p>
            The <dfn id="dfn-scaled-active-time">scaled active time</dfn> is calculated according to
            the following steps:
          </p>
          <ol>
            <li>
              If the <a href="#dfn-active-time" class="internalDFN">active time</a> is <code>null</code>, return
              <code>null</code>.
            </li>
            <li>
              Return the scaled active time based on the
              <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a> as
              follows,
              <dl class="switch">
                <dt>If the <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback
                    rate</a> is less than zero,</dt>
                <dd>
                  Return <code>(<a href="#dfn-active-time" class="internalDFN">active time</a> -
                                <a href="#dfn-active-duration" class="internalDFN">active duration</a>)
                   &#xd7; <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback
                   rate</a>
                   + <a href="#dfn-start-offset" class="internalDFN">start offset</a></code>.
                </dd>
                <dt>If the <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback
                    rate</a> is zero,</dt>
                <dd>
                  Return <a href="#dfn-start-offset" class="internalDFN">start offset</a>.
                </dd>
                <dt>Otherwise,</dt>
                <dd>
                  Return <code><a href="#dfn-active-time" class="internalDFN">active time</a>
                  &#xd7; <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback
                  rate</a> + <a href="#dfn-start-offset" class="internalDFN">start offset</a></code>.
                </dd>
            </dl></li>
          </ol>
        </section>
        <section id="calculating-the-iteration-time">
          <h5><span class="secno">3.10.3.3 </span>Calculating the iteration time</h5>
          <p>
            The <dfn id="dfn-iteration-time">iteration time</dfn> is calculated according to the
            following steps:
          </p>
          <ol>
            <li>
              If the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> is <code>null</code>,
              return <code>null</code>.
            </li>
            <li>
              If the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is zero, return zero.
            </li>
            <li>
              If <code><a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> - <a href="#dfn-start-offset" class="internalDFN">start
              offset</a></code> is equal to the <a href="#dfn-repeated-duration" class="internalDFN">repeated duration</a>,
              and <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> is not zero,
              and <code>(<a href="#dfn-iteration-count" class="internalDFN">iteration count</a> + <a href="#dfn-iteration-start" class="internalDFN">iteration start</a>)
              % 1</code> is zero,
              return the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>.
            </li>
            <li>
              Otherwise, return <code><a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a>
              % <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a></code>.
            </li>
          </ol>
        </section>
      </section>
      <section id="calculating-the-current-iteration">
        <h4><span class="secno">3.10.4 </span>Calculating the current iteration</h4>
        <p>
          The <dfn id="dfn-current-iteration">current iteration</dfn> can be calculated using the
          following steps:
        </p>
        <ol>
          <li>
            If the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> is <code>null</code>, return
            <code>null</code>.
          </li>
          <li>
            If the <a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> is zero, return zero.
          </li>
          <li>
            If the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is zero, return
            <code>ceil(<a href="#dfn-iteration-start" class="internalDFN">iteration start</a> + <a href="#dfn-iteration-count" class="internalDFN">iteration count</a>) -
            1</code>.
          </li>
          <li>
            If the <a href="#dfn-iteration-time" class="internalDFN">iteration time</a> equals the <a href="#dfn-iteration-duration" class="internalDFN">iteration
            duration</a>, return <code><a href="#dfn-iteration-start" class="internalDFN">iteration start</a>
            + <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> - 1</code>.
          </li>
          <li>
            Return <code>floor(<a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> /
            <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>)</code>.
            <p class="note">
              If the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is infinite, the
              result of <code>floor(<a href="#dfn-scaled-active-time" class="internalDFN">scaled active time</a> /
              <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>)</code> will be zero as defined by
              IEEE 754-2008.
            </p>
          </li>
        </ol>
      </section>
    </section>

    <section id="direction-control">
      <h3><span class="secno">3.11 </span>Direction control</h3>
      <p>
        <a href="#dfn-animation-node" class="internalDFN">Animation nodes</a> may also be configured to run iterations in
        alternative directions using direction control.
        For this purpose, <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> have a <dfn id="dfn-playback-direction">playback
        direction</dfn> parameter which takes one of the following values:
      </p>
      <ul>
        <li>normal,</li>
        <li>reverse,</li>
        <li>alternate, or</li>
        <li>alternate-reverse.</li>
      </ul>
      <p>
        The semantics of these values are incorporated into the calculation of
        the <a href="#dfn-directed-time" class="internalDFN">directed time</a> which follows.
      </p>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          A non-normative definition of these values is as follows:
        </p>
        <dl>
          <dt>normal</dt>
          <dd>
            All iterations are played as specified.
          </dd>
          <dt>reverse</dt>
          <dd>
            All iterations are played in the reverse direction from the way
            they are specified.
          </dd>
          <dt>alternate</dt>
          <dd>
            Even iterations are played as specified, odd iterations are played
            in the reverse direction from the way they are specified.
          </dd>
          <dt>alternate-reverse</dt>
          <dd>
            Even iterations are played in the reverse direction from the way
            they are specified, odd iterations are played as specified.
          </dd>
        </dl>
      </div>
      <section id="calculating-the-directed-time">
        <h4><span class="secno">3.11.1 </span>Calculating the directed time</h4>
        <p>
          The <dfn id="dfn-directed-time">directed time</dfn> is calculated from the <a href="#dfn-iteration-time" class="internalDFN">iteration
          time</a> using the following steps:
        </p>
        <ol>
          <li>If the <a href="#dfn-iteration-time" class="internalDFN">iteration time</a> is <code>null</code>, return
              <code>null</code>.
          </li><li>
            Calculate the <var>current direction</var> using the first
            matching condition from the following list:
            <dl class="switch">
              <dt>
                If <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> is <code>normal</code>,
              </dt>
              <dd>Let the <var>current direction</var> be forwards.</dd>
              <dt>
                If <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> is <code>reverse</code>,
              </dt>
              <dd>Let the <var>current direction</var> be reverse.</dd>
              <dt>
                Otherwise,
              </dt>
              <dd>
                <ol>
                  <li>
                    Let <var>d</var> be the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>.
                  </li>
                  <li>
                    If <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> is
                    <code>alternate-reverse</code> increment
                    <var>d</var> by 1.
                  </li>
                  <li>
                    <p class="issue">
                      There used to be a step here which seemed to be adding
                      special handling for filling when the node ends on
                      a repeat boundary but it seems like that is taken care
                      of by the calcuation of <a href="#dfn-iteration-time" class="internalDFN">iteration time</a> and
                      <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>.
                      Is anything actually needed here?
                    </p>
                  </li>
                  <li>
                    If <code><var>d</var> % 2 == 0</code>, let the
                    <var>current direction</var> be forwards, otherwise let
                    the <var>current direction</var> be reverse.
                  </li>
                </ol>
              </dd>
            </dl>
          </li>
          <li>
            If the <var>current direction</var> is forwards then return
            the <a href="#dfn-iteration-time" class="internalDFN">iteration time</a>.
            <p>
              Otherwise, return the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>
              - <a href="#dfn-iteration-time" class="internalDFN">iteration time</a>.
            </p>
          </li>
        </ol>
      </section>
    </section>

    <section id="time-transformations">
      <h3><span class="secno">3.12 </span>Time transformations</h3>
      <section class="informative" id="scaling-the-time">
        <h4><span class="secno">3.12.1 </span>Scaling the time</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          It is often desirable to control the rate at which an <a href="#dfn-animation-node" class="internalDFN">animation
          node</a> progresses.
          For example, easing the rate of animation can create a sense of
          momentum and produce a more natural effect.
          Conversely, in other situations such as when modelling a discrete
          change, a smooth transition is undesirable and instead it is necessary
          for the <a href="#dfn-animation-node" class="internalDFN">animation node</a> to progress in a series of distinct
          steps.
        </p>
        <p>
          For such situations Web Animations provides <a href="#dfn-timing-function" class="internalDFN">timing functions</a>
          that scale the progress of an <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
        </p>
        <p>
          <a href="#dfn-timing-function" class="internalDFN">Timing functions</a> take an input time fraction and produce
          a scaled output time fraction.
        </p>
        <div class="figure">
          <img src="img/timing-function-example.svg" width="350" alt="Example of a timing function that produces an ease-in effect.">
        </div>
        <p class="caption">
          Example of a timing function that produces an ease-in effect.
          Given an input timing fraction of 0.7, the timing function scales the
          value to produce an output time fraction of 0.52.<br>
          By applying this timing function, time will appear to progress more
          slowly at first but then gradually progress more quickly.
        </p>
        <p>
          <a href="#dfn-timing-function" class="internalDFN">Timing functions</a> are applied to an iteration of an <a href="#dfn-animation-node" class="internalDFN">animation
          node</a>.
        </p>
      </div></section>
      <section id="timing-functions">
        <h4><span class="secno">3.12.2 </span>Timing functions</h4>
        <p>
          A <dfn id="dfn-timing-function">timing function</dfn> takes an input time fraction in the range
          [0, 1] and produces an output time fraction whose range is unbounded
          (i.e. positive and negative infinity are permitted).
        </p>
        <p>
          <a href="#dfn-animation-node" class="internalDFN">Animation nodes</a> have one <a href="#dfn-timing-function" class="internalDFN">timing function</a> associated with
          them.
          The default <a href="#dfn-timing-function" class="internalDFN">timing function</a> is the <dfn id="dfn-linear-timing-function">linear timing
          function</dfn> whose output is identical to its input.
          The <a href="#dfn-linear-timing-function" class="internalDFN">linear timing function</a> can be represented by the string
          &#x201c;linear&#x201d;.
        </p>
        <p>
          The range of timing functions that may be applied to a given
          <a href="#dfn-animation-node" class="internalDFN">animation node</a> depends on the type of the <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
        </p>
        <div class="issue">
          <p>
            Currently, the set of <a href="#dfn-timing-function" class="internalDFN">timing functions</a> allowed on
            an <a href="#dfn-animation-group" class="internalDFN">animation group</a> is not restricted.
            This has raised concern about complexity of implementation and also
            complexity of behavior with regards to fill modes.
            As a result, allowing the full set of timing functions on animation
            groups is considered <strong>at risk</strong>.
          </p>
          <p>
            Alternatives are to either restrict timing functions on animation
            groups to the <a href="#dfn-linear-timing-function" class="internalDFN">linear timing function</a> or to a set of
            &#x201c;simple&#x201d; timing functions that have properties that
            alleviate some of the concerns with the more complex timing
            functions.
          </p>
          <p>
            See <a href="http://lists.w3.org/Archives/Public/public-fx/2013JulSep/0076.html">section
            2 of the discussion from August 2013</a>.
          </p>
        </div>
      </section>
      <section id="scaling-using-a-cubic-b-zier-curve">
        <h4><span class="secno">3.12.3 </span>Scaling using a cubic B&#xe9;zier curve</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            A common method of producing easing effects is to use a cubic B&#xe9;zier
            curve to scale the time.
            The endpoints of the curve are fixed at (0, 0) and (1, 1) while two
            control points <var>P1</var> and <var>P2</var> define the shape of
            the curve.
            Provided the <var>x</var> values of <var>P1</var> and <var>P2</var>
            lie within the range [0, 1] such a curve produces a function that is
            used to map input times (the <var>x</var> values) onto output times
            (the <var>y</var> values).
            This arrangement is illustrated below.
          </p>
          <div class="figure">
            <img src="img/cubic-bezier-timing-curve.svg" width="500" alt="A cubic Bezier curve used as a timing function.">
          </div>
          <p class="caption">
            A cubic B&#xe9;zier curve used as a timing function.<br>
            The shape of the curve is determined by the location of the control
            points <var>P1</var> and <var>P2</var>.<br>
            Input time fractions serve as <var>x</var> values of the curve,
            whilst the <var>y</var> values are the output time fractions.
          </p>
          <p>
            Some example cubic B&#xe9;zier timing functions are illustrated below.
          </p>
          <div class="figure">
            <img src="img/curve-keywords.svg" width="500" alt="The timing functions produced by keyword values.">
          </div>
          <p class="caption">
            The timing functions produced by each of the keyword values
            associated with cubic B&#xe9;zier timing functions accepted by the
            <a href="#widl-AnimationTiming-easing" class="idlType"><code>AnimationTiming.easing</code></a>
            member from the <a href="#programming-interface">programming
            interface</a>.
          </p>
        </div>
        <p>
          A <dfn id="dfn-cubic-b-zier-timing-function">cubic B&#xe9;zier timing function</dfn> is a type of <a href="#dfn-timing-function" class="internalDFN">timing
          function</a> defined by four real numbers that specify the two control
          points, <var>P1</var> and <var>P2</var>, of a cubic B&#xe9;zier curve whose
          end points are fixed at (0, 0) and (1, 1).
          The x coordinates of <var>P1</var> and <var>P2</var> are
          restricted to the range [0, 1].
        </p>
        <p>
          The evaluation of this curve is covered in many sources such as
          [<cite><a class="bibref" href="#bib-FUND-COMP-GRAPHICS">FUND-COMP-GRAPHICS</a></cite>].
        </p>
        <p>
          A <a href="#dfn-cubic-b-zier-timing-function" class="internalDFN">cubic B&#xe9;zier timing function</a> may be specified as a string
          using the following syntax (using notation from [<cite><a class="bibref" href="#bib-CSS3-VALUES">CSS3-VALUES</a></cite>]):
        </p>
        <blockquote>
          <div class="production"><dfn id="dfn-cubic-bezier-timing-function">&lt;cubic-bezier-timing-function&gt;</dfn> =
            ease | ease-in | ease-out | ease-in-out |
            <span class="atom">cubic-bezier(&lt;number&gt; &lt;number&gt;
                                            &lt;number&gt;
            &lt;number&gt;)</span></div>
        </blockquote>
        <p>
          The meaning of each value is as follows:
        </p>
        <dl>
          <dt>ease</dt>
          <dd>
            Equivalent to cubic-bezier(0.25, 0.1, 0.25, 1).
          </dd>
          <dt>ease-in</dt>
          <dd>
            Equivalent to cubic-bezier(0.42, 0, 1, 1).
          </dd>
          <dt>ease-out</dt>
          <dd>
            Equivalent to cubic-bezier(0, 0, 0.58, 1).
          </dd>
          <dt>ease-in-out</dt>
          <dd>
            Equivalent to cubic-bezier(0.42, 0, 0.58, 1).
          </dd>
          <dt>cubic-bezier(&lt;number&gt; &lt;number&gt; &lt;number&gt; &lt;number&gt;)</dt>
          <dd>
            Specifies a <a href="#dfn-cubic-b-zier-timing-function" class="internalDFN">cubic B&#xe9;zier timing function</a>.
            The four numbers specify points <var>P1</var> and <var>P2</var> of
            the curve as (x1, y1, x2, y2).
            Both x values must be in the range [0, 1] or the definition is
            invalid.
          </dd>
        </dl>
        <div class="issue">
          <p>
            It has been proposed to extend <code>cubic-bezier</code> to allow
            multiple segments, using syntax such as the following:
          </p>
          <pre>            <code>cubic-bezier( [ &lt;number&gt;{6} ; ]* &lt;number&gt;{4} )</code>
          </pre>
          <p>
            (i.e. the curve starts at (0, 0); each segment is defined by six
            numbers where the start point is the end of the previous segment and
            the numbers define the two control points and the end point. The
            last segment is defined by four numbers since the end point is fixed
            at (1, 1).)
          </p>
          <p>
            This would provide a simple and compact syntax for tools trying to
            map arbitrary curves (e.g. bounce functions) to timing functions.
          </p>
        </div>
      </section>
      <section id="timing-in-discrete-steps">
        <h4><span class="secno">3.12.4 </span>Timing in discrete steps</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            It is possible to scale an animation node's timing so that the animation node
            occurs in a series of discrete steps using a stepping function.
          </p>
          <p>
            Some example step timing functions are illustrated below.
          </p>
          <div class="figure">
            <img src="img/step-timing-func-examples.svg" width="700" alt="Example step timing functions.">
          </div>
          <p class="caption">
            Example step timing functions.
            In each case the domain is the input time fraction whilst the range
            represents the output time fraction produced by the step
            function.<br>
            The first row shows the function for each transition point when only
            one step is specified whilst the second row shows the same for three
            steps.
          </p>
        </div>
        <p>
          A <dfn id="dfn-step-timing-function">step timing function</dfn> is a type of <a href="#dfn-timing-function" class="internalDFN">timing function</a>
          that divides the input time into a specified number of intervals that
          are equal in duration.
          The output time, starting at zero, rises by an amount equal to the
          interval duration once during each interval at the transition point
          which may be either the start, midpoint, or end of the interval.
        </p>
        <p>
          In keeping with Web Animations' model of endpoint exclusive
          interval timing (see <a href="#interval-timing" class="sectionRef">section 3.8.4 Interval timing</a>), the output time at the transition point is
          the time <em>after</em> applying the increase (i.e. the top of the
          step) with the following exception.
        </p>
        <p>
          When a transition point coincides with the end of the <a href="#dfn-active-interval" class="internalDFN">active
          interval</a> extra care must be taken to produce the correct result
          when performing a <a title="fill mode" href="#dfn-fill-mode" class="internalDFN">fill</a>.
          To achieve this, when a <a href="#dfn-step-timing-function" class="internalDFN">step timing function</a> is
          applied to an <a href="#dfn-animation-node" class="internalDFN">animation node</a> or applied to an <a href="#dfn-animation-effect" class="internalDFN">animation
          effect</a> associated with an <a href="#dfn-animation-node" class="internalDFN">animation node</a>, an additional
          <dfn id="dfn-before-flag">before flag</dfn> is passed.
          The value of the <a href="#dfn-before-flag" class="internalDFN">before flag</a> is determined as follows:
        </p>
        <ol>
          <li>If the <a href="#dfn-active-time" class="internalDFN">active time</a> of the animation node is null, the
              <a href="#dfn-before-flag" class="internalDFN">before flag</a> is not set and these steps should be aborted.
          </li><li>Determine the <var>current direction</var> using the procedure
              defined in <a href="#calculating-the-directed-time" class="sectionRef">section 3.11.1 Calculating the directed time</a>.
          </li><li>If either the <var>current direction</var> is <span class="prop-value">forwards</span> or the <a href="#dfn-animation-node-playback-rate" class="internalDFN">animation node
              playback rate</a> &#x2265; 0 (but <em>not</em> when both conditions
              are true),
              let <var>going forwards</var> be true, otherwise it is false.
          </li><li>The <a href="#dfn-before-flag" class="internalDFN">before flag</a> is set if the animation node is in the
              <a href="#dfn-before-phase" class="internalDFN">before phase</a> and <var>going forwards</var> is true;
              or if the animation node is in the <a href="#dfn-after-phase" class="internalDFN">after phase</a> and
              <var>going forwards</var> is false.
        </li></ol>
        <p>
          When a step timing function is evaluated at a transition point, if
          the <a href="#dfn-before-flag" class="internalDFN">before flag</a> is set the result is the value <em>before</em>
          applying the increase.
        </p>
        <p>
          A <a href="#dfn-step-timing-function" class="internalDFN">step timing function</a> may be specified as a string
          using the following syntax:
        </p>
        <blockquote>
          <div class="production"><dfn id="dfn-step-timing-function-1">&lt;step-timing-function&gt;</dfn> =
            step-start | step-middle | step-end |
            <span class="atom">steps(&lt;integer&gt;[,
                               [ start | middle | end ] ]?)</span></div>
        </blockquote>
        <p>
          The meaning of each value is as follows:
        </p>
        <dl>
          <dt>step-start</dt>
          <dd>
            Equivalent to steps(1, start);
          </dd>
          <dt>step-middle</dt>
          <dd>
            Equivalent to steps(1, middle);
          </dd>
          <dt>step-end</dt>
          <dd>
            Equivalent to steps(1, end);
          </dd>
          <dt>steps(&lt;integer&gt;[, [ start | middle | end ] ]?)</dt>
          <dd>
            Specifies a <a href="#dfn-step-timing-function" class="internalDFN">step timing function</a>.
            The first parameter specifies the number of intervals in the
            function.
            It must be a positive integer (greater than 0).
            The second parameter, which is optional, specifies the point at
            which the change of values occur within the interval.
            If the second parameter is omitted, it is given the value <span class="prop-value">end</span>.
          </dd>
        </dl>
      </section>
      <section id="calculating-the-transformed-time">
        <h4><span class="secno">3.12.5 </span>Calculating the transformed time</h4>
        <p>
          The <dfn id="dfn-transformed-time">transformed time</dfn> is calculated from the
          <a href="#dfn-directed-time" class="internalDFN">directed time</a> using the following steps:
        </p>
        <ol>
          <li>If the <a href="#dfn-directed-time" class="internalDFN">directed time</a> is <code>null</code>,
              return <code>null</code>.
          </li><li>If the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is infinity,
              return the <a href="#dfn-directed-time" class="internalDFN">directed time</a>.
          </li><li>Let <var>iteration fraction</var> be the result of
              evaluating <code><a href="#dfn-directed-time" class="internalDFN">directed time</a> / <a href="#dfn-iteration-duration" class="internalDFN">iteration
              duration</a></code> unless <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is
              zero, in which case let <var>iteration fraction</var> be
              zero.
          </li><li>Let <var>scaled fraction</var> be the result of
              evaluating the <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-timing-function" class="internalDFN">timing function</a>
              with <var>iteration fraction</var> as the input time
              fraction.
          </li><li>Return the result of evaluating <code><var>scaled
              fraction</var> &#xd7; <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a></code>.
              If the <var>scaled fraction</var> is zero, let the result be
              zero.
              <p class="note">
                This clarification is needed since the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>
                may be infinity and the result of infinity multiplied by zero is
                undefined according to IEEE 754-2008.
              </p>
        </li></ol>
      </section>
    </section>

    <section id="grouping-and-synchronization">
      <h3><span class="secno">3.13 </span>Grouping and synchronization</h3>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          While it is possible to set the timing properties of <a href="#dfn-animation-node" class="internalDFN">animation
          nodes</a> individually, it is often useful to synchronize <a href="#dfn-animation-node" class="internalDFN">animation
          nodes</a> so that they share common timing properties and maintain
          their temporal relationship.  This is achieved using an <a href="#dfn-animation-group" class="internalDFN">animation
          group</a>.
        </p>
        <p>
          A simple example is illustrated below.
        </p>
        <div class="figure">
          <img src="img/grouping-delay.svg" width="800" alt="Using groups to share common timing properties.">
        </div>
        <p class="caption">
          Using groups to share common timing properties.<br>
          (a) Shows setting a delay of 5 seconds on individual animations.<br>
          (b) Produces the same effect by setting the delay on the group.
        </p>
        <p>
          When an <a href="#dfn-animation-group" class="internalDFN">animation group</a> is <a href="#dfn-directly-associated-with-a-player" class="internalDFN">directly associated with
          a player</a>, the <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> associated with the
          <a href="#dfn-animation-group" class="internalDFN">animation group</a> can be seeked, paused, and stopped as a unit.
        </p>
      </div>
      <p>
        An <dfn id="dfn-animation-group">animation group</dfn> is a type of <a href="#dfn-animation-node" class="internalDFN">animation node</a> that
        contains an ordered sequence of zero or more <a href="#dfn-animation-node" class="internalDFN">animation nodes</a>
        known as <dfn title="child animation node" id="dfn-child-animation-node">child animation nodes</dfn>.
      </p>
      <p>
        At a given moment, an <a href="#dfn-animation-node" class="internalDFN">animation node</a> may be a <a href="#dfn-child-animation-node" class="internalDFN">child animation
        node</a> of at most one <a href="#dfn-animation-group" class="internalDFN">animation group</a> known as the <dfn id="dfn-parent-animation-group">parent
        animation group</dfn>.
        The <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a> cannot be the same <a href="#dfn-animation-node" class="internalDFN">animation
        node</a> as the <a href="#dfn-child-animation-node" class="internalDFN">child animation node</a> itself.
      </p>
      <p>
        By nesting <a href="#dfn-animation-group" class="internalDFN">animation groups</a> it is possible to create hierarchical
        tree structures.
        The following terms are used to describe the parts and properties of
        such structures and are defined in [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>]:
      </p>
      <ul>
        <li><dfn id="dfn-tree-order"><a href="http://www.w3.org/TR/dom/#concept-tree-order">tree order</a></dfn>
        </li><li><dfn id="dfn-root"><a href="http://www.w3.org/TR/dom/#concept-tree-root">root</a></dfn>
        </li><li><dfn id="dfn-ancestor"><a href="http://www.w3.org/TR/dom/#concept-tree-ancestor">ancestor</a></dfn>
        </li><li><dfn id="dfn-descendant"><a href="http://www.w3.org/TR/dom/#concept-tree-descendant">descendant</a></dfn>
        </li><li><dfn id="dfn-inclusive-ancestor"><a href="http://www.w3.org/TR/dom/#concept-tree-inclusive-ancestor">inclusive ancestor</a></dfn>
        </li><li><dfn id="dfn-inclusive-descendant"><a href="http://www.w3.org/TR/dom/#concept-tree-inclusive-descendant">inclusive descendant</a></dfn>
        </li><li><dfn id="dfn-next-sibling"><a href="http://www.w3.org/TR/dom/#concept-tree-next-sibling">next
        sibling</a></dfn>
        </li><li><dfn id="dfn-previous-sibling"><a href="http://www.w3.org/TR/dom/#concept-tree-previous-sibling">previous
        sibling</a></dfn>
        </li><li><dfn id="dfn-first-child"><a href="http://www.w3.org/TR/dom/#concept-tree-first-child">first child</a></dfn>
        </li><li><dfn id="dfn-last-child"><a href="http://www.w3.org/TR/dom/#concept-tree-last-child">last child</a></dfn>
      </li></ul>
      <p class="note">
        Note that in applying these definitions to <a href="#dfn-animation-node" class="internalDFN">animation nodes</a>, the
        term <em>parent</em> refers exclusively to a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation
        group</a> and does <em>not</em> include the <a href="#dfn-player" class="internalDFN">player</a> which with
        an <a href="#dfn-animation-node" class="internalDFN">animation node</a> may be <a title="directly associated with a player" href="#dfn-directly-associated-with-a-player" class="internalDFN">directly associated</a>
        despite the fact that conceptually the <a href="#dfn-player" class="internalDFN">player</a> acts as a parent
        time source.
      </p>
      <p>
        The temporal relationship between a <a href="#dfn-child-animation-node" class="internalDFN">child animation node</a> and its
        <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a> is incorporated in the definition of
        <a href="#dfn-inherited-time" class="internalDFN">inherited time</a> (see <a href="#local-time-and-inherited-time" class="sectionRef">section 3.6.4 Local time and inherited time</a>).
      </p>
      <section class="informative" id="relationship-of-group-time-to-child-time">
        <h4><span class="secno">3.13.1 </span>Relationship of group time to child time</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
        <p>
          The timing of the children of an <a href="#dfn-animation-group" class="internalDFN">animation group</a> is based on
          the timing of the group.
          Specifically, times for the children are based on the parent's
          <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>.
          With regards to repetition, this means the children operate
          <em>inside</em> an iteration of the parent.
        </p>
        <p>
          For example, if an <a href="#dfn-animation-group" class="internalDFN">animation group</a> has an <a href="#dfn-iteration-count" class="internalDFN">iteration
          count</a> of 2, then the children of of the group will all play twice
          since they effectively play <em>inside</em> the group's iterations.
        </p>
        <div class="figure">
          <img src="img/grouping-repetition.svg" width="600" alt="The effect of multiple iterations on the children of a group.">
        </div>
        <p class="caption">
          Since children of an <a href="#dfn-animation-group" class="internalDFN">animation group</a> base their timing on the
          group's <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>, when the group repeats, the
          children play again.
        </p>
        <p>
          Note that even in this case, the child <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> still
          have only <em>one</em> <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          However, as a result of the parent's timing, the <a href="#dfn-active-interval" class="internalDFN">active
          interval</a> is played twice.
        </p>
        <p>
          If an <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> is specified for the children of a group
          as well as for the group itself, the effect is as if the <a href="#dfn-iteration-count" class="internalDFN">iteration
          count</a> of the group was multiplied with the <a href="#dfn-iteration-count" class="internalDFN">iteration count</a>
          of the children.
        </p>
        <div class="figure">
          <img src="img/grouping-repetition-and-animation-repetition.svg" width="600" alt="Iteration counts are multiplicative.">
        </div>
        <p class="caption">
          Specifying an <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> of 2 on an <a href="#dfn-animation-group" class="internalDFN">animation group</a>
          and an <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> of 3 on one of its children results in
          that child playing 6 times.
        </p>
        <p>
          A further result of the children of an <a href="#dfn-animation-group" class="internalDFN">animation group</a> basing
          their timing on the group's <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> is that they
          cannot animate outside of the group's <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          This is because the <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> of a group will not
          change outside its <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
          This allows groups to <em>clip</em> the playback of their children.
        </p>
        <div class="figure">
          <img src="img/grouping-clipping.svg" width="600" alt="Groups clip the active interval of contained children.">
        </div>
        <p class="caption">
          In the first instance, an <a href="#dfn-animation-node" class="internalDFN">animation node</a> has a negative delay
          and an infinite <a href="#dfn-iteration-count" class="internalDFN">iteration count</a>.<br>
          However, when a similar <a href="#dfn-animation-node" class="internalDFN">animation node</a> is placed inside
          an <a href="#dfn-animation-group" class="internalDFN">animation group</a> with a specified <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a>
          it has the effect of clipping the child <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s
          <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
        </p>
        <p>
          Some further consequences of <a href="#dfn-animation-group" class="internalDFN">animation group</a> children basing
          their timing on their parent group's <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> are:
        </p>
        <ul>
          <li>
            Setting the <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback
            rate</a> of an <a href="#dfn-animation-group" class="internalDFN">animation group</a> will speed up or slow down all
            children.
          </li>
          <li>
            Changing the <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> of an <a href="#dfn-animation-group" class="internalDFN">animation group</a>
            will change the direction of all children.
          </li>
          <li>
            Applying a <a href="#dfn-timing-function" class="internalDFN">timing function</a> to an <a href="#dfn-animation-group" class="internalDFN">animation group</a> will
            affect the progress of all children.
          </li>
        </ul>
      </div></section>
      <section id="the-start-time-of-children-of-an-animation-group">
        <h4><span class="secno">3.13.2 </span>The start time of children of an animation group</h4>
        <p>
          The <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> of a <a href="#dfn-child-animation-node" class="internalDFN">child
          animation node</a> of an <a href="#dfn-animation-group" class="internalDFN">animation group</a> is zero.
        </p>
        <p>
          Note that specific types of <a href="#dfn-animation-group" class="internalDFN">animation groups</a> may override
          this definition to provide other kinds of synchronization behavior.
        </p>
      </section>
      <section id="the-intrinsic-iteration-duration-of-an-animation-group">
        <h4><span class="secno">3.13.3 </span>The intrinsic iteration duration of an animation group</h4>
        <p>
          The <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> of an <a href="#dfn-animation-group" class="internalDFN">animation
          group</a> is based on the time when the last <a href="#dfn-child-animation-node" class="internalDFN">child animation
          node</a> completes its <a href="#dfn-active-interval" class="internalDFN">active interval</a> and is calculated using
          the following procedure.
        </p>
        <ol>
          <li>
            <p>Define the <a href="#dfn-end-time" class="internalDFN">end time</a> of an <a href="#dfn-animation-node" class="internalDFN">animation node</a> as
            :</p>
            <blockquote>
              <dfn id="dfn-end-time">end time</dfn> =
              <code><a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> +
              <a href="#dfn-start-delay" class="internalDFN">start delay</a> + <a href="#dfn-active-duration" class="internalDFN">active duration</a> + <a href="#dfn-end-delay" class="internalDFN">end
              delay</a></code>
            </blockquote>
          </li>
          <li>
            <p>
              The <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> depends on the number of
              <a href="#dfn-child-animation-node" class="internalDFN">child animation nodes</a> as follows,
            </p>
            <dl class="switch">
              <dt>If the group has no <a href="#dfn-child-animation-node" class="internalDFN">child animation nodes</a>,</dt>
              <dd>
                the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> is zero.
              </dd>
              <dt>Otherwise,</dt>
              <dd>
                <ol>
                  <li>Let <var>maximum end time</var> be the maximum value
                      after calculating the <a href="#dfn-end-time" class="internalDFN">end time</a> of each <a href="#dfn-child-animation-node" class="internalDFN">child
                      animation node</a> in the group.</li>
                  <li>The <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> is the result of
                      evaluating <code>max(0, <var>maximum end
                      time</var>)</code>.</li>
                </ol>
              </dd>
            </dl>
          </li>
        </ol>
        <p>
          This definition of the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> may be
          overridden by specific types of <a href="#dfn-animation-group" class="internalDFN">animation groups</a>.
        </p>
      </section>
      <section id="animation-sequences">
        <h4><span class="secno">3.13.4 </span>Animation sequences</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            Specific types of <a href="#dfn-animation-group" class="internalDFN">animation groups</a> can be used to provide
            different kinds of synchronization behavior for their children.
            This specification defines one additional type of <a href="#dfn-animation-group" class="internalDFN">animation
            group</a>: an <a href="#dfn-animation-sequence" class="internalDFN">animation sequence</a>.
            <a href="#dfn-animation-sequence" class="internalDFN">Animation sequences</a> arrange the start times of their
            children so that they run one at a time, in turn.
          </p>
          <p>
            Compare the two arrangements illustrated below:
          </p>
          <div class="figure">
            <img src="img/grouping-types.svg" width="600" alt="Animation groups and animation sequences.">
          </div>
          <p class="caption">
            Animation groups and animation sequences.<br>
            (a) is a regular <a href="#dfn-animation-group" class="internalDFN">animation group</a> where all the children run
                simultaneously.<br>
            (b) is an <a href="#dfn-animation-sequence" class="internalDFN">animation sequence</a> where the children run in turn.
          </p>
          <p>
            Since <a href="#dfn-animation-group" class="internalDFN">animation groups</a> can also contain other <a href="#dfn-animation-group" class="internalDFN">animation
            groups</a>, complex synchronization is possible by combining
            different types of groups as illustrated below.
          </p>
          <div class="figure">
            <img src="img/grouping-nesting.svg" width="600" alt="Nesting of animation groups.">
          </div>
          <p class="caption">
            An <a href="#dfn-animation-sequence" class="internalDFN">animation sequence</a> that contains a regular <a href="#dfn-animation-group" class="internalDFN">animation
            group</a> as a child.<br>
            The <a href="#dfn-animation-group" class="internalDFN">animation group</a> waits for the previous child of the
            <a href="#dfn-animation-sequence" class="internalDFN">animation sequence</a> to finish, and then the children of the
            <a href="#dfn-animation-group" class="internalDFN">animation group</a> play simultaneously.
            After they have finished the next child of the <a href="#dfn-animation-sequence" class="internalDFN">animation
            sequence</a> plays.
          </p>
        </div>
        <p>
          An <dfn id="dfn-animation-sequence">animation sequence</dfn> is a type of <a href="#dfn-animation-group" class="internalDFN">animation group</a>
          that schedules its <a href="#dfn-child-animation-node" class="internalDFN">child animation nodes</a> such that they play in
          turn following their order in the group.
          This sequencing is achieved by adjusting the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> of each <a href="#dfn-child-animation-node" class="internalDFN">child
          animation node</a> in the group.
        </p>
        <section id="the-start-time-of-children-of-an-animation-sequence">
          <h5><span class="secno">3.13.4.1 </span>The start time of children of an animation sequence</h5>
          <p>
            The <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> of
            a <a href="#dfn-child-animation-node" class="internalDFN">child animation node</a> of an <a href="#dfn-animation-sequence" class="internalDFN">animation sequence</a> is the
            <a href="#dfn-end-time" class="internalDFN">end time</a> of the child's <a href="#dfn-previous-sibling" class="internalDFN">previous sibling</a>.
            If the child has no <a href="#dfn-previous-sibling" class="internalDFN">previous sibling</a> the start time is zero.
          </p>
          <div class="note">
            <p>
              When the <a href="#dfn-active-duration" class="internalDFN">active duration</a> is positive infinity the behavior
              for calculating the <a href="#dfn-end-time" class="internalDFN">end time</a> of an <a href="#dfn-animation-node" class="internalDFN">animation node</a>
              and the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> of
              subsequent children follows the usual behavior defined by IEEE
              754-2008.
              As a result, if any of the children of an <a href="#dfn-animation-sequence" class="internalDFN">animation
              sequence</a> has an infinite <a href="#dfn-active-duration" class="internalDFN">active duration</a>, any children
              that occur later in the sequence will not play.
            </p>
            <p>
              Similarly, the above definition does not restrict
              <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start times</a> to positive
              values and hence some children may not play due to a negative
              <a href="#dfn-start-delay" class="internalDFN">start delay</a> on children that occur earlier in the group
              since their <a href="#dfn-active-interval" class="internalDFN">active interval</a> may end before the group's <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a>.
            </p>
          </div>
          <div class="informative informative-bg">
            <p><em>This section is non-normative.</em></p><p>
              Because the start of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> is based on the
              sum of an <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> <em>and</em>
              <a href="#dfn-start-delay" class="internalDFN">start delay</a>, the <a href="#dfn-active-interval" class="internalDFN">active intervals</a> of
              children of an <a href="#dfn-animation-sequence" class="internalDFN">animation sequence</a> need not run in strict
              sequence but can be shifted back and forth by using the <a href="#dfn-start-delay" class="internalDFN">start
              delay</a> as shown in the following diagram.
            </p>
            <div class="figure">
              <img src="img/sequence-groups-and-start-delays.svg" width="600" alt="Using negative start delays to overlap children of seq
                    groups">
            </div>
            <p class="caption">
              Example of using the <a href="#dfn-start-delay" class="internalDFN">start delay</a> on children of an
              <a href="#dfn-animation-sequence" class="internalDFN">animation sequence</a> to shift their timing so that they
              overlap (a negative delay) or are spaced apart (a positive delay).
            </p>
            <p>
              A negative <a href="#dfn-start-delay" class="internalDFN">start delay</a> can be used to cause the <a href="#dfn-active-interval" class="internalDFN">active
              interval</a> of two children to overlap.
              Note that the <a href="#dfn-start-delay" class="internalDFN">start delay</a> affects the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> of subsequent
              children in the group.
            </p>
          </div>
        </section>
        <section id="the-intrinsic-iteration-duration-of-an-animation-sequence">
          <h5><span class="secno">3.13.4.2 </span>The intrinsic iteration duration of an animation sequence</h5>
          <p>
            The <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> of an <a href="#dfn-animation-sequence" class="internalDFN">animation
            sequence</a> is equivalent to the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> of a hypothetical
            <a href="#dfn-child-animation-node" class="internalDFN">child animation node</a> appended to the group's children
            calculated according to the definition in <a href="#the-start-time-of-children-of-an-animation-sequence" class="sectionRef">section 3.13.4.1 The start time of children of an animation sequence</a> unless that produces a negative value, in
            which case the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> is zero.
          </p>
          <p>
            As a result, if the <a href="#dfn-animation-sequence" class="internalDFN">animation sequence</a> has no <a href="#dfn-child-animation-node" class="internalDFN">child
            animation nodes</a> the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a> will be
            zero.
          </p>
        </section>
      </section>
    </section>

    <section id="animations">
      <h3><span class="secno">3.14 </span>Animations</h3>
      <p>
        <dfn title="animation" id="dfn-animation">Animations</dfn> are a kind of <a href="#dfn-animation-node" class="internalDFN">animation
        node</a> that apply an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> or a <a href="#dfn-custom-effect" class="internalDFN">custom effect</a>
        to an element or pseudo-element such as <code>::before</code> and
        <code>::first-line</code> [<cite><a class="bibref" href="#bib-SELECT">SELECT</a></cite>] referred to as the <dfn id="dfn-animation-target">animation
        target</dfn>.
      </p>
      <section id="calculating-the-time-fraction">
        <h4><span class="secno">3.14.1 </span>Calculating the time fraction</h4>
        <p>
          Before passing the <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> of an <a href="#dfn-animation" class="internalDFN">animation</a> to
          its <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> it is converted to a <em>time
          fraction</em>.
          The <dfn id="dfn-time-fraction">time fraction</dfn> of an <a href="#dfn-animation-node" class="internalDFN">animation node</a> is calculated
          according to the following steps:
        </p>
        <dl class="switch">
          <dt>
            If the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> is zero,
          </dt>
          <dd>
            <p>
              the <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> is as follows,
            </p>
            <dl class="switch">
              <dt>
                If <a href="#dfn-local-time" class="internalDFN">local time</a> &lt; <a href="#dfn-start-delay" class="internalDFN">start delay</a>,
              </dt>
              <dd>
                Return the result of recalculating the <a href="#dfn-transformed-time" class="internalDFN">transformed time</a>
                using an <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of 1.
              </dd>
              <dt>
                Otherwise,
              </dt>
              <dd>
                <ol>
                  <li>Let <var>normalized active duration</var> be the result of
                      recalculating the <a href="#dfn-active-duration" class="internalDFN">active duration</a> using an
                      <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of 1.
                  </li><li>Return the result of recalculating the <a href="#dfn-transformed-time" class="internalDFN">transformed
                      time</a> using a <a href="#dfn-local-time" class="internalDFN">local time</a> of <code><a href="#dfn-start-delay" class="internalDFN">start
                      delay</a> + <var>normalized active duration</var></code>
                      and an <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of 1.
                </li></ol>
              </dd>
            </dl>
          </dd>
          <dt>
            Otherwise,
          </dt>
          <dd>
            Return <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> / <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> unless
            <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> is <code>null</code>, in which case return
            <code>null</code>.
          </dd>
        </dl>
        <p class="note">
          Since <a href="#dfn-timing-function" class="internalDFN">timing functions</a> are allowed to produce output times
          outside the range [0, 1] it is possible that the value calculated for
          a <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> also lies outside this range.
        </p>
      </section>
    </section>
    </section> <!-- End of timing model -->

    <section id="animation-model">
      <!--OddPage--><h2><span class="secno">4. </span>Animation model</h2>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          The Web Animations <em>animation model</em> takes the <a href="#dfn-time-fraction" class="internalDFN">time
          fractions</a> and <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> values produced by the
          <em>timing model</em> for a given <a href="#dfn-animation" class="internalDFN">animation</a> and applies it as
          the input to the <a href="#dfn-animation" class="internalDFN">animation</a>'s <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>.
        </p>
        <p>
          The output of each <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> is then combined with other
          <a href="#dfn-animation-effect" class="internalDFN">animation effects</a> using an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> before being
          applied to the target properties (see <a href="#combining-animations" class="sectionRef">section 4.2 Combining animations</a>).
        </p>
      </div>

    <section id="animation-effects">
      <h3><span class="secno">4.1 </span>Animation effects</h3>
      <p>
        An <dfn id="dfn-animation-effect">animation effect</dfn> takes a <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and
        a <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> value and uses them to calculate an
        <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> for its <a title="target property" href="#dfn-target-property" class="internalDFN">target properties</a>.  Each <a href="#dfn-animation" class="internalDFN">animation</a>
        may have at most one <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> associated with it.
      </p>
      <p>
        Since the result of an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> is based on the
        <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> value, it is updated
        whenever the timing model is <a title="sampling" href="#dfn-sampling" class="internalDFN">sampled</a>.
      </p>
      <section id="target-properties">
        <h4><span class="secno">4.1.1 </span>Target properties</h4>
        <p>
          Each <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> can have zero or more associated
          <dfn title="target property" id="dfn-target-property">target properties</dfn>.
        </p>
          <a title="target property" href="#dfn-target-property" class="internalDFN">Target properties</a> may be CSS properties
          or DOM attributes.
          If a given <a href="#dfn-animation-target" class="internalDFN">animation target</a> has an attribute with the same name
          as a CSS property, any <a href="#dfn-target-property" class="internalDFN">target property</a> of that name is taken to
          refer to to the CSS property.
        <p></p>
        <p class="note">
          If there ever exists a situation where we need to animate an attribute
          with the same name as a property (other than a <a href="http://www.w3.org/TR/SVG2/intro.html#TermPresentationAttribute">presentation
          attribute</a> [<cite><a class="bibref" href="#bib-SVG2">SVG2</a></cite>]) then we will need to introduce
          a disambiguation strategy. Generally, however, such naming should be
          avoided.
        </p>
      </section>
      <section id="procedures-for-animating-properties">
        <h4><span class="secno">4.1.2 </span>Procedures for animating properties</h4>
        <p>
          In order to animate a <a href="#dfn-target-property" class="internalDFN">target property</a>, the following procedures
          must be defined.
        </p>
        <ul>
          <li><dfn title="animation interpolation" id="dfn-animation-interpolation">interpolation</dfn> &#x2014;
              given two target property values <var>V</var><sub>start</sub> and
              <var>V</var><sub>end</sub>, produces an intermediate value
              <var>V</var><sub>res</sub> at a distance of <var>p</var> along the
              interval between <var>V</var><sub>start</sub> and
              <var>V</var><sub>end</sub> such that
              <var>p</var> = 0 produces <var>V</var><sub>start</sub> and
              <var>p</var> = 1 produces <var>V</var><sub>end</sub>.
              The range of <var>p</var> is (&#x2212;&#x221e;, &#x221e;) due to the
              effect of <a href="#dfn-timing-function" class="internalDFN">timing functions</a>.
              As a result, this procedure must also define extrapolation
              behavior for <var>p</var> outside [0, 1].
          </li><li><dfn title="animation addition" id="dfn-animation-addition">addition</dfn> &#x2014; given two
              target property values
              <var>V</var><sub>a</sub> and <var>V</var><sub>b</sub>, returns the
              sum of the two properties, <var>V</var><sub>result</sub>.
              For addition that is not commutative (for example, matrix
              multiplication) <var>V</var><sub>a</sub> represents the first term
              of the operation and <var>V</var><sub>b</sub> represents the
              second.
              <div class="informative informative-bg">
                <p><em>This section is non-normative.</em></p><p>
                  While <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition</a> can often be
                  expressed in terms of the same weighted sum function used to
                  define <a title="animation interpolation" href="#dfn-animation-interpolation" class="internalDFN">interpolation</a>,
                  this is not always the case.
                  For example, interpolation of transform matrices involves
                  decomposing and interpolating the matrix components whilst
                  addition relies on matrix multiplication.
                </p>
              </div>
          </li><li><dfn title="animation accumulation" id="dfn-animation-accumulation">accumulation</dfn> &#x2014;
              given two target property values
              <var>V</var><sub>a</sub> and <var>V</var><sub>b</sub>, returns the
              result, <var>V</var><sub>result</sub>, of combining
              the two operands such that <var>V</var><sub>b</sub> is treated as
              a <em>delta</em> from <var>V</var><sub>a</sub>.
              For accumulation that is not commutative (for example,
              accumulation of mismatched transform lists)
              <var>V</var><sub>a</sub> represents the first term of the
              operation and <var>V</var><sub>b</sub> represents the second.
              <div class="informative informative-bg">
                <p><em>This section is non-normative.</em></p><p>
                  For many types of animation such as numbers or lengths, <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulation</a> is defined to
                  be identical to <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition</a>.
                </p>
                <p>
                  A common case where the definitions differ is for list-based
                  types where <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition</a> may be
                  defined as appending to a list
                  whilst <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulation</a> may
                  be defined as component-based addition.
                  For example, the filter list values "blur(2)" and
                  "blur(3)", when <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">added</a>
                  together may produce "blur(2) blur(3)", but when
                  <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulated</a>,
                  may produce "blur(5)".
                </p>
              </div>
          </li><li><dfn id="dfn-distance-computation">distance computation</dfn> &#x2014; given two target property
              values <var>V</var><sub>start</sub> and
              <var>V</var><sub>end</sub>, calculates some notion of scalar
              distance between the values, <var>distance</var>.
        </li></ul>
      </section>
      <section id="specific-animation-behaviors">
        <h4><span class="secno">4.1.3 </span>Specific animation behaviors</h4>
        <p>
          The specific procedures used for animating a given <a href="#dfn-target-property" class="internalDFN">target
          property</a> are referred to as the property's <dfn id="dfn-animation-behavior">animation
          behavior</dfn>.
        </p>
        <p>
          The <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a> of CSS properties is defined by the
          "Animatable:" line in the summary of the property's definition or in
          [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>] for properties that lack a such a line.
        </p>
        <p class="issue">
          The default <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a> for CSS properties is "as
          string".  Should this be defined here or in CSS Animations Level 4?
        </p>
        <p>
          For DOM attributes, the <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a> is defined alongside
          the attribute definition.
          Unlike CSS properties, if such a definition is not provided the
          default <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a> is &#x201c;<a href="#dfn-not-animatable" class="internalDFN">not
          animatable</a>&#x201d;.
        </p>
        <p>
          Following is a series of pre-defined <a href="#dfn-animation-behavior" class="internalDFN">animation behaviors</a>.
          [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>] provides further CSS-specific <a href="#dfn-animation-behavior" class="internalDFN">animation
          behaviors</a>.
        </p>
        <p>
          For <a href="#dfn-animation-behavior" class="internalDFN">animation behaviors</a> that do not define a specific procedure
          for <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition</a> or which are defined as
          <dfn id="dfn-not-additive">not additive</dfn>, the <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition procedure</a> is simply
          <var>V</var><sub>res</sub> = <var>V</var><sub>b</sub>.
        </p>
        <p>
          For <a href="#dfn-animation-behavior" class="internalDFN">animation behaviors</a> that do not define a specific procedure
          for <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulation</a>, the <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulation procedure</a> is identical
          to the <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition procedure</a> for that
          behavior.
        </p>
        <p>
          For <a href="#dfn-animation-behavior" class="internalDFN">animation behaviors</a> that do not define a specific procedure
          for <a href="#dfn-distance-computation" class="internalDFN">distance computation</a> or which are defined as <dfn id="dfn-not-paceable">not
          paceable</dfn>, the <a href="#dfn-distance-computation" class="internalDFN">distance computation</a> procedure is simply
          <var>distance</var> = 1.
        </p>
        <section id="not-animatable">
          <h5><span class="secno">4.1.3.1 </span>Not animatable</h5>
          <p>
            Some properties are specifically defined as <dfn id="dfn-not-animatable">not
            animatable</dfn>.
            For example, properties defining animation parameters are <a href="#dfn-not-animatable" class="internalDFN">not
            animatable</a> since doing so would create complex recursive
            behavior.
          </p>
          <p>
            Unlike other <a href="#dfn-animation-behavior" class="internalDFN">animation behaviors</a>, no procedures for
            <a title="animation interpolation" href="#dfn-animation-interpolation" class="internalDFN">interpolation</a>,
            <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition</a> and <a href="#dfn-distance-computation" class="internalDFN">distance
            computation</a> are defined for properties whose <a href="#dfn-animation-behavior" class="internalDFN">animation
            behavior</a> is <a href="#dfn-not-animatable" class="internalDFN">not animatable</a> since these properties should
            not be modified.
          </p>
          <p>
            An <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> that targets a property that is
            <a href="#dfn-not-animatable" class="internalDFN">not animatable</a> will still exhibit the usual behavior for
            an <a href="#dfn-animation-node" class="internalDFN">animation node</a> such as occupying time in an <a href="#dfn-animation-sequence" class="internalDFN">animation
            sequence</a> and delaying the firing of a <a href="#dfn-player" class="internalDFN">player</a>'s <a title="finish player event" href="#dfn-finish-player-event" class="internalDFN">finish event</a>.
          </p>
        </section>
        <section id="animatable-as-string">
          <h5><span class="secno">4.1.3.2 </span>Animatable as string</h5>
          <p>
            A <a href="#dfn-target-property" class="internalDFN">target property</a> that is <dfn id="dfn-animatable-as-string">animatable as string</dfn>
            has the following <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a>:
          </p>
          <ul>
            <li><a title="animation interpolation" href="#dfn-animation-interpolation" class="internalDFN">interpolation</a>:
              <div role="math" aria-describedby="math-string-interpolation" style="display: inline">
                <math xmlns="http://www.w3.org/1998/Math/MathML">
                  <msub><mi>V</mi><mn>res</mn></msub><mo>=</mo>
                  <mrow>
                    <mfenced open="{" close="">
                      <mtable>
                        <mtr>
                          <mtd columnalign="left">
                            <msub><mi>V</mi><mn>start</mn></msub>
                          </mtd>
                          <mtd columnalign="left">
                            <mtext>if&nbsp;</mtext><mi>p</mi>
                            <mo>&lt;</mo><mn>0.5</mn>
                          </mtd>
                        </mtr>
                        <mtr>
                          <mtd columnalign="left">
                            <msub><mi>V</mi><mn>end</mn></msub>
                          </mtd>
                          <mtd columnalign="left">
                            <mtext>if&nbsp;</mtext><mi>p</mi>
                            <mo>&#x2265;</mo><mn>0.5</mn>
                          </mtd>
                        </mtr>
                      </mtable>
                    </mfenced>
                  </mrow>
                </math>
                <div id="math-string-interpolation">
                  <var>V</var><sub>res</sub> =
                    <var>V</var><sub>start</sub>, if <var>p</var> &lt; 0.5 or
                    <var>V</var><sub>end</sub>, if <var>p</var> &#x2265; 0.5
                </div>
              </div>
          </li></ul>
        </section>
        <section id="animatable-as-real-number">
          <h5><span class="secno">4.1.3.3 </span>Animatable as real number</h5>
          <p>
            A <a href="#dfn-target-property" class="internalDFN">target property</a> that is <dfn id="dfn-animatable-as-real-number">animatable as real
            number</dfn> has the following <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a>:
          </p>
          <ul>
            <li><a title="animation interpolation" href="#dfn-animation-interpolation" class="internalDFN">interpolation</a>:
                <var>V</var><sub>res</sub> =
                  (1 - <var>p</var>) &#xd7; <var>V</var><sub>start</sub>
                  + <var>p</var> &#xd7; <var>V</var><sub>end</sub>
            </li><li><a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition</a>:
                  <var>V</var><sub>a</sub> + <var>V</var><sub>b</sub>
            </li><li><a href="#dfn-distance-computation" class="internalDFN">distance computation</a>:
                <var>distance</var> = |<var>V</var><sub>end</sub>
                                       - <var>V</var><sub>start</sub>|
          </li></ul>
        </section>
        <section id="animatable-as-length--percentage--or-calc">
          <h5><span class="secno">4.1.3.4 </span>Animatable as length, percentage, or calc</h5>
          <p>
            A <a href="#dfn-target-property" class="internalDFN">target property</a> that is <dfn id="dfn-animatable-as-length--percentage--or-calc">animatable as length,
            percentage, or calc</dfn> has the following <a href="#dfn-animation-behavior" class="internalDFN">animation
            behavior</a>:
          </p>
          <ul>
            <li><a title="animation interpolation" href="#dfn-animation-interpolation" class="internalDFN">interpolation</a>:
                as defined in [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>].
            </li><li><a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition</a>:
                calc(<var>V</var><sub>a</sub> + <var>V</var><sub>b</sub>)<br>
                (Nested <code>calc()</code> functions are expanded when
                determining the computed value as defined in <a href="http://www.w3.org/TR/css3-values/#calc-computed-value">CSS
                Values and Units</a> [<cite><a class="bibref" href="#bib-CSS3-VALUES">CSS3-VALUES</a></cite>].)
            </li><li><a href="#dfn-distance-computation" class="internalDFN">distance computation</a>: as with <a href="#dfn-animatable-as-real-number" class="internalDFN">animatable as real
                number</a> but using the <a href="http://www.w3.org/TR/CSS2/cascade.html#used-value">used
                value</a> [<cite><a class="bibref" href="#bib-CSS21">CSS21</a></cite>] for <var>V</var><sub>start</sub> and
                <var>V</var><sub>end</sub>.
          </li></ul>
        </section>
        <section id="animatable-as-color">
          <h5><span class="secno">4.1.3.5 </span>Animatable as color</h5>
          <p>
            A <a href="#dfn-target-property" class="internalDFN">target property</a> that is <dfn id="dfn-animatable-as-color">animatable as color</dfn> has
            the following <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a>:
          </p>
          <ul>
            <li><a title="animation interpolation" href="#dfn-animation-interpolation" class="internalDFN">interpolation</a>:
                as defined in [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>].
            </li><li><a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition</a>:
                as with <a href="#dfn-animatable-as-real-number" class="internalDFN">animatable as real number</a> but performed on each
                RGBA color component in premultiplied space.
                <p class="note">
                  Since negative color is not currently supported, clamping of
                  the channel values may be performed upon each addition or once
                  when <a>composition</a> is complete.
                </p>
            </li><li><a href="#dfn-distance-computation" class="internalDFN">distance computation</a>:
                <blockquote>
                <div role="math" aria-describedby="math-color-distance">
                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                  <mrow>
                    <mi>distance</mi><mo>=</mo>
                    <msqrt>
                      <msup>
                        <mrow>
                          <mfenced open="(" close=")" separators=",">
                            <mrow><msub><mi>R</mi><mn>end</mn></msub>
                                  <mo>-</mo>
                                  <msub><mi>R</mi><mn>start</mn></msub></mrow>
                          </mfenced>
                        </mrow><mn>2</mn>
                      </msup>
                      <mo>+</mo>
                      <msup>
                        <mrow>
                          <mfenced open="(" close=")" separators=",">
                            <mrow><msub><mi>G</mi><mn>end</mn></msub>
                                  <mo>-</mo>
                                  <msub><mi>G</mi><mn>start</mn></msub></mrow>
                          </mfenced>
                        </mrow><mn>2</mn>
                      </msup>
                      <mo>+</mo>
                      <msup>
                        <mrow>
                          <mfenced open="(" close=")" separators=",">
                            <mrow><msub><mi>B</mi><mn>end</mn></msub>
                                  <mo>-</mo>
                                  <msub><mi>B</mi><mn>start</mn></msub></mrow>
                            </mfenced>
                        </mrow><mn>2</mn>
                      </msup>
                      <mo>+</mo>
                      <msup>
                        <mrow>
                          <mfenced open="(" close=")" separators=",">
                            <mrow><msub><mi>A</mi><mn>end</mn></msub>
                                  <mo>-</mo>
                                  <msub><mi>A</mi><mn>start</mn></msub></mrow>
                          </mfenced>
                        </mrow><mn>2</mn>
                      </msup>
                    </msqrt>
                  </mrow>
                  </math>
                  <pre id="math-color-distance">sqrt((R<sub>end</sub>
                  - R<sub>start</sub>)^2 + (G<sub>end</sub>
                  - G<sub>start</sub>)^2 + (B<sub>end</sub>
                  - B<sub>start</sub>)^2 + (A<sub>end</sub>
                  - A<sub>start</sub>)^2)</pre>
                  </div>
                </blockquote>
                <div>
                  where &lt;<var>R|G|B|A</var><sub>start|end</sub>&gt;
                  represents the red, green, blue, or alpha channel of
                  <var>V</var><sub>start</sub> or <var>V</var><sub>end</sub>
                  respectively.
                  Each value is normalized to the [0.0, 1.0] range and expressed
                  in premultiplied color space.
                </div>
          </li></ul>
          <p class="issue">
            Should we call this &#x201c;animatable as premultiplied RGBA additive
            color in sRGB color space&#x201d; instead?
          </p>
        </section>
        <section id="animatable-as-transform-list">
          <h5><span class="secno">4.1.3.6 </span>Animatable as transform list</h5>
          <p>
            A <a href="#dfn-target-property" class="internalDFN">target property</a> that is <dfn id="dfn-animatable-as-transform-list">animatable as transform
            list</dfn> has the following <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a>:
          </p>
          <ul>
            <li><a title="animation interpolation" href="#dfn-animation-interpolation" class="internalDFN">interpolation</a>:
                as defined in <a href="http://www.w3.org/TR/css3-transforms/#interpolation-of-transforms">Interpolation
                of Transforms</a> [<cite><a class="bibref" href="#bib-CSS3-TRANSFORMS">CSS3-TRANSFORMS</a></cite>].
            </li><li><a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition</a>: performed by
                concatenating transform lists as 
                &#x2018;<var>V</var><sub>a</sub> <var>V</var><sub>b</sub>&#x2019;.
            </li><li><a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulation</a>:
              <ol>
                <li>Beginning at the end of each list, <var>V</var><sub>a</sub>
                    and <var>V</var><sub>b</sub>,
                    find the largest contiguous portion of each list where the
                    corresponding list elements from each list have the same
                    transform type.
                    Call the matching portions from <var>V</var><sub>a</sub> and
                    <var>V</var><sub>b</sub>, <var>V</var><sub>matching-a</sub>
                    and
                    <var>V</var><sub>matching-b</sub> respectively and likewise
                    <var>V</var><sub>remainder-a</sub> and
                    <var>V</var><sub>remainder-b</sub> for the non-matching
                    parts.
                    <p class="issue">
                      We should probably expand 2d functions to their 3d
                      equivalents before matching?
                    </p>
                </li><li>Let <var>V</var><sub>combined</sub> be a transform list
                    combining <var>V</var><sub>matching-a</sub> and
                    <var>V</var><sub>matching-b</sub> by adding the numeric
                    components of each corresponding function.
                    <p class="issue">
                      This needs to be more specific, e.g. when combining
                      <code>translate(20px)</code> and <code>translate(30px
                      10px)</code> we have to expand the first function to
                      <code>translate(20px 0px)</code> first.
                      Probably need to define unit conversion too.
                    </p>
                </li><li>The result of accumulation is a transform list created by <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">adding</a> the combined result
                    with the non-matching portions of the two lists as follows:
                    &#x2018;<var>V</var><sub>remainder-a</sub> 
                    <var>V</var><sub>remainder-b</sub>
                    <var>V</var><sub>combined</sub>&#x2019;.
              </li></ol>
            </li><li><a href="#dfn-distance-computation" class="internalDFN">distance computation</a>: <span class="todo">See issue
                below</span>
          </li></ul>
          <div class="issue">
            <p>
              For <a href="#dfn-distance-computation" class="internalDFN">distance computation</a> we previously defined it as
              follows:
            </p>
            <ol>
              <li>Look only at the first component of the two lists
              </li><li>If both are translate &#x2192; euclidean distance
              </li><li>If both are scale &#x2192; absolute difference
              </li><li>If both are rotate &#x2192; absolute difference
              </li><li>If both match but are something else &#x2192; use linear
              </li><li>If they don't match &#x2192; use matrix decomposition and
                  euclidean distance between translate components
            </li></ol>
            <p>
              This seems really arbitrary, especially part 5.
            </p>
            <p>
              Also, looking at only the first component seems odd.
              Going through each component, working out the distance and then
              getting the square of the distance also seems much more consistent
              with what we do elsewhere.
            </p>
          </div>
        </section>
        <section id="other-animation-behaviors">
          <h5><span class="secno">4.1.3.7 </span>Other animation behaviors</h5>
          <p>
            The set of <a href="#dfn-animation-behavior" class="internalDFN">animation behaviors</a> defined here may be extended
            by other specifications.
            For example, properties with using the &lt;image&gt; type are
            animated using the interpolation behavior defined in <a href="http://dev.w3.org/csswg/css-images-4/#interpolation">CSS Image
            Values and Replaced Content</a>
            [<cite><a class="bibref" href="#bib-CSS4-IMAGES">CSS4-IMAGES</a></cite>].
          </p>
          <div class="issue">
            <p>
              There are a bunch of CSS properties for which distance (and in
              some cases addition) is not defined or which need special
              handling.
            </p>
            <p>
              For example,
            </p>
            <ul>
              <li>font-stretch (an enum but handled like an integer)
              </li><li>visibility (0 or 1 depending on if endpoints match or not)
              </li><li>flex-grow and flex-shrink which allow animation only if one of
                  the endpoints is 0)
              </li><li>value pairs, triples (use square distance)
              </li><li>rects (use square distance)
              </li><li>dash arrays (square distance but a bit weird due to
                               percentages)
              </li><li>shadows (square distance of components)
              </li><li>filters (undefined)
              </li><li>background-position (special list handling needed)
              </li><li>pair lists
            </li></ul>
            <p>
              Should we define these here or in the CSS Animation 4 spec?
            </p>
          </div>
        </section>
      </section>
      <section id="intermediate-animation-values">
        <h4><span class="secno">4.1.4 </span>Intermediate animation values</h4>
        <p>
          Given a <a href="#dfn-time-fraction" class="internalDFN">time fraction</a>, a <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>, and an
          <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>, an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> produces
          an <dfn id="dfn-intermediate-animation-value">intermediate animation value</dfn> for each <a>animatable</a>
          <a href="#dfn-target-property" class="internalDFN">target property</a>.
          The procedure for calculating this value depends on the specific
          type of <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> and is defined subsequently (see <a href="#the-intermediate-animation-value-of-a-keyframe-animation-effect" class="sectionRef">section 4.3.2 The intermediate animation value of a keyframe animation effect</a> and <a href="#the-intermediate-animation-value-of-a-motion-path-animation-effect" class="sectionRef">section 4.4.4 The intermediate animation value of a motion path animation effect</a>).
        </p>
        <p>
          Before being applied to the <a title="target property" href="#dfn-target-property" class="internalDFN">target
          properties</a>,
          these <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> are composed together using
          the process defined in <a href="#combining-animations" class="sectionRef">section 4.2 Combining animations</a>.
        </p>
      </section>
    </section>

    <section id="combining-animations">
      <h3><span class="secno">4.2 </span>Combining animations</h3>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          After calculating the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> for an
          <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>, they are applied to the <a href="#dfn-animation-effect" class="internalDFN">animation
          effect</a>'s <a title="target property" href="#dfn-target-property" class="internalDFN">target properties</a>.
        </p>
        <p>
          Since it is possible for multiple <a href="#dfn-in-effect" class="internalDFN">in effect</a> <a title="animation" href="#dfn-animation" class="internalDFN">animations</a> to target the same property it is
          often necessary to combine the results of several <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a> together.
          This process is called <em>compositing</em> and is based on
          establishing an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> for each property targetted by
          an <a href="#dfn-in-effect" class="internalDFN">in effect</a> <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>.
        </p>
        <p>
          After compositing the results of <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a> together, the composited result is combined with other
          values specified for the <a href="#dfn-target-property" class="internalDFN">target property</a>.
        </p>
        <p>
          For a CSS <a href="#dfn-target-property" class="internalDFN">target property</a> the arrangement is illustrated below:
        </p>
        <div class="figure">
          <img src="img/animation-cascade.svg" width="450" alt="Overview of the application of intermediate animation values
                to their target properties">
        </div>
        <p class="caption">
          Overview of the application of <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> to
          their <a>target properties</a>.<br>
          The results of <a href="#dfn-animation-effect" class="internalDFN">animation effects</a> targetting the same property
          are composited together using an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>.<br>
          The result of this composition is written to an animation stylesheet
          that is more important than other stylesheets but less than any
          <code>!important</code> rules.
        </p>
        <p>
          For a <a href="#dfn-target-property" class="internalDFN">target property</a> that specifies a DOM attribute, the
          composited result is combined with the value of the attribute
          specified in the DOM or the lacuna value for that attribute if it is
          not specified.
        </p>
        <p>
          For the first part of this operation&#x2014;combining <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate
          animation values</a> that target the same <a title="target property" href="#dfn-target-property" class="internalDFN">property</a>&#x2014; it is necessary to
          determine both
          <em>how</em> the <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>
          associated with the <a href="#dfn-animation" class="internalDFN">animations</a> are combined
          with one another,
          as well as the <em>order</em> in which they are applied, that is,
          their relative <em>priority</em>.
        </p>
        <p>
          The matter of <em>how</em> <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> are
          combined is governed by the <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> of
          the corresponding <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>.
        </p>
        <p>
          The relative <em>priority</em> of <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a>
          is determined by an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> established for each
          animated property.
        </p>
      </div>
      <section id="the-animation-stack">
        <h4><span class="secno">4.2.1 </span>The animation stack</h4>
        <p>
          Associated with each property <a title="target property" href="#dfn-target-property" class="internalDFN">targetted</a>
          by one or more <a href="#dfn-animation-effect" class="internalDFN">animation effects</a> is an <dfn id="dfn-animation-stack">animation
          stack</dfn> that establishes the relative priority of the <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a>.
        </p>
        <p>
          The relative priority of any two <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a>, <var>A</var> and <var>B</var>, within an <a href="#dfn-animation-stack" class="internalDFN">animation
          stack</a> is established by comparing the properties of the
          <a href="#dfn-animation" class="internalDFN">animations</a> applying <var>A</var> and <var>B</var> as follows:
        </p>
        <ol>
          <li>Let the <dfn id="dfn-associated-player-of-an-animation-effect">associated player of an animation effect</dfn>
              be the <a href="#dfn-player" class="internalDFN">player</a> <a title="associated with a player" href="#dfn-associated-with-a-player" class="internalDFN">associated</a> with the
              <a href="#dfn-animation" class="internalDFN">animation</a> that is applying the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> to
              the property with which this <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> is
              associated.
          </li><li>Sort <var>A</var> and <var>B</var> by applying the following
              conditions in turn until the order is resolved,
            <ol>
              <li>Sort <var>A</var> and <var>B</var> using any <a href="#dfn-custom-player-priority" class="internalDFN">custom
                  player priority</a> specified for the <a title="associated player of an animation effect" href="#dfn-associated-player-of-an-animation-effect" class="internalDFN">associated
                  player</a> of each of <var>A</var> and
                  <var>B</var> so that lower priorities sort first.
              </li><li>Sort by the <a href="#dfn-player-sequence-number" class="internalDFN">player sequence number</a> so that lower
                  sequence numbers sort first.
              </li><li>Sort <var>A</var> and <var>B</var> in <a href="#dfn-tree-order" class="internalDFN">tree order</a>.
                  (By this point, <var>A</var> and <var>B</var> must have the
                  same <a href="#dfn-player" class="internalDFN">player</a> since otherwise the order would have been
                  resolved in the previous step.)
           </li></ol>
        </li></ol>
        <p>
          <a href="#dfn-animation-effect" class="internalDFN">Animation effects</a> that sort earlier have <em>lower</em>
          priority.
        </p>
        <section id="the-custom-player-priority">
          <h5><span class="secno">4.2.1.1 </span>The custom player priority</h5>
          <p>
            Each <a href="#dfn-player" class="internalDFN">player</a> has an associated numeric <dfn id="dfn-custom-player-priority">custom player
            priority</dfn> that is used to provide high-level control of
            animation priority for specifications layered on top of Web
            Animations.
            The initial value of the <a href="#dfn-custom-player-priority" class="internalDFN">custom player priority</a> is zero.
          </p>
          <div class="note">
            <p>
              Note that the <a href="#dfn-custom-player-priority" class="internalDFN">custom player priority</a> is primarily
              intended to be used to prioritize animations at
              a high-level, such as to prioritize animations <em>by type</em>.
              For example, it can be used to ensure that CSS Animations always
              override CSS Transitions.
            </p>
            <p>
              It is possible to control animation priority at a lower-level by
              setting the <a href="#dfn-player-start-time" class="internalDFN">player start time</a> appropriately,
              (possibly after making compensatory adjustments to the <a href="#dfn-start-delay" class="internalDFN">start
              delay</a> of the <a href="#dfn-source-content" class="internalDFN">source content</a>) or influencing the
              <a href="#dfn-player-sequence-number" class="internalDFN">player sequence number</a> by controlling when <a href="#dfn-player" class="internalDFN">players</a>
              are created.
            </p>
          </div>
        </section>
      </section>
      <section id="calculating-the-result-of-an-animation-stack">
        <h4><span class="secno">4.2.2 </span>Calculating the result of an animation stack</h4>
        <p>
          In order to calculate the final value of an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>,
          the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> of each
          <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> in the stack are combined in order of priority
          from lowest to highest priority.
        </p>
        <p>
          Each step in the process of evaluating an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> takes
          an <dfn id="dfn-underlying-value">underlying value</dfn> as input.
        </p>
        <p>
          For each <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> in the stack, the appropriate
          <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> from the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>
          is combined with the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> to produce a new value.
          This resulting value becomes the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> for combining
          the next <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> in the stack.
        </p>
        <p>
          The final value of an <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>, called the
          <dfn id="dfn-composited-value">composited value</dfn>, is simply the result of combining the
          <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> of the final (highest priority)
          <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> in the stack with the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>
          at that point.
        </p>
      </section>
      <section id="animation-composition">
        <h4><span class="secno">4.2.3 </span>Animation composition</h4>
        <p>
          The specific operation used to combine an <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation
          value</a> with an <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> is determined by the
          <dfn id="dfn-composite-operation">composite operation</dfn> of the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> that
          produced the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a>.
        </p>
        <p>
          This specification defines three <a href="#dfn-composite-operation" class="internalDFN">composite operations</a> as
          follows:
        </p>
        <dl>
          <dt><dfn title="composite operation replace" id="dfn-composite-operation-replace">replace</dfn></dt>
          <dd>
            The result of compositing the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a>
            with the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> is simply the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate
            animation value</a>.
          </dd>
          <dt><dfn title="composite operation add" id="dfn-composite-operation-add">add</dfn></dt>
          <dd>
            <p>
              The <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> is <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">added</a> to the <a href="#dfn-underlying-value" class="internalDFN">underlying
              value</a>.
              For <a href="#dfn-animation-behavior" class="internalDFN">animation behaviors</a> where the
              <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition operation</a> is defined
              such that it is not commutative, the order of the operands is
              <code><a href="#dfn-underlying-value" class="internalDFN">underlying value</a> + <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation
              value</a></code>.
            </p>
          </dd>
          <dt><dfn title="composite operation accumulate" id="dfn-composite-operation-accumulate">accumulate</dfn></dt>
          <dd>
            <p>
              The <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> is <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulated</a>
              onto the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>.
              For <a>animation behaviours</a> where the
              <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulation operation</a> is
              defined such that it is not commutative, the order of the operands
              is <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> followed by <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation
              value</a>.
            </p>
          </dd>
        </dl>
      </section>
      <section id="applying-the-composited-result">
        <h4><span class="secno">4.2.4 </span>Applying the composited result</h4>
        <p>
          The process for a applying a <a href="#dfn-composited-value" class="internalDFN">composited value</a> depends on if the
          <a href="#dfn-target-property" class="internalDFN">target property</a> refers to a CSS property or a DOM attribute.
        </p>
        <section id="applying-the-result-to-a-css-property">
          <h5><span class="secno">4.2.4.1 </span>Applying the result to a CSS property</h5>
          <p>
            Applying a <a href="#dfn-composited-value" class="internalDFN">composited value</a> to a CSS <a href="#dfn-target-property" class="internalDFN">target property</a>
            depends on establishing an <a href="#dfn-animation-stylesheet" class="internalDFN">animation stylesheet</a>.
          </p>
          <p>
            The <dfn id="dfn-animation-stylesheet">animation stylesheet</dfn> contains
            <a title="composited value" href="#dfn-composited-value" class="internalDFN">composited animation values</a>
            and acts with a higher priority than all other stylesheets.
            However, <code>!important</code> rules from all other stylesheets
            act with a higher priority than the <a href="#dfn-animation-stylesheet" class="internalDFN">animation stylesheet</a>.
            The <a href="#dfn-animation-stylesheet" class="internalDFN">animation stylesheet</a> is regenerated each time the
            <a>animation model</a> is updated (see <a href="#animation-effects" class="sectionRef">section 4.1 Animation effects</a>).
          </p>
          <p>
            The <a href="#dfn-composited-value" class="internalDFN">composited value</a> calculated for a CSS <a href="#dfn-target-property" class="internalDFN">target
            property</a> is applied using the following process.
          </p>
          <ol>
            <li>Calculate the <var>base value</var> of the property as
                the value generated for that property by computing the <a href="http://www.w3.org/TR/CSS2/cascade.html#used-value">used
                value</a> [<cite><a class="bibref" href="#bib-CSS21">CSS21</a></cite>] for that property in the absence of the
                <a href="#dfn-animation-stylesheet" class="internalDFN">animation stylesheet</a>.
            </li><li>Establish the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> for the property (see <a href="#the-animation-stack" class="sectionRef">section 4.2.1 The animation stack</a>).</li>
            <li>Calculate the <a href="#dfn-composited-value" class="internalDFN">composited value</a> of the <a href="#dfn-animation-stack" class="internalDFN">animation
                stack</a> passing in the <var>base value</var> of the property
                as the initial <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> (see <a href="#calculating-the-result-of-an-animation-stack" class="sectionRef">section 4.2.2 Calculating the result of an animation stack</a>).
            </li><li>Insert the <a href="#dfn-composited-value" class="internalDFN">composited value</a> into the <a href="#dfn-animation-stylesheet" class="internalDFN">animation
                stylesheet</a>.
          </li></ol>
        </section>
        <section id="applying-the-composited-result-to-a-dom-attribute">
          <h5><span class="secno">4.2.4.2 </span>Applying the composited result to a DOM attribute</h5>
          <p>
            DOM attributes are, unless otherwise specified, <a href="#dfn-not-animatable" class="internalDFN">not
            animatable</a>.
            For each attribute that has a specific <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a>
            associated with it, an attribute value to use when the attribute is
            not specified or in error must be defined, referred to as the
            <dfn id="dfn-lacuna-value">lacuna value</dfn>.
            For example, SVG2 ([<cite><a class="bibref" href="#bib-SVG2">SVG2</a></cite>]) defines <a href="http://www.w3.org/TR/SVG2/intro.html#TermLacunaValue">lacunae
            values</a> for its attributes.
          </p>
          <p>
            The <a href="#dfn-composited-value" class="internalDFN">composited value</a> calculated for a DOM attribute <a href="#dfn-target-property" class="internalDFN">target
            property</a> is applied using the following process.
          </p>
          <ol>
            <li>Let the <var>base value</var> of the property be the value
                specified for attribute in the DOM or,
                if the attribute value is not specified in the DOM, the
                <a href="#dfn-lacuna-value" class="internalDFN">lacuna value</a> for that attribute.
            </li><li>Establish the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a> for the property (see <a href="#the-animation-stack" class="sectionRef">section 4.2.1 The animation stack</a>).</li>
            <li>Calculate the <a href="#dfn-composited-value" class="internalDFN">composited value</a> of the <a href="#dfn-animation-stack" class="internalDFN">animation
                stack</a> passing in the <var>base value</var> of the attribute
                as the initial <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> (see <a href="#calculating-the-result-of-an-animation-stack" class="sectionRef">section 4.2.2 Calculating the result of an animation stack</a>).</li>
            <li>Record the <a href="#dfn-composited-value" class="internalDFN">composited value</a> as the <dfn id="dfn-animated-attribute-value">animated
                attribute value</dfn> of the attribute.
          </li></ol>
          <p>
            The <a href="#dfn-animated-attribute-value" class="internalDFN">animated attribute value</a> does not replace the value of
            the attribute in the DOM although it may be accessible via some
            other interface.
            For all intents and purposes other than interaction with DOM
            interfaces, user agents must treat the <a href="#dfn-animated-attribute-value" class="internalDFN">animated attribute
            value</a> as the attribute value.
          </p>
        </section>
      </section>
      <section id="animation-accumulation">
        <h4><span class="secno">4.2.5 </span>Animation accumulation</h4>
        <p>
          Similar to the compositing performed between <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation
          values</a> (see <a href="#animation-composition" class="sectionRef">section 4.2.3 Animation composition</a>), the <dfn id="dfn-iteration-composite-operation">iteration composite operation</dfn>
          determines how values are combined between successive iterations of
          the same <a href="#dfn-animation" class="internalDFN">animation</a>.
        </p>
        <p>
          This specification defines two <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite operations</a>
          as follows:
        </p>
        <dl>
          <dt><dfn title="iteration composite operation replace" id="dfn-iteration-composite-operation-replace">replace</dfn>
          </dt>
          <dd>
            Each successive iteration is calculated independently of previous
            iterations.
          </dd>
          <dt><dfn title="iteration composite operation accumulate" id="dfn-iteration-composite-operation-accumulate">accumulate
          </dfn></dt>
          <dd>
            Successive iterations of the animation are <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulated</a> with the
            final value of the previous iteration.
          </dd>
        </dl>
        <p>
          The application of the <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite operation</a> is
          incorporated in the calculation of the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation
          value</a> for each type of <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>.
        </p>
      </section>
    </section>

    <section id="keyframe-animation-effects">
      <h3><span class="secno">4.3 </span>Keyframe animation effects</h3>
      <p>
        A <dfn id="dfn-keyframe-animation-effect">keyframe animation effect</dfn> is an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>
        that produces <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation values</a> for its <a>target
        properties</a> by interpolating between a series of property values
        positioned at fractional offsets.
      </p>
      <p>
        Each set of property values indexed by an offset is called
        a <dfn id="dfn-keyframe">keyframe</dfn>.
      </p>
      <p>
        The <dfn title="keyframe offset" id="dfn-keyframe-offset">offset of a keyframe</dfn> is a value
        in the range [0, 1] or the special value null.
        The list of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> for a <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effect</a> is
        <dfn id="dfn-loosely-sorted-by-offset">loosely sorted by offset</dfn> which means that for each
        <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in the list that has a <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> that is
        not null, the offset is greater than or equal to the offset of the
        previous <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in the list with a <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> that
        is not null, if any.
      </p>
      <p>
        The behavior when <a href="#dfn-keyframe" class="internalDFN">keyframes</a> overlap or have unsupported values
        is defined in <a href="#the-intermediate-animation-value-of-a-keyframe-animation-effect" class="sectionRef">section 4.3.2 The intermediate animation value of a keyframe animation effect</a>.
      </p>
      <p>
        Each keyframe also has a <a href="#dfn-timing-function" class="internalDFN">timing function</a> associated with it
        that is applied to the period of time between the keyframe on which it
        is specified and the <em>next</em> keyframe in the list.
        The <a href="#dfn-timing-function" class="internalDFN">timing function</a> specified on the last keyframe in the
        list is never applied.
      </p>
      <p>
        In addition to the <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> specified on the
        <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>, each <a href="#dfn-keyframe" class="internalDFN">keyframe</a> may also have an
        associated <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> that is applied to all values
        specified in that <a href="#dfn-keyframe" class="internalDFN">keyframe</a>.
        If no <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> is specified for a <a href="#dfn-keyframe" class="internalDFN">keyframe</a>,
        the <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> specified for the <a href="#dfn-animation-effect" class="internalDFN">animation
        effect</a> is used.
      </p>
      <section id="spacing-keyframes"> 
        <h4><span class="secno">4.3.1 </span>Spacing keyframes</h4>
        <div class="informative informative-bg">
          <p><em>This section is non-normative.</em></p><p>
            It is often useful to be able to provide a series of property values
            without having calculate the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of each value in
            time but instead to rely on some automatic spacing.
          </p>
          <p>
            For example, rather than typing:
          </p>
          <pre class="example sh_javascript sh_sourceCode">elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">([</span> <span class="sh_cbracket">{</span> color<span class="sh_symbol">:</span> <span class="sh_string">'blue'</span><span class="sh_symbol">,</span> offset<span class="sh_symbol">:</span> <span class="sh_number">0</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
               <span class="sh_cbracket">{</span> color<span class="sh_symbol">:</span> <span class="sh_string">'green'</span><span class="sh_symbol">,</span> offset<span class="sh_symbol">:</span> <span class="sh_number">1</span><span class="sh_symbol">/</span><span class="sh_number">3</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
               <span class="sh_cbracket">{</span> color<span class="sh_symbol">:</span> <span class="sh_string">'red'</span><span class="sh_symbol">,</span> offset<span class="sh_symbol">:</span> <span class="sh_number">2</span><span class="sh_symbol">/</span><span class="sh_number">3</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
               <span class="sh_cbracket">{</span> color<span class="sh_symbol">:</span> <span class="sh_string">'yellow'</span><span class="sh_symbol">,</span> offset<span class="sh_symbol">:</span> <span class="sh_number">1</span> <span class="sh_cbracket">}</span> <span class="sh_symbol">],</span> <span class="sh_number">2000</span><span class="sh_symbol">);</span></pre>
          <p>
            It should be possible to type the following and allow the user agent
            to calculate the <a title="keyframe offset" href="#dfn-keyframe-offset" class="internalDFN">offset</a> of each
            keyframe:
          </p>
          <pre class="example sh_javascript sh_sourceCode">elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">([</span> <span class="sh_cbracket">{</span> color<span class="sh_symbol">:</span> <span class="sh_string">'blue'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
               <span class="sh_cbracket">{</span> color<span class="sh_symbol">:</span> <span class="sh_string">'green'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
               <span class="sh_cbracket">{</span> color<span class="sh_symbol">:</span> <span class="sh_string">'red'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
               <span class="sh_cbracket">{</span> color<span class="sh_symbol">:</span> <span class="sh_string">'yellow'</span> <span class="sh_cbracket">}</span> <span class="sh_symbol">],</span> <span class="sh_number">2000</span><span class="sh_symbol">);</span></pre>
          <p>
            Web Animations provides spacing modes for this purpose. The default
            spacing mode for keyframe animation effects is
            &#x201c;<a title="distribute keyframe spacing mode" href="#dfn-distribute-keyframe-spacing-mode" class="internalDFN">distribute</a>&#x201d; which
            produces the result described above.
          </p>
          <p>
            The other spacing mode, &#x201c;<a title="paced keyframe spacing mode" href="#dfn-paced-keyframe-spacing-mode" class="internalDFN">paced</a>&#x201d;, is useful when
            it is desirable to maintain an even rate of change such as for <a href="#motion-path-animation-effects">motion path animation</a>.
          </p>
          <p>
            For example, consider the following animation:
          </p>
          <pre class="example sh_javascript sh_sourceCode">elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">([</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'0px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
               <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'-20px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
               <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
               <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'50px'</span> <span class="sh_cbracket">}</span> <span class="sh_symbol">],</span> <span class="sh_number">1000</span><span class="sh_symbol">);</span></pre>
          <p>
            The resulting value of the <span class="prop-name">left</span>
            property is illustrated below:
          </p>
          <div class="figure">
            <img src="img/spacing-distribute.svg" width="350" alt="The animated value of the left property over time when applying the distribute spacing mode.
The values are evenly spaced in time but the rate of change differs for each segment as indicated the varying slope of the graph.">
          </div>
          <p class="caption">
            The animated value of the left property over time when applying the
            <a title="distribute keyframe spacing mode" href="#dfn-distribute-keyframe-spacing-mode" class="internalDFN">distribute</a> spacing
            mode.
            The values are evenly spaced in time but the rate of change differs
            for each segment as indicated the varying slope of the graph.
          </p>
          <p>
            We can use the <a title="paced keyframe spacing mode" href="#dfn-paced-keyframe-spacing-mode" class="internalDFN">paced</a>
            spacing mode as follows:
          </p>
          <pre class="example sh_javascript sh_sourceCode">elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span>
  <span class="sh_keyword">new</span> <span class="sh_function">KeyframeEffect</span><span class="sh_symbol">([</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'0px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
                       <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'-20px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
                       <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
                       <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'50px'</span> <span class="sh_cbracket">}</span> <span class="sh_symbol">],</span> <span class="sh_cbracket">{</span> spacing<span class="sh_symbol">:</span> <span class="sh_string">"paced"</span> <span class="sh_cbracket">}</span><span class="sh_symbol">),</span> <span class="sh_number">1000</span><span class="sh_symbol">);</span></pre>
          <p>
            The result is illustrated below:
          </p>
          <div class="figure">
            <img src="img/spacing-paced.svg" width="350" alt="The animated value of the left property over time when applying the paced spacing mode.
The absolute value of the slope is graph is equal for all segments of the animation indicating a constant rate of change.">
          </div>
          <p class="caption">
            The animated value of the left property over time when applying the
            <a title="paced keyframe spacing mode" href="#dfn-paced-keyframe-spacing-mode" class="internalDFN">paced</a> spacing mode.
            The absolute value of the slope is graph is equal for all segments
            of the animation indicating a constant rate of change.
          </p>
          <p>
            It is also possible to combine fixed <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offsets</a> with
            spacing modes as follows:
          </p>
          <pre class="example sh_javascript sh_sourceCode">elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span>
  <span class="sh_keyword">new</span> <span class="sh_function">KeyframeEffect</span><span class="sh_symbol">([</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'0px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
                       <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'-20px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
                       <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span><span class="sh_symbol">,</span> offset<span class="sh_symbol">:</span> <span class="sh_number">0.5</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
                       <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'50px'</span> <span class="sh_cbracket">}</span> <span class="sh_symbol">],</span> <span class="sh_cbracket">{</span> spacing<span class="sh_symbol">:</span> <span class="sh_string">"paced"</span> <span class="sh_cbracket">}</span><span class="sh_symbol">),</span> <span class="sh_number">1000</span><span class="sh_symbol">);</span></pre>
          <p>
            The result is illustrated below:
          </p>
          <div class="figure">
            <img src="img/spacing-paced-with-offset.svg" width="350" alt="The animated value of the left property over time when applying the paced spacing mode and a fixed offset that puts the 100px value at 0.5.
The slope of the graph is equal for the first two segments but changes for the last segment in order to accommodate the fixed offset.">
          </div>
          <p class="caption">
            The animated value of the left property over time when applying the
            <a title="paced keyframe spacing mode" href="#dfn-paced-keyframe-spacing-mode" class="internalDFN">paced</a> spacing mode and
            a fixed <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> that
            puts the 100px value at 0.5.
            The slope of the graph is equal for the first two segments but
            changes for the last segment in order to accommodate the fixed
            offset.
          </p>
        </div>
        <p>
          Before calculating animation values from a <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation
          effect</a>, an absolute value must be computed for the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe
          offset</a> of each <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with a null offset.
          The values computed depend on the <dfn id="dfn-keyframe-spacing-mode">keyframe spacing mode</dfn>
          specified for the <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effect</a>.
          The keyframe spacing modes are:
        </p>
        <dl>
          <dt><dfn title="distribute keyframe spacing mode" id="dfn-distribute-keyframe-spacing-mode">distribute</dfn></dt>
          <dd>
            Indicates that <a href="#dfn-keyframe" class="internalDFN">keyframes</a> with a null <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a>
            null are positioned so that the difference between subsequent
            <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offsets</a> are equal.
          </dd>
          <dt><dfn title="paced keyframe spacing mode" id="dfn-paced-keyframe-spacing-mode">paced</dfn></dt>
          <dd>
            Indicates that <a href="#dfn-keyframe" class="internalDFN">keyframes</a> with a null <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a>
            null are positioned so that the <em>distance</em> between subsequent
            values of a specified <dfn id="dfn-paced-property">paced property</dfn> are equal.
            The distance is calculated using the <a href="#dfn-distance-computation" class="internalDFN">distance computation</a>
            procedure defined by the <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a> associated
            with the <a href="#dfn-paced-property" class="internalDFN">paced property</a>.
          </dd>
        </dl>
        <section id="applying-spacing-to-keyframes">
          <h5><span class="secno">4.3.1.1 </span>Applying spacing to keyframes</h5>
          <p>
            We define a generic procedure for <dfn id="dfn-evenly-distributing-a-keyframe">evenly distributing
            a keyframe</dfn>, <var>keyframe</var>, between two reference
            keyframes, <var>start</var> and <var>end</var>, whose <a href="#dfn-keyframe-offset" class="internalDFN">keyframe
            offsets</a> are <em>not</em> null, as follows:
          </p>
          <ol>
            <li>Let <dfn id="dfn-offsetk">offset<sub><var>k</var></sub></dfn> be the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe
                offset</a> of a <a href="#dfn-keyframe" class="internalDFN">keyframe</a> <var>k</var>.
            </li><li>Let <var>n</var> be the number of keyframes <em>between</em> and
                including <var>start</var> and <var>end</var> minus 1.
            </li><li>Let <var>index</var> refer to the position of
                <var>keyframe</var> in the sequence of keyframes between
                <var>start</var> and <var>end</var> such that the first keyframe
                after <var>start</var> has an <var>index</var> of 1.
            </li><li>Set the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of <var>keyframe</var> to
                <a title="offsetk" href="#dfn-offsetk" class="internalDFN">offset</a><sub><var>start</var></sub> +
                (<a title="offsetk" href="#dfn-offsetk" class="internalDFN">offset</a><sub><var>end</var></sub> &#x2212;
                 <a title="offsetk" href="#dfn-offsetk" class="internalDFN">offset</a><sub><var>start</var></sub>)
                &#xd7; <var>index</var> / <var>n</var>.
          </li></ol>
          <p>
            The computed <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> values of each <a href="#dfn-keyframe" class="internalDFN">keyframe</a>
            with a null keyframe offset are determined using the following
            procedure.
          </p>
          <ol>
            <li>Let <var>keyframes</var> refer to the list of <a href="#dfn-keyframe" class="internalDFN">keyframes</a>
                associated with the <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effect</a>.
            </li><li>If <var>keyframes</var> contains more than one
                <a href="#dfn-keyframe" class="internalDFN">keyframe</a> and the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of
                the first <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>keyframes</var> is null,
                set the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of
                the first <a href="#dfn-keyframe" class="internalDFN">keyframe</a> to 0.
            </li><li>If the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of the last <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in
                <var>distributed keyframes</var> is null, set its
                <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> to 1.
            </li><li>For each pair of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> <var>A</var> and <var>B</var>
                where:
                <ul>
                  <li><var>A</var> appears before <var>B</var> in
                      <var>keyframes</var>, and
                  </li><li><var>A</var> and <var>B</var> have a <a href="#dfn-keyframe-offset" class="internalDFN">keyframe
                      offset</a> that is not null, and
                  </li><li>all <a href="#dfn-keyframe" class="internalDFN">keyframes</a> between <var>A</var> and <var>B</var>
                      have a null <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a>,
                </li></ul>
                <p>
                  calculate the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of
                  each <a href="#dfn-keyframe" class="internalDFN">keyframe</a> between <var>A</var> and <var>B</var>
                  depending on the <a href="#dfn-keyframe-spacing-mode" class="internalDFN">keyframe spacing mode</a> as follows:
                </p>
                <dl class="switch">
                  <dt>If the <a title="keyframe spacing mode" href="#dfn-keyframe-spacing-mode" class="internalDFN">spacing mode</a>
                      is <a title="paced keyframe spacing mode" href="#dfn-paced-keyframe-spacing-mode" class="internalDFN">paced</a>,</dt>
                  <dd>
                    <ol>
                      <li>Define a keyframe as <dfn id="dfn-paceable">paceable</dfn> if it
                          contains a value for the <a href="#dfn-paced-property" class="internalDFN">paced property</a>.
                      </li><li>Let <var>paced A</var> be the first keyframe in the
                          range [<var>A</var>, <var>B</var>] that is
                          <a href="#dfn-paceable" class="internalDFN">paceable</a>, if any.
                      </li><li>Let <var>paced B</var> be the last keyframe in the
                          range [<var>A</var>, <var>B</var>] that is
                          <a href="#dfn-paceable" class="internalDFN">paceable</a>, if any.
                      </li><li>If there is no <var>paced A</var> or <var>paced
                          B</var> let both refer to <var>B</var>.
                          <!-- I want to mark this up as an inline note but
                               currently respec's CSS for notes doesn't play
                               will with inlines. -->
                          <span>Note that in this case, the spacing
                          behavior degenerates to <a title="distribute keyframe spacing mode" href="#dfn-distribute-keyframe-spacing-mode" class="internalDFN">distribute</a>
                          spacing.
                      </span></li><li>For each keyframe in the range
                          (<var>A</var>, <var>paced A</var>] and
                          [<var>paced B</var>, <var>B</var>),
                          apply the procedure for <a href="#dfn-evenly-distributing-a-keyframe" class="internalDFN">evenly distributing
                          a keyframe</a> using <var>A</var> and <var>B</var> as
                          the <var>start</var> and <var>end</var> keyframes
                          respectively.
                          <div class="annotation">
                            Yes, this is correct.
                            We want, <var>index</var> and <var>n</var> in that
                            procedure to reflect <em>all</em> the keyframes
                            between <var>A</var> and <var>B</var>, not just the
                            keyframes between, for example, <var>A</var> and
                            <var>spaced A</var>.
                          </div>
                      </li><li>For each keyframe in the range
                          (<var>paced A</var>, <var>paced B</var>) that is
                          <a href="#dfn-paceable" class="internalDFN">paceable</a>:
                        <ol>
                          <li>Let
                            <dfn title="distk" id="dfn-distk">dist<sub><var>k</var></sub></dfn>
                            represent the cumulative distance to a keyframe
                            <var>k</var> from <var>paced A</var>
                            as calculated by applying the <a href="#dfn-distance-computation" class="internalDFN">distance
                            computation</a> defined by the <a href="#dfn-animation-behavior" class="internalDFN">animation
                            behavior</a> of the <a href="#dfn-paced-property" class="internalDFN">paced property</a> to the
                            values of the <a href="#dfn-paced-property" class="internalDFN">paced property</a> on each pair of
                            successive <a href="#dfn-paceable" class="internalDFN">paceable</a> keyframes in the range
                            [<var>paced A</var>, <var>k</var>].
                          </li><li>Set the offset of <var>k</var> to
                            <a title="offsetk" href="#dfn-offsetk" class="internalDFN">offset</a><sub><var>paced
                              A</var></sub>
                            +
                            (<a title="offsetk" href="#dfn-offsetk" class="internalDFN">offset</a><sub><var>paced
                              B</var></sub>
                            &#x2212; 
                            <a title="offsetk" href="#dfn-offsetk" class="internalDFN">offset</a><sub><var>paced
                              A</var></sub>)
                            &#xd7;
                            <a title="distk" href="#dfn-distk" class="internalDFN">dist</a><sub><var>k</var></sub>
                            /
                            <a title="distk" href="#dfn-distk" class="internalDFN">dist</a><sub><var>paced
                              B</var></sub>
                        </li></ol>
                      </li><li>For each keyframe in the range (<var>paced A</var>,
                          <var>paced B</var>) that still has
                          a null <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> (because it is not
                          <a href="#dfn-paceable" class="internalDFN">paceable</a>), apply the procedure
                          for <a href="#dfn-evenly-distributing-a-keyframe" class="internalDFN">evenly distributing a keyframe</a> using
                          the nearest <a href="#dfn-keyframe" class="internalDFN">keyframe</a> before and after the
                          keyframe in question in <var>keyframes</var> that has
                          a <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> that is not null, as the
                          <var>start</var> and <var>end</var> keyframes
                          respectively.
                    </li></ol>
                  </dd>
                  <dt>Otherwise,</dt>
                  <dd>
                    Apply the procedure for <a href="#dfn-evenly-distributing-a-keyframe" class="internalDFN">evenly distributing
                    a keyframe</a> to each keyframe in the range (<var>A</var>,
                    <var>B</var>) using <var>A</var> and <var>B</var> as the
                    <var>start</var> and <var>end</var> keyframes respectively.
                  </dd>
                </dl>
          </li></ol>
          <div class="note">
            <p>
              Note that although the above procedure defines computing keyframe
              offsets in terms of overwriting null values, user agents that
              implement the <a href="#programming-interface">programming
              interface</a> are required to maintain the original null values as
              well as calculating the computed offsets.
              This is because the <code>getFrames</code> method of the
              <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a> interface returns keyframe offsets both
              before and after applying spacing.
            </p>
          </div>
          <div class="issue">
            <p>
              The above algorithm is quite complex.
              It attempts to cover all possible combinations of input where
              keyframe offsets and or paced property values may be missing.
              Furthermore, it attempts to do this in a way that degenerates
              consistently and also allows the author to combine fixed offsets
              with either pacing or distribute spacing.
              We await implementation experience to determine if the complexity
              is justified.
            </p>
          </div>
        </section>
      </section>
      <section id="the-intermediate-animation-value-of-a-keyframe-animation-effect">              
        <h4><span class="secno">4.3.2 </span>The intermediate animation value of a keyframe animation effect</h4>
        <p>
          The <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> of a single property
          referenced by a <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effect</a> as one of its
          <a title="target property" href="#dfn-target-property" class="internalDFN">target properties</a>, for a given
          <var>time fraction</var>, <var>current iteration</var> and
          <var>underlying value</var> is calculated as follows.
        </p>
        <ol>
          <li>Let <var>target property</var> be the property for which the
              <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> is to be calculated.
          </li><li>If <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a> of the <var>target property</var> is
              <a href="#dfn-not-animatable" class="internalDFN">not animatable</a> abort this procedure since the effect cannot
              be applied.
          </li><li>Define the <dfn id="dfn-neutral-value-for-composition">neutral value for composition</dfn> as a value
              which, when combined with an <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> using the <a title="composite operation add" href="#dfn-composite-operation-add" class="internalDFN">add</a> <a href="#dfn-composite-operation" class="internalDFN">composite
              operation</a>, produces the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>.
          </li><li>Let <var>property-specific keyframes</var> be a copy of the list
              of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> specified on the effect.
          </li><li>Remove any <a href="#dfn-keyframe" class="internalDFN">keyframes</a> from <var>property-specific
              keyframes</var> that do not have a property value for
              <var>target property</var>.
          </li><li>If <var>property-specific keyframes</var> is empty, return
              <var>underlying value</var>.
          </li><li>If there is no <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>property-specific
              keyframes</var> with a <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of
              0, create a new <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with a <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of
              0, a property value set to the <a href="#dfn-neutral-value-for-composition" class="internalDFN">neutral value for
              composition</a>, and a <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> of <a title="composite operation add" href="#dfn-composite-operation-add" class="internalDFN">add</a>, and prepend it to the
              beginning of <var>property-specific keyframes</var>.
          </li><li>Similarly, if there is no <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in
              <var>property-specific keyframes</var> with a <a href="#dfn-keyframe-offset" class="internalDFN">keyframe
              offset</a> of 1,
              create a new <a href="#dfn-keyframe" class="internalDFN">keyframe</a> with a <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of 1,
              a property value set to the <a href="#dfn-neutral-value-for-composition" class="internalDFN">neutral value for composition</a>,
              and a <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> of <a title="composite operation add" href="#dfn-composite-operation-add" class="internalDFN">add</a>, and append it to the
              end of <var>property-specific keyframes</var>.
          </li><li>Let <var>interval endpoints</var> be an empty sequence of
              keyframes.
          </li><li>Populate <var>interval points</var> by following the steps from
              the first matching condition from below:
            <dl class="switch">
              <dt>If <var>time fraction</var> &lt; 0 and there is more
                  than one <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>property-specific
                  keyframes</var> with a <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of
                  0,</dt>
              <dd>Add the first <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>property-specific
                  keyframes</var> to <var>interval endpoints</var>.</dd>
              <dt>If <var>time fraction</var> &#x2265; 1 and there is more
                  than one <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>property-specific
                  keyframes</var> with a <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of
                  1,</dt>
              <dd>Add the last <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>property-specific
                  keyframes</var> to <var>interval endpoints</var>.</dd>
              <dt>Otherwise,</dt>
              <dd>
                <ol>
                  <li>Append to <var>interval endpoints</var> the last
                      <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>property-specific
                      keyframes</var> whose <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> is less than
                      or equal to <var>time fraction</var> and less than 1.  If
                      there is no such <a href="#dfn-keyframe" class="internalDFN">keyframe</a> (because, for example,
                      the <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> is negative), add the last
                      <a href="#dfn-keyframe" class="internalDFN">keyframe</a> whose <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> is 0.
                  </li><li>Append to <var>interval endpoints</var> the next
                      <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>property-specific keyframes</var>
                      after the one added in the previous step.
                </li></ol>
            </dd></dl>
          </li><li>For each <var>keyframe</var> in <var>interval endpoints</var>:
            <ol>
              <li>If <var>keyframe</var> has a <a href="#dfn-composite-operation" class="internalDFN">composite operation</a>
                  that is <em>not</em> <a title="composite operation replace" href="#dfn-composite-operation-replace" class="internalDFN">replace</a>, or
                  <var>keyframe</var> has no <a href="#dfn-composite-operation" class="internalDFN">composite operation</a>
                  and the <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> of this <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe
                  animation effect</a> is <em>not</em> <a title="composite operation replace" href="#dfn-composite-operation-replace" class="internalDFN">replace</a>, then
                  perform the following steps:
                <ol>
                  <li>Let <var>composite operation to use</var> be the
                      <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> of <var>keyframe</var>, or if
                      it has none, the <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> of this
                      <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effect</a>.
                  </li><li>Let <var>value to combine</var> be the property value of
                      <var>target property</var> specified on
                      <var>keyframe</var>.
                  </li><li>Replace the property value of <var>target property</var>
                      on <var>keyframe</var> with the result of combining
                      <var>underlying value</var> (<var>V</var><sub>a</sub>) and
                      <var>value to combine</var> (<var>V</var><sub>b</sub>)
                      using the <var>composite operation to use</var>
                      procedure defined by the <var>target property</var>'s
                      <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a>.
                </li></ol>
              </li><li>If this <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effect</a> has an <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration
                  composite operation</a> of <a title="iteration composite operation accumulate" href="#dfn-iteration-composite-operation-accumulate" class="internalDFN">accumulate</a>,
                  apply the following step <var>current iteration</var> times:
                <ul>
                  <li>replace the property value of <var>target property</var>
                      on <var>keyframe</var> with the result of combining the
                      property value (<var>V</var><sub>a</sub>) with the
                      property value on the final keyframe in
                      <var>property-specific keyframes</var>
                      (<var>V</var><sub>b</sub>) using the <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulation procedure</a>
                      defined for <var>target property</var>.
                </li></ul>
                <p class="issue">
                  It seems like this could be done as a separate step at the end
                  and applied to all types of animation effects consistently.
                </p>
            </li></ol>
          </li><li>If there is only one keyframe in <var>interval endpoints</var>
              return the property value of <var>target property</var> on that
              keyframe.
          </li><li>Let <var>start offset</var> be the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of the
              first keyframe in <var>interval endpoints</var>.
          </li><li>Let <var>end offset</var> be the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of
              last keyframe in <var>interval endpoints</var>.
          </li><li>
            Let <var>interval distance</var> be the result of evaluating
            <code>(<var>time fraction</var> - <var>start offset</var>) /
                  (<var>end offset</var> - <var>start offset</var>)</code>
          </li><li>
            Return the result of applying the <a title="animation interpolation" href="#dfn-animation-interpolation" class="internalDFN">interpolation procedure</a> defined
            by the <a href="#dfn-animation-behavior" class="internalDFN">animation behavior</a> of the <var>target property</var>,
            to the values of the <var>target property</var> specified on the
            two keyframes in <var>interval endpoints</var> taking the first such
            value as <var>V</var><sub>start</sub> and the second as
            <var>V</var><sub>end</sub> and using <var>interval
            distance</var> as the interpolation parameter <var>p</var>.
        </li></ol>
        <div class="note">
          <p>Note that this procedure assumes the following about the list of
             <a href="#dfn-keyframe" class="internalDFN">keyframes</a> specified on the effect:</p>
          <ul>
            <li>Each <a href="#dfn-keyframe" class="internalDFN">keyframe</a> has a specified <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> in
                the range [0, 1].
            </li><li>The list of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> is sorted in ascending order by
                <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a>.
            </li><li>Each specified property value is a valid and supported value.
            </li><li>For a given property, there is a most one specified property
                value on each keyframe.
          </li></ul>
          <p>
            It is the responsibility of the user of the model (for example,
            a declarative markup or programming interface) to ensure these
            conditions are met.
          </p>
          <p>
            For example, for the <a href="#programming-interface">programming
            interface</a> defined by this specification, these conditions are
            met by applying the normalization defined in <a href="#normalizing-a-sequence-of-keyframes" class="sectionRef">section 5.14.6 Normalizing a sequence of keyframes</a>
            and resolving <code>null</code> <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offsets</a> by
            applying <a href="#spacing-keyframes">spacing behavior</a>.
          </p>
        </div>
        <p class="note">
          Note that this procedure permits overlapping <a href="#dfn-keyframe" class="internalDFN">keyframes</a>.
          The behavior is that at the point of overlap the output value jumps to
          the value of the last defined <a href="#dfn-keyframe" class="internalDFN">keyframe</a> at that offset.
          For overlapping frames at 0 or 1, the output value for <a title="time fraction" href="#dfn-time-fraction" class="internalDFN">time fractions</a> less than 0 or greater than
          or equal to 1 is the value of the first <a href="#dfn-keyframe" class="internalDFN">keyframe</a> or the last
          <a href="#dfn-keyframe" class="internalDFN">keyframe</a> in <var>keyframes</var> respectively.
        </p>
        <div class="issue">
          <p>
            In the presence of certain timing functions, the input time
            fraction to an animation effect is not limited to the range [0, 1].
            Currently, however, keyframe offsets <em>are</em> limited to the
            range [0, 1] and property values are simply extrapolated for input
            time fractions outside this range.
          </p>
          <p>
            We have considered removing this restriction since some cases exist
            where it is useful to be able to specify non-linear
            changes in property values at time fractions outside the range
            [0, 1].
            One example is an animation that interpolates from green to yellow
            but has an overshoot timing function that makes it temporarily
            interpolate &#x2018;beyond&#x2019; yellow to red before settling back
            to yellow.
          </p>
          <p>
            While this effect could be achieved by modification of the keyframes
            and timing function, this approach seems to break the model's
            separation of timing concerns from animation effects.
          </p>
          <p>
            It is not clear how this effect should be achieved but we note that
            allowing keyframe offsets outside [0, 1] may make the currently
            specified behavior where keyframes at offset 0 and 1 are synthesized
            as necessary, inconsistent.
          </p>
          <p>
            See <a href="http://lists.w3.org/Archives/Public/public-fx/2013AprJun/0184.html">section
            4 (Keyframe offsets outside [0, 1]) of minuted discussion from Tokyo
              2013 F2F</a>.
          </p>
        </div>
      </section>
    </section>

    <section id="motion-path-animation-effects">
      <h3><span class="secno">4.4 </span>Motion path animation effects</h3>
      <p>
        A <dfn id="dfn-motion-path-animation-effect">motion path animation effect</dfn> is an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>
        that produces <a>animation values</a> for the transform <a href="#dfn-target-property" class="internalDFN">target
        property</a> of an <a href="#dfn-animation-target" class="internalDFN">animation target</a> such that it follows
        a geometric curve commonly referred to as a &#x201c;motion path&#x201d;.
      </p>
      <p>
        The <dfn id="dfn-motion-path">motion path</dfn> of a <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path animation effect</a> is
        defined by an SVG Path, as specified by SVG [<cite><a class="bibref" href="#bib-SVG2">SVG2</a></cite>].
        A <a href="#dfn-motion-path" class="internalDFN">motion path</a> consists of a list of <dfn title="path command" id="dfn-path-command">path commands</dfn> (see <a href="http://www.w3.org/TR/SVG2/paths.html#PathData">path data</a>
        [<cite><a class="bibref" href="#bib-SVG2">SVG2</a></cite>]).
      </p>
      <p>
        Amongst the different types of path commands, we define
        <dfn title="orientation path command" id="dfn-orientation-path-command">orientation path commands</dfn> as
        <a href="http://www.w3.org/TR/SVG2/paths.html#PathDataMovetoCommands">moveto</a>
        commands and <a href="http://www.w3.org/TR/SVG2/paths.html#PathDataBearingCommands">bearing</a>
        commands.
        All types of path commands that are <em>not</em> <a href="#dfn-orientation-path-command" class="internalDFN">orientation
        path commands</a> are referred to as <dfn title="drawing path command" id="dfn-drawing-path-command">drawing path commands</dfn>.
      </p>
      <p>
        The <dfn id="dfn-automatic-rotation-flag">automatic rotation flag</dfn> of a <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path animation
        effect</a>, if set, specifies that the <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation
        value</a> generated by the <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path animation effect</a> produces
        a rotation that matches the directional tangent vector of the
        <a href="#dfn-motion-path" class="internalDFN">motion path</a>.
      </p>
      <p>
        The <dfn id="dfn-rotation-angle">rotation angle</dfn> parameter of a <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path animation
        effect</a> specifies a constant rotation that applies to the target
        transform in addition to any rotation generated by setting the
        <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a>.
      </p>
      <section id="distance-along-a-path">
        <h4><span class="secno">4.4.1 </span>Distance along a path</h4>
        <p>
          The procedure used for calculating the length of a path or
          a subsection is provided by the definition of <a href="http://www.w3.org/TR/SVG2/paths.html#DistanceAlongAPath"><dfn id="dfn-distance-along-a-path">distance
          along a path</dfn></a> in SVG [<cite><a class="bibref" href="#bib-SVG2">SVG2</a></cite>].
        </p>
      </section>
      <section id="spacing-motion-paths">
        <h4><span class="secno">4.4.2 </span>Spacing motion paths</h4>
        <p>
          The following properties control the rate of progress of a <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion
          path animation effect</a>:
        </p>
        <dl>
          <dt><dfn title="motion path spacing mode" id="dfn-motion-path-spacing-mode">spacing mode</dfn></dt>
          <dd>
            <p>
              Specifies the strategy used for determining the offset of each
              <a href="#dfn-spacing-point" class="internalDFN">spacing point</a> or <a href="#dfn-path-command" class="internalDFN">path command</a> when not specified by
              a <a href="#dfn-point-offset" class="internalDFN">point offset</a>.
              The possible spacing modes are identical to those defined for
              <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effects</a> (see <a href="#spacing-keyframes" class="sectionRef">section 4.3.1 Spacing keyframes</a>).
            </p>
            <p>
              Note that a spacing mode of <a title="distribute keyframe spacing mode" href="#dfn-distribute-keyframe-spacing-mode" class="internalDFN">distribute</a> has no
              effect if <a href="#dfn-point-offset" class="internalDFN">point offsets</a> are specified.
              This is because spacing <em>between</em> <a href="#dfn-point-offset" class="internalDFN">point offsets</a>
              always uses <a title="paced keyframe spacing mode" href="#dfn-paced-keyframe-spacing-mode" class="internalDFN">paced</a>
              spacing mode.
            </p>
          </dd>
          <dt><dfn title="spacing point" id="dfn-spacing-point">spacing points</dfn></dt>
          <dd>
            <p>
              An optional sequence of real numbers in the range [0.0, 1.0] that
              correspond to fractions of the total path length.
              The animation effect produces animation values such that the
              <a href="#dfn-animation-target" class="internalDFN">animation target</a> moves backwards and forwards along the
              <a href="#dfn-motion-path" class="internalDFN">motion path</a> following the sequence indicated by these
              points.
            </p>
            <p>
              Furthermore, the point on the <a href="#dfn-motion-path" class="internalDFN">motion path</a> indicated by each
              such number forms a handle that may be associated with a <a href="#dfn-point-offset" class="internalDFN">point
              offset</a> or positioned by the <a title="motion path spacing mode" href="#dfn-motion-path-spacing-mode" class="internalDFN">spacing mode</a>.
            </p>
          </dd>
          <dt><dfn title="point offset" id="dfn-point-offset">point offsets</dfn></dt>
          <dd>
            <p>
              An optional ordered sequence of real numbers in the range [0.0,
              1.0] that specifies the <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> when the
              corresponding <a href="#dfn-spacing-point" class="internalDFN">spacing point</a>, or, if <a href="#dfn-spacing-point" class="internalDFN">spacing points</a>
              are not provided, <a href="#dfn-drawing-path-command" class="internalDFN">drawing path command</a>, should be visited.
            </p>
            <p>
              If specified, the first value in the sequence must be 0.0 and the
              last value must be 1.0.
              There must be as many items in the sequence of <a href="#dfn-point-offset" class="internalDFN">point
              offsets</a> as in the sequence of <a href="#dfn-spacing-point" class="internalDFN">spacing points</a>, if
              provided.
              If a sequence of <a href="#dfn-spacing-point" class="internalDFN">spacing points</a> is not provided,
              the number of items in <a href="#dfn-point-offset" class="internalDFN">point offsets</a> must equal the number
              of <a href="#dfn-drawing-path-command" class="internalDFN">drawing path commands</a> in the <a href="#dfn-motion-path" class="internalDFN">motion path</a> plus
              one.
            </p>
          </dd>
          <dt><dfn title="point easing" id="dfn-point-easing">point easing</dfn></dt>
          <dd>
            <p>
              An optional ordered sequence of <a href="#dfn-timing-function" class="internalDFN">timing functions</a> that
              specify the easing behavior between each pair of <a href="#dfn-spacing-point" class="internalDFN">spacing
              points</a>, or, if <a href="#dfn-spacing-point" class="internalDFN">spacing points</a> are not provided, between
              each pair of <a href="#dfn-drawing-path-command" class="internalDFN">drawing path commands</a>.
            </p>
            <p>
              If specified, there must be as many items as in
              the sequence of <a href="#dfn-spacing-point" class="internalDFN">spacing points</a> minus one, if provided.
              If a sequence of <a href="#dfn-spacing-point" class="internalDFN">spacing points</a> is not provided,
              the number of items in <a href="#dfn-point-easing" class="internalDFN">point easing</a> must equal the number
              of <a href="#dfn-drawing-path-command" class="internalDFN">drawing path commands</a> in the <a href="#dfn-motion-path" class="internalDFN">motion path</a>.
            </p>
          </dd>
        </dl>
        <div class="note">
          <p>
            Note that the above descriptions of the length of each list
            represent the requirements of the model.
            Users of the model such as markup or programming interfaces
            may fulfil these requirements, for example, by defining padding
            behavior or error handling.
          </p>
        </div>
        <div class="issue">
          Need a diagram here showing how the different combinations work.
        </div>
        <section id="applying-spacing-to-motion-paths">
          <h5><span class="secno">4.4.2.1 </span>Applying spacing to motion paths</h5>
          <p>
            The end result of applying spacing is:
          </p>
          <ul>
            <li>a sequence of <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a>,
            </li><li>a sequence of <a href="#dfn-effective-point-offsets" class="internalDFN">effective point offsets</a>, and
            </li><li>a sequence of <a href="#dfn-effective-point-easing" class="internalDFN">effective point easing</a>
               <a href="#dfn-timing-function" class="internalDFN">timing functions</a>.
          </li></ul>
          <p></p>
          <p>
            The sequence of <dfn id="dfn-effective-spacing-points">effective spacing points</dfn> is determined by
            following the steps associated with the first matching condition
            from below:
          </p>
          <dl class="switch">
            <dt>If there are no <a href="#dfn-drawing-path-command" class="internalDFN">drawing path commands</a>,</dt>
            <dd>
              Let <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a> be an empty sequence.
            </dd>
            <dt>If <a href="#dfn-spacing-point" class="internalDFN">spacing points</a> is specified,</dt>
            <dd>
              Let <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a> refer to <a href="#dfn-spacing-point" class="internalDFN">spacing
              points</a>.
            </dd>
            <dt>Otherwise,</dt>
            <dd>
              Perform the following steps:
              <ol>
                <li>Let <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a> be a sequence
                    consisting of the single element 0.
                </li><li>For each <a href="#dfn-drawing-path-command" class="internalDFN">drawing path command</a> in <a href="#dfn-path-command" class="internalDFN">path
                    commands</a>, append to <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a>
                    a number equal to the <a href="#dfn-distance-along-a-path" class="internalDFN">distance along a path</a> up to
                    the point at the end of the given <a href="#dfn-path-command" class="internalDFN">path command</a>,
                    divided by the total path length.
              </li></ol>
            </dd>
          </dl>
          <p>
            Having determined the <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a>, the sequence
            of <dfn id="dfn-effective-point-offsets">effective point offsets</dfn> is determined by following the
            steps associated with the first matching condition from below:
          </p>
          <dl class="switch">
            <dt>If there are no <a href="#dfn-drawing-path-command" class="internalDFN">drawing path commands</a>,</dt>
            <dd>Let <a href="#dfn-effective-point-offsets" class="internalDFN">effective point offsets</a> be an empty sequence.</dd>
            <dt>If point offsets is specified,</dt>
            <dd>Let <a href="#dfn-effective-point-offsets" class="internalDFN">effective point offsets</a> refer to <a href="#dfn-point-offset" class="internalDFN">point
                offsets</a>.</dd>
            <dt>If the <a title="motion path spacing mode" href="#dfn-motion-path-spacing-mode" class="internalDFN">spacing mode</a>
              is <a title="distribute spacing mode">distribute</a>,</dt>
            <dd>
              Perform the following steps:
              <ol>
                <li>Let <a href="#dfn-effective-point-offsets" class="internalDFN">effective point offsets</a> be a sequence of
                    equal length to <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a>.
                </li><li>Let <var>n</var> be the number of elements in
                   <a href="#dfn-effective-point-offsets" class="internalDFN">effective point offsets</a> minus one.
                </li><li>Let <var>k</var> represent an index in the range [0,
                    <var>n</var>].
                </li><li>Set the value of each point in <a href="#dfn-effective-point-offsets" class="internalDFN">effective point
                    offsets</a> so that the point at index <var>k</var>
                    is equal to <var>k</var> / <var>n</var>.
              </li></ol>
            </dd>
            <dt>Otherwise,</dt>
            <dd>
              Perform the following steps:
              <ol>
                <li>Let <a href="#dfn-effective-point-offsets" class="internalDFN">effective point offsets</a> be a sequence of
                    equal length to <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a>.
                </li><li>Let <var>n</var> be the number of elements in
                   <a href="#dfn-effective-point-offsets" class="internalDFN">effective point offsets</a> minus one.
                </li><li>Let <var>k</var> represent an index in the range [0,
                    <var>n</var>].
                </li><li>Let <dfn title="pointk" id="dfn-pointk">point(<var>k</var>)</dfn>
                    represent the value of <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a>
                    at index <var>k</var>.
                </li><li>Set the value of each point in <var>effective point
                    offsets</var> so that the value at index <var>k</var> is
                    defined by the following formula:
                  <ul>
                    <li>For <var>k</var> = 0, <var>offset</var> = 0
                    </li><li>For <var>k</var> = 1..<var>n</var>,
                      <var>offset</var> =
                      <div role="math" aria-describedby="math-pacing-points" style="display: inline">
  <math xmlns="http://www.w3.org/1998/Math/MathML">
  <mrow>
    <mfrac>
      <mrow>
        <munderover>
            <mo>&#x3a3;</mo>
            <mrow>
              <mi>i</mi>
              <mo>=</mo>
              <mn>1</mn>
            </mrow>
              <mi>k</mi>
        </munderover>
        <mfenced open="|" close="|" separators=",">
          <mrow>
            <mi>point</mi><mo>&#x2061;</mo>
            <mfenced open="(" close=")" separators=",">
              <mrow>
                <mi>i</mi>
              </mrow>
            </mfenced>
            <mo>-</mo>
            <mi>point</mi><mo>&#x2061;</mo>
            <mfenced open="(" close=")" separators=",">
              <mrow>
                <mi>i</mi>
                <mo>-</mo>
                <mn>1</mn>
              </mrow>
            </mfenced>
          </mrow>
        </mfenced>
      </mrow> 
      <mrow>
        <munderover>
            <mo>&#x3a3;</mo>
            <mrow>
              <mi>i</mi>
              <mo>=</mo>
              <mn>1</mn>
            </mrow>
              <mi>n</mi>
        </munderover>
        <mfenced open="|" close="|" separators=",">
          <mrow>
            <mi>point</mi><mo>&#x2061;</mo>
            <mfenced open="(" close=")" separators=",">
              <mrow>
                <mi>i</mi>
              </mrow>
            </mfenced>
            <mo>-</mo>
            <mi>point</mi><mo>&#x2061;</mo>
            <mfenced open="(" close=")" separators=",">
              <mrow>
                <mi>i</mi>
                <mo>-</mo>
                <mn>1</mn>
              </mrow>
            </mfenced>
          </mrow>
        </mfenced>
      </mrow>
    </mfrac>
  </mrow>
  </math>
  <div id="math-pacing-points">
    [ \sum_{i=1}^k | point(i)-point(i-1) | ]
    /
    [ \sum_{i=1}^n | point(i)-point(i-1) | ]
  </div>
                  </div>
                  </li></ul>
              </li></ol>
              <div class="note">
                When <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a> is a sequence of
                monotonically increasing points beginning with 0 and ending
                with 1 (or, in fact, any time the sum of distances between
                <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a> is equal to&nbsp;1),
                <a href="#dfn-effective-point-offsets" class="internalDFN">effective point offsets</a> will mirror <a href="#dfn-effective-spacing-points" class="internalDFN">effective
                spacing points</a>.
              </div>
            </dd>
          </dl>
          <p>
            The <dfn id="dfn-effective-point-easing">effective point easing</dfn> is simply the specified
            <a href="#dfn-point-easing" class="internalDFN">point easing</a>.
            If <a href="#dfn-point-easing" class="internalDFN">point easing</a> is not set, the <a href="#dfn-effective-point-easing" class="internalDFN">effective point easing</a>
            is a sequence of <a href="#dfn-linear-timing-function" class="internalDFN">linear timing functions</a> equal in length to
            the number of <a href="#dfn-drawing-path-command" class="internalDFN">drawing path commands</a> in the <a href="#dfn-motion-path" class="internalDFN">motion
            path</a>.
          </p>
        </section>
      </section>
      <section id="determining-the-path-fraction">
        <h4><span class="secno">4.4.3 </span>Determining the path fraction</h4>
        <p>
          The <dfn id="dfn-path-fraction">path fraction</dfn> for a given <a href="#dfn-time-fraction" class="internalDFN">time fraction</a>,
          <var>progress</var>, is determined using the following procedure:
        </p>
        <ol>
          <li>If <a href="#dfn-effective-point-offsets" class="internalDFN">effective point offsets</a> is empty, let <a href="#dfn-path-fraction" class="internalDFN">path
              fraction</a> equal <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and abort these steps.
          </li><li>If <a href="#dfn-effective-point-offsets" class="internalDFN">effective point offsets</a> has only one item, let <a href="#dfn-path-fraction" class="internalDFN">path
              fraction</a> equal the value of the one item in <a href="#dfn-effective-spacing-points" class="internalDFN">effective
              spacing points</a> and abort these steps.
              <div class="note">
                <a href="#dfn-effective-point-offsets" class="internalDFN">Effective point offsets</a> can only have one item if
                <a href="#dfn-spacing-point" class="internalDFN">spacing points</a> has exactly one item. In this case, the
                <a>effective points offsets</a> will always be a list containing
                just the value 0.
              </div>
          </li><li>If <var>progress</var> &#x2265; 1, let the <a href="#dfn-path-fraction" class="internalDFN">path fraction</a> equal
              the value of the <em>last</em> item in <a href="#dfn-effective-point-offsets" class="internalDFN">effective point
              offsets</a> and abort these steps.
          </li><li>If <var>progress</var> &lt; 0, let the <a href="#dfn-path-fraction" class="internalDFN">path fraction</a> equal
              the value of the <em>first</em> item in <a href="#dfn-effective-point-offsets" class="internalDFN">effective point
              offsets</a> and abort these steps.
          </li><li>Let <var>start index</var> and <var>end index</var> represent
              the zero-based indices of the <em>last</em> pair of successive
              values in <var>effective point offsets</var> such that <var>start
              offset</var> &#x2264; <var>progress</var> &#x2264; <var>end offset</var>.
          </li><li>Let <var>interval fraction</var> be the ratio of the difference
              between <var>progress</var> and the offset at <var>start
              index</var>, and the difference between the offset at <var>end
              index</var> and the offset at <var>start index</var>.
          </li><li>Let <var>scaled interval fraction</var> be the result of applying
              the <a href="#dfn-timing-function" class="internalDFN">timing function</a> from <a href="#dfn-effective-point-easing" class="internalDFN">effective point easing</a>
              at index <var>start index</var> with <var>interval fraction</var>
              as the input.
          </li><li>Let <var>segment start</var> and <var>segment end</var> be the
              values in <a href="#dfn-effective-spacing-points" class="internalDFN">effective spacing points</a> at the indicies
              <var>start index</var> and <var>end index</var> respectively.
          </li><li>Let the <a href="#dfn-path-fraction" class="internalDFN">path fraction</a> be the result of evaluating the
              following formula:
              <code><var>scaled interval fraction</var> *
              (<var>segment end</var> - <var>segment start</var>) +
              <var>segment start</var></code>.
        </li></ol>
      </section>
      <section id="the-intermediate-animation-value-of-a-motion-path-animation-effect">
        <h4><span class="secno">4.4.4 </span>The intermediate animation value of a motion path animation effect</h4>
        <p>
          The <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> of a <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path animation
          effect</a> for a given <var>time fraction</var>, <var>current
          iteration</var>, and <var>underlying value</var> is given by the
          following process:
        </p>
        <ol>
          <li>
            Let <var>distance</var> be the <a href="#dfn-path-fraction" class="internalDFN">path fraction</a> for the given
            <a href="#dfn-time-fraction" class="internalDFN">time fraction</a>.
          </li><li>
            Let <var>displacement</var> be the point located
            <var>distance</var> along the <a href="#dfn-motion-path" class="internalDFN">motion path</a> using the
            definition for <a href="#dfn-distance-along-a-path" class="internalDFN">distance along a path</a>.
            <p>
            If <var>distance</var> indicates a point on the path that is
            coincidental with one or more <a href="#dfn-orientation-path-command" class="internalDFN">orientation path
            commands</a>, <var>displacement</var> is the point
            <em>after</em> all <a href="#dfn-orientation-path-command" class="internalDFN">orientation path commands</a> (this will
            be the <em>start</em> of the next <a href="#dfn-drawing-path-command" class="internalDFN">drawing path command</a> if
            there is one).
            </p>
          </li><li>
            Let the <var>translation component</var> be the translation
            transform required to transform the point at the start of
            <a href="#dfn-motion-path" class="internalDFN">motion path</a> to <var>displacement</var>.
          </li><li>Calculate the <var>rotation component</var> according to the
             first match condition from the following:
            <dl class="switch">
              <dt>If the <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a> is set,</dt>
              <dd>
                the <var>rotation component</var> is a transform representing
                the sum of:
                <ul>
                  <li>
                    the angle of the tangent vector at
                    <var>displacement</var>, and
                  </li>
                  <li>
                    the <a href="#dfn-rotation-angle" class="internalDFN">rotation angle</a>.
                  </li>
                </ul>
              </dd>
              <dt>Otherwise,</dt>
              <dd>
                the <var>rotation component</var> is a transform representing
                the <a href="#dfn-rotation-angle" class="internalDFN">rotation angle</a>.
              </dd>
            </dl>
            <p>
              When calculating the angle of the tangent vector, if there are
              no <a href="#dfn-drawing-path-command" class="internalDFN">drawing path commands</a> in the <a href="#dfn-motion-path" class="internalDFN">motion path</a>, the
              the angle should be taken to be zero.
            </p>
            <div class="issue">
              <p>
                The original text for this section contained the following
                qualifications but I'm not sure how meaningful they are:
              </p>
              <ul>
                <li>
                  For continuous <a href="#dfn-path-command" class="internalDFN">path commands</a> (all elements except
                  moveto), the angle of the tangent vector for the purpose of
                  these calculations is defined to be an integer multiple of
                  2&#x3c0; different from the value given by <a href="http://en.wikipedia.org/wiki/Tangential_angle">standard
                  mathematical formulae for tangents to curves in
                  2 dimensional space</a>.
               </li><li>
                 For moveto <a href="#dfn-path-command" class="internalDFN">path commands</a>, which are discontinuous, the
                 angle of the tangent vector for the purpose of these
                 calculations is always an integer multiple of 2&#x3c0;.
               </li><li>
                 The initial value of the angle of the tangent vector is
                 computed using the first element of the curve, and is always
                 in the range [0, 2&#x3c0;).
               </li><li>
                 Single continuous path commands must never produce tangent
                 vector angles that are discontinuous over their defined
                 region. This implies that a single unique solution is
                 available for all points on continuous path commands.
               </li><li>
                 When computing angles after discontinuous or non-smooth
                 jumps, multiple possible solutions may be available.  These
                 solutions will differ by integer multiples of 2&#x3c0;.  In
                 such cases the solution that lies closest to the previous
                 tangent angle is used.
            </li></ul></div>
          </li><li>
            Let the <var>transform value</var> be the result of
            by constructing a transform list consisting of the
            <var>translation component</var> followed by the <var>rotation
            component</var>.
            <div class="issue">
              What's the value in keeping these separate?
              Shouldn't we collapse them?
            </div>
          </li><li>
            Let the <var>unaccumulated value</var> be the result of
            combining the <var>underlying value</var> (<var>V</var><sub>a</sub>)
            with the <var>transform value</var> (<var>V</var><sub>b</sub>)
            using the <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> of the effect.
          </li><li>Let the <var>intermediate animation value</var> be
              <var>unaccumulated value</var>.
          </li><li>
            If the <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite operation</a> of this <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path
            animation effect</a> is <a title="iteration composite operation accumulate" href="#dfn-iteration-composite-operation-accumulate" class="internalDFN">accumulate</a>,
            perform the following steps:
            <ol>
              <li>Let the <var>final transform value</var> be the value
                  calculated for the <var>transform value</var> when performing
                  the first five steps of this procedure using a <var>time
                  fraction</var> of 1.
              </li><li>Perform the following step <var>current iteration</var> times:
                <ul>
                  <li>Set the <var>intermediate animation value</var> to the
                      result of combining the current value of
                      <var>intermediate animation value</var>
                      (<var>V</var><sub>a</sub>) with
                      <var>final transform value</var>
                      (<var>V</var><sub>b</sub>)
                      using the <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulation
                      procedure</a> defined by the
                      <a href="#dfn-animatable-as-transform-list" class="internalDFN">animatable as transform list</a> <a href="#dfn-animation-behavior" class="internalDFN">animation
                      behavior</a>.
                </li></ul>
            </li></ol>
          </li><li>Return the <var>intermediate animation value</var>.
        </li></ol>
        <div class="issue">
          Need to describe how <a href="http://www.w3.org/TR/css3-transforms/#transform-origin-property">transform-origin</a>
          is applied.
        </div>
      </section>
    </section>

    <section id="custom-effects">
      <h3><span class="secno">4.5 </span>Custom effects</h3>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          In some situations the <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a> provided by Web Animations may be insufficient.
          For example, the <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>
          defined here are only able to target certain CSS properties.
          They are unable, therefore, to modify the <a href="http://www.w3.org/TR/SVG11/struct.html#__svg__SVGSVGElement__currentScale"><code>currentScale</code></a>
          property of an SVG element to smoothly zoom the viewport without
          affecting the document content.
        </p>
        <p>
          In such cases, where the provided <a href="#dfn-animation-effect" class="internalDFN">animation
          effects</a> do not provide needed functionality, an effect defined by
          script may be used.
          Such <a href="#dfn-custom-effect" class="internalDFN">custom effects</a> receive a <a href="#dfn-time-fraction" class="internalDFN">time
          fraction</a> and <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> from the timing model and
          are responsible for producing an effect corresponding to the specified
          time.
        </p>
        <p>
          Using an effect defined in script it is possible to animate not only
          otherwise un-animatable attributes and properties, but potentially
          anything that is accessible via script, including even producing audio
          or creating vibrations.
        </p>
        <p>
          For example, using a <a href="#dfn-custom-effect"
          class="internalDFN">custom effect</a> that draws to a <a href="http://www.w3.org/TR/html5/scripting-1.html#the-canvas-element"><code>canvas</code></a>
          element, it is possible to produce a complex animated effect
          featuring patterns that may be difficult to create using CSS or
          SVG.
          Compared to using <a href="http://www.w3.org/TR/animation-timing/">Timing control for
          script-based animations</a>,
          this approach ensures the animation is frame-rate
          independent and can be paused, reversed, eased with timing effects,
          accelerated, synchronized with other animations, and be controlled
          in the same manner as any other Web Animations animation without any
          additional programming.
        </p>
      </div> <!-- informative -->
      <p>
        A <dfn id="dfn-custom-effect">custom effect</dfn> is an author-defined programming callback
        that is passed timing information when <a href="#dfn-sampling" class="internalDFN">sampling</a> is performed.
      </p>
      <section id="sampling-custom-effects">
        <h4><span class="secno">4.5.1 </span>Sampling custom effects</h4>
        <p>
          <a href="#dfn-custom-effect" class="internalDFN">Custom effects</a> are called for each referencing <a href="#dfn-animation" class="internalDFN">animation</a>
          when a <a href="#dfn-sample" class="internalDFN">sample</a> is performed based on the following criteria.
        </p>
        <ol>
          <li>If, on the previous sample, the <a href="#dfn-animation" class="internalDFN">animation</a> referencing the
              <a href="#dfn-custom-effect" class="internalDFN">custom effect</a>:
            <ul>
              <li>was <a href="#dfn-in-effect" class="internalDFN">in effect</a>, and
              </li><li>referenced this same <a href="#dfn-custom-effect" class="internalDFN">custom effect</a>, and
              </li><li>had a different <a href="#dfn-animation-target" class="internalDFN">animation target</a>
            </li></ul>
            <p>
              Call the callback passing a null <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and the
              <a href="#dfn-animation-target" class="internalDFN">animation target</a> from the previous sample as parameters to
              the callback.
            </p>
          </li><li>Call the callback for the current <a href="#dfn-animation-target" class="internalDFN">animation target</a> based on
              the first matching condition from the following:
            <dl class="switch">
              <dt>If the <a href="#dfn-animation" class="internalDFN">animation</a> referencing the custom effect is not
                  <a href="#dfn-in-effect" class="internalDFN">in effect</a> but was <a href="#dfn-in-effect" class="internalDFN">in effect</a> in the previous
                  sample,
              </dt>
              <dd>
                Call the callback passing a null <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and the
                current <a href="#dfn-animation-target" class="internalDFN">animation target</a> as parameters to the callback.
              </dd>
              <dt>Otherwise, if the <a href="#dfn-animation" class="internalDFN">animation</a> referencing the custom
                  effect:
                <ul>
                  <li>is <a href="#dfn-in-effect" class="internalDFN">in effect</a>, and
                  </li><li>was not <a href="#dfn-in-effect" class="internalDFN">in effect</a> in the previous <a href="#dfn-sample" class="internalDFN">sample</a>, or
                      was <a href="#dfn-in-effect" class="internalDFN">in effect</a> but with a different <a href="#dfn-time-fraction" class="internalDFN">time
                      fraction</a> or <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>,
                </li></ul>
              </dt>
              <dd>
                Call the callback passing with the referencing
                <a href="#dfn-animation" class="internalDFN">animation</a>'s current <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> and <a href="#dfn-animation-target" class="internalDFN">animation
                target</a> as parameters to the callback.
              </dd>
            </dl>
        </li></ol>
        <div class="issue">
          <p>
            There may be use cases where an action needs to be triggered at
            a specific point in an animation tree.
            In many cases this can be achieved by inserting a custom effect with
            a step-start easing that spans the period during which the action
            should be triggered.
            However, this can impose additional layout requirements on the
            content which might be cumbersome to accomodate.
          </p>
          <p>
            Some alternatives under consideration:
          </p>
          <ul>
            <li>Additional calling conditions could be defined to accommodate
                zero-width custom effects. For example, it could be required
                that the callback be called if (given infinite precision) there
                was a time between the previous and current sample times that
                aligned with the custom effect.
            </li><li>Instead of adding special calling conditions to custom effects,
                a new type of animation node, Trigger, could be introduced. The
                trigger would only ever act as a zero-width custom effect as
                described above, its constructor would take a callback function,
                but not require a target or timing. It could also specify other
                calling conventions, for example whether it should only trigger
                in a specific playback direction.
          </li></ul>
        </div>
      </section>
      <section id="execution-order-of-custom-effects">
        <h4><span class="secno">4.5.2 </span>Execution order of custom effects</h4>
        <p>
          Since <a href="#dfn-custom-effect" class="internalDFN">custom effects</a>, unlike <a title="animation effect" href="#dfn-animation-effect" class="internalDFN">animation effects</a>, are not limited to
          a single <a href="#dfn-target-property" class="internalDFN">target property</a>, the steps for assessing their
          order of execution differs from <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>.
        </p>
        <p>
          <a href="#dfn-custom-effect" class="internalDFN">Custom effects</a> are executed after all
          <a href="#dfn-animation-effect" class="internalDFN">animation effects</a> have completed and
          applied their result to their targets (see <a href="#applying-the-composited-result" class="sectionRef">section 4.2.4 Applying the composited result</a>).
        </p>
        <p class="issue">
          Need to define this more precisely.
          Are styles flushed?
          Presumably they are.
          Can we suspend reflow for the duration of executing the script-based
          animation effects and just do it once afterwards?
        </p>
        <p>
          Within the set of <a href="#dfn-custom-effect" class="internalDFN">custom effects</a>, the
          order of execution is the same as that defined for <a title="animation
          effect" href="#dfn-animation-effect" class="internalDFN">animation effects</a> in <a href="#the-animation-stack" class="sectionRef">section 4.2.1 The animation stack</a>.
          Items sorted earlier are executed before those sorted later.
        </p>
      </section>
    </section>
    </section> <!-- End of animation model -->

    <section id="programming-interface">
      <!--OddPage--><h2><span class="secno">5. </span>Programming interface</h2>
      <div class="informative informative-bg">
        <p><em>This section is non-normative.</em></p><p>
          In addition to the abstract model described above, Web Animations also
          defines a programming interface to the model.
          This interface can be used to inspect and extend animations produced
          by declarative means or for directly producing animations when
          a procedural approach is more suitable.
        </p>
      </div>
      <section id="the-animationtimeline-interface">
        <h3><span class="secno">5.1 </span>The <code>AnimationTimeline</code> interface</h3>
        <p>
          <a href="#dfn-timeline" class="internalDFN">Timelines</a>, including the <a href="#dfn-document-timeline" class="internalDFN">document
          timeline</a> are represented in the Web Animations <abbr title="Application Programming Interface">API</abbr> by the
          <a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-AnimationTimeline">interface <span class="idlInterfaceID">AnimationTimeline</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a>?</span> <span class="idlAttrName"><a href="#widl-AnimationTimeline-currentTime">currentTime</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a></span>           <span class="idlMethName"><a href="#widl-AnimationTimeline-play-AnimationPlayer-AnimationNode-source">play</a></span> (<span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span> <span class="idlParamName">source</span> = <span class="idlParamValue">null</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-AnimationTimeline-getAnimationPlayers-sequence-AnimationPlayer">getAnimationPlayers</a></span> ();</span>
};</span>
</pre><section id="attributes"><h4><span class="secno">5.1.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-AnimationTimeline-currentTime"><code>currentTime</code> of type <span class="idlAttrType"><a>double</a></span>, readonly, nullable</dt><dd>
            <p>
              Returns the <a href="#dfn-time-value" class="internalDFN">time value</a> for this timeline or
              <code>null</code> if this timeline is <a href="#dfn-not-started" class="internalDFN">not started</a>.
            </p>
          </dd></dl></section><section id="methods"><h4><span class="secno">5.1.2 </span>Methods</h4><dl class="methods"><dt id="widl-AnimationTimeline-play-AnimationPlayer-AnimationNode-source"><code>play</code></dt><dd>
            <p>
              Creates a new <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> object
              associated with this <a href="#dfn-timeline" class="internalDFN">timeline</a> that is scheduled to start
              at <code>currentTime</code>.
            </p>
            <p>
              The <code>timeline</code> attribute of the newly-created
              <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> object will be set to this object.
            </p>
            <p>
              Similarly, the <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a> of the
              newly created <a href="#dfn-player" class="internalDFN">player</a> will be set to the value of this
              object's <code>currentTime</code> attribute at the moment the
              method was called.
            </p>
            <p>
              The setting of the <code>source</code> attribute is described
              below under the description of the <em>source</em> parameter.
            </p>
            <p>
              The <code>currentTime</code> attribute of the
              <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> object is a calculated value described in
              <a href="#the-current-time-of-a-player" class="sectionRef">section 3.5.1 The current time of a player</a>.
            </p>
            <p>
              The <code>playbackRate</code> and <code>paused</code> attributes
              take on their default values as described in the definitions of
              the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> and
              <a href="#dfn-paused-state" class="internalDFN">paused state</a> properties of <a href="#dfn-player" class="internalDFN">player</a> objects.
            </p>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">source</td><td class="prmType"><code><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span> (<code>null</code>)</td><td class="prmDesc">
                <p>
                  The <a href="#dfn-source-content" class="internalDFN">source content</a> to assign to the newly-created
                  <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> object.
                </p>
                <p>
                  The <a href="#widl-AnimationPlayer-source"><code>source</code></a>
                  attribute of the created <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>
                  is set by following the procedure defined for updating that
                  attribute.
                  As a result, if <em>source</em> is already associated with
                  a <code>player</code>, it will be disassociated first before
                  being associated with the new <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>.
                </p>
              </td></tr></table><div><em>Return type: </em><code><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a></code></div></dd><dt id="widl-AnimationTimeline-getAnimationPlayers-sequence-AnimationPlayer"><code>getAnimationPlayers</code></dt><dd>
            <p>
              Returns the set of <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> objects
              associated with this <a href="#dfn-timeline" class="internalDFN">timeline</a> that have associated
              <a href="#dfn-source-content" class="internalDFN">source content</a> which is <a href="#dfn-current" class="internalDFN">current</a>.
            </p>
            <p>
              The returned list is sorted in increasing order by <a href="#dfn-player-sequence-number" class="internalDFN">player
              sequence number</a>.
            </p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code>sequence&lt;<a></a><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>&gt;</code></div></dd></dl></section>
      </section>
      <section id="the-animationplayer-interface">
        <h3><span class="secno">5.2 </span>The <code>AnimationPlayer</code> interface</h3>
        <p>
          <a href="#dfn-player" class="internalDFN">Players</a> are represented in the Web Animations
          <abbr title="Application Programming Interface">API</abbr> by the <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-AnimationPlayer">interface <span class="idlInterfaceID">AnimationPlayer</span> : <span class="idlSuperclass"><a>EventTarget</a></span> {
<span class="idlAttribute">             attribute <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span>    <span class="idlAttrName"><a href="#widl-AnimationPlayer-source">source</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a></span> <span class="idlAttrName"><a href="#widl-AnimationPlayer-timeline">timeline</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>            <span class="idlAttrName"><a href="#widl-AnimationPlayer-startTime">startTime</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>            <span class="idlAttrName"><a href="#widl-AnimationPlayer-currentTime">currentTime</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>            <span class="idlAttrName"><a href="#widl-AnimationPlayer-playbackRate">playbackRate</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>boolean</a></span>           <span class="idlAttrName"><a href="#widl-AnimationPlayer-paused">paused</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>boolean</a></span>           <span class="idlAttrName"><a href="#widl-AnimationPlayer-finished">finished</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationPlayer-cancel-void">cancel</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationPlayer-finish-void">finish</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationPlayer-play-void">play</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationPlayer-pause-void">pause</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationPlayer-reverse-void">reverse</a></span> ();</span>
<span class="idlSectionComment">
    // Event callbacks</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>EventHandler</a></span>      <span class="idlAttrName"><a href="#widl-AnimationPlayer-onfinish">onfinish</a></span>;</span>
};</span>
</pre><section id="attributes-1"><h4><span class="secno">5.2.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-AnimationPlayer-source"><code>source</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></span>, nullable</dt><dd>
            <p>
              The <a href="#dfn-source-content" class="internalDFN">source content</a> associated with this player.
            </p>
            <p>
              A <a href="#dfn-player" class="internalDFN">player</a> can only be associated with at most one
              <a href="#dfn-animation-node" class="internalDFN">animation node</a>, and likewise, an <a href="#dfn-animation-node" class="internalDFN">animation node</a> can
              only be <a title="associated with a player" href="#dfn-associated-with-a-player" class="internalDFN">associated</a> with at
              most one <a href="#dfn-player" class="internalDFN">player</a>.
              In order to maintain these invariants, on setting this value, the
              following procedure is performed:
            </p>
            <ol>
              <li>Let <var>old value</var> be the current value of the
                  <code>source</code> attribute.</li>
              <li>Let <var>new value</var> be the value to set.</li>
              <li>If <var>new value</var> is the same object as <var>old
                  value</var>, return.</li>
              <li>If <var>old value</var> is not <code>null</code>,
                  disassociate <var>old value</var> from this player.</li>
              <li>If <var>new value</var> is not <code>null</code>,
                  perform the steps associated with the first matching condition
                  of the following:
                <dl class="switch">
                  <dt>If <var>new value</var> has no parent group and is
                      associated with a player,</dt>
                  <dd>disassociate <var>new value</var> from its player.</dd>
                  <dt>If <var>new value</var> has a parent group,</dt>
                  <dd>remove <var>new value</var> from its parent group by
                      calling <code><var>new value</var>.remove()</code>.</dd>
                  <dt>Otherwise,</dt>
                  <dd>do nothing.</dd>
                </dl>
              </li>
              <li>Associate <var>new value</var> with this player.
              </li><li>Set the <code>source</code> attribute to <var>new
                  value</var>.</li>
            </ol>
          </dd><dt id="widl-AnimationPlayer-timeline"><code>timeline</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a></span>, readonly</dt><dd>
            The <a href="#dfn-timeline" class="internalDFN">timeline</a> associated with this player.
          </dd><dt id="widl-AnimationPlayer-startTime"><code>startTime</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            Returns the <a title="player start time" href="#dfn-player-start-time" class="internalDFN">start time</a> of this
            player.
            Setting this attribute updates the <a href="#dfn-player-start-time" class="internalDFN">player start time</a> using
            the procedure defined in <a href="#updating-the-player-start-time" class="sectionRef">section 3.5.2.6 Updating the player start time</a>.
          </dd><dt id="widl-AnimationPlayer-currentTime"><code>currentTime</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            The <a href="#dfn-effective-current-time" class="internalDFN">effective current time</a> of this player.
            Setting this attribute follows the procedure defined in <a href="#performing-a-seek" class="sectionRef">section 3.5.2.9 Performing a seek</a>.
          </dd><dt id="widl-AnimationPlayer-playbackRate"><code>playbackRate</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            The <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> of this
            player.
            Setting this attribute follows the procedure defined in <a href="#updating-the-playback-rate" class="sectionRef">section 3.5.3.1 Updating the playback rate</a>.
          </dd><dt id="widl-AnimationPlayer-paused"><code>paused</code> of type <span class="idlAttrType"><a>boolean</a></span>, readonly</dt><dd>
            The <a href="#dfn-paused-state" class="internalDFN">paused state</a> of this player.
          </dd><dt id="widl-AnimationPlayer-finished"><code>finished</code> of type <span class="idlAttrType"><a>boolean</a></span>, readonly</dt><dd>
            Returns true if this <a href="#dfn-player" class="internalDFN">player</a> has reached or passed the end of
            its <a href="#dfn-source-content" class="internalDFN">source content</a> in its current <a href="#dfn-playback-direction" class="internalDFN">playback direction</a>.
            This corresponds to when the player is <a href="#dfn-limited" class="internalDFN">limited</a>.
          </dd><dt id="widl-AnimationPlayer-onfinish"><code>onfinish</code> of type <span class="idlAttrType"><a>EventHandler</a></span></dt><dd>
            <p>
              The event handler for the <a title="finish player event" href="#dfn-finish-player-event" class="internalDFN">finish</a> event.
            </p>
            <p class="note">
              Note that the <a href="http://www.w3.org/TR/html5/webappapis.html#eventhandler">EventHandler</a>
              callback interface type is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
            </p>
          </dd></dl></section><section id="methods-1"><h4><span class="secno">5.2.2 </span>Methods</h4><dl class="methods"><dt id="widl-AnimationPlayer-cancel-void"><code>cancel</code></dt><dd>
            Set <code>source</code> to null and clears all effects associated
            with the previous <a href="#dfn-source-content" class="internalDFN">source content</a>.
            <div class="issue">
              We need to make sure, for example, that any custom effects get
              called with a null sample time so they can remove their effects.
              This applies to manually setting <code>source</code> to null as
              well so we should define this behavior there.
            </div>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-AnimationPlayer-finish-void"><code>finish</code></dt><dd>
            <p>
              Seeks the player to the end of the <a href="#dfn-source-content" class="internalDFN">source content</a> in the
              current direction as follows:
            </p>
            <dl class="switch">
              <dt>If <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &lt; zero,</dt>
              <dd>
                <a href="#performing-a-seek">Seek</a> the player so its
                <a href="#dfn-current-time" class="internalDFN">current time</a> is zero.
              </dd>
              <dt>If <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> equals zero,</dt>
              <dd>
                Do nothing.
              </dd>
              <dt>If <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &gt; zero,</dt>
              <dd>
                <a href="#performing-a-seek">Seek</a> the player so its
                <a href="#dfn-current-time" class="internalDFN">current time</a> is equal to the <a href="#dfn-end-time" class="internalDFN">end time</a> of the
                <a href="#dfn-source-content" class="internalDFN">source content</a> or zero if there is no <a href="#dfn-source-content" class="internalDFN">source
                content</a> associated with this player..
              </dd>
            </dl>
            <p>
              Exceptions:
            </p>
            <dl class="exceptions">
              <dt>DOMException of type <code>InvalidStateError</code></dt>
              <dd>
                Raised if the <a href="#dfn-end-time" class="internalDFN">end time</a> of this player's <a href="#dfn-source-content" class="internalDFN">source
                content</a> is infinity and the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> is
                &gt; zero.
              </dd>
            </dl>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-AnimationPlayer-play-void"><code>play</code></dt><dd>
            <p>
              Unpauses the player and rewinds if it has finished playing using
              the following procedure:
            </p>
            <ol>
              <li>Set the <a href="#dfn-paused-state" class="internalDFN">paused state</a> of the player to false using the
                  procedure defined in <a href="#updating-the-paused-state" class="sectionRef">section 3.5.2.8 Updating the paused state</a>.
              </li><li>If <a href="#dfn-source-content" class="internalDFN">source content</a> is associated with the player,
                  <a href="#performing-a-seek">adjust the current time</a> of
                  the player as follows:
                  <dl class="switch">
                    <dt>If <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &gt; 0; and
                        either <a href="#dfn-current-time" class="internalDFN">current time</a> &lt; zero or
                        <a href="#dfn-current-time" class="internalDFN">current time</a> &#x2265; <a href="#dfn-source-content" class="internalDFN">source
                        content</a>'s <a href="#dfn-end-time" class="internalDFN">end time</a>,</dt>
                    <dd>Seek to time zero.</dd>
                    <dt>If <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &lt; 0; and
                        either <a href="#dfn-current-time" class="internalDFN">current time</a> &#x2264; zero or
                        <a href="#dfn-current-time" class="internalDFN">current time</a> &gt; <a href="#dfn-source-content" class="internalDFN">source
                        content</a>'s <a href="#dfn-end-time" class="internalDFN">end time</a>,</dt>
                    <dd>Seek to the <a href="#dfn-source-content" class="internalDFN">source content</a>'s <a href="#dfn-end-time" class="internalDFN">end
                        time</a>.</dd>
                    <dt>Otherwise,</dt>
                    <dd>Do nothing.</dd>
                  </dl>
              </li><li>Set the player's <a href="#dfn-finished-flag" class="internalDFN">finished flag</a> to false.
            </li></ol>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-AnimationPlayer-pause-void"><code>pause</code></dt><dd>
            Set the <a href="#dfn-paused-state" class="internalDFN">paused state</a> of this player to true using the
            procedure defined in <a href="#updating-the-paused-state" class="sectionRef">section 3.5.2.8 Updating the paused state</a>.
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-AnimationPlayer-reverse-void"><code>reverse</code></dt><dd>
            <p>
              Inverts the <a title="player playback rate" href="#dfn-player-playback-rate" class="internalDFN">playback rate</a> of
              this player and seeks to the start of the source media if it has
              finished playing in the reversed direction using the following
              procedure.
            </p><ol>
              <li>If the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> is zero, abort these steps.
              </li><li>If <a href="#dfn-source-content" class="internalDFN">source content</a> is associated with the player,
                  <a href="#performing-a-seek">adjust the current time</a> of
                  the player as follows:
                <dl class="switch">
                  <dt>If <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &gt; zero and
                      <a href="#dfn-effective-current-time" class="internalDFN">effective current time</a> &gt; <a href="#dfn-source-content" class="internalDFN">source
                      content</a>'s <a href="#dfn-end-time" class="internalDFN">end time</a>,
                  </dt>
                  <dd>Seek to the <a href="#dfn-source-content" class="internalDFN">source content</a>'s <a href="#dfn-end-time" class="internalDFN">end time</a>.</dd>
                  <dt>If <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> &lt; zero and
                      <a href="#dfn-effective-current-time" class="internalDFN">effective current time</a> &lt; zero,</dt>
                  <dd>Seek to time zero.</dd>
                  <dt>Otherwise,</dt>
                  <dd>Do nothing.</dd>
                </dl>
              </li><li>Set the <a href="#dfn-player-playback-rate" class="internalDFN">player playback rate</a> to <code>-<a href="#dfn-player-playback-rate" class="internalDFN">player
                  playback rate</a></code> following the steps in <a href="#updating-the-playback-rate" class="sectionRef">section 3.5.3.1 Updating the playback rate</a>.
              </li><li>Set the <a href="#dfn-paused-state" class="internalDFN">paused state</a> of the <a href="#dfn-player" class="internalDFN">player</a> to false.
                  <p class="issue">Is this unpausing behavior correct?</p>
            </li></ol>
            <p class="note">
              Note that unlike <code>play()</code>, the player's <a href="#dfn-finished-flag" class="internalDFN">finished
              flag</a> is not explicitly reset here since that behavior is
              performed by the procedure for updating the <a href="#dfn-player-playback-rate" class="internalDFN">player playback
              rate</a> defined in <a href="#updating-the-playback-rate" class="sectionRef">section 3.5.3.1 Updating the playback rate</a>.
            </p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></section>
      </section>
      <section id="the-animationnode-interface">
        <h3><span class="secno">5.3 </span>The <code>AnimationNode</code> interface</h3>
        <p>
          <a href="#dfn-animation-node" class="internalDFN">Animation nodes</a> are represented in the Web
          Animations <abbr title="Application Programming Interface">API</abbr> by the <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-AnimationNode">interface <span class="idlInterfaceID">AnimationNode</span> {
<span class="idlSectionComment">    // Playback state</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a>?</span>             <span class="idlAttrName"><a href="#widl-AnimationNode-localTime">localTime</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a>?</span>      <span class="idlAttrName"><a href="#widl-AnimationNode-currentIteration">currentIteration</a></span>;</span>
<span class="idlSectionComment">
    // Specified timing</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a></span>     <span class="idlAttrName"><a href="#widl-AnimationNode-timing">timing</a></span>;</span>
<span class="idlSectionComment">
    // Calculated timing</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a></span>              <span class="idlAttrName"><a href="#widl-AnimationNode-startTime">startTime</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-AnimationNode-duration">duration</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-AnimationNode-activeDuration">activeDuration</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-AnimationNode-endTime">endTime</a></span>;</span>
<span class="idlSectionComment">
    // Timing hierarchy</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a>?</span>     <span class="idlAttrName"><a href="#widl-AnimationNode-parent">parent</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span>      <span class="idlAttrName"><a href="#widl-AnimationNode-previousSibling">previousSibling</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span>      <span class="idlAttrName"><a href="#widl-AnimationNode-nextSibling">nextSibling</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationNode-before-void-AnimationNode...-nodes">before</a></span> (<span class="idlParam"><span class="idlParamType"><a>AnimationNode...</a></span> <span class="idlParamName">nodes</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationNode-after-void-AnimationNode...-nodes">after</a></span> (<span class="idlParam"><span class="idlParamType"><a>AnimationNode...</a></span> <span class="idlParamName">nodes</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationNode-replace-void-AnimationNode...-nodes">replace</a></span> (<span class="idlParam"><span class="idlParamType"><a>AnimationNode...</a></span> <span class="idlParamName">nodes</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationNode-remove-void">remove</a></span> ();</span>
<span class="idlSectionComment">
    // Associated player</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>?</span>    <span class="idlAttrName"><a href="#widl-AnimationNode-player">player</a></span>;</span>
};</span>
</pre><section id="attributes-2"><h4><span class="secno">5.3.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-AnimationNode-localTime"><code>localTime</code> of type <span class="idlAttrType"><a>double</a></span>, readonly, nullable</dt><dd>
            <p>
              The <a href="#dfn-local-time" class="internalDFN">local time</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
            </p>
            <p>
              <code>localTime</code> will be <code>null</code> if this
              <a href="#dfn-animation-node" class="internalDFN">animation node</a> is not <a href="#dfn-associated-with-a-player" class="internalDFN">associated with a player</a> or if it has
              a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a> that is not <a href="#dfn-in-effect" class="internalDFN">in effect</a>.
            </p>
          </dd><dt id="widl-AnimationNode-currentIteration"><code>currentIteration</code> of type <span class="idlAttrType"><a>unsigned long</a></span>, readonly, nullable</dt><dd>
            The <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> index beginning with zero for the first
            iteration.
          </dd><dt id="widl-AnimationNode-timing"><code>timing</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a></span>, readonly</dt><dd>
            <p>
              Returns the input timing properties specified for this
              <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
              This is comparable to the specified style on an Element,
              <code>elem.style</code>.
            </p>
            <div class="issue">
              <p>
                Should we make this writeable? Then you could do:
              </p>
              <pre class="example sh_javascript sh_sourceCode">animA<span class="sh_symbol">.</span>timing <span class="sh_symbol">=</span> animB<span class="sh_symbol">.</span>timing<span class="sh_symbol">;</span></pre>
              <p>
                Doing so would probably also involve defining
                <code>AnimationTiming.clone</code> and a constructor for
                <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a>.
              </p>
            </div>
            <div class="feedbackWanted">
              <p>
                Representing these parameters has been a particularly
                contentious topic.
              </p>
              <p>
                The current arrangement:
              </p>
              <ul>
                <li>requires defining both an <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface
                    and an <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> dictionary type which
                    increases the <abbr title="Application Programming Interface">API</abbr> surface area somewhat
                </li><li>means that setting the value occurs at a different place
                    (<code>anim.timing.duration</code>) to reading
                    the value (typically, <code>anim.duration</code>)
                </li><li>opens up questions about whether <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a>
                    objects should be share-able or not
                </li><li>uses a union of a string and a double to represent
                    a duration which opens up questions about whether strings
                    such as <code>"3s"</code> should be allowed (and allowing
                    them makes walking the tree more complex).
              </li></ul>
              <p>
                However, it separates "specified" timing from "computed" timing
                which some consider advantageous.
              </p>
              <p>
                The only situation where calculated values and input values
                differ is for <code>duration</code>.
              </p>
              <p>
                One alternative that has been proposed is to introduce
                a <code>Duration</code> interface as follows:
              </p>
              <pre class="example webidl">interface AnimationNode {
   // AnimationTiming
   attribute double   delay;
   attribute FillMode fill;
   attribute Duration duration;
   attribute double   playbackRate;
   // ...
   
   // Scheduled time
   readonly attribute double              startTime;
   readonly attribute unrestricted double endTime;
};

interface Duration {
  double    ms;
  DOMString string;
}</pre>
              <p>
                Usage is as follows:
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> specifiedDur  <span class="sh_symbol">=</span> anim<span class="sh_symbol">.</span>duration<span class="sh_symbol">.</span>string<span class="sh_symbol">;</span> <span class="sh_comment">// "auto"</span>
<span class="sh_keyword">var</span> calculatedDur <span class="sh_symbol">=</span> anim<span class="sh_symbol">.</span>duration<span class="sh_symbol">.</span>ms<span class="sh_symbol">;</span> <span class="sh_comment">// 5000</span>

<span class="sh_comment">// Update duration to 3s</span>
anim<span class="sh_symbol">.</span>duration<span class="sh_symbol">.</span>ms <span class="sh_symbol">=</span> <span class="sh_number">3000</span><span class="sh_symbol">;</span>
<span class="sh_comment">// anim.duration.string -&gt; "3s"</span>

<span class="sh_comment">// Update duration to 3s (alt.)</span>
anim<span class="sh_symbol">.</span>duration<span class="sh_symbol">.</span>string <span class="sh_symbol">=</span> <span class="sh_string">"3s"</span><span class="sh_symbol">;</span>
<span class="sh_comment">// anim.duration.ms -&gt; 3000</span>

<span class="sh_comment">// Reset to auto</span>
anim<span class="sh_symbol">.</span>duration<span class="sh_symbol">.</span>string <span class="sh_symbol">=</span> <span class="sh_string">"auto"</span><span class="sh_symbol">;</span>  
<span class="sh_comment">// anim.duration.ms -&gt; 5000</span></pre>
              <p>
                Your feedback is most welcome at <a href="mailto:public-fx@w3.org">public-fx@w3.org</a>, subject
                <em>[web-animations] &#x2026;</em>.
              </p>
            </div>
          </dd><dt id="widl-AnimationNode-startTime"><code>startTime</code> of type <span class="idlAttrType"><a>double</a></span>, readonly</dt><dd>
            <p>
              The <a>start time</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a> in
              milliseconds.
              This is the time at which the <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>, if
              any, has scheduled this child to run within its <a title="transformed time" href="#dfn-transformed-time" class="internalDFN">transformed time space</a>, that is, the
              <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a title="inherited time" href="#dfn-inherited-time" class="internalDFN">inherited time
              space</a>.
            </p>
            <p>
              The start of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> is based on the sum of
              the <a title="animation node start time" href="#dfn-animation-node-start-time" class="internalDFN">start time</a> and
              <a href="#dfn-start-delay" class="internalDFN">start delay</a>.
            </p>
          </dd><dt id="widl-AnimationNode-duration"><code>duration</code> of type <span class="idlAttrType"><a>unrestricted double</a></span>, readonly</dt><dd>
            <p>
              The <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
            </p>
            <p>
              Unlike the <code>duration</code> attribute of
              the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface or
              <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> dictionary,
              this attribute returns the calculated value of the <a href="#dfn-iteration-duration" class="internalDFN">iteration
              duration</a>.
              If <code>timing.duration</code> is the
              string <code>auto</code> or any unsupported value, this attribute
              will return the current calculated value of the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic
              iteration duration</a>.
            </p>
            <p>
              This value may be changed by setting the
              <code>duration</code> attribute of the
              <code>timing</code> member of this interface.
            </p>
          </dd><dt id="widl-AnimationNode-activeDuration"><code>activeDuration</code> of type <span class="idlAttrType"><a>unrestricted double</a></span>, readonly</dt><dd>
            <p>
              The <a href="#dfn-active-duration" class="internalDFN">active duration</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
            </p>
          </dd><dt id="widl-AnimationNode-endTime"><code>endTime</code> of type <span class="idlAttrType"><a>unrestricted double</a></span>, readonly</dt><dd>
            <p>
              The <a href="#dfn-end-time" class="internalDFN">end time</a> of the <a href="#dfn-animation-node" class="internalDFN">animation node</a> expressed in
              milliseconds in <a title="inherited time" href="#dfn-inherited-time" class="internalDFN">inherited time
              space</a>.
              This corresponds to the end of the <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s active
              interval plus any <a href="#dfn-end-delay" class="internalDFN">end delay</a>.
            </p>
          </dd><dt id="widl-AnimationNode-parent"><code>parent</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a></span>, readonly, nullable</dt><dd>
            <p>
              The <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a> or
              <code>null</code> if this <a href="#dfn-animation-node" class="internalDFN">animation node</a> does not have
              a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>.
            </p>
            <div class="issue">
              Should this be <code>parentGroup</code>?
            </div>
          </dd><dt id="widl-AnimationNode-previousSibling"><code>previousSibling</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></span>, readonly, nullable</dt><dd>
            The <a href="#dfn-previous-sibling" class="internalDFN">previous sibling</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
          </dd><dt id="widl-AnimationNode-nextSibling"><code>nextSibling</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></span>, readonly, nullable</dt><dd>
            The <a href="#dfn-next-sibling" class="internalDFN">next sibling</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
          </dd><dt id="widl-AnimationNode-player"><code>player</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a></span>, readonly, nullable</dt><dd>
            <p>
              The <a href="#dfn-player" class="internalDFN">player</a> with which this animation node is <a title="associated with a player" href="#dfn-associated-with-a-player" class="internalDFN">associated</a>, if any.
              This object can be used to perform play control such as pausing or
              rewinding on this <a href="#dfn-animation-node" class="internalDFN">animation node</a> <em>and all other
              animation nodes in the same hierarchy</em>.
            </p>
            <p>
              This will be <code>null</code> if this <a href="#dfn-animation-node" class="internalDFN">animation node</a> is
              not <a href="#dfn-associated-with-a-player" class="internalDFN">associated with a player</a>.
            </p>
            <p class="issue">
              Feedback has been provided that suggests this reference causes the
        relationship between AnimationPlayers and AnimationNodes to be
        circular, which confuses the model. The player attribute should be
        considered <strong>at risk</strong> unless a strong use case for the
        reference arises.
            </p>
          </dd></dl></section><section id="methods-2"><h4><span class="secno">5.3.2 </span>Methods</h4><dl class="methods"><dt id="widl-AnimationNode-before-void-AnimationNode...-nodes"><code>before</code></dt><dd>
            <p>
              Inserts <var>nodes</var> before this <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
            </p>
            <ol>
              <li>If there is no <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>, terminate these
                  steps.
              </li><li>If any of the <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> in <var>nodes</var> is an
                  <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a>
                  throw a <code>HierarchyRequestError</code> exception and
                  terminate these steps. 
              </li><li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>nodes</var> before
                  this <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
            </li></ol>
            <div class="note">
              <p>
                Note that this definition precludes the following usage since
                <code>node</code> is an <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of itself:
              </p>
              <pre class="example sh_javascript sh_sourceCode">node<span class="sh_symbol">.</span><span class="sh_function">before</span><span class="sh_symbol">(</span>node<span class="sh_symbol">);</span> <span class="sh_comment">// throws HierarchyRequestError</span></pre>
            </div>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">nodes</td><td class="prmType"><code><a>AnimationNode...</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-AnimationNode-after-void-AnimationNode...-nodes"><code>after</code></dt><dd>
            <p>
              Inserts <var>nodes</var> after this <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
            </p>
            <ol>
              <li>If there is no <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>, terminate these
                  steps.
              </li><li>If any of the <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> in <var>nodes</var> is an
                  <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a>
                  throw a <code>HierarchyRequestError</code> exception and
                  terminate these steps. 
              </li><li>Let <var>reference child</var> be the <a title="next sibling not included" href="#dfn-next-sibling-not-included" class="internalDFN">next sibling of
                  this animation node not in <var>nodes</var></a>.
              </li><li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>nodes</var> before
                  <var>reference child</var>.
            </li></ol>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">nodes</td><td class="prmType"><code><a>AnimationNode...</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-AnimationNode-replace-void-AnimationNode...-nodes"><code>replace</code></dt><dd>
            <p>
              Replaces this <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a> with the passed in
              <var>nodes</var>.
            </p>
            <ol>
              <li>If there is no <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>, terminate these
                  steps.
              </li><li>If any of the <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> in <var>nodes</var> is an
                  <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of the <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>
                  throw a <code>HierarchyRequestError</code> exception and
                  terminate these steps. 
              </li><li>Let <var>reference child</var> be the <a title="next sibling not included" href="#dfn-next-sibling-not-included" class="internalDFN">next sibling of
                  this animation node not in <var>nodes</var></a>.
              </li><li><a title="remove an animation node" href="#dfn-remove-an-animation-node" class="internalDFN">Remove</a> this
                  <a href="#dfn-animation-node" class="internalDFN">animation node</a> from its <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>.
              </li><li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>nodes</var> before
                  <var>reference child</var>.
            </li></ol>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">nodes</td><td class="prmType"><code><a>AnimationNode...</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-AnimationNode-remove-void"><code>remove</code></dt><dd>
            <a title="remove an animation node" href="#dfn-remove-an-animation-node" class="internalDFN">Removes</a> this <a href="#dfn-animation-node" class="internalDFN">animation
            node</a> from its <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a> or <a href="#dfn-player" class="internalDFN">player</a>.
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></section>
      </section>
      <section id="the-animationtiming-interface">
        <h3><span class="secno">5.4 </span>The <code>AnimationTiming</code> interface</h3>
        <p>
          Timing parameters for an <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a> are collected together
          under the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> type.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-AnimationTiming">interface <span class="idlInterfaceID">AnimationTiming</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-AnimationTiming-delay">delay</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-AnimationTiming-endDelay">endDelay</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span>                           <span class="idlAttrName"><a href="#widl-AnimationTiming-fill">fill</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-AnimationTiming-iterationStart">iterationStart</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>unrestricted double</a></span>                <span class="idlAttrName"><a href="#widl-AnimationTiming-iterations">iterations</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlAttrName"><a href="#widl-AnimationTiming-duration">duration</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-AnimationTiming-playbackRate">playbackRate</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span>                  <span class="idlAttrName"><a href="#widl-AnimationTiming-direction">direction</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span>                          <span class="idlAttrName"><a href="#widl-AnimationTiming-easing">easing</a></span>;</span>
};</span>
</pre><section id="attributes-3"><h4><span class="secno">5.4.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-AnimationTiming-delay"><code>delay</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            <p>
              The <a href="#dfn-start-delay" class="internalDFN">start delay</a> which represents the number of milliseconds
              from an <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a title="start time">start
              time</a> to the start of the <a href="#dfn-active-interval" class="internalDFN">active interval</a>.
            </p>
            <p class="issue">
              Now that we have <code>endDelay</code>, should we change this back
              to <code>startDelay</code>?
            </p>
          </dd><dt id="widl-AnimationTiming-endDelay"><code>endDelay</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            <p>
              The <a href="#dfn-end-delay" class="internalDFN">end delay</a> which represents the number of milliseconds
              from the end of an <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-active-interval" class="internalDFN">active interval</a>
              until the <a>start time</a> of any <a href="#dfn-animation-node" class="internalDFN">animation node</a> that may
              follow, for example, in an <a href="#dfn-animation-sequence" class="internalDFN">animation sequence</a>.
            </p>
          </dd><dt id="widl-AnimationTiming-fill"><code>fill</code> of type <span class="idlAttrType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span></dt><dd>
            <p>
              The <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> as specified by one of the <a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a>
              enumeration values.
            </p>
            <p>
              When performing timing calculations the special value <span class="prop-value">auto</span> is expanded
              to one of the <a href="#dfn-fill-mode" class="internalDFN">fill modes</a> recognized by the timing model as
              follows,
            </p>
            <dl class="switch">
              <dt>
                If the <a href="#dfn-animation-node" class="internalDFN">animation node</a> to which the fill mode is being is
                applied is an <a href="#dfn-animation" class="internalDFN">animation</a>,
              </dt>
              <dd>
                Use <span class="prop-value">none</span> as the <a href="#dfn-fill-mode" class="internalDFN">fill
                mode</a>.
              </dd>
              <dt>Otherwise,</dt>
              <dd>
                Use <span class="prop-value">both</span> as the <a href="#dfn-fill-mode" class="internalDFN">fill
                mode</a>.
              </dd>
            </dl>
          </dd><dt id="widl-AnimationTiming-iterationStart"><code>iterationStart</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            <p>
              The <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> property.
            </p>
            <p>
              A finite real number greater than or equal to zero representing
              the number of iterations into the animation node at which to
              begin.
              For example, a value of 0.5 would cause the animation node to
              begin half-way through the first iteration.
            </p>
            <p>
              Values less than zero are clamped to zero for the purpose of
              timing model calculations.
            </p>
            <div class="note">
              <p>
                Note that the value of <code>iterations</code> is effectively
                <em>added</em> to the <code>iterationStart</code> such that
                an animation node with an <code>iterationStart</code> of
                &#x2018;0.5&#x2019; and <code>iterations</code> of
                &#x2018;2&#x2019; would still repeat twice however it would begin
                and end half-way through the animation node's <a href="#dfn-iteration-interval" class="internalDFN">iteration
                interval</a>.
              </p>
              <p>
                Setting the <code>iterationStart</code> to a value greater than
                or equal to one is typically only useful in combination with an
                animation effect that has an <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite
                operation</a> of &#x2018;accumulate&#x2019;.
              </p>
            </div>
          </dd><dt id="widl-AnimationTiming-iterations"><code>iterations</code> of type <span class="idlAttrType"><a>unrestricted double</a></span></dt><dd>
            <p>
              The <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> property.
            </p>
            <p>
              A real number greater than or equal to zero (including positive
              infinity) representing the number of times to repeat the
              animation node.
            </p>
            <p>
              Values less than zero and <code>NaN</code> values are treated as
              the value 1.0 for the purpose of timing model calculations.
            </p>
          </dd><dt id="widl-AnimationTiming-duration"><code>duration</code> of type <span class="idlAttrType">(<a>unrestricted double</a> or <a>DOMString</a>)</span></dt><dd>
            <p>
              The <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> which is a real number greater than
              or equal to zero (including positive infinity) representing the
              time taken to complete a single iteration of the <a href="#dfn-animation-node" class="internalDFN">animation
              node</a>.
            </p>
            <p>
              The string value <code>auto</code> is used to indicate that the
              <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> reflects the animation node's
              <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration duration</a>.
            </p>
            <p>
              Real numbers less than zero, <code>NaN</code> values, and strings
              other than the lowercase value <code>auto</code> are treated
              the same as <code>auto</code> for the purpose of timing model
              calculations.
            </p>
            <div class="issue">
              <p>Should we allow strings such as <code>"3s"</code> here?
              i.e. a CSS <a href="http://www.w3.org/TR/css3-values/#time">&lt;time&gt;</a>.
              It might be useful for readability but introduces complexity when
              handling this member (need to test the type, then possibly parse
              the string).
              It also introduces the issue of whether we should parse a full
              <a href="http://www.w3.org/TR/SVG11/animate.html#ClockValueSyntax">clock
              value</a>.
            </p></div>
          </dd><dt id="widl-AnimationTiming-playbackRate"><code>playbackRate</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            <p>
              The <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a> property.
            </p>
            <p>
              This is a multiplier applied to the <a href="#dfn-local-time" class="internalDFN">local time</a> potentially
              causing the node to run at a different rate to its natural speed.
            </p>
          </dd><dt id="widl-AnimationTiming-direction"><code>direction</code> of type <span class="idlAttrType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span></dt><dd>
            <p>
              The <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> of the <a href="#dfn-animation-node" class="internalDFN">animation node</a> as
              specified by one of the <a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a> enumeration
              values.
            </p>
          </dd><dt id="widl-AnimationTiming-easing"><code>easing</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd>
            <p>
              The <a href="#dfn-timing-function" class="internalDFN">timing function</a> used to scale the time to
              produce easing effects.
            </p>
            <p>
              The syntax of the string is defined by the following production:
            </p>
            <blockquote>
              <div class="production">
                "linear"
                  | <a href="#dfn-cubic-bezier-timing-function" class="internalDFN">&lt;cubic-bezier-timing-function&gt;</a>
                  | <a href="#dfn-step-timing-function-1" class="internalDFN">&lt;step-timing-function&gt;</a>
              </div>
            </blockquote>
            <p>
              Unrecognized string values or values that correspond to
              a <a href="#dfn-timing-function" class="internalDFN">timing function</a> that is not supported for the type of
              <a href="#dfn-animation-node" class="internalDFN">animation node</a> to which this property is applied
              are treated as if the <code>linear</code> keyword was specified
              for the purpose of timing model calculations.
            </p>
            <div class="annotation">
              In future we may extend this so that it is possible to query the
              individual functions in the string.
              It may be possible to do this by extending this attribute using
              some stringifier magic, or else we could just add
              <code>easingList</code> similar to HTML's <code>classList</code>.
            </div>
          </dd></dl></section>
      </section>
      <section id="the-animationtiminginput-dictionary">
        <h3><span class="secno">5.5 </span>The <code>AnimationTimingInput</code> dictionary</h3>
        <p>
          The <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> dictionary is used as a convenience
          for specifying the timing properties of an <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a> in
          bulk.
        </p>
        <pre class="idl"><span class="idlDictionary" id="idl-def-AnimationTimingInput">dictionary <span class="idlDictionaryID">AnimationTimingInput</span> {
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-AnimationTimingInput-delay">delay</a></span> = <span class="idlMemberValue">0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-AnimationTimingInput-endDelay">endDelay</a></span> = <span class="idlMemberValue">0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span>                           <span class="idlMemberName"><a href="#widl-AnimationTimingInput-fill">fill</a></span> = <span class="idlMemberValue">"auto"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-AnimationTimingInput-iterationStart">iterationStart</a></span> = <span class="idlMemberValue">0.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>unrestricted double</a></span>                <span class="idlMemberName"><a href="#widl-AnimationTimingInput-iterations">iterations</a></span> = <span class="idlMemberValue">1.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlMemberName"><a href="#widl-AnimationTimingInput-duration">duration</a></span> = <span class="idlMemberValue">"auto"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-AnimationTimingInput-playbackRate">playbackRate</a></span> = <span class="idlMemberValue">1.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span>                  <span class="idlMemberName"><a href="#widl-AnimationTimingInput-direction">direction</a></span> = <span class="idlMemberValue">"normal"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>                          <span class="idlMemberName"><a href="#widl-AnimationTimingInput-easing">easing</a></span> = <span class="idlMemberValue">"linear"</span>;</span>
};</span>
</pre><section id="dictionary-animationtiminginput-members"><h4><span class="secno">5.5.1 </span>Dictionary <a class="idlType" href="#idl-def-AnimationTimingInput"><code>AnimationTimingInput</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-AnimationTimingInput-delay"><code>delay</code> of type <span class="idlMemberType"><a>double</a></span>, defaulting to <code>0</code></dt><dd>
            <p>
              The specified <a href="#dfn-start-delay" class="internalDFN">start delay</a>.
            </p>
            <p>
              See the description of the <code>delay</code> attribute on
              the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface.
            </p>
          </dd><dt id="widl-AnimationTimingInput-endDelay"><code>endDelay</code> of type <span class="idlMemberType"><a>double</a></span>, defaulting to <code>0</code></dt><dd>
            <p>
              The specified <a href="#dfn-end-delay" class="internalDFN">end delay</a>.
            </p>
            <p>
              See the description of the <code>endDelay</code> attribute on
              the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface.
            </p>
          </dd><dt id="widl-AnimationTimingInput-fill"><code>fill</code> of type <span class="idlMemberType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span>, defaulting to <code>"auto"</code></dt><dd>
            <p>
              The <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> as specified by one of the <a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a>
              enumeration values.
            </p>
          </dd><dt id="widl-AnimationTimingInput-iterationStart"><code>iterationStart</code> of type <span class="idlMemberType"><a>double</a></span>, defaulting to <code>0.0</code></dt><dd>
            <p>
              The <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-iteration-start" class="internalDFN">iteration start</a> property.
            </p>
            <p>
              See the description of the <code>iterationStart</code> attribute
              on the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface.
            </p>
          </dd><dt id="widl-AnimationTimingInput-iterations"><code>iterations</code> of type <span class="idlMemberType"><a>unrestricted double</a></span>, defaulting to <code>1.0</code></dt><dd>
            <p>
              The <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a href="#dfn-iteration-count" class="internalDFN">iteration count</a> property.
            </p>
            <p>
              See the description of the <code>iterations</code> attribute
              on the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface.
            </p>
          </dd><dt id="widl-AnimationTimingInput-duration"><code>duration</code> of type <span class="idlMemberType">(<a>unrestricted double</a> or <a>DOMString</a>)</span>, defaulting to <code>"auto"</code></dt><dd>
            <p>
              The <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of the <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
            </p>
            <p>
              See the description of the <code>duration</code>
              attribute on the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface.
            </p>
          </dd><dt id="widl-AnimationTimingInput-playbackRate"><code>playbackRate</code> of type <span class="idlMemberType"><a>double</a></span>, defaulting to <code>1.0</code></dt><dd>
            <p>
              The <a href="#dfn-animation-node" class="internalDFN">animation node</a>'s <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a> property.
            </p>
            <p>
              See the description of the <code>playbackRate</code> attribute
              on the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface.
            </p>
          </dd><dt id="widl-AnimationTimingInput-direction"><code>direction</code> of type <span class="idlMemberType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span>, defaulting to <code>"normal"</code></dt><dd>
            <p>
              The <a href="#dfn-playback-direction" class="internalDFN">playback direction</a> of the <a href="#dfn-animation-node" class="internalDFN">animation node</a>.
            </p>
            <p>
              See the description of the <code>direction</code> attribute
              on the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface.
            </p>
          </dd><dt id="widl-AnimationTimingInput-easing"><code>easing</code> of type <span class="idlMemberType"><a>DOMString</a></span>, defaulting to <code>"linear"</code></dt><dd>
            <p>
              The <a href="#dfn-timing-function" class="internalDFN">timing function</a> used to scale the time to produce
              easing effects.
            </p>
            <p>
              See the description of the <code>easing</code> attribute
              on the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface.
            </p>
          </dd></dl></section>
        <section id="the-fillmode-enumeration">
          <h4><span class="secno">5.5.2 </span>The <code>FillMode</code> enumeration</h4>
          <pre class="idl"><span class="idlEnum" id="idl-def-FillMode">enum <span class="idlEnumName">FillMode</span> {<span class="idlEnumValues"> "<a href="#widl-FillMode-none">none</a>", "<a href="#widl-FillMode-forwards">forwards</a>", "<a href="#widl-FillMode-backwards">backwards</a>", "<a href="#widl-FillMode-both">both</a>", "<a href="#widl-FillMode-auto">auto</a>" </span>};</span>
</pre><section id="values"><h5><span class="secno">5.5.2.1 </span>Values</h5><dl class="values"><dt id="widl-FillMode-none"><code>none</code></dt><dd>
              No fill.
            </dd><dt id="widl-FillMode-forwards"><code>forwards</code></dt><dd>
              Fill forwards.
            </dd><dt id="widl-FillMode-backwards"><code>backwards</code></dt><dd>
              Fill backwards.
            </dd><dt id="widl-FillMode-both"><code>both</code></dt><dd>
              Fill backwards and forwards.
            </dd><dt id="widl-FillMode-auto"><code>auto</code></dt><dd>
              Fill backwards and forwards when applied to an
              <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a> and no fill when applied to an
              <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a>.
            </dd></dl></section>
        </section>
        <section id="the-playbackdirection-enumeration">
          <h4><span class="secno">5.5.3 </span>The <code>PlaybackDirection</code> enumeration</h4>
          <pre class="idl"><span class="idlEnum" id="idl-def-PlaybackDirection">enum <span class="idlEnumName">PlaybackDirection</span> {<span class="idlEnumValues"> "<a href="#widl-PlaybackDirection-normal">normal</a>", "<a href="#widl-PlaybackDirection-reverse">reverse</a>", "<a href="#widl-PlaybackDirection-alternate">alternate</a>", "<a href="#widl-PlaybackDirection-alternate-reverse">alternate-reverse</a>" </span>};</span>
</pre><section id="values-1"><h5><span class="secno">5.5.3.1 </span>Values</h5><dl class="values"><dt id="widl-PlaybackDirection-normal"><code>normal</code></dt><dd>
              All iterations are played as specified.
            </dd><dt id="widl-PlaybackDirection-reverse"><code>reverse</code></dt><dd>
              All iterations are played in the reverse direction from the way
              they are specified.
            </dd><dt id="widl-PlaybackDirection-alternate"><code>alternate</code></dt><dd>
              Even iterations are played as specified, odd iterations are played
              in the reverse direction from the way they are specified.
            </dd><dt id="widl-PlaybackDirection-alternate-reverse"><code>alternate-reverse</code></dt><dd>
              Even iterations are played in the reverse direction from the way
              they are specified, odd iterations are played as specified.
            </dd></dl></section>
        </section>
      </section>
      <section id="the-animationgroup-interface">
        <h3><span class="secno">5.6 </span>The <code>AnimationGroup</code> interface</h3>
        <p>
          <a href="#dfn-animation-group" class="internalDFN">Animation groups</a> are represented by the <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a>
          interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-AnimationGroup">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-AnimationGroup--sequence-AnimationNode--children--unrestricted-double-or-AnimationTimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">sequence&lt;<a></a><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>&gt;?</span> <span class="idlParamName">children</span></span>, 
              <span class="idlParam">optional <span class="idlParamType">(<a>unrestricted double</a> or <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>)</span> <span class="idlParamName">timing</span></span>)</span>]
interface <span class="idlInterfaceID">AnimationGroup</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationNodeList" class="idlType"><code>AnimationNodeList</code></a></span> <span class="idlAttrName"><a href="#widl-AnimationGroup-children">children</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span>    <span class="idlAttrName"><a href="#widl-AnimationGroup-firstChild">firstChild</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span>    <span class="idlAttrName"><a href="#widl-AnimationGroup-lastChild">lastChild</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>           <span class="idlMethName"><a href="#widl-AnimationGroup-prepend-void-AnimationNode...-nodes">prepend</a></span> (<span class="idlParam"><span class="idlParamType"><a>AnimationNode...</a></span> <span class="idlParamName">nodes</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>           <span class="idlMethName"><a href="#widl-AnimationGroup-append-void-AnimationNode...-nodes">append</a></span> (<span class="idlParam"><span class="idlParamType"><a>AnimationNode...</a></span> <span class="idlParamName">nodes</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a></span> <span class="idlMethName"><a href="#widl-AnimationGroup-clone-AnimationGroup">clone</a></span> ();</span>
};</span>
</pre><section id="constructors"><h4><span class="secno">5.6.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-AnimationGroup--sequence-AnimationNode--children--unrestricted-double-or-AnimationTimingInput--timing"><code>AnimationGroup</code></dt><dd>
            <p>
              Creates a new <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a> object using the following
              procedure:
            </p>
            <ol>
              <li>Create a new <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a> object,
                  <var>group</var>.</li>
              <li>Set <var>timing input</var> as follows,
                <dl class="switch">
                  <dt>If <var>timing</var> is an <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>
                    object,</dt>
                  <dd>
                    Let <var>timing input</var> refer to <var>timing</var>.
                  </dd>
                  <dt>If <var>timing</var> is a <code>double</code>,</dt>
                  <dd>
                    Let <var>timing input</var> be a new
                    <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> object with all members set to
                    their default values and <code>duration</code> set to
                    <var>timing</var>.
                  </dd>
                  <dt>Otherwise (<var>timing</var> is undefined),</dt>
                  <dd>
                    Let <var>timing input</var> be a new
                    <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> object with all members set to
                    their default values.
                  </dd>
                </dl>
              </li>
              <li>
                Set <code><var>group</var>.timing</code> to a new
                <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> object whose attributes are assigned the
                value of the member of the same name on <var>timing input</var>.
                <p class="todo">
                  The above two steps are identical with the constructor for <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> and should be
                  factored out somewhere.
                </p>
              </li>
              <li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>children</var>
                  before <code>null</code>.
              </li>
            </ol>
            <div class="note">
              <p>
                Note that since <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> objects have the same
                member names as <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> dictionaries, it is
                also possible to pass the <code>timing</code> member of another
                <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a> as the <var>timing</var> parameter.
              </p>
              <p>
                Doing so will cause the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> object to be
                treated as an <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> dictionary and thus it
                will effectively be cloned, not shared.
              </p>
            </div>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">children</td><td class="prmType"><code>sequence&lt;<a></a><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>&gt;</code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                <p>
                  A sequence of animation nodes to add as children of this group.
                </p>
                <p>
                  These children are appended in sequence using the same
                  semantics as the <code><a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a>.append</code>
                  method.
                </p>
              </td></tr><tr><td class="prmName">timing</td><td class="prmType"><code>(<a>unrestricted double</a> or <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>)</code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span></td><td class="prmDesc">
                <p>
                  The timing properties or <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of the new
                  animation group.
                </p>
              </td></tr></table></dd></dl></section><section id="attributes-4"><h4><span class="secno">5.6.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-AnimationGroup-children"><code>children</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationNodeList" class="idlType"><code>AnimationNodeList</code></a></span>, readonly</dt><dd>
            The list of <a href="#dfn-child-animation-node" class="internalDFN">child animation nodes</a> in the group.
          </dd><dt id="widl-AnimationGroup-firstChild"><code>firstChild</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></span>, readonly, nullable</dt><dd>
            The <a href="#dfn-first-child" class="internalDFN">first child</a> of this <a href="#dfn-animation-group" class="internalDFN">animation group</a>.
          </dd><dt id="widl-AnimationGroup-lastChild"><code>lastChild</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></span>, readonly, nullable</dt><dd>
            The <a href="#dfn-last-child" class="internalDFN">last child</a> of this <a href="#dfn-animation-group" class="internalDFN">animation group</a>.
          </dd></dl></section><section id="methods-3"><h4><span class="secno">5.6.3 </span>Methods</h4><dl class="methods"><dt id="widl-AnimationGroup-prepend-void-AnimationNode...-nodes"><code>prepend</code></dt><dd>
            <ol>
              <li>If any of the <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> in <var>nodes</var> is an
                  <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a>
                  throw a <code>HierarchyRequestError</code> exception and
                  terminate these steps. 
              </li><li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>nodes</var> before
                  the <a href="#dfn-first-child" class="internalDFN">first child</a>.
            </li></ol>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">nodes</td><td class="prmType"><code><a>AnimationNode...</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-AnimationGroup-append-void-AnimationNode...-nodes"><code>append</code></dt><dd>
            <ol>
              <li>If any of the <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> in <var>nodes</var> is an
                  <a href="#dfn-inclusive-ancestor" class="internalDFN">inclusive ancestor</a> of this <a href="#dfn-animation-node" class="internalDFN">animation node</a>
                  throw a <code>HierarchyRequestError</code> exception and
                  terminate these steps. 
              </li><li><a title="insert children" href="#dfn-insert-children" class="internalDFN">Insert</a> <var>nodes</var> before
                  <code>null</code>.
            </li></ol>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">nodes</td><td class="prmType"><code><a>AnimationNode...</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-AnimationGroup-clone-AnimationGroup"><code>clone</code></dt><dd>
            <p>
              Creates a deep copy of this <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a> object using the
              following procedure.
            </p>
            <ol>
              <li>Let <var>source</var> be this <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a> object,
                  the object to be cloned.
              </li><li>Let <var>cloned timing</var> be a new
                  <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> object whose members are assigned
                  the value of the attribute with the same name on
                  <code><var>source</var>.timing</code>.
              </li><li>Let <var>cloned children</var> be an empty sequence of
                  <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a> objects.
              </li><li>For each <var>child</var> in
                  <code><var>source</var>.children</code>, append the result
                  of calling <code><var>child</var>.clone()</code>
                  to <var>cloned children</var>.
              </li><li>Return a new <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a> object created by
                  calling the <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a> constructor with parameters
                  <code>AnimationGroup(<var>cloned children</var>,
                  <var>cloned timing</var>)</code>.
            </li></ol>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a></code></div></dd></dl></section>
        <section id="definitions-for-manipulating-hierarchies">
          <h4><span class="secno">5.6.4 </span>Definitions for manipulating hierarchies</h4>
          <p>The <dfn title="next sibling not included" id="dfn-next-sibling-not-included">next sibling of
             <var>node</var> not included</dfn> in a set of <a href="#dfn-animation-node" class="internalDFN">animation
             nodes</a>, <var>nodes</var> is determined using the following
             steps:</p>
          <ol>
            <li>Let <var>context node</var> be <var>node</var>.
            </li><li>While the <a href="#dfn-next-sibling" class="internalDFN">next sibling</a> of <var>context node</var> is not
                <code>null</code> perform the following steps:
              <ol>
                <li>Let <var>context node</var> be the <a href="#dfn-next-sibling" class="internalDFN">next sibling</a> of
                    <var>context node</var>.
                </li><li>If <var>context node</var> is not in <var>nodes</var> return
                    <var>context node</var> and terminate these steps.
              </li></ol>
            </li><li>Return <code>null</code>.
          </li></ol>
          <p>To <dfn title="remove an animation node" id="dfn-remove-an-animation-node">remove</dfn> a
             <var>node</var> from its <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a> or
             <a href="#dfn-player" class="internalDFN">player</a>, perform the steps corresponding to the first
             matching condition from below, if any:
          </p><dl class="switch">
            <dt>If <var>node</var> has a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>,</dt>
            <dd>
              Remove <var>node</var> from the <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a>'s
              list of <a href="#dfn-child-animation-node" class="internalDFN">child animation nodes</a>.
            </dd>
            <dt>If <var>node</var> is <a href="#dfn-directly-associated-with-a-player" class="internalDFN">directly associated with
                a player</a>,</dt>
            <dd>
              Disassociate <var>node</var> from the <a href="#dfn-player" class="internalDFN">player</a>.
            </dd>
          </dl>
          <p>To <dfn title="insert children" id="dfn-insert-children">insert</dfn> a series of zero or
             more <a href="#dfn-animation-node" class="internalDFN">animation nodes</a>, <var>nodes</var>, to
             <var>parent</var>'s list of <a href="#dfn-child-animation-node" class="internalDFN">child animation nodes</a> before
             <var>reference child</var> perform the following steps for each
             <var>node</var> in <var>nodes</var>:</p>
          <ol>
            <li><a title="remove an animation node" href="#dfn-remove-an-animation-node" class="internalDFN">Remove</a> <var>node</var>
                from its parent.
            </li><li>Insert <var>node</var> to <var>parent</var>'s list of <a href="#dfn-child-animation-node" class="internalDFN">child
                animation nodes</a> before <var>reference child</var>.
          </li></ol>
        </section>
      </section>
      <section id="the-animationnodelist-interface">
        <h3><span class="secno">5.7 </span>The <code>AnimationNodeList</code> interface</h3>
        <p>
          A list of <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> may be represented by
          an <a href="#idl-def-AnimationNodeList" class="idlType"><code>AnimationNodeList</code></a>.
        </p>
        <p>
          The <code>AnimationNodeList</code> interface supports indexed
          properties with indices in the range 0 &#x2264; <var>index</var> &lt;
          <code>length</code>. 
        </p>
        <p class="annotation">
          The only reason this interface exists is to provide a familiar
          experience for authors familiar with DOM interfaces where child nodes
          are accessed via a <code>children</code> member.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-AnimationNodeList">interface <span class="idlInterfaceID">AnimationNodeList</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a></span> <span class="idlAttrName"><a href="#widl-AnimationNodeList-length">length</a></span>;</span>
<span class="idlMethod">    getter <span class="idlMethType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span> <span class="idlMethName"><a href="#widl-AnimationNodeList-item-AnimationNode-unsigned-long-index">item</a></span> (<span class="idlParam"><span class="idlParamType"><a>unsigned long</a></span> <span class="idlParamName">index</span></span>);</span>
};</span>
</pre><section id="attributes-5"><h4><span class="secno">5.7.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-AnimationNodeList-length"><code>length</code> of type <span class="idlAttrType"><a>unsigned long</a></span>, readonly</dt><dd>
            The number of <a href="#dfn-animation-node" class="internalDFN">animation nodes</a> in the list.
          </dd></dl></section><section id="methods-4"><h4><span class="secno">5.7.2 </span>Methods</h4><dl class="methods"><dt id="widl-AnimationNodeList-item-AnimationNode-unsigned-long-index"><code>item</code> [<em>index</em>]</dt><dd>
            <p>
              Returns the <a href="#dfn-animation-node" class="internalDFN">animation node</a> at <code>index</code>.
              If <code>index</code> is greater than or equal to
              <code>length</code> returns <code>null</code>.
            </p>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">index</td><td class="prmType"><code><a>unsigned long</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></code>, nullable</div></dd></dl></section>
      </section>
      <section id="the-animationsequence-interface">
        <h3><span class="secno">5.8 </span>The <code>AnimationSequence</code> interface</h3>
        <p>
          <a href="#dfn-animation-sequence" class="internalDFN">Animation sequences</a> are represented by the
          <code>AnimationSequence</code> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-AnimationSequence">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-AnimationSequence--sequence-AnimationNode--children--unrestricted-double-or-AnimationTimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">sequence&lt;<a></a><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>&gt;?</span> <span class="idlParamName">children</span></span>, 
              <span class="idlParam">optional <span class="idlParamType">(<a>unrestricted double</a> or <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>)</span> <span class="idlParamName">timing</span></span>)</span>]
interface <span class="idlInterfaceID">AnimationSequence</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a></span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationSequence" class="idlType"><code>AnimationSequence</code></a></span> <span class="idlMethName"><a href="#widl-AnimationSequence-clone-AnimationSequence">clone</a></span> ();</span>
};</span>
</pre><section id="constructors-1"><h4><span class="secno">5.8.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-AnimationSequence--sequence-AnimationNode--children--unrestricted-double-or-AnimationTimingInput--timing"><code>AnimationSequence</code></dt><dd>
            The meaning and handling of each of the parameters in this
            constructor is identical to the constructor for
            <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a>.
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">children</td><td class="prmType"><code>sequence&lt;<a></a><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>&gt;</code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr><tr><td class="prmName">timing</td><td class="prmType"><code>(<a>unrestricted double</a> or <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>)</code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span></td><td class="prmDesc"></td></tr></table></dd></dl></section><section id="methods-5"><h4><span class="secno">5.8.2 </span>Methods</h4><dl class="methods"><dt id="widl-AnimationSequence-clone-AnimationSequence"><code>clone</code></dt><dd>
            <p>
              Creates a deep copy of this <a href="#idl-def-AnimationSequence" class="idlType"><code>AnimationSequence</code></a> object using
              the same procedure as defined for <a href="#widl-AnimationGroup-clone-AnimationGroup">AnimationGroup.clone</a>
              except that a new <a href="#idl-def-AnimationSequence" class="idlType"><code>AnimationSequence</code></a> object is created.
            </p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="#idl-def-AnimationSequence" class="idlType"><code>AnimationSequence</code></a></code></div></dd></dl></section>
      </section>
      <section id="the-animation-interface">
        <h3><span class="secno">5.9 </span>The <code>Animation</code> interface</h3>
        <p>
          <a href="#dfn-animation" class="internalDFN">Animations</a> are represented by the
          <code>Animation</code> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-Animation">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-Animation--Animatable-target-object-effect--unrestricted-double-or-AnimationTimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>?</span> <span class="idlParamName">target</span></span>, <span class="idlParam"><span class="idlParamType"><a>object</a>?</span> <span class="idlParamName">effect</span></span>, 
              <span class="idlParam">optional <span class="idlParamType"><a>(unrestricted double or AnimationTimingInput)
               </a></span> <span class="idlParamName">timing</span></span>)</span>]
interface <span class="idlInterfaceID">Animation</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType">(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a>)?</span> <span class="idlAttrName"><a href="#widl-Animation-effect">effect</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>?</span>                          <span class="idlAttrName"><a href="#widl-Animation-target">target</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></span> <span class="idlMethName"><a href="#widl-Animation-clone-Animation">clone</a></span> ();</span>
};</span>
</pre><section id="constructors-2"><h4><span class="secno">5.9.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-Animation--Animatable-target-object-effect--unrestricted-double-or-AnimationTimingInput--timing"><code>Animation</code></dt><dd>
            <p>
              Creates a new <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object
              using the following procedure:
            </p>
            <ol>
              <li>Create a new <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a>
                  object, <var>animation</var>.</li>
              <li>Set <var>timing input</var> as follows,
                <dl class="switch">
                  <dt>If <var>timing</var> is an <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>
                    object,</dt>
                  <dd>
                    Let <var>timing input</var> refer to <var>timing</var>.
                  </dd>
                  <dt>If <var>timing</var> is a <code>double</code>,</dt>
                  <dd>
                    Let <var>timing input</var> be a new
                    <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> object with all members set to
                    their default values and <code>duration</code> set to
                    <var>timing</var>.
                  </dd>
                  <dt>Otherwise (<var>timing</var> is undefined),</dt>
                  <dd>
                    Let <var>timing input</var> be a new
                    <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> object with all members set to
                    their default values.
                  </dd>
                </dl>
              </li>
              <li>
                Set <code><var>animation</var>.timing</code> to a new
                <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> object whose attributes are assigned the
                value of the member of the same name on <var>timing input</var>.
              </li>
              <li>
                Set <code><var>animation</var>.effect</code> to
                the result of applying the <a href="#dfn-procedure-for-converting-an-effect-to-an-idl-value" class="internalDFN">procedure for converting an effect
                to an IDL value</a> to <var>effect</var>.
              </li>
            </ol>
            <p>
              Examples of the usage of this constructor are given in <a href="#creating-a-new-animation-object" class="sectionRef">section 5.9.5 Creating a new Animation object</a>.
            </p>
            <div class="note">
              <p>
                Note that as with <a href="#widl-ctor-AnimationGroup--sequence-AnimationNode--children--unrestricted-double-or-AnimationTimingInput--timing">the
                constructor for </a><a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a>s
                it is possible to pass in an <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> object here
                (e.g. the <code>timing</code> member of another
                <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>) in which case it will be cloned.
              </p>
            </div>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">target</td><td class="prmType"><code><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a></code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The <a href="#dfn-animation-target" class="internalDFN">animation target</a> or target pseudo-element.
                This may be <code>null</code> for animations that do not target
                a specific element.
              </td></tr><tr><td class="prmName">effect</td><td class="prmType"><code><a>object</a></code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                <p>
                  The animation effect used to set the <code>effect</code>
                  attribute of the newly-created <a title="Animation
                  interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object.
                </p>
                <p>
                  The processing of this parameter is defined normatively in <a href="#processing-the-effect-parameter" class="sectionRef">section 5.9.4 Processing the effect parameter</a>.
                  Following is a non-normative summary of this handing.
                </p>
                <p></p>
                  <var>effect</var> may be one of the following:
                <p></p>
                <ul>
                  <li>An <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> object,
                  </li><li>An <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a> function,
                  </li><li>A single <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a>
                      object,
                  </li><li>A sequence of <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a>
                      objects, or
                  </li><li>null
                </li></ul>
                <p>
                  If this parameter is an <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> object or
                  <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a> object, it will be shared with any
                  other <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> objects
                  referring to the same <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or
                  <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a> object.
                  It will <em>not</em> be copied.
                </p>
                <p>
                  If this parameter is of type <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> or
                  <code>sequence&lt;<a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a>&gt;</code>,
                  the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> of the newly-created
                  <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> will be
                  a newly-created <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a> object
                  initialized by using this object as the list of
                  <a href="#dfn-keyframe" class="internalDFN">keyframes</a> and with all other parameters set to their
                  default values.
                </p>
                <p>
                  If this parameter is <code>null</code>, the newly-created
                  <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> will also have
                  a <code>null</code> animation effect.
                </p>
              </td></tr><tr><td class="prmName">timing</td><td class="prmType"><code><a>(unrestricted double or AnimationTimingInput)
               </a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span></td><td class="prmDesc">
                <p>
                  The timing properties or <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> of the new
                  animation.
                </p>
              </td></tr></table></dd></dl></section><section id="attributes-6"><h4><span class="secno">5.9.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-Animation-effect"><code>effect</code> of type <span class="idlAttrType">(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a>)</span>, nullable</dt><dd>
            <p>
              The <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> or <a href="#dfn-custom-effect" class="internalDFN">custom effect</a> to apply.
              May be <code>null</code> in which case the animation will produce
              no observable effect.
            </p>
            <p class="issue">
              On setting, if the previous value was an <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a>, we
              should call the old callback with a null time fraction so it can
              clear its result.
            </p>
          </dd><dt id="widl-Animation-target"><code>target</code> of type <span class="idlAttrType"><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a></span>, nullable</dt><dd>
            <p>
              The element or pseudo-element being animated by this object.
              This may be <code>null</code> for animations that do not target
              a specific element such as an animation that produces a sound
              using an audio <abbr title="Application Programming Interface">API</abbr>.
            </p>
          </dd></dl></section><section id="methods-6"><h4><span class="secno">5.9.3 </span>Methods</h4><dl class="methods"><dt id="widl-Animation-clone-Animation"><code>clone</code></dt><dd>
            <p>
              Creates a copy of this <a title="Animation
              interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object using the following procedure.
            </p>
            <ol>
              <li>Let <var>source</var> be the <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object to
                  clone, that is, this object.</li>
              <li>Let <var>cloned timing</var> be a new
                  <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> object whose members are assigned
                  the value of the attribute with the same name on
                  <code><var>source</var>.timing</code>.</li>
              <li>
                The <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> is cloned depending on the type of
                <code><var>source</var>.effect</code> as follows,
                <dl class="switch">
                  <dt>If <code><var>source</var>.effect</code> is an
                      <a href="#dfn-animation" class="internalDFN">Animation</a> object,</dt>
                  <dd>
                    Let <var>cloned effect</var> be the result of calling
                    <code><var>source</var>.effect.clone()</code>.
                  </dd>
                  <dt>If <code><var>source</var>.effect</code> is an
                      <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a> object,</dt>
                  <dd>
                    Let <var>cloned effect</var> be
                    <code><var>source</var>.effect</code>.
                  </dd>
                  <dt>Otherwise,</dt>
                  <dd>
                    Let <var>cloned effect</var> be <code>null</code>.
                  </dd>
                </dl>
              </li>
              <li>Return a new <a href="#dfn-animation" class="internalDFN">Animation</a> object created by
                  calling the <a href="#widl-ctor-Animation--Animatable-target-object-effect--unrestricted-double-or-AnimationTimingInput--timing">Animation
                  constructor</a> with parameters
                  <code>Animation(<var>source</var>.target, <var>cloned
                  effect</var>, <var>cloned timing</var>)</code>.</li>
            </ol>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></code></div></dd></dl></section>
        <section id="processing-the-effect-parameter">
          <h4><span class="secno">5.9.4 </span>Processing the <var>effect</var> parameter</h4>
          <p>
            The <var>effect</var> parameter, an ECMAScript value passed to the
            <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> constructor or to the
            <code>animate</code> operation of the <a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a> interface,
            may specify an <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a>, an <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a>,
            a <a href="#dfn-keyframe" class="internalDFN">Keyframe</a> a sequence of <a href="#dfn-keyframe" class="internalDFN">Keyframes</a>, or <span class="esvalue">null</span>.
            However, since callback functions and dictionaries are not
            distinguishable in WebIDL, we define the processing of this
            parameter for ECMAScript here in prose.
          </p>
          <p>
            The <dfn id="dfn-procedure-for-converting-an-effect-to-an-idl-value">procedure for converting an effect to an IDL value</dfn>
            with parameter <var>effect</var> is as follows:
          </p>
          <dl class="switch">
            <dt>If <var>effect</var> is <span class="esvalue">null</span>,</dt>
            <dd>Return <span class="idlvalue">null</span>.</dd>
            <dt>If <var>effect</var> is a <a href="http://www.w3.org/TR/WebIDL/#dfn-platform-object">platform
                object</a> that implements <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a>,</dt>
            <dd>
                return the IDL value that is a reference to the that platform
                object.
            </dd>
            <dt>If IsCallable(<var>effect</var>) is true,</dt>
            <dd>Return the result of applying the <a href="http://www.w3.org/TR/WebIDL/#es-callback-function">procedure
                for converting an ECMAScript value to an IDL callback function
                type</a> to <var>effect</var> using <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a> as the
                callback function type.
            </dd>
            <dt>Otherwise,</dt>
            <dd>Return a new <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a> object constructed passing
                <var>effect</var> as the <var>frames</var> parameter.
            </dd>
          </dl>
          <p class="note">
            Note that since the processing of this parameter is defined in
            prose, the above steps will take place after any coercion is applied
            to other parameters passed to the same operation.
          </p>
        </section>
        <section class="informative" id="creating-a-new-animation-object">
          <h4><span class="secno">5.9.5 </span>Creating a new <code>Animation</code> object</h4><div class="informative-bg"><p><em>This section is non-normative.</em></p>
          <p>
            The <a href="#dfn-animation" class="internalDFN">Animation</a> constructor offers a number of approaches to
            creating a new <a href="#dfn-animation" class="internalDFN">Animation</a> object.
            At its simplest, an <a href="#dfn-animation" class="internalDFN">Animation</a> object that changes the
            &#x2018;left&#x2019; property of <var>elem</var> to 100px over three
            seconds can be achieved as follows:
          </p>
          <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> anim <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">3000</span><span class="sh_symbol">);</span></pre>
          <p>
            The second parameter, representing the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>, may
            specify multiple properties, an <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> object, or
            even a callback function.
          </p>
          <pre class="example sh_javascript sh_sourceCode"><span class="sh_comment">// Specify multiple properties at once</span>
<span class="sh_keyword">var</span> animA <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span><span class="sh_symbol">,</span> top<span class="sh_symbol">:</span> <span class="sh_string">'300px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">3000</span><span class="sh_symbol">);</span>

<span class="sh_comment">// Specify multiple frames</span>
<span class="sh_keyword">var</span> animB <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_symbol">[</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'300px'</span> <span class="sh_cbracket">}</span> <span class="sh_symbol">],</span> <span class="sh_number">3000</span><span class="sh_symbol">);</span>

<span class="sh_comment">// Share the animation effect of another animation</span>
<span class="sh_keyword">var</span> animC <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> animB<span class="sh_symbol">.</span>effect<span class="sh_symbol">,</span> <span class="sh_number">3000</span><span class="sh_symbol">);</span>

<span class="sh_comment">// Supply a specialized animation effect</span>
<span class="sh_keyword">var</span> animD <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span>
                          <span class="sh_keyword">new</span> <span class="sh_function">MotionPathEffect</span><span class="sh_symbol">(</span><span class="sh_string">"M100 250C100 50 400 50 400 250"</span><span class="sh_symbol">),</span>
                          <span class="sh_number">3000</span><span class="sh_symbol">);</span>

<span class="sh_comment">// Supply a custom script-based animation effect</span>
<span class="sh_keyword">var</span> animE <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_keyword">function</span><span class="sh_symbol">(</span>time<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span> 
    <span class="sh_comment">// (Normally we should check for time===null, but in this case it produces</span>
    <span class="sh_comment">//  the correct result anyway)</span>
    document<span class="sh_symbol">.</span>documentElement<span class="sh_symbol">.</span>currentScale <span class="sh_symbol">=</span> <span class="sh_number">1.0</span> <span class="sh_symbol">+</span> time <span class="sh_symbol">*</span> <span class="sh_number">2.0</span><span class="sh_symbol">;</span>
  <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">3000</span><span class="sh_symbol">);</span></pre>
          <p>
            The third parameter representing the animation's timing, may
            simply be a number representing the <a href="#dfn-iteration-duration" class="internalDFN">iteration duration</a> in
            milliseconds as above, or, to specify further timing properties such
            as the <a title="animation node playback rate" href="#dfn-animation-node-playback-rate" class="internalDFN">playback rate</a>,
            an <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> object can be used as follows:
          </p>
          <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> anim <span class="sh_symbol">=</span>
  <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> duration<span class="sh_symbol">:</span> <span class="sh_number">3000</span><span class="sh_symbol">,</span> playbackRate<span class="sh_symbol">:</span> <span class="sh_number">2</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span></pre>
          <p>
            If the duration is not specified, the <a href="#dfn-intrinsic-iteration-duration" class="internalDFN">intrinsic iteration
            duration</a> is used which, for an <a href="#dfn-animation" class="internalDFN">animation</a> is zero.
            It is possible to create an animation that simply sets a property
            without any interpolation as follows:
          </p>
          <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> display<span class="sh_symbol">:</span> <span class="sh_string">'none'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> fill<span class="sh_symbol">:</span> <span class="sh_string">'forwards'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span></pre>
          <p>
            This is particularly useful in combination with other <a title="animation" href="#dfn-animation" class="internalDFN">animations</a> or <a href="#dfn-animation-node" class="internalDFN">animation nodes</a>.
            For example, fading an element before switching
            &#x2018;display&#x2019; to &#x2018;none&#x2019; can be achieved as
            follows,
          </p>
          <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">new</span> <span class="sh_function">AnimationSequence</span><span class="sh_symbol">(</span>
  <span class="sh_symbol">[</span>
    <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> opacity<span class="sh_symbol">:</span> <span class="sh_number">0</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">1000</span><span class="sh_symbol">),</span>
    <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> display<span class="sh_symbol">:</span> <span class="sh_string">'none'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> fill<span class="sh_symbol">:</span> <span class="sh_string">'forwards'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">)</span>
  <span class="sh_symbol">]</span>
<span class="sh_symbol">);</span></pre>
          <p>
            Having created an <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a>, it
            can be played using
            <code>document.timeline.play(<var>anim</var>)</code>.
            For simple effects, however, the <a href="#extensions-to-the-element-interface"><code>Element.animate</code></a>
            shortcut is more convenient since it performs this last step
            automatically. For example,
          </p>
          <pre class="example sh_javascript sh_sourceCode">elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span> left<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">3000</span><span class="sh_symbol">);</span></pre>
        </div></section>
      </section>
      <section id="the-animatable-interface">
        <h3><span class="secno">5.10 </span>The <code>Animatable</code> interface</h3>
        <p>
          Objects that may be the target of an <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> implement the
          <a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-Animatable">[<span class="extAttr">NoInterfaceObject</span>]
interface <span class="idlInterfaceID">Animatable</span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a></span>           <span class="idlMethName"><a href="#widl-Animatable-animate-AnimationPlayer-object-effect--double-or-AnimationTimingInput--timing">animate</a></span> (<span class="idlParam"><span class="idlParamType"><a>object</a>?</span> <span class="idlParamName">effect</span></span>, 
                                       <span class="idlParam">optional <span class="idlParamType">(<a>double</a> or <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>)</span> <span class="idlParamName">timing</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a>&gt;</span>       <span class="idlMethName"><a href="#widl-Animatable-getCurrentAnimations-sequence-Animation">getCurrentAnimations</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-Animatable-getAnimationPlayers-sequence-AnimationPlayer">getAnimationPlayers</a></span> ();</span>
};</span>
</pre><section id="methods-7"><h4><span class="secno">5.10.1 </span>Methods</h4><dl class="methods"><dt id="widl-Animatable-animate-AnimationPlayer-object-effect--double-or-AnimationTimingInput--timing"><code>animate</code></dt><dd>
            <p>
              Creates a new <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object
              whose <a href="#dfn-animation-target" class="internalDFN">animation target</a> is the object on which the method is
              called, and calls
              the <a href="#widl-AnimationTimeline-play-AnimationPlayer-AnimationNode-source"><code>play</code></a>
              method of the <a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a> object of
              the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> of the <a href="http://www.w3.org/TR/dom/#concept-node-document">node
              document</a> [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>] of the element passing the newly created
              <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> as the argument to
              the method.
            </p>
            <p>
              The following code fragment:
            </p>
            <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> anim <span class="sh_symbol">=</span> elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span> opacity<span class="sh_symbol">:</span> <span class="sh_number">0</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">2000</span><span class="sh_symbol">);</span></pre>
            <p>
              is equivalent to:
            </p>
            <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> anim <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">Animation</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> opacity<span class="sh_symbol">:</span> <span class="sh_number">0</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">2000</span><span class="sh_symbol">);</span>
elem<span class="sh_symbol">.</span>ownerDocument<span class="sh_symbol">.</span>timeline<span class="sh_symbol">.</span><span class="sh_function">play</span><span class="sh_symbol">(</span>anim<span class="sh_symbol">);</span></pre>
            <p>
              Returns the <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> object returned by the
              <code>play</code> method of the <a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a>.
            </p>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">effect</td><td class="prmType"><code><a>object</a></code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The effect to apply.
                This value is passed to the <a href="#widl-ctor-Animation--Animatable-target-object-effect--unrestricted-double-or-AnimationTimingInput--timing">Animation
                constructor</a> as the <var>effect</var> parameter and has the
                same interpretation as defined for that constructor.
              </td></tr><tr><td class="prmName">timing</td><td class="prmType"><code>(<a>double</a> or <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>)</code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span></td><td class="prmDesc">
                The timing parameters of the animation.
                This value is passed to the <a href="#widl-ctor-Animation--Animatable-target-object-effect--unrestricted-double-or-AnimationTimingInput--timing">Animation
                constructor</a> as the <var>timing</var> parameter and has the
                same interpretation as defined for that constructor.
              </td></tr></table><div><em>Return type: </em><code><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a></code></div></dd><dt id="widl-Animatable-getCurrentAnimations-sequence-Animation"><code>getCurrentAnimations</code></dt><dd>
            <p>
              Returns the set of <a href="#dfn-current" class="internalDFN">current</a> <a title="Animation
              interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> objects that have an <a href="#dfn-animation-effect" class="internalDFN">animation
              effect</a> whose <a href="#dfn-animation-target" class="internalDFN">animation target</a> is this object.
            </p>
            <p>
              The returned list of <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a>
              objects is sorted by their associated <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>
              using the procedure defined for sorting <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>
              in <a href="#the-animation-stack" class="sectionRef">section 4.2.1 The animation stack</a>.
            </p>
            <div class="note">
              <p>
                Note that the definition of a <a href="#dfn-current" class="internalDFN">current</a> <a href="#dfn-animation" class="internalDFN">animation</a>
                does not include those <a href="#dfn-animation" class="internalDFN">animations</a> whose
                <a href="#dfn-local-time" class="internalDFN">local time</a> falls <em>after</em> the <a href="#dfn-active-interval" class="internalDFN">active
                interval</a> but which are still <a href="#dfn-in-effect" class="internalDFN">in effect</a> due to
                a <a href="#dfn-fill-mode" class="internalDFN">fill mode</a>.
                As a result such <a href="#dfn-animation" class="internalDFN">animations</a> are <em>not</em> returned by
                this method.
              </p>
              <p>
                This is because in order to return such <a title="animation" href="#dfn-animation" class="internalDFN">animations</a>, user agents
                would be required to maintain all <a title="animation" href="#dfn-animation" class="internalDFN">animations</a> with a forwards
                <a title="fill mode" href="#dfn-fill-mode" class="internalDFN">fill</a> indefinitely.
                As a result the resources consumed by an animated document would
                steadily accumulate over time.
              </p>
            </div>
            <p class="note">
              Note that when called on <code>Element</code> objects, the list of
              returned <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a>s will
              <em>not</em> include those animations whose target is
              a <code>PseudoElement</code> associated with the
              <code>Element</code> since <code>PseudoElement</code> and
              <code>Element</code> are treated as independent <a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>
              objects.
            </p>
            <p class="issue">
              Feedback has been provided that suggests direct references from
              AnimationNode objects to AnimationPlayers generate circular
              reference and confuse the model. Without this reference,
              getCurrentAnimations is not very useful, as the returned
              AnimationNodes can't be used to effect play control. In the
              absence of a strong use case for a reference from AnimationNode
              to AnimationPlayer, this feature should be considered <strong>at
              risk</strong>.
            </p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code>sequence&lt;<a></a><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a>&gt;</code></div></dd><dt id="widl-Animatable-getAnimationPlayers-sequence-AnimationPlayer"><code>getAnimationPlayers</code></dt><dd>
            <p>
              Returns the set of <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> objects
              whose <a href="#dfn-source-content" class="internalDFN">source content</a> is <a href="#dfn-current" class="internalDFN">current</a> and contains at
              least one <a href="#dfn-animation" class="internalDFN">animation</a> whose <a href="#dfn-animation-target" class="internalDFN">animation target</a> is this
              object.
            </p>
            <p>
              If this object is the <a href="#dfn-animation-target" class="internalDFN">animation target</a> of two or more <a title="animation" href="#dfn-animation" class="internalDFN">animations</a> which are associated with the
              same <a href="#dfn-player" class="internalDFN">player</a>, the corresponding <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>
              object will still only appear in the returned list once.
            </p>
            <p>
              The returned list is sorted in increasing order by <a href="#dfn-player-sequence-number" class="internalDFN">player
              sequence number</a>.
            </p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code>sequence&lt;<a></a><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>&gt;</code></div></dd></dl></section>
      </section>
      <section id="the-animationeffect-interface">
        <h3><span class="secno">5.11 </span>The <code>AnimationEffect</code> interface</h3>
        <p>
          <a href="#dfn-animation-effect" class="internalDFN">Animation effects</a> are represented by
          the <code>AnimationEffect</code> interface.
          <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> is an abstract interface of which several
          concrete subinterfaces are provided.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-AnimationEffect">interface <span class="idlInterfaceID">AnimationEffect</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a></span> <span class="idlAttrName"><a href="#widl-AnimationEffect-iterationComposite">iterationComposite</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span>          <span class="idlAttrName"><a href="#widl-AnimationEffect-composite">composite</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> <span class="idlMethName"><a href="#widl-AnimationEffect-clone-AnimationEffect">clone</a></span> ();</span>
};</span>
</pre><section id="attributes-7"><h4><span class="secno">5.11.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-AnimationEffect-iterationComposite"><code>iterationComposite</code> of type <span class="idlAttrType"><a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a></span></dt><dd>
            <p>
              The <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite operation</a> property of this
              <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> as specified by one of the
              <a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a> enumeration values.
            </p>
          </dd><dt id="widl-AnimationEffect-composite"><code>composite</code> of type <span class="idlAttrType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span></dt><dd>
            <p>
              The <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> used to composite this
              <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> with the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>, as
              specified by one of the <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> enumeration
              values.
            </p>
          </dd></dl></section><section id="methods-8"><h4><span class="secno">5.11.2 </span>Methods</h4><dl class="methods"><dt id="widl-AnimationEffect-clone-AnimationEffect"><code>clone</code></dt><dd>
            <p>
              Creates and returns a new object of the same type as this object's
              most-derived interface such that it will produce the same output
              as this object.
            </p>
            <p class="todo">
              We either need a more rigorous definition here or (probably
              better) a sets of steps on a per-subclass basis.
            </p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></code></div></dd></dl></section>
        <div class="annotation">
          In future, we may expose <code>any sample (double?  timeFraction,
          double currentIteration, Animatable? target, any
          underlyingValue)</code> so that the animation effects can be driven
          apart from the timing model.
        </div>
      </section>
      <section id="the-iterationcompositeoperation-enumeration">
        <h3><span class="secno">5.12 </span>The <code>IterationCompositeOperation</code> enumeration</h3>
        <p>
          The possible values of an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>'s
          <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite operation</a> are represented by the
          <a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a> enumeration.
        </p>
        <pre class="idl"><span class="idlEnum" id="idl-def-IterationCompositeOperation">enum <span class="idlEnumName">IterationCompositeOperation</span> {<span class="idlEnumValues"> "<a href="#widl-IterationCompositeOperation-replace">replace</a>", "<a href="#widl-IterationCompositeOperation-accumulate">accumulate</a>" </span>};</span>
</pre><section id="values-2"><h4><span class="secno">5.12.1 </span>Values</h4><dl class="values"><dt id="widl-IterationCompositeOperation-replace"><code>replace</code></dt><dd>
            Corresponds to the <a title="iteration composite operation replace" href="#dfn-iteration-composite-operation-replace" class="internalDFN">replace</a>
            <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite operation</a> value such that the
            <a href="#dfn-intermediate-animation-value" class="internalDFN">intermediate animation value</a> produced is independent of the
            <a href="#dfn-current-iteration" class="internalDFN">current iteration</a>.
          </dd><dt id="widl-IterationCompositeOperation-accumulate"><code>accumulate</code></dt><dd>
            Corresponds to the <a title="iteration composite operation accumulate" href="#dfn-iteration-composite-operation-accumulate" class="internalDFN">accumulate</a>
            iteration composite operation value such that
            subsequent iterations of an <a href="#dfn-animation" class="internalDFN">animation</a> build on the final
            value of the previous iteration.
          </dd></dl></section>
      </section>
      <section id="the-compositeoperation-enumeration">
        <h3><span class="secno">5.13 </span>The <code>CompositeOperation</code> enumeration</h3>
        <p>
          The possible values of an <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>'s
          composition behavior are represented by the
          <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> enumeration.
        </p>
        <pre class="idl"><span class="idlEnum" id="idl-def-CompositeOperation">enum <span class="idlEnumName">CompositeOperation</span> {<span class="idlEnumValues"> "<a href="#widl-CompositeOperation-replace">replace</a>", "<a href="#widl-CompositeOperation-add">add</a>", "<a href="#widl-CompositeOperation-accumulate">accumulate</a>" </span>};</span>
</pre><section id="values-3"><h4><span class="secno">5.13.1 </span>Values</h4><dl class="values"><dt id="widl-CompositeOperation-replace"><code>replace</code></dt><dd>
            Corresponds to the <a title="composite operation replace" href="#dfn-composite-operation-replace" class="internalDFN">replace</a>
            <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> value such that
            the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> overrides the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a> it
            is combined with.
          </dd><dt id="widl-CompositeOperation-add"><code>add</code></dt><dd>
            Corresponds to the <a title="composite operation add" href="#dfn-composite-operation-add" class="internalDFN">add</a>
            <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> value such that
            the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> is <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">added</a> to the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>
            with which it is combined.
          </dd><dt id="widl-CompositeOperation-accumulate"><code>accumulate</code></dt><dd>
            Corresponds to the <a title="composite operation accumulate" href="#dfn-composite-operation-accumulate" class="internalDFN">accumulate</a>
            <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> value such that
            the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> is <a title="animation accumulation" href="#dfn-animation-accumulation" class="internalDFN">accumulated</a> on to the
            <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>.
          </dd></dl></section>
      </section>
      <section id="the-keyframeeffect-interface">
        <h3><span class="secno">5.14 </span>The <code>KeyframeEffect</code> interface</h3>
        <p>
          <a href="#dfn-keyframe-animation-effect" class="internalDFN">Keyframe animation effects</a> are represented by the
          <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-KeyframeEffect">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-KeyframeEffect--object-frames-KeyframeEffectOptions-options">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a>object</a></span> <span class="idlParamName">frames</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-KeyframeEffectOptions" class="idlType"><code>KeyframeEffectOptions</code></a></span> <span class="idlParamName">options</span></span>)</span>]
interface <span class="idlInterfaceID">KeyframeEffect</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span> <span class="idlAttrName"><a href="#widl-KeyframeEffect-spacing">spacing</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-ComputedKeyframe" class="idlType"><code>ComputedKeyframe</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-KeyframeEffect-getFrames-sequence-ComputedKeyframe">getFrames</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>                       <span class="idlMethName"><a href="#widl-KeyframeEffect-setFrames-void-object-frames">setFrames</a></span> (<span class="idlParam"><span class="idlParamType"><a>object</a></span> <span class="idlParamName">frames</span></span>);</span>
};</span>
</pre><section id="constructors-3"><h4><span class="secno">5.14.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-KeyframeEffect--object-frames-KeyframeEffectOptions-options"><code>KeyframeEffect</code></dt><dd>
            <p>
              Creates a new <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a> object for the
              given set of keyframes.
            </p>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">frames</td><td class="prmType"><code><a>object</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                A <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> object or sequence
                of <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> objects used for
                calculating animation values for this <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>.
                The constraints on this parameter and its processing are
                identical to those for <code>setFrames</code>.
              </td></tr><tr><td class="prmName">options</td><td class="prmType"><code><a href="#idl-def-KeyframeEffectOptions" class="idlType"><code>KeyframeEffectOptions</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span></td><td class="prmDesc">
                A <a href="#idl-def-KeyframeEffectOptions" class="idlType"><code>KeyframeEffectOptions</code></a> dictionary defining other aspects
                of the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>'s behavior.
                If this parameter is not provided, the default values of the
                dictionary are used.
              </td></tr></table></dd></dl></section><section id="attributes-8"><h4><span class="secno">5.14.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-KeyframeEffect-spacing"><code>spacing</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd>
            <p>
              The <a title="keyframe spacing mode" href="#dfn-keyframe-spacing-mode" class="internalDFN">spacing mode</a> to use for
              this <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>.
            </p>
            <p>
              Recognized values are defined by the following grammar:
            </p>
            <blockquote>
              <div class="production">distribute | paced({ident}) | paced</div>
            </blockquote>
            <p>
              <code>{ident}</code> here is an <a href="http://www.w3.org/TR/css3-values/#identifier">identifier</a>
              as defined by CSS3 Values [<cite><a class="bibref" href="#bib-CSS3-VALUES">CSS3-VALUES</a></cite>].
            </p>
            <p>
              The meaning of each value is as follows:
            </p>
            <dl>
              <dt>distribute</dt>
              <dd>Use the <a href="#dfn-distribute-keyframe-spacing-mode" class="internalDFN">distribute keyframe spacing mode</a>.
              </dd><dt>paced({ident})</dt>
              <dd>
                <p>
                  Use the <a href="#dfn-paced-keyframe-spacing-mode" class="internalDFN">paced keyframe spacing mode</a> with the property
                  name indicated by <code>{ident}</code> as the <a href="#dfn-paced-property" class="internalDFN">paced
                  property</a>.
                </p>
                <p>
                  For example, <code>paced(transform)</code> would indicate that
                  the keyframes should be spaced such that changes to the <span class="prop-name">transform</span> property occur at
                  a constant rate.
                </p>
              </dd>
              <dt>paced</dt>
              <dd>
                <p>
                  Use the <a href="#dfn-paced-keyframe-spacing-mode" class="internalDFN">paced keyframe spacing mode</a>.
                </p>
                <p>
                  The <a href="#dfn-paced-property" class="internalDFN">paced property</a> to use is the first property
                  specified in the first keyframe in the list of keyframes
                  associated with this <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>
                  when sorting the CSS property names in ascending order by
                  Unicode codepoint.
                </p>
                <p>
                  As a result, changes to the keyframes may cause the <a href="#dfn-paced-property" class="internalDFN">paced
                  property</a> to change.
                </p>
                <div class="note">
                  Note that this behavior is generally not useful for
                  keyframes specifying more than one property.
                  It is provided for consistency with <a href="#idl-def-MotionPathEffect" class="idlType"><code>MotionPathEffect</code></a>
                  and as a convenience for <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effects</a>
                  that specify only one property.
                </div>
              </dd>
            </dl>
            <p>
              All other values are treated as "distribute" for the purpose of
              animation model calculations.
            </p>
          </dd></dl></section><section id="methods-9"><h4><span class="secno">5.14.3 </span>Methods</h4><dl class="methods"><dt id="widl-KeyframeEffect-getFrames-sequence-ComputedKeyframe"><code>getFrames</code></dt><dd>
            <p>
              Returns the <a href="#dfn-keyframe" class="internalDFN">keyframes</a> that make up this effect as
              a sequence of <a href="#idl-def-ComputedKeyframe" class="idlType"><code>ComputedKeyframe</code></a> objects.
            </p>
            <p>
              The value returned differs from the <var>frames</var> parameter
              passed into <code>setFrames</code> or the constructor for this
              interface in the following ways:
            </p>
            <ul>
              <li>The normalization defined in <a href="#normalizing-a-sequence-of-keyframes" class="sectionRef">section 5.14.6 Normalizing a sequence of keyframes</a> is applied to <var>frames</var> which
                  may result in some frames being removed or re-ordered and some
                  properties being removed.
                  This normalization will also cause a single <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> object to be replaced
                  with a sequence.
              </li><li>The result of computing the <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a>
                  of each <a href="#dfn-keyframe" class="internalDFN">keyframe</a> as defined in <a href="#spacing-keyframes" class="sectionRef">section 4.3.1 Spacing keyframes</a> is stored in
                  the <code>computedOffset</code> member of each frame.
            </li></ul>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code>sequence&lt;<a></a><a href="#idl-def-ComputedKeyframe" class="idlType"><code>ComputedKeyframe</code></a>&gt;</code></div></dd><dt id="widl-KeyframeEffect-setFrames-void-object-frames"><code>setFrames</code></dt><dd>
            <p>
              A <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> object or sequence
              of <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> objects used to
              replace the set of <a href="#dfn-keyframe" class="internalDFN">keyframes</a> that make up this effect.
            </p>
            <p>
              The processing of the <var>frames</var> parameter is defined in <a href="#processing-a-sequence-of-keyframe-objects-or-a-single-item" class="sectionRef">section 5.14.4 Processing a sequence of Keyframe objects or a single item</a>.
              Subsequently, the resulting sequence of <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> objects is normalized 
              using the procedure in <a href="#normalizing-a-sequence-of-keyframes" class="sectionRef">section 5.14.6 Normalizing a sequence of keyframes</a> before storing.
            </p>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">frames</td><td class="prmType"><code><a>object</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></section>
        <section id="processing-a-sequence-of-keyframe-objects-or-a-single-item">
          <h4><span class="secno">5.14.4 </span>Processing a sequence of <code>Keyframe</code> objects or a single item</h4>
          <p>
            WebIDL does not currently make a dictionary and a sequence
            distinguishable but it was felt that allowing both was important
            for useability of the <code>animate</code> operation on
            <a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>.
            Therefore, we define the processing for handling a parameter
            that may be either a single <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> dictionary object, or
            a sequence of such objects.
          </p>
          <p>
            The <dfn id="dfn-procedure-for-converting-an-ecmascript-value-into-an-idl-keyframe-or-sequence-of-keyframes">procedure for converting an ECMAScript value into
            an IDL keyframe or sequence of keyframes</dfn> with parameter
            <var>keyframeOrKeyframeList</var> is as follows:
          </p>
          <dl class="switch">
            <dt>If, using the canonical definition of
                <code>Array.isArray</code> [<cite><a class="bibref" href="#bib-ECMA-262">ECMA-262</a></cite>],
                Array.isArray(<var>keyframeOrKeyframeList</var>) is
                true,</dt>
            <dd>Return the result of following the steps for <a href="http://www.w3.org/TR/WebIDL/#es-sequence">converting an
                ECMAScript value into an IDL sequence</a> using the <a href="#dfn-procedure-for-converting-an-ecmascript-value-to-an-idl-keyframe-object" class="internalDFN">procedure
                for converting an ECMAScript value to an IDL Keyframe object</a>
                as the procedure for converting <var>E</var> to an IDL value of
                type <var>T</var>.</dd>
            <dt>Otherwise,</dt>
            <dd>Return the result of applying the <a href="#dfn-procedure-for-converting-an-ecmascript-value-to-an-idl-keyframe-object" class="internalDFN">procedure for converting
                an ECMAScript value to an IDL Keyframe object</a> to
                <var>keyframeOrKeyframeList.</var></dd><dd>
          </dd></dl>
          <p class="issue">
            Should this be defined in terms of <code>IsIterable</code> instead?
          </p>
        </section>
        <section id="the-keyframeeffectoptions-dictionary">
          <h4><span class="secno">5.14.5 </span>The <code>KeyframeEffectOptions</code> dictionary</h4>
          <p>
            Additional parameters may be passed to the <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a>
            constructor by providing a <a href="#idl-def-KeyframeEffectOptions" class="idlType"><code>KeyframeEffectOptions</code></a> object.
          </p>
          <pre class="idl"><span class="idlDictionary" id="idl-def-KeyframeEffectOptions">dictionary <span class="idlDictionaryID">KeyframeEffectOptions</span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a></span> <span class="idlMemberName"><a href="#widl-KeyframeEffectOptions-iterationComposite">iterationComposite</a></span> = <span class="idlMemberValue">"replace"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span>          <span class="idlMemberName"><a href="#widl-KeyframeEffectOptions-composite">composite</a></span> = <span class="idlMemberValue">"replace"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>                   <span class="idlMemberName"><a href="#widl-KeyframeEffectOptions-spacing">spacing</a></span> = <span class="idlMemberValue">"distribute"</span>;</span>
};</span>
</pre><section id="dictionary-keyframeeffectoptions-members"><h5><span class="secno">5.14.5.1 </span>Dictionary <a class="idlType" href="#idl-def-KeyframeEffectOptions"><code>KeyframeEffectOptions</code></a> Members</h5><dl class="dictionary-members"><dt id="widl-KeyframeEffectOptions-iterationComposite"><code>iterationComposite</code> of type <span class="idlMemberType"><a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a></span>, defaulting to <code>"replace"</code></dt><dd>
              The <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite operation</a> used to define the way
              animation values build from iteration to iteration.
            </dd><dt id="widl-KeyframeEffectOptions-composite"><code>composite</code> of type <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span>, defaulting to <code>"replace"</code></dt><dd>
              The <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> used to composite this
              animation with the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>, as specified by one
              of the <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> enumeration values.
              This is used for all <a href="#dfn-keyframe" class="internalDFN">keyframes</a> that do not specify
              a <a href="#dfn-composite-operation" class="internalDFN">composite operation</a>.
            </dd><dt id="widl-KeyframeEffectOptions-spacing"><code>spacing</code> of type <span class="idlMemberType"><a>DOMString</a></span>, defaulting to <code>"distribute"</code></dt><dd>
              <p>
                The <a title="keyframe spacing mode" href="#dfn-keyframe-spacing-mode" class="internalDFN">spacing mode</a> to apply
                to this <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>'s <a href="#dfn-keyframe" class="internalDFN">keyframes</a>.
              </p>
              <p>
                See the description of the <code>spacing</code> attribute of the
                <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a> interface for the recognized values and
                their meaning are described 
              </p>
              <p>
                Unrecognized values are set on the created <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a>
                object, but are treated as "distribute" for the purpose of
                animation model calculations.
              </p>
            </dd></dl></section>
        </section>
        <section id="normalizing-a-sequence-of-keyframes">
          <h4><span class="secno">5.14.6 </span>Normalizing a sequence of keyframes</h4>
          <p>
            For each call to <code>setFrames</code> or the <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a>
            constructor, the following normalization is performed on the passed
            in <var>frames</var> parameter before storing its value.
          </p>
          <p class="note">
            Note that the processing of the ECMAScript value into a suitable IDL
            value defined in <a href="#processing-a-keyframe-object" class="sectionRef">section 5.15.2 Processing a Keyframe object</a> is performed before this operation is
            initiated.
          </p>
          <ol>
            <li>If <var>frames</var> is a single <a title="Keyframe
                interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> object, replaces <var>frames</var> with
                a new sequence with a single item that is the previous value of
                <var>frames</var>.
            </li><li>If <var>frames</var> is not <a href="#dfn-loosely-sorted-by-offset" class="internalDFN">loosely sorted by offset</a>,
                then,
                <dl class="switch">
                  <dt>If each <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> has
                      a non-null <code>offset</code>,</dt>
                  <dd>Sort <var>frames</var> in ascending order by
                      <code>offset</code>.</dd>
                  <dt>Otherwise,</dt>
                  <dd>Throw a DOMException of type
                      <code>InvalidModificationError</code>.</dd>
                </dl>
            </li><li>If there exist any <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a>
                objects in <var>frames</var> whose <code>offset</code> member is
                non-null and less than zero, remove all keyframes
                objects from the start of <var>frames</var> up to and including
                the keyframe with the largest non-null <code>offset</code>
                that is still less than zero.
            </li><li>Likewise, if there exist any <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> objects in
                <var>frames</var> whose <code>offset</code> member is non-null
                and greater than one, remove all <a href="#dfn-keyframe" class="internalDFN">keyframes</a> from
                the keyframe with the smallest non-null <code>offset</code>
                that is still greater than one until the end of
                <var>frames</var>.
            </li><li>Remove all property values in <var>frames</var> that are invalid
                or not supported by the implementation.
                <p class="issue">
                  Need to define what invalid means here.
                </p>
          </li></ol>
        </section>
      </section>
      <section id="the-keyframe-dictionary">
        <h3><span class="secno">5.15 </span>The <code>Keyframe</code> dictionary</h3>
        <p>
          Individual <a href="#dfn-keyframe" class="internalDFN">keyframes</a> are represented by a special kind of
          <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> dictionary type whose
          members map to the properties to be animated.
          At the time of writing, this kind of open-ended dictionary cannot
          be represented using WebIDL and hence special
          ECMAScript-specific handling for this type is defined in
          <a href="#processing-a-keyframe-object" class="sectionRef">section 5.15.2 Processing a Keyframe object</a>.
          No handling is defined for other languages.
        </p>
        <pre class="idl"><span class="idlDictionary" id="idl-def-Keyframe">dictionary <span class="idlDictionaryID">Keyframe</span> {
<span class="idlSectionComment">    // ... property-value pairs ...</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span>             <span class="idlMemberName"><a href="#widl-Keyframe-offset">offset</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>           <span class="idlMemberName"><a href="#widl-Keyframe-easing">easing</a></span> = <span class="idlMemberValue">"linear"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a>?</span> <span class="idlMemberName"><a href="#widl-Keyframe-composite">composite</a></span> = <span class="idlMemberValue">null</span>;</span>
};</span>
</pre><section id="dictionary-keyframe-members"><h4><span class="secno">5.15.1 </span>Dictionary <a class="idlType" href="#idl-def-Keyframe"><code>Keyframe</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-Keyframe-offset"><code>offset</code> of type <span class="idlMemberType"><a>double</a></span>, nullable, defaulting to <code>null</code></dt><dd>
            <p>
              The <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> of the <a href="#dfn-keyframe" class="internalDFN">keyframe</a> specified as
              a number between 0.0 and 1.0 inclusive or <code>null</code>.
            </p>
            <p>
              <a href="#dfn-keyframe" class="internalDFN">Keyframes</a> with offsets outside the range [0.0, 1.0] are
              ignored when calculating animation values as defined in
              <a href="#normalizing-a-sequence-of-keyframes" class="sectionRef">section 5.14.6 Normalizing a sequence of keyframes</a>.
            </p>
            <p>
              A <code>null</code> value indicates that the <a href="#dfn-keyframe" class="internalDFN">keyframe</a>
              should be positioned using the <a href="#dfn-keyframe-animation-effect" class="internalDFN">keyframe animation effect</a>'s
              <a href="#dfn-keyframe-spacing-mode" class="internalDFN">keyframe spacing mode</a>.
            </p>
          </dd><dt id="widl-Keyframe-easing"><code>easing</code> of type <span class="idlMemberType"><a>DOMString</a></span>, defaulting to <code>"linear"</code></dt><dd>
            <p>
              The <a href="#dfn-timing-function" class="internalDFN">timing function</a> used to transform the progress of time
              from this keyframe until the next keyframe in the series.
            </p>
            <p>
              The syntax and error-handling associated with parsing this string
              is identical to that defined for the <code>easing</code> attribute
              of the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface.
            </p>
          </dd><dt id="widl-Keyframe-composite"><code>composite</code> of type <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span>, nullable, defaulting to <code>null</code></dt><dd>
            <p>
              The <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> used to combine the values
              specified in this keyframe with the <a href="#dfn-underlying-value" class="internalDFN">underlying value</a>.
            </p>
            <p>
              If <code>null</code>, the <a href="#dfn-composite-operation" class="internalDFN">composite operation</a>
              specified on the <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> will be used.
            </p>
          </dd></dl></section>
        <section id="processing-a-keyframe-object">
          <h4><span class="secno">5.15.2 </span>Processing a <code>Keyframe</code> object</h4>
          <div class="note">
            <p>
              Since accessing the properties of an ECMAScript user object can
              have side effects, the manner in which these properties is
              accessed is important.
              In light of this consideration the procedure for converting an
              ECMAScript object into an IDL <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> object has the following
              properties:
            </p>
            <ul>
              <li>Each property that is read, is read only once.</li>
              <li>Properties are read in a well-defined order.</li>
              <li>Properties corresponding to unsupported target properties or
                  attributes are not read.</li>
            </ul>
          </div>
          <p>
            The <dfn id="dfn-procedure-for-converting-an-ecmascript-value-to-an-idl-keyframe-object">procedure for converting an ECMAScript value to an IDL
            Keyframe object</dfn> with parameter <var>keyframe input</var>
            is as follows:
          </p>
          <ol>
            <li>Let <var>keyframe result</var> be a <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> object with the
                <code>offset</code>, <code>easing</code> and
                <code>composite</code> attributes set to the default dictionary
                values.
            </li><li>Create a list, <var>supported properties</var>, of property
                names and attribute names that can be animated by the
                implementation.
            </li><li>Convert each property name in <var>supported properties</var>
                to the equivalent IDL attribute by applying the <a href="http://dev.w3.org/csswg/cssom/#css-property-to-idl-attribute">CSS
                property to IDL attribute</a> algorithm [<cite><a class="bibref" href="#bib-CSSOM">CSSOM</a></cite>].
            </li><li>If the user agent supports animation of the <span class="prop-name">float CSS property, replace 'float' in
                <var>supported properties</var> with 'cssFloat'.
            </span></li><li>Let <var>animation properties</var> be an empty sequence.
            </li><li>Use the internal [&#x200c;[Enumerate]] operation on <var>keyframe
                input</var> to iterate over its properties.
                For each <var>property</var> perform the step corresponding to
                the first matching condition from below, if any.
              <dl class="switch">
                <dt>If <var>property</var> is a case-sensitive match for
                  the string 'offset',</dt>
                <dd>
                  Set the <code>offset</code> member of <var>keyframe
                  result</var> to the result of applying the <a href="http://www.w3.org/TR/WebIDL/#es-double">procedure for
                  converting an ECMAScript value into an IDL double</a>
                  [<cite><a class="bibref" href="#bib-WEBIDL">WEBIDL</a></cite>] to the result of calling the [&#x200c;[Get]]
                  internal method on <var>keyframe input</var> with property
                  name 'offset'.
                </dd>
                <dt>If <var>property</var> is a case-sensitive match for
                  the string 'easing',</dt>
                <dd>
                  <p>
                    Set the <code>easing</code> member of <var>keyframe
                    result</var> to the result of applying the <a href="http://www.w3.org/TR/WebIDL/#es-DOMString">procedure
                    for converting an ECMAScript value to an IDL
                    DOMString value</a> [<cite><a class="bibref" href="#bib-WEBIDL">WEBIDL</a></cite>] with the <a href="http://www.w3.org/TR/WebIDL/#TreatNullAs">[TreatNullAs=EmptyString]</a>
                    annotation in effect, to the result of calling
                    the [&#x200c;[Get]] internal method of <var>keyframe
                    input</var> with property name 'easing'.
                  </p>
                  <p>
                    If the resulting string does not conform to the 
                    grammar defined for the <a href="#widl-AnimationTiming-easing"><code>easing</code></a>
                    attribute of the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a> interface or
                    is not supported by the implementation, then
                    set the <code>easing</code> of <var>keyframe result</var>
                    to the string &#x201c;linear&#x201d;.
                  </p>
                </dd>
                <dt>If <var>property</var> is a case-sensitive match for
                  the string 'composite',</dt>
                <dd>
                  Set the <code>composite</code> member of <var>keyframe
                  result</var> to the result applying <a href="http://www.w3.org/TR/WebIDL/#es-enumeration">the
                  procedure for converting an ECMAScript value to an IDL
                  enumeration type</a> [<cite><a class="bibref" href="#bib-WEBIDL">WEBIDL</a></cite>] with
                  <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> as the enumeration type, to
                  the result of calling the [&#x200c;[Get]] internal method on
                  <var>keyframe input</var> with property name 'composite'.
                </dd>
                <dt>Otherwise, if <var>property</var> also exists in
                  <var>supported properties</var> based on a case-sensitive
                  comparison,</dt>
                <dd>append <var>property</var> to <var>animation
                  properties</var>.</dd>
              </dl>
            </li><li>For user agents that support both a prefixed and an
                unprefixed version of some CSS properties, remove all
                prefixed properties from <var>animation properties</var>
                where the corresponding unprefixed version is also
                present in <var>animation properties</var>.
                <p class="issue">
                  I'd like to remove this step.
                  Prefixes are history.
                </p>
            </li><li>Sort <var>animation properties</var> lexicographically by
                the Unicode codepoints that define each element.
            </li><li>Iterate over <var>animation properties</var> from beginning to
                end and for each <var>name</var> in <var>animation
                properties</var> add a new member pair to <var>keyframe
                result</var> as follows:
              <ul>
                <li><em>member name</em>: the result of applying the
                    the <a href="http://dev.w3.org/csswg/cssom/#idl-attribute-to-css-property">IDL
                    attribute to CSS property</a> algorithm [<cite><a class="bibref" href="#bib-CSSOM">CSSOM</a></cite>] to
                    <var>name</var> unless <var>name</var> is
                    a case-sensitive match for the string 'cssFloat' in
                    which case use the string 'float'.
                </li><li><em>member value</em>: the result of calling
                    <code>ToString</code> on the value returned from the
                    [&#x200c;[Get]] method of <a>keyframe input</a> with property
                    name, <var>name</var>.
                    If [&#x200c;[Get]] returns null or undefined, let the member
                    value be an empty string.
              </li></ul>
            </li><li>Return <var>keyframe result</var>.
          </li></ol>
          <div class="issue">
            <p>
              The above algorithm gives special meaning to the property names
              'offset', 'computedOffset', 'easing', and 'composite'.
              If a CSS property called 'offset' or 'composite' is ever
              introduced it will clash with the meaning here.
            </p>
            <p>
              We have a few options:
            </p>
            <ul>
              <li>Add special handling at that time to allow addressing the
                  property of the same name, e.g. <code>cssOffset</code>.
              </li><li>Rename these keywords now to reduce risk of a later clash,
                  e.g. 'keyframeOffset'.
            </li></ul>
          </div>
        </section>
      </section>
      <section id="the-computedkeyframe-dictionary">
        <h3><span class="secno">5.16 </span>The <code>ComputedKeyframe</code> dictionary</h3>
        <p>
          <a href="#dfn-keyframe" class="internalDFN">Keyframes</a> returned by
          <code><a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a>.getFrames</code> are represented using
          <a href="#idl-def-ComputedKeyframe" class="idlType"><code>ComputedKeyframe</code></a> dictionary objects.
        </p>
        <pre class="idl"><span class="idlDictionary" id="idl-def-ComputedKeyframe">dictionary <span class="idlDictionaryID">ComputedKeyframe</span> : <span class="idlSuperclass"><a href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a></span> {
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span> <span class="idlMemberName"><a href="#widl-ComputedKeyframe-computedOffset">computedOffset</a></span>;</span>
};</span>
</pre><section id="dictionary-computedkeyframe-members"><h4><span class="secno">5.16.1 </span>Dictionary <a class="idlType" href="#idl-def-ComputedKeyframe"><code>ComputedKeyframe</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-ComputedKeyframe-computedOffset"><code>computedOffset</code> of type <span class="idlMemberType"><a>double</a></span></dt><dd>
            The <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> calculated for this <a href="#dfn-keyframe" class="internalDFN">keyframe</a> as
            a result of applying the spacing procedure defined in <a href="#spacing-keyframes" class="sectionRef">section 4.3.1 Spacing keyframes</a>.
          </dd></dl></section>
      </section>
      <section id="the-motionpatheffect-interface">
        <h3><span class="secno">5.17 </span>The <code>MotionPathEffect</code> interface</h3>
        <p>
          <a href="#dfn-motion-path-animation-effect" class="internalDFN">Motion path animation effects</a> are
          represented by the <a href="#idl-def-MotionPathEffect" class="idlType"><code>MotionPathEffect</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-MotionPathEffect">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-MotionPathEffect---DOMString-or-SVGPathSegList--path-MotionPathEffectOptions-options">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">(<a>DOMString</a> or <a>SVGPathSegList</a>)</span> <span class="idlParamName">path</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-MotionPathEffectOptions" class="idlType"><code>MotionPathEffectOptions</code></a></span> <span class="idlParamName">options</span></span>)</span>]
interface <span class="idlInterfaceID">MotionPathEffect</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>SVGPathSegList</a></span>   <span class="idlAttrName"><a href="#widl-MotionPathEffect-segments">segments</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a></span> <span class="idlAttrName"><a href="#widl-MotionPathEffect-autoRotate">autoRotate</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>           <span class="idlAttrName"><a href="#widl-MotionPathEffect-angle">angle</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span>        <span class="idlAttrName"><a href="#widl-MotionPathEffect-spacing">spacing</a></span>;</span>
};</span>
</pre><section id="constructors-4"><h4><span class="secno">5.17.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-MotionPathEffect---DOMString-or-SVGPathSegList--path-MotionPathEffectOptions-options"><code>MotionPathEffect</code></dt><dd>
            <p>
              Creates a new <a href="#idl-def-MotionPathEffect" class="idlType"><code>MotionPathEffect</code></a> object with the specified
              parameters.
            </p>
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">path</td><td class="prmType"><code>(<a>DOMString</a> or <a>SVGPathSegList</a>)</code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                <p>
                  The <a href="#dfn-motion-path" class="internalDFN">motion path</a> which defines the course the
                  <a href="#dfn-animation-target" class="internalDFN">animation target</a> follows.
                </p>
                <p>
                  A string may be provided specifying the path using the syntax
                  for <a href="http://www.w3.org/TR/SVG2/paths.html#PathData">SVG path
                  data</a> [<cite><a class="bibref" href="#bib-SVG2">SVG2</a></cite>].
                </p>
                <p>
                  If a string is provided, it is converted into an
                  <code>SVGPathSegList</code> using the procedure defined for
                  parsing <a href="http://www.w3.org/TR/SVG2/paths.html#PathData">path
                  data</a> in [<cite><a class="bibref" href="#bib-SVG2">SVG2</a></cite>].
                  Any errors encountered in the path data cause parsing to
                  cease and the path data processed up to that point to be used.
                </p>
                <p>
                  The resulting <a>SVGPathSegList</a> is assigned to the
                  <code>path</code> attribute of the generated object without
                  copying.
                </p>
              </td></tr><tr><td class="prmName">options</td><td class="prmType"><code><a href="#idl-def-MotionPathEffectOptions" class="idlType"><code>MotionPathEffectOptions</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span></td><td class="prmDesc">
                A <a href="#idl-def-MotionPathEffectOptions" class="idlType"><code>MotionPathEffectOptions</code></a> dictionary defining other
                aspects of the <a href="#dfn-animation-effect" class="internalDFN">animation effect</a>'s behavior.
                If this parameter is not provided, the default values of the
                dictionary are used.
              </td></tr></table></dd></dl></section><section id="attributes-9"><h4><span class="secno">5.17.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-MotionPathEffect-segments"><code>segments</code> of type <span class="idlAttrType"><a>SVGPathSegList</a></span></dt><dd>
            The list of segments that make up the <a href="#dfn-motion-path" class="internalDFN">motion path</a>.
          </dd><dt id="widl-MotionPathEffect-autoRotate"><code>autoRotate</code> of type <span class="idlAttrType"><a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a></span></dt><dd>
            The <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a> of the <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path animation
            effect</a>.
          </dd><dt id="widl-MotionPathEffect-angle"><code>angle</code> of type <span class="idlAttrType"><a>double</a></span></dt><dd>
            The <a href="#dfn-rotation-angle" class="internalDFN">rotation angle</a> of the <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path animation
            effect</a>.
          </dd><dt id="widl-MotionPathEffect-spacing"><code>spacing</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd>
            <p>
              The <a href="#dfn-motion-path-spacing-mode" class="internalDFN">motion path spacing mode</a> to use for this <a href="#dfn-animation-effect" class="internalDFN">animation
              effect</a>.
            </p>
            <p>
              Recognized values are defined by the following grammar:
            </p>
            <blockquote>
              <div class="production">distribute | paced</div>
            </blockquote>
            <p>
              The meaning of each value is as follows:
            </p>
            <dl>
              <dt>distribute</dt>
              <dd>Use the <a title="distribute keyframe spacing mode" href="#dfn-distribute-keyframe-spacing-mode" class="internalDFN">distribute</a>
                  spacing mode.</dd>
              <dt>paced</dt>
              <dd>Use the <a title="paced keyframe spacing mode" href="#dfn-paced-keyframe-spacing-mode" class="internalDFN">paced</a>
                  spacing mode.</dd>
            </dl>
            <p>
              All other values are treated as "paced" for the purpose of
              animation model calculations.
            </p>
          </dd></dl></section>
        <section id="the-motionpatheffectoptions-dictionary">
          <h4><span class="secno">5.17.3 </span>The <code>MotionPathEffectOptions</code> dictionary</h4>
          <p>
            Additional parameters may be passed to the <a href="#idl-def-MotionPathEffect" class="idlType"><code>MotionPathEffect</code></a>
            constructor by providing a <a href="#idl-def-MotionPathEffectOptions" class="idlType"><code>MotionPathEffectOptions</code></a> object.
          </p>
          <pre class="idl"><span class="idlDictionary" id="idl-def-MotionPathEffectOptions">dictionary <span class="idlDictionaryID">MotionPathEffectOptions</span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a></span>            <span class="idlMemberName"><a href="#widl-MotionPathEffectOptions-autoRotate">autoRotate</a></span> = <span class="idlMemberValue">"none"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                      <span class="idlMemberName"><a href="#widl-MotionPathEffectOptions-angle">angle</a></span> = <span class="idlMemberValue">0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a></span> <span class="idlMemberName"><a href="#widl-MotionPathEffectOptions-iterationComposite">iterationComposite</a></span> = <span class="idlMemberValue">"replace"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span>          <span class="idlMemberName"><a href="#widl-MotionPathEffectOptions-composite">composite</a></span> = <span class="idlMemberValue">"replace"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>                   <span class="idlMemberName"><a href="#widl-MotionPathEffectOptions-spacing">spacing</a></span> = <span class="idlMemberValue">"paced"</span>;</span>
};</span>
</pre><section id="dictionary-motionpatheffectoptions-members"><h5><span class="secno">5.17.3.1 </span>Dictionary <a class="idlType" href="#idl-def-MotionPathEffectOptions"><code>MotionPathEffectOptions</code></a> Members</h5><dl class="dictionary-members"><dt id="widl-MotionPathEffectOptions-autoRotate"><code>autoRotate</code> of type <span class="idlMemberType"><a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a></span>, defaulting to <code>"none"</code></dt><dd>
              The <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a> setting for the generated
              effect.
            </dd><dt id="widl-MotionPathEffectOptions-angle"><code>angle</code> of type <span class="idlMemberType"><a>double</a></span>, defaulting to <code>0</code></dt><dd>
              The <a href="#dfn-rotation-angle" class="internalDFN">rotation angle</a> for the generated effect.
            </dd><dt id="widl-MotionPathEffectOptions-iterationComposite"><code>iterationComposite</code> of type <span class="idlMemberType"><a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a></span>, defaulting to <code>"replace"</code></dt><dd>
              The <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite operation</a> used to define the way
              animation values build from iteration to iteration.
            </dd><dt id="widl-MotionPathEffectOptions-composite"><code>composite</code> of type <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span>, defaulting to <code>"replace"</code></dt><dd>
              The <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> used to composite this
              <a href="#dfn-animation-effect" class="internalDFN">animation effect</a> with the <a href="#dfn-animation-stack" class="internalDFN">animation stack</a>, as
              specified by one of the <a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a> enumeration
              values.
            </dd><dt id="widl-MotionPathEffectOptions-spacing"><code>spacing</code> of type <span class="idlMemberType"><a>DOMString</a></span>, defaulting to <code>"paced"</code></dt><dd>
              <p>
                The <a title="keyframe spacing mode" href="#dfn-keyframe-spacing-mode" class="internalDFN">spacing mode</a> to apply
                to this <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path animation effect</a>.
              </p>
              <p>
                See the description of the <code>spacing</code> attribute of the
                <a href="#idl-def-MotionPathEffect" class="idlType"><code>MotionPathEffect</code></a> interface for the recognized values and
                their meaning are described 
              </p>
              <p>
                Unrecognized values are set on the created
                <a href="#idl-def-MotionPathEffect" class="idlType"><code>MotionPathEffect</code></a> object, but are treated as "paced" for
                the purpose of animation model calculations.
              </p>
            </dd></dl></section>
        </section>
        <section id="the-autorotationmode-enumeration">
          <h4><span class="secno">5.17.4 </span>The <code>AutoRotationMode</code> enumeration</h4>
          <p>
            The values of the <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a> of a <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path
            animation effect</a> are represented by the <a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a>
            enumeration.
          </p>
          <pre class="idl"><span class="idlEnum" id="idl-def-AutoRotationMode">enum <span class="idlEnumName">AutoRotationMode</span> {<span class="idlEnumValues"> "<a href="#widl-AutoRotationMode-auto-rotate">auto-rotate</a>", "<a href="#widl-AutoRotationMode-none">none</a>" </span>};</span>
</pre><section id="values-4"><h5><span class="secno">5.17.4.1 </span>Values</h5><dl class="values"><dt id="widl-AutoRotationMode-auto-rotate"><code>auto-rotate</code></dt><dd>
              Corresponds to setting the <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a>.
            </dd><dt id="widl-AutoRotationMode-none"><code>none</code></dt><dd>
              Corresponds to clearing the <a href="#dfn-automatic-rotation-flag" class="internalDFN">automatic rotation flag</a>.
            </dd></dl></section>
        </section>
      </section>
      <section id="the-effectcallback-callback-function">
        <h3><span class="secno">5.18 </span>The <code>EffectCallback</code> callback function</h3>
        <p>
          <a href="#dfn-custom-effect" class="internalDFN">Custom effects</a> can be defined in script by providing an
          <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a> callback function.
        </p>
        <pre class="idl"><span class="idlCallback" id="idl-def-EffectCallback">callback <span class="idlCallbackID">EffectCallback</span> = <span class="idlCallbackType"><a>void</a></span> (<span class="idlParam"><span class="idlParamType"><a>double</a>?</span> <span class="idlParamName">timeFraction</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a></span> <span class="idlParamName">currentTarget</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></span> <span class="idlParamName">animation</span></span>)</span>;
</pre><div class="idlCallbackDesc">
          <p>
            An <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a> is called each time an <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> with which it is
            associated is <a title="sampling" href="#dfn-sampling" class="internalDFN">sampled</a>.
          </p>
          
        <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">timeFraction</td><td class="prmType"><code><a>double</a></code></td><td class="prmNullTrue">&#x2714;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
              The <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> for which to produce an effect.
              When this is <code>null</code>, the function <em class="rfc2119" title="should">should</em>
              remove the effect.
            </td></tr><tr><td class="prmName">currentTarget</td><td class="prmType"><code><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
              <p>
                The <a href="#dfn-animation-target" class="internalDFN">animation target</a> on which this callback is expected
                to operate.
              </p>
              <div class="note">
                <p>
                  Note that <var>currentTarget</var> may differ from
                  <code><var>animation</var>.target</code>.
                </p>
                <p>
                  If the <a href="#dfn-animation-target" class="internalDFN">animation target</a> of <var>animation</var>
                  is changed between samples, this method will be
                  called once with a null <var>timeFraction</var> and the
                  previous <a href="#dfn-animation-target" class="internalDFN">animation target</a> as the
                  <var>currentTarget</var>, then again with the current
                  <var>timeFraction</var> and the updated <a href="#dfn-animation-target" class="internalDFN">animation
                  target</a> as the <var>currentTarget</var>.
                  This allows the animation effect to be removed from the old
                  <a href="#dfn-animation-target" class="internalDFN">animation target</a>.
                </p>
              </div>
            </td></tr><tr><td class="prmName">animation</td><td class="prmType"><code><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
              The <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object that is
              being sampled.
            </td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></div>
      </section>
      <section id="the-animationplayerevent-interface">
        <h3><span class="secno">5.19 </span>The <code>AnimationPlayerEvent</code> interface</h3>
        <p>
          <a href="#dfn-player-event" class="internalDFN">Player events</a> are represented in the <abbr title="Application Programming Interface">API</abbr> by the
          <a href="#idl-def-AnimationPlayerEvent" class="idlType"><code>AnimationPlayerEvent</code></a> interface.
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-AnimationPlayerEvent">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-AnimationPlayerEvent--DOMString-type-AnimationPlayerEventInit-eventInit">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">type</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-AnimationPlayerEventInit" class="idlType"><code>AnimationPlayerEventInit</code></a></span> <span class="idlParamName">eventInit</span></span>)</span>]
interface <span class="idlInterfaceID">AnimationPlayerEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a>?</span> <span class="idlAttrName"><a href="#widl-AnimationPlayerEvent-currentTime">currentTime</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a>?</span> <span class="idlAttrName"><a href="#widl-AnimationPlayerEvent-timelineTime">timelineTime</a></span>;</span>
};</span>
</pre><section id="constructors-5"><h4><span class="secno">5.19.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-AnimationPlayerEvent--DOMString-type-AnimationPlayerEventInit-eventInit"><code>AnimationPlayerEvent</code></dt><dd>
            Constructs a new <a href="#idl-def-AnimationPlayerEvent" class="idlType"><code>AnimationPlayerEvent</code></a> object as described in
            <a href="http://www.w3.org/TR/dom/#constructing-events">Constructing
            events</a> in [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>].
            
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">type</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt prmOptFalse">&#x2718;</td><td class="prmDesc">
                The type of <a href="#dfn-player-event" class="internalDFN">player event</a> corresponding to one of the
                types defined in <a href="#types-of-player-events" class="sectionRef">section 3.5.4.1 Types of player events</a>.
              </td></tr><tr><td class="prmName">eventInit</td><td class="prmType"><code><a href="#idl-def-AnimationPlayerEventInit" class="idlType"><code>AnimationPlayerEventInit</code></a></code></td><td class="prmNullFalse">&#x2718;</td><td class="prmOpt"><span class="prmOptTrue">&#x2714;</span></td><td class="prmDesc">
                The parameters of the new <a href="#idl-def-AnimationPlayerEvent" class="idlType"><code>AnimationPlayerEvent</code></a>.
              </td></tr></table></dd></dl></section><section id="attributes-10"><h4><span class="secno">5.19.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-AnimationPlayerEvent-currentTime"><code>currentTime</code> of type <span class="idlAttrType"><a>double</a></span>, nullable</dt><dd>
            The <a href="#dfn-event-current-time" class="internalDFN">event current time</a>.
          </dd><dt id="widl-AnimationPlayerEvent-timelineTime"><code>timelineTime</code> of type <span class="idlAttrType"><a>double</a></span>, nullable</dt><dd>
            The <a href="#dfn-event-timeline-time" class="internalDFN">event timeline time</a>.
          </dd></dl></section>
        <p>
          The <a href="#idl-def-AnimationPlayerEventInit" class="idlType"><code>AnimationPlayerEventInit</code></a> dictionary type is used to specify
          the parameters when constructing an <a href="#idl-def-AnimationPlayerEvent" class="idlType"><code>AnimationPlayerEvent</code></a>
          object.
        </p>
        <pre class="idl"><span class="idlDictionary" id="idl-def-AnimationPlayerEventInit">dictionary <span class="idlDictionaryID">AnimationPlayerEventInit</span> {
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span> <span class="idlMemberName"><a href="#widl-AnimationPlayerEventInit-currentTime">currentTime</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span> <span class="idlMemberName"><a href="#widl-AnimationPlayerEventInit-timelineTime">timelineTime</a></span> = <span class="idlMemberValue">null</span>;</span>
};</span>
</pre><section id="dictionary-animationplayereventinit-members"><h4><span class="secno">5.19.3 </span>Dictionary <a class="idlType" href="#idl-def-AnimationPlayerEventInit"><code>AnimationPlayerEventInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-AnimationPlayerEventInit-currentTime"><code>currentTime</code> of type <span class="idlMemberType"><a>double</a></span>, nullable, defaulting to <code>null</code></dt><dd></dd><dt id="widl-AnimationPlayerEventInit-timelineTime"><code>timelineTime</code> of type <span class="idlMemberType"><a>double</a></span>, nullable, defaulting to <code>null</code></dt><dd></dd></dl></section>
      </section>
      <section id="extensions-to-the-document-interface">
        <h3><span class="secno">5.20 </span>Extensions to the <code>Document</code> interface</h3>
        <p>
          The following extensions are made to the <a class="externalDFN" href="http://www.w3.org/TR/dom/#interface-document">Document
          interface</a> defined in [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>].
        </p>
        <pre class="idl"><span class="idlInterface" id="idl-def-Document">partial interface <span class="idlInterfaceID">Document</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a></span> <span class="idlAttrName"><a href="#widl-Document-timeline">timeline</a></span>;</span>
};</span>
</pre><section id="attributes-11"><h4><span class="secno">5.20.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-Document-timeline"><code>timeline</code> of type <span class="idlAttrType"><a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a></span>, readonly</dt><dd>
            The <a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a> object representing
            the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a>.
          </dd></dl></section>
      </section>
      <section id="extensions-to-the-element-interface">
        <h3><span class="secno">5.21 </span>Extensions to the <code>Element</code> interface</h3>
        <p>
          Since DOM Elements may be the target of an animation, 
          the <a class="externalDFN" href="http://www.w3.org/TR/dom/#interface-element">Element</a>
          interface [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>] is extended as follows:
        </p>
        <pre class="idl"><span class="idlImplements"><a>Element</a> implements <a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>;</span></pre><div class="idlImplementsDesc">
          <p>This allows the following kind of usage.</p>
          <pre class="example sh_javascript sh_sourceCode">elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span> color<span class="sh_symbol">:</span> <span class="sh_string">'red'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">2000</span><span class="sh_symbol">);</span></pre>
        </div>
      </section>
      <section id="extensions-to-the-pseudoelement-interface">
        <h3><span class="secno">5.22 </span>Extensions to the <code>PseudoElement</code> interface</h3>
        <p>
          Since <a href="#dfn-animation" class="internalDFN">animations</a> may also target
          pseudo-elements, the <a class="externalDFN" href="http://www.w3.org/TR/cssom/#the-pseudoelement-interface"><code>PseudoElement</code></a>
          interface [<cite><a class="bibref" href="#bib-CSSOM">CSSOM</a></cite>] is also defined to be animatable.
        </p>
        <pre class="idl"><span class="idlImplements"><a>PseudoElement</a> implements <a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>;</span></pre><div class="idlImplementsDesc">
        </div>
        <p class="issue">
          This interface is marked at-risk in the <a class="externalDFN" href="http://www.w3.org/TR/2013/WD-cssom-20131205/">5 December 2013 WD
          of CSSOM</a>.
          If it is removed, we will need to provide an equivalent definition
          here.
        </p>
      </section>
      <section id="script-execution-and-live-updates-to-the-model">
        <h3><span class="secno">5.23 </span>Script execution and live updates to the model</h3>
        <p>
          The interaction between script execution and the state and effects of
          the Web Animations model is as follows:
        </p>
        <ul>
          <li>
            <p>
              Changes made to the Web Animations model via the programming
              interface are reflected immediately in the values returned by the
              interfaces defined in this specification.
            </p>
            <p>
              Similarly, methods that operate on the current state of the model
              such as pausing or reversing are applied to a fully-updated timing
              model, that is, after all previous modifications have been
              incorporated.
            </p>
            <div class="informative informative-bg">
              <p><em>This section is non-normative.</em></p><p>
                For example, if the <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>
                associated with an
                <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> is <a title="seeking" href="#dfn-seeking" class="internalDFN">seeked</a> via the programming interface,
                the value returned when querying the
                animation's <code>startTime</code> will reflect updated state of
                the model immediately.
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_comment">// Initially player.src.localTime is 3000</span>
player<span class="sh_symbol">.</span>currentTime <span class="sh_symbol">+=</span> <span class="sh_number">2000</span><span class="sh_symbol">;</span>
<span class="sh_function">alert</span><span class="sh_symbol">(</span>player<span class="sh_symbol">.</span>src<span class="sh_symbol">.</span>localTime<span class="sh_symbol">);</span> <span class="sh_comment">// Displays '5000'</span></pre>
              <p>
                The same concept applies to more complex modifications of the
                Web Animations model such as adding and removing children from
                an <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a>.
              </p>
            </div>
          </li>
          <li>
            <p>
              Querying the computed style of a property affected by
              animation, or the value of an attribute affected by animation,
              returns the value based the <em>current state</em> of the
              model, that is, after incorporating any modifications made using
              the programming interface.
            </p>
            <div class="informative informative-bg">
              <p><em>This section is non-normative.</em></p><p>
                For example, if the used style of an element is queried
                immediately after applying a new <a href="#dfn-animation" class="internalDFN">Animation</a> to that
                element, the result of the new animation will be
                incorporated in the value returned.
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_comment">// Set opacity to 0 immediately</span>
elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span> opacity<span class="sh_symbol">:</span> <span class="sh_number">0</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> fill<span class="sh_symbol">:</span> <span class="sh_string">'forwards'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span>
<span class="sh_function">alert</span><span class="sh_symbol">(</span>window<span class="sh_symbol">.</span><span class="sh_function">getComputedStyle</span><span class="sh_symbol">(</span>elem<span class="sh_symbol">).</span>opacity<span class="sh_symbol">);</span> <span class="sh_comment">// Displays '0'</span></pre>
              <p>
                The means of querying the animated value of an attribute depends
                on the interface defined for the attribute.
                SVG 1.1 [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>] defines an additional interface for querying
                animated values.
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_comment">// Set width to 0 immediately</span>
rect<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span> width<span class="sh_symbol">:</span> <span class="sh_string">'100px'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> fill<span class="sh_symbol">:</span> <span class="sh_string">'forwards'</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span>
<span class="sh_function">alert</span><span class="sh_symbol">(</span>rect<span class="sh_symbol">.</span>width<span class="sh_symbol">.</span>animVal<span class="sh_symbol">.</span>value<span class="sh_symbol">);</span> <span class="sh_comment">// Displays '100'</span></pre>
            </div>
          </li>
          <li>
            <p>
              Changes made to the model using the programming interface do
              <em>not</em> cause any <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a> functions to be
              called.
            </p>
            <div class="informative informative-bg">
              <p><em>This section is non-normative.</em></p><p>
                For example, in the following code, the callback function will
                not be called until <em>after</em> the script block has
                completed during regular sampling.
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> timesCalled <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>
elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">(</span><span class="sh_keyword">function</span><span class="sh_symbol">()</span> <span class="sh_cbracket">{</span>
  timesCalled<span class="sh_symbol">++;</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_number">10000</span><span class="sh_symbol">);</span>
<span class="sh_function">alert</span><span class="sh_symbol">(</span>timesCalled<span class="sh_symbol">);</span> <span class="sh_comment">// Displays '0'</span></pre>
            </div>
          </li>
          <li>
            <p>
              Changes to specified style, specified attribute values, and the
              state of the Web Animations model made within the same execution
              block must be synchronized when rendering such that the whole set
              of changes is rendered together.
            </p>
            <div class="informative informative-bg">
              <p><em>This section is non-normative.</em></p><p>
                For example, a user agent must not render only the changes to
                specified style made in a script execution block whilst ignoring
                changes to animations.
                This guarantees that the following usage will never produce
                a situation where <em>only</em> the change to specified style is
                rendered without the animation.
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_comment">// Fade the opacity with fallback for browsers that don't</span>
<span class="sh_comment">// support Element.animate</span>
elem<span class="sh_symbol">.</span>style<span class="sh_symbol">.</span>opacity <span class="sh_symbol">=</span> <span class="sh_string">'0'</span><span class="sh_symbol">;</span>
elem<span class="sh_symbol">.</span><span class="sh_function">animate</span><span class="sh_symbol">([</span> <span class="sh_cbracket">{</span> opacity<span class="sh_symbol">:</span> <span class="sh_number">1</span> <span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> opacity<span class="sh_symbol">:</span> <span class="sh_number">0</span> <span class="sh_cbracket">}</span> <span class="sh_symbol">],</span> <span class="sh_number">500</span><span class="sh_symbol">);</span></pre>
              <p>
                Note that a user agent may render a frame with <em>none</em> of
                the changes made in a script execution block.
                This might happen, for example, if rendering occurs in
                a separate process that is scheduled to run shortly after
                a script execution block completes but before changes made via
                script can be communicated to the process.
              </p>
            </div>
          </li>
          <li>
            <p>
              The value returned by the <code>currentTime</code> attribute of
              a <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> will not change within a script block.
            </p>
            <div class="informative informative-bg">
              <p><em>This section is non-normative.</em></p><p>
                For example, querying the <code>currentTime</code> twice within
                a long block of code that is executed in the same script block
                will return the same value as shown in the following example.
              </p>
              <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> a <span class="sh_symbol">=</span> document<span class="sh_symbol">.</span>timeline<span class="sh_symbol">.</span>currentTime<span class="sh_symbol">;</span>
<span class="sh_comment">// ... many lines of code ...</span>
<span class="sh_keyword">var</span> b <span class="sh_symbol">=</span> document<span class="sh_symbol">.</span>timeline<span class="sh_symbol">.</span>currentTime<span class="sh_symbol">;</span>
<span class="sh_function">alert</span><span class="sh_symbol">(</span>b <span class="sh_symbol">-</span> a<span class="sh_symbol">);</span> <span class="sh_comment">// Displays 0</span></pre>
            </div>
          </li>
          <li>
            <p>
              User agents that support Timing control for script-based
              animations [<cite><a class="bibref" href="#bib-RAF">RAF</a></cite>], prior to <a href="http://www.w3.org/TR/animation-timing/#dfn-sample-all-animations" class="externalDFN">sampling animation frame request
              callbacks</a> for a given <a href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context" class="externalDFN">top-level browsing context</a>,
              must perform a <a href="#dfn-sample" class="internalDFN">sample</a> including executing any eligible
              <a href="#dfn-custom-effect" class="internalDFN">custom effects</a> (see <a href="#sampling-custom-effects" class="sectionRef">section 4.5.1 Sampling custom effects</a>) for all <a href="#dfn-animation-node" class="internalDFN">animation nodes</a>
              <a href="#dfn-associated-with-a-timeline" class="internalDFN">associated with a timeline</a> that is the <a href="#dfn-document-timeline" class="internalDFN">document
              timeline</a> of the
              <a href="http://www.w3.org/TR/html5/browsers.html#active-document" class="externalDFN">active document</a> of the <a href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context" class="externalDFN">top-level browsing context</a> or
              of any of its <a href="http://www.w3.org/TR/html5/browsers.html#list-of-the-descendant-browsing-contexts" class="externalDFN">descendant browsing contexts</a>.
              When performing this <a href="#dfn-sample" class="internalDFN">sample</a>, the <a href="#dfn-time-value" class="internalDFN">time value</a> of
              each <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> must be equal to the <var>time</var>
              passed to animation frame request callbacks for that browsing
              context.
              </p><div class="informative informative-bg">
                <p><em>This section is non-normative.</em></p><p>
                  As a result of this definition, the time passed to
                  a <code>requestAnimationFrame</code> callback acts as
                  an alias for <code>document.timeline.currentTime</code>.
                </p>
                <pre class="example sh_javascript sh_sourceCode">window<span class="sh_symbol">.</span><span class="sh_function">requestAnimationFrame</span><span class="sh_symbol">(</span><span class="sh_keyword">function</span><span class="sh_symbol">(</span>sampleTime<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
  <span class="sh_comment">// Displays '0'</span>
  <span class="sh_function">alert</span><span class="sh_symbol">(</span>sampleTime <span class="sh_symbol">-</span> document<span class="sh_symbol">.</span>timeline<span class="sh_symbol">.</span>currentTime<span class="sh_symbol">);</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">);</span></pre>
              </div>
            <p></p>
          </li>
        </ul>
      </section>
    </section>

    <section id="integration-with-media-fragments">
      <!--OddPage--><h2><span class="secno">6. </span>Integration with Media Fragments</h2>
      <p>
        The Media Fragments specification [<cite><a class="bibref" href="#bib-MEDIA-FRAGMENTS">MEDIA-FRAGMENTS</a></cite>] defines a means
        for addressing a temporal range of a media resource.
        The application of media fragments depends on the MIME type of the
        resource on which they are specified.
        For resources with the <a class="externalDFN" href="http://www.w3.org/TR/SVG/intro.html#MIMEType">SVG MIME type</a>
        [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>], the application of temporal parameters is defined in the <a href="http://dev.w3.org/fxtf/web-animations/animation-elements.html">
        Animation elements</a> specification.
      </p>
      <p class="note">
        Note that media fragments are defined to operate on resources based on
        their MIME type.
        As a result, temporal addressing may not be supported in all situations
        where Web Animations content is used.
      </p>
    </section>

    <section id="interaction-with-page-display">
      <!--OddPage--><h2><span class="secno">7. </span>Interaction with page display</h2>
      <p>
        HTML permits user agents to store <a class="externalDFN" href="http://www.w3.org/TR/html51/browsers.html#an-entry-with-persisted-user-state">user-agent
          defined state</a> along with a
        <a class="externalDFN" href="http://www.w3.org/TR/html51/browsers.html#session-history-entry">session
        history entry</a> so that as a user navigates between pages, the
        previous state of the page can be restored including state such as
        scroll position [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
      </p>
      <p>
        User agents that pause and resume <a class="externalDFN" href="http://www.w3.org/TR/html51/embedded-content-0.html#media-element">media
        elements</a> when the referencing document is
        unloaded and traversed,
        are encouraged to apply consistent handling to documents containing Web
        Animations content.
        If provided, this behavior <em class="rfc2119" title="should">should</em> be achieved by adjusting the <a href="#dfn-time-value" class="internalDFN">time
        values</a> of any <a href="#dfn-timeline" class="internalDFN">timelines</a> bound to the <a href="#dfn-global-clock" class="internalDFN">global clock</a>.
      </p>
      <p class="issue">
        Is this at odds with those <a href="#dfn-time-value" class="internalDFN">time values</a> being relative to
        <code>navigationStart</code> and with <code>requestAnimationFrame</code>
        using the same time as <code>document.timeline.currentTime</code>?
      </p>
    </section>

    <section id="implementation-requirements">
      <!--OddPage--><h2><span class="secno">8. </span>Implementation requirements</h2>
      <section id="precision-of-time-values">
        <h3><span class="secno">8.1 </span>Precision of time values</h3>
        <p>
          The internal representation of time values is implementation dependant
          however, it is <em class="rfc2119" title="recommended">recommended</em> that user agents be able to represent input
          time values with microsecond precision so that 0.000001 is
          distinguishable from 0.0.
        </p>
      </section>
      <section id="conformance-criteria">
        <h3><span class="secno">8.2 </span>Conformance criteria</h3>
        <p>
          This specification defines an abstract model for animation and, as
          such, for user agents that do not support scripting, there are no
          conformance criteria since there is no testable surface area.
        </p>
        <p>
          User agents that do not support scripting, however, may implement
          additional technologies defined in terms of this specification in
          which case the definitions provided in this specification will form
          part of the conformance criteria of the additional technology.
        </p>
        <p>
          A <dfn id="dfn-conforming-scripted-web-animations-user-agent">conforming scripted Web Animations user agent</dfn> is a user
          agent that implements the <abbr title="Application Programming Interface">API</abbr> defined in <a href="#programming-interface" class="sectionRef">section 5. Programming interface</a> including
          dispatching events as defined in <a href="#player-events" class="sectionRef">section 3.5.4 Player events</a>.
        </p>
      </section>
    </section>

    <section class="appendix" id="webidl-ref">
      <!--OddPage--><h2><span class="secno">A. </span>Interface summary</h2>
    <pre class="idl"><span class="idlInterface" id="idl-def-AnimationTimeline-s">interface <span class="idlInterfaceID">AnimationTimeline</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a>?</span> <span class="idlAttrName"><a href="#widl-AnimationTimeline-currentTime">currentTime</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a></span>           <span class="idlMethName"><a href="#widl-AnimationTimeline-play-AnimationPlayer-AnimationNode-source">play</a></span> (<span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span> <span class="idlParamName">source</span> = <span class="idlParamValue">null</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-AnimationTimeline-getAnimationPlayers-sequence-AnimationPlayer">getAnimationPlayers</a></span> ();</span>
};</span>

<span class="idlInterface" id="idl-def-AnimationPlayer-s">interface <span class="idlInterfaceID">AnimationPlayer</span> : <span class="idlSuperclass"><a>EventTarget</a></span> {
<span class="idlAttribute">             attribute <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span>    <span class="idlAttrName"><a href="#widl-AnimationPlayer-source">source</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a></span> <span class="idlAttrName"><a href="#widl-AnimationPlayer-timeline">timeline</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>            <span class="idlAttrName"><a href="#widl-AnimationPlayer-startTime">startTime</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>            <span class="idlAttrName"><a href="#widl-AnimationPlayer-currentTime">currentTime</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>double</a></span>            <span class="idlAttrName"><a href="#widl-AnimationPlayer-playbackRate">playbackRate</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>boolean</a></span>           <span class="idlAttrName"><a href="#widl-AnimationPlayer-paused">paused</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>boolean</a></span>           <span class="idlAttrName"><a href="#widl-AnimationPlayer-finished">finished</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationPlayer-cancel-void">cancel</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationPlayer-finish-void">finish</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationPlayer-play-void">play</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationPlayer-pause-void">pause</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationPlayer-reverse-void">reverse</a></span> ();</span>
<span class="idlSectionComment">
    // Event callbacks</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>EventHandler</a></span>      <span class="idlAttrName"><a href="#widl-AnimationPlayer-onfinish">onfinish</a></span>;</span>
};</span>

<span class="idlInterface" id="idl-def-AnimationNode-s">interface <span class="idlInterfaceID">AnimationNode</span> {
<span class="idlSectionComment">    // Playback state</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a>?</span>             <span class="idlAttrName"><a href="#widl-AnimationNode-localTime">localTime</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a>?</span>      <span class="idlAttrName"><a href="#widl-AnimationNode-currentIteration">currentIteration</a></span>;</span>
<span class="idlSectionComment">
    // Specified timing</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a></span>     <span class="idlAttrName"><a href="#widl-AnimationNode-timing">timing</a></span>;</span>
<span class="idlSectionComment">
    // Calculated timing</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>double</a></span>              <span class="idlAttrName"><a href="#widl-AnimationNode-startTime">startTime</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-AnimationNode-duration">duration</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-AnimationNode-activeDuration">activeDuration</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unrestricted double</a></span> <span class="idlAttrName"><a href="#widl-AnimationNode-endTime">endTime</a></span>;</span>
<span class="idlSectionComment">
    // Timing hierarchy</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a>?</span>     <span class="idlAttrName"><a href="#widl-AnimationNode-parent">parent</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span>      <span class="idlAttrName"><a href="#widl-AnimationNode-previousSibling">previousSibling</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span>      <span class="idlAttrName"><a href="#widl-AnimationNode-nextSibling">nextSibling</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationNode-before-void-AnimationNode...-nodes">before</a></span> (<span class="idlParam"><span class="idlParamType"><a>AnimationNode...</a></span> <span class="idlParamName">nodes</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationNode-after-void-AnimationNode...-nodes">after</a></span> (<span class="idlParam"><span class="idlParamType"><a>AnimationNode...</a></span> <span class="idlParamName">nodes</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationNode-replace-void-AnimationNode...-nodes">replace</a></span> (<span class="idlParam"><span class="idlParamType"><a>AnimationNode...</a></span> <span class="idlParamName">nodes</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AnimationNode-remove-void">remove</a></span> ();</span>
<span class="idlSectionComment">
    // Associated player</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>?</span>    <span class="idlAttrName"><a href="#widl-AnimationNode-player">player</a></span>;</span>
};</span>

<span class="idlInterface" id="idl-def-AnimationTiming-s">interface <span class="idlInterfaceID">AnimationTiming</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-AnimationTiming-delay">delay</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-AnimationTiming-endDelay">endDelay</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span>                           <span class="idlAttrName"><a href="#widl-AnimationTiming-fill">fill</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-AnimationTiming-iterationStart">iterationStart</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>unrestricted double</a></span>                <span class="idlAttrName"><a href="#widl-AnimationTiming-iterations">iterations</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlAttrName"><a href="#widl-AnimationTiming-duration">duration</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>                             <span class="idlAttrName"><a href="#widl-AnimationTiming-playbackRate">playbackRate</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span>                  <span class="idlAttrName"><a href="#widl-AnimationTiming-direction">direction</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span>                          <span class="idlAttrName"><a href="#widl-AnimationTiming-easing">easing</a></span>;</span>
};</span>

<span class="idlDictionary" id="idl-def-AnimationTimingInput-s">dictionary <span class="idlDictionaryID">AnimationTimingInput</span> {
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-AnimationTimingInput-delay">delay</a></span> = <span class="idlMemberValue">0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-AnimationTimingInput-endDelay">endDelay</a></span> = <span class="idlMemberValue">0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a></span>                           <span class="idlMemberName"><a href="#widl-AnimationTimingInput-fill">fill</a></span> = <span class="idlMemberValue">"auto"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-AnimationTimingInput-iterationStart">iterationStart</a></span> = <span class="idlMemberValue">0.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>unrestricted double</a></span>                <span class="idlMemberName"><a href="#widl-AnimationTimingInput-iterations">iterations</a></span> = <span class="idlMemberValue">1.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType">(<a>unrestricted double</a> or <a>DOMString</a>)</span> <span class="idlMemberName"><a href="#widl-AnimationTimingInput-duration">duration</a></span> = <span class="idlMemberValue">"auto"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                             <span class="idlMemberName"><a href="#widl-AnimationTimingInput-playbackRate">playbackRate</a></span> = <span class="idlMemberValue">1.0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-PlaybackDirection" class="idlType"><code>PlaybackDirection</code></a></span>                  <span class="idlMemberName"><a href="#widl-AnimationTimingInput-direction">direction</a></span> = <span class="idlMemberValue">"normal"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>                          <span class="idlMemberName"><a href="#widl-AnimationTimingInput-easing">easing</a></span> = <span class="idlMemberValue">"linear"</span>;</span>
};</span>

<span class="idlEnum" id="idl-def-FillMode-s">enum <span class="idlEnumName">FillMode</span> {<span class="idlEnumValues"> "<a href="#widl-FillMode-none">none</a>", "<a href="#widl-FillMode-forwards">forwards</a>", "<a href="#widl-FillMode-backwards">backwards</a>", "<a href="#widl-FillMode-both">both</a>", "<a href="#widl-FillMode-auto">auto</a>" </span>};</span>

<span class="idlEnum" id="idl-def-PlaybackDirection-s">enum <span class="idlEnumName">PlaybackDirection</span> {<span class="idlEnumValues"> "<a href="#widl-PlaybackDirection-normal">normal</a>", "<a href="#widl-PlaybackDirection-reverse">reverse</a>", "<a href="#widl-PlaybackDirection-alternate">alternate</a>", "<a href="#widl-PlaybackDirection-alternate-reverse">alternate-reverse</a>" </span>};</span>

<span class="idlInterface" id="idl-def-AnimationGroup-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-AnimationGroup--sequence-AnimationNode--children--unrestricted-double-or-AnimationTimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">sequence&lt;<a></a><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>&gt;?</span> <span class="idlParamName">children</span></span>, 
              <span class="idlParam">optional <span class="idlParamType">(<a>unrestricted double</a> or <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>)</span> <span class="idlParamName">timing</span></span>)</span>]
interface <span class="idlInterfaceID">AnimationGroup</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationNodeList" class="idlType"><code>AnimationNodeList</code></a></span> <span class="idlAttrName"><a href="#widl-AnimationGroup-children">children</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span>    <span class="idlAttrName"><a href="#widl-AnimationGroup-firstChild">firstChild</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span>    <span class="idlAttrName"><a href="#widl-AnimationGroup-lastChild">lastChild</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>           <span class="idlMethName"><a href="#widl-AnimationGroup-prepend-void-AnimationNode...-nodes">prepend</a></span> (<span class="idlParam"><span class="idlParamType"><a>AnimationNode...</a></span> <span class="idlParamName">nodes</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>           <span class="idlMethName"><a href="#widl-AnimationGroup-append-void-AnimationNode...-nodes">append</a></span> (<span class="idlParam"><span class="idlParamType"><a>AnimationNode...</a></span> <span class="idlParamName">nodes</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a></span> <span class="idlMethName"><a href="#widl-AnimationGroup-clone-AnimationGroup">clone</a></span> ();</span>
};</span>

<span class="idlInterface" id="idl-def-AnimationNodeList-s">interface <span class="idlInterfaceID">AnimationNodeList</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a></span> <span class="idlAttrName"><a href="#widl-AnimationNodeList-length">length</a></span>;</span>
<span class="idlMethod">    getter <span class="idlMethType"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>?</span> <span class="idlMethName"><a href="#widl-AnimationNodeList-item-AnimationNode-unsigned-long-index">item</a></span> (<span class="idlParam"><span class="idlParamType"><a>unsigned long</a></span> <span class="idlParamName">index</span></span>);</span>
};</span>

<span class="idlInterface" id="idl-def-AnimationSequence-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-AnimationSequence--sequence-AnimationNode--children--unrestricted-double-or-AnimationTimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">sequence&lt;<a></a><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>&gt;?</span> <span class="idlParamName">children</span></span>, 
              <span class="idlParam">optional <span class="idlParamType">(<a>unrestricted double</a> or <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>)</span> <span class="idlParamName">timing</span></span>)</span>]
interface <span class="idlInterfaceID">AnimationSequence</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a></span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationSequence" class="idlType"><code>AnimationSequence</code></a></span> <span class="idlMethName"><a href="#widl-AnimationSequence-clone-AnimationSequence">clone</a></span> ();</span>
};</span>

<span class="idlInterface" id="idl-def-Animation-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-Animation--Animatable-target-object-effect--unrestricted-double-or-AnimationTimingInput--timing">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>?</span> <span class="idlParamName">target</span></span>, <span class="idlParam"><span class="idlParamType"><a>object</a>?</span> <span class="idlParamName">effect</span></span>, 
              <span class="idlParam">optional <span class="idlParamType"><a>(unrestricted double or AnimationTimingInput)
               </a></span> <span class="idlParamName">timing</span></span>)</span>]
interface <span class="idlInterfaceID">Animation</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType">(<a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a> or <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a>)?</span> <span class="idlAttrName"><a href="#widl-Animation-effect">effect</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>?</span>                          <span class="idlAttrName"><a href="#widl-Animation-target">target</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></span> <span class="idlMethName"><a href="#widl-Animation-clone-Animation">clone</a></span> ();</span>
};</span>

<span class="idlInterface" id="idl-def-Animatable-s">[<span class="extAttr">NoInterfaceObject</span>]
interface <span class="idlInterfaceID">Animatable</span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a></span>           <span class="idlMethName"><a href="#widl-Animatable-animate-AnimationPlayer-object-effect--double-or-AnimationTimingInput--timing">animate</a></span> (<span class="idlParam"><span class="idlParamType"><a>object</a>?</span> <span class="idlParamName">effect</span></span>, 
                                       <span class="idlParam">optional <span class="idlParamType">(<a>double</a> or <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>)</span> <span class="idlParamName">timing</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a>&gt;</span>       <span class="idlMethName"><a href="#widl-Animatable-getCurrentAnimations-sequence-Animation">getCurrentAnimations</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-Animatable-getAnimationPlayers-sequence-AnimationPlayer">getAnimationPlayers</a></span> ();</span>
};</span>

<span class="idlInterface" id="idl-def-AnimationEffect-s">interface <span class="idlInterfaceID">AnimationEffect</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a></span> <span class="idlAttrName"><a href="#widl-AnimationEffect-iterationComposite">iterationComposite</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span>          <span class="idlAttrName"><a href="#widl-AnimationEffect-composite">composite</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> <span class="idlMethName"><a href="#widl-AnimationEffect-clone-AnimationEffect">clone</a></span> ();</span>
};</span>

<span class="idlEnum" id="idl-def-IterationCompositeOperation-s">enum <span class="idlEnumName">IterationCompositeOperation</span> {<span class="idlEnumValues"> "<a href="#widl-IterationCompositeOperation-replace">replace</a>", "<a href="#widl-IterationCompositeOperation-accumulate">accumulate</a>" </span>};</span>

<span class="idlEnum" id="idl-def-CompositeOperation-s">enum <span class="idlEnumName">CompositeOperation</span> {<span class="idlEnumValues"> "<a href="#widl-CompositeOperation-replace">replace</a>", "<a href="#widl-CompositeOperation-add">add</a>", "<a href="#widl-CompositeOperation-accumulate">accumulate</a>" </span>};</span>

<span class="idlInterface" id="idl-def-KeyframeEffect-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-KeyframeEffect--object-frames-KeyframeEffectOptions-options">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a>object</a></span> <span class="idlParamName">frames</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-KeyframeEffectOptions" class="idlType"><code>KeyframeEffectOptions</code></a></span> <span class="idlParamName">options</span></span>)</span>]
interface <span class="idlInterfaceID">KeyframeEffect</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span> <span class="idlAttrName"><a href="#widl-KeyframeEffect-spacing">spacing</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType">sequence&lt;<a></a><a href="#idl-def-ComputedKeyframe" class="idlType"><code>ComputedKeyframe</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-KeyframeEffect-getFrames-sequence-ComputedKeyframe">getFrames</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>                       <span class="idlMethName"><a href="#widl-KeyframeEffect-setFrames-void-object-frames">setFrames</a></span> (<span class="idlParam"><span class="idlParamType"><a>object</a></span> <span class="idlParamName">frames</span></span>);</span>
};</span>

<span class="idlDictionary" id="idl-def-KeyframeEffectOptions-s">dictionary <span class="idlDictionaryID">KeyframeEffectOptions</span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a></span> <span class="idlMemberName"><a href="#widl-KeyframeEffectOptions-iterationComposite">iterationComposite</a></span> = <span class="idlMemberValue">"replace"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span>          <span class="idlMemberName"><a href="#widl-KeyframeEffectOptions-composite">composite</a></span> = <span class="idlMemberValue">"replace"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>                   <span class="idlMemberName"><a href="#widl-KeyframeEffectOptions-spacing">spacing</a></span> = <span class="idlMemberValue">"distribute"</span>;</span>
};</span>

<span class="idlDictionary" id="idl-def-Keyframe-s">dictionary <span class="idlDictionaryID">Keyframe</span> {
<span class="idlSectionComment">    // ... property-value pairs ...</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span>             <span class="idlMemberName"><a href="#widl-Keyframe-offset">offset</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>           <span class="idlMemberName"><a href="#widl-Keyframe-easing">easing</a></span> = <span class="idlMemberValue">"linear"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a>?</span> <span class="idlMemberName"><a href="#widl-Keyframe-composite">composite</a></span> = <span class="idlMemberValue">null</span>;</span>
};</span>

<span class="idlDictionary" id="idl-def-ComputedKeyframe-s">dictionary <span class="idlDictionaryID">ComputedKeyframe</span> : <span class="idlSuperclass"><a href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a></span> {
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span> <span class="idlMemberName"><a href="#widl-ComputedKeyframe-computedOffset">computedOffset</a></span>;</span>
};</span>

<span class="idlInterface" id="idl-def-MotionPathEffect-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-MotionPathEffect---DOMString-or-SVGPathSegList--path-MotionPathEffectOptions-options">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">(<a>DOMString</a> or <a>SVGPathSegList</a>)</span> <span class="idlParamName">path</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-MotionPathEffectOptions" class="idlType"><code>MotionPathEffectOptions</code></a></span> <span class="idlParamName">options</span></span>)</span>]
interface <span class="idlInterfaceID">MotionPathEffect</span> : <span class="idlSuperclass"><a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>SVGPathSegList</a></span>   <span class="idlAttrName"><a href="#widl-MotionPathEffect-segments">segments</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a></span> <span class="idlAttrName"><a href="#widl-MotionPathEffect-autoRotate">autoRotate</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a></span>           <span class="idlAttrName"><a href="#widl-MotionPathEffect-angle">angle</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span>        <span class="idlAttrName"><a href="#widl-MotionPathEffect-spacing">spacing</a></span>;</span>
};</span>

<span class="idlDictionary" id="idl-def-MotionPathEffectOptions-s">dictionary <span class="idlDictionaryID">MotionPathEffectOptions</span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-AutoRotationMode" class="idlType"><code>AutoRotationMode</code></a></span>            <span class="idlMemberName"><a href="#widl-MotionPathEffectOptions-autoRotate">autoRotate</a></span> = <span class="idlMemberValue">"none"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a></span>                      <span class="idlMemberName"><a href="#widl-MotionPathEffectOptions-angle">angle</a></span> = <span class="idlMemberValue">0</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-IterationCompositeOperation" class="idlType"><code>IterationCompositeOperation</code></a></span> <span class="idlMemberName"><a href="#widl-MotionPathEffectOptions-iterationComposite">iterationComposite</a></span> = <span class="idlMemberValue">"replace"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-CompositeOperation" class="idlType"><code>CompositeOperation</code></a></span>          <span class="idlMemberName"><a href="#widl-MotionPathEffectOptions-composite">composite</a></span> = <span class="idlMemberValue">"replace"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>DOMString</a></span>                   <span class="idlMemberName"><a href="#widl-MotionPathEffectOptions-spacing">spacing</a></span> = <span class="idlMemberValue">"paced"</span>;</span>
};</span>

<span class="idlEnum" id="idl-def-AutoRotationMode-s">enum <span class="idlEnumName">AutoRotationMode</span> {<span class="idlEnumValues"> "<a href="#widl-AutoRotationMode-auto-rotate">auto-rotate</a>", "<a href="#widl-AutoRotationMode-none">none</a>" </span>};</span>

<span class="idlCallback" id="idl-def-EffectCallback-s">callback <span class="idlCallbackID">EffectCallback</span> = <span class="idlCallbackType"><a>void</a></span> (<span class="idlParam"><span class="idlParamType"><a>double</a>?</span> <span class="idlParamName">timeFraction</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a></span> <span class="idlParamName">currentTarget</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-Animation" class="idlType"><code>Animation</code></a></span> <span class="idlParamName">animation</span></span>)</span>;

<span class="idlInterface" id="idl-def-AnimationPlayerEvent-s">[<span class="idlCtor"><span class="idlCtorName"><a href="#widl-ctor-AnimationPlayerEvent--DOMString-type-AnimationPlayerEventInit-eventInit">Constructor</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">type</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-AnimationPlayerEventInit" class="idlType"><code>AnimationPlayerEventInit</code></a></span> <span class="idlParamName">eventInit</span></span>)</span>]
interface <span class="idlInterfaceID">AnimationPlayerEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a>?</span> <span class="idlAttrName"><a href="#widl-AnimationPlayerEvent-currentTime">currentTime</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>double</a>?</span> <span class="idlAttrName"><a href="#widl-AnimationPlayerEvent-timelineTime">timelineTime</a></span>;</span>
};</span>

<span class="idlDictionary" id="idl-def-AnimationPlayerEventInit-s">dictionary <span class="idlDictionaryID">AnimationPlayerEventInit</span> {
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span> <span class="idlMemberName"><a href="#widl-AnimationPlayerEventInit-currentTime">currentTime</a></span> = <span class="idlMemberValue">null</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>double</a>?</span> <span class="idlMemberName"><a href="#widl-AnimationPlayerEventInit-timelineTime">timelineTime</a></span> = <span class="idlMemberValue">null</span>;</span>
};</span>

<span class="idlInterface" id="idl-def-Document-s">partial interface <span class="idlInterfaceID">Document</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a></span> <span class="idlAttrName"><a href="#widl-Document-timeline">timeline</a></span>;</span>
};</span>

<span class="idlImplements"><a>Element</a> implements <a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>;
<span class="idlImplements"><a>PseudoElement</a> implements <a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>;</span></span></pre></section>

    <section class="appendix" id="acknowledgements">
      <!--OddPage--><h2><span class="secno">B. </span>Acknowledgements</h2>
      <p>
        Thank you to Michiel &#x201c;Pomax&#x201d; Kamermans for help with the
        equations for a proposed smooth timing function although this feature
        has been deferred to a subsequent specification.
      </p>
      <p>
        Our deep gratitude goes out to <a href="http://www.southernstarentertainment.com.au/">Southern Star
        Animation</a> for their kind generosity and patience in introducing the
        editors to the processes and techniques used producing broadcast
        animations.
      </p>
    </section>

    <section id="changes-since-last-publication">
      <!--OddPage--><h2><span class="secno">C. </span>Changes since last publication</h2>
      <p>
        The following changes have been made since the <a href="http://www.w3.org/TR/2013/WD-web-animations-20130625/">25 June
          2013 Working Draft</a>.
      </p>
      <ul>
        <li>Changed the basic unit of time from seconds to milliseconds.
        </li><li>Altered the <a href="#dfn-zero-time" class="internalDFN">zero time</a> for the <a href="#dfn-document-timeline" class="internalDFN">document timeline</a> to
            correspond to the <a href="http://www.w3.org/TR/navigation-timing/#dom-performancetiming-navigationstart"><code>navigationStart</code></a>
            moment defined by [<cite><a class="bibref" href="#bib-NAVIGATION-TIMING">NAVIGATION-TIMING</a></cite>].
        </li><li>Altered the definition of <a href="#dfn-effective-current-time" class="internalDFN">effective current time</a>.
        </li><li>Removed the &#x2018;time drift&#x2019; property of <a href="#dfn-player" class="internalDFN">players</a> and
            redefined play control algorithms to simply adjust the <a href="#dfn-player-start-time" class="internalDFN">player
            start time</a>.
        </li><li>Introduced <a title="limited" href="#dfn-limited" class="internalDFN">limiting</a> behavior to players so
            that the <a href="#dfn-current-time" class="internalDFN">current time</a> behaves more like a DVD or cassette
            player.
        </li><li>Removed timing events and added <a href="#dfn-player-event" class="internalDFN">player events</a> instead.
        </li><li>Renamed timed items to <a href="#dfn-animation-node" class="internalDFN">animation nodes</a>.
        </li><li>Introduced an <a href="#dfn-end-delay" class="internalDFN">end delay</a> property to animation nodes.
        </li><li>Reworked the description of <a href="#animation-node-phases-and-states">animation node states</a> to
            include phases as well.
            Renamed the &#x2018;active&#x2019; state to the <a href="#dfn-in-play" class="internalDFN">in play</a> state.
        </li><li>Changed the behavior of <a href="#dfn-fill-mode" class="internalDFN">fill modes</a> so that children
            that are clipped part-way through their <a href="#dfn-active-interval" class="internalDFN">active interval</a> by
            a <a href="#dfn-parent-animation-group" class="internalDFN">parent animation group</a> only fill if they have the
            corresponding <a href="#dfn-fill-mode" class="internalDFN">fill mode</a> set.
        </li><li>Fixed a bug in the calculation of the <a href="#dfn-current-iteration" class="internalDFN">current iteration</a> for
            zero-length iteration durations (<a href="#calculating-the-current-iteration" class="sectionRef">section 3.10.4 Calculating the current iteration</a>).
        </li><li>Added extra wording so that an <a href="#dfn-animation-node" class="internalDFN">animation node</a> with a
            <a href="#dfn-step-timing-function" class="internalDFN">step timing function</a> whose transition point coincides with
            either end of the <a href="#dfn-active-interval" class="internalDFN">active interval</a> produces the expected value
            when <a title="fill mode" href="#dfn-fill-mode" class="internalDFN">filling</a>.
        </li><li>Fixed a bug in the calculation of the <a href="#dfn-transformed-time" class="internalDFN">transformed time</a> so
            that children of groups with infinite duration will play.
        </li><li>Fixed a bug in the calculation of the <a href="#dfn-time-fraction" class="internalDFN">time fraction</a> for
            zero-length iteration durations (<a href="#calculating-the-time-fraction" class="sectionRef">section 3.14.1 Calculating the time fraction</a>).
        </li><li>Clarified behavior in a number of cases where a value of infinity
            may be multiplied with zero.
        </li><li>Renamed timing groups, <a href="#dfn-animation-group" class="internalDFN">animation groups</a>. Parallel timing
            groups are now simply <a href="#dfn-animation-group" class="internalDFN">animation groups</a>, and sequence timing
            groups are now <a href="#dfn-animation-sequence" class="internalDFN">animation sequences</a>.
        </li><li>Rewrote and re-organized most of the animation model section (see <a href="#animation-model" class="sectionRef">section 4. Animation model</a>) to provide greater
            internal consistency.
            CSS properties are now animatable by default and procedures for
            <a title="animation interpolation" href="#dfn-animation-interpolation" class="internalDFN">interpolation</a>,
            <a title="animation addition" href="#dfn-animation-addition" class="internalDFN">addition</a>, and <a href="#dfn-distance-computation" class="internalDFN">distance
            computation</a> are now defined for all cases
            (see <a href="#procedures-for-animating-properties" class="sectionRef">section 4.1.2 Procedures for animating properties</a>).
        </li><li>Renamed the <em>target element</em> of an <a href="#dfn-animation" class="internalDFN">animation</a> to the
            <a href="#dfn-animation-target" class="internalDFN">animation target</a>.
        </li><li>Made the prioritization of animtions no longer dependent on the
            <a href="#dfn-player-start-time" class="internalDFN">player start time</a> (see <a href="#the-animation-stack" class="sectionRef">section 4.2.1 The animation stack</a>).
        </li><li>Made the <em>custom animation priority</em> specific to
            a <a href="#dfn-player" class="internalDFN">player</a> and renamed it to the <a href="#dfn-custom-player-priority" class="internalDFN">custom player priority</a>.
        </li><li>Made the <a href="#dfn-composite-operation" class="internalDFN">composite operation</a> a property of all
            <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>.
        </li><li>Added the <a title="composite operation accumulate" href="#dfn-composite-operation-accumulate" class="internalDFN">accumulate</a>
            <a href="#dfn-composite-operation" class="internalDFN">composite operation</a>.
        </li><li>Replaced the accumulation operation with an 
            <a href="#dfn-iteration-composite-operation" class="internalDFN">iteration composite operation</a> on <a href="#dfn-animation-effect" class="internalDFN">animation effects</a>.
        </li><li>Added per-<a href="#dfn-keyframe" class="internalDFN">keyframe</a> <a href="#dfn-timing-function" class="internalDFN">timing functions</a>.
        </li><li>Replaced paced timing functions with <a href="#spacing-keyframes">spacing</a> behavior that can either
            evenly distribute values or space them to maintain an even rate of
            change.
        </li><li>Added <a title="motion path spacing mode" href="#dfn-motion-path-spacing-mode" class="internalDFN">spacing modes</a>,
            <a href="#dfn-spacing-point" class="internalDFN">spacing points</a>, and <a href="#dfn-point-offset" class="internalDFN">point offsets</a> to <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path
            animation effects</a> in order to support all the features of SVG's
            <code>animateMotion</code> element.
        </li><li>Clarified the conditions for calling <a href="#dfn-custom-effect" class="internalDFN">custom effects</a>.
        </li><li>Removed custom effect priorities.
        </li><li>Renamed the <code>Timeline</code> interface to
            <a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a>.
        </li><li>Removed both versions of <code>toTimelineTime</code> from the
            <a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a> interface.
        </li><li>Renamed <code>getCurrentPlayers</code> on the
            <a href="#idl-def-AnimationTimeline" class="idlType"><code>AnimationTimeline</code></a> interface to
            <code>getAnimationPlayers</code>.
        </li><li>Renamed <code>Player</code> interface to <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>.
        </li><li>Added <code>onfinish</code> to the <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> interface
            as the event handler for the new <a href="#dfn-finish-player-event" class="internalDFN">finish player event</a> and made
            the <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> interface inherit from
            <code>EventTarget</code>.
        </li><li>Added the following members to the <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> interface:
            <ul>
              <li><code>finished</code>
              </li><li><code>cancel()</code>
              </li><li><code>finish()</code>
              </li><li><code>play()</code>
              </li><li><code>pause()</code>
              </li><li><code>reverse()</code>
            </li></ul>
        </li><li>Made the <code>paused</code> member of the <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a>
            interface readonly.
        </li><li>Renamed the <code>TimedItem</code> interface to
            <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>.
        </li><li>Removed the event handlers from <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a> since timing
            events have been replaced with <a href="#dfn-player-event" class="internalDFN">player events</a>.
            Similarly, made the <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a> interface no longer
            inherit from <code>EventTarget</code>.
        </li><li>Marked <code><a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a>.player</code> as at risk.
        </li><li>Renamed the <code>specified</code> attribute on
            <a href="#idl-def-AnimationNode" class="idlType"><code>AnimationNode</code></a> to <code>timing</code>.
        </li><li>Renamed the <code>Timing</code> interface to <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a>
            and likewise the <code>TimingInput</code> dictionary to
            <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>.
        </li><li>Renamed the following members of the <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a>
            interface and <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> dictionary:
            <ul>
              <li><code>iterationDuration</code> &#x2192; <code>duration</code>
              </li><li><code>startDelay</code> &#x2192; <code>delay</code>
              </li><li><code>fillMode</code> &#x2192; <code>fill</code>
              </li><li><code>iterationCount</code> &#x2192; <code>iterations</code>
              </li><li><code>timingFunction</code> &#x2192; <code>easing</code>
            </li></ul>
        </li><li>Removed the <code>activeDuration</code> member of the
            <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a> dictionary and <a href="#idl-def-AnimationTiming" class="idlType"><code>AnimationTiming</code></a>
            interface and introduced <code>endDelay</code> to both.
        </li><li>Introduced an <span class="prop-value">auto</span> value for
            <a href="#idl-def-FillMode" class="idlType"><code>FillMode</code></a> and made it the default value for <code>fill</code>
            on <a href="#idl-def-AnimationTimingInput" class="idlType"><code>AnimationTimingInput</code></a>.
        </li><li>Added <a href="#dfn-timing-function" class="internalDFN">timing function</a> syntax directly to this specification
            rather than referring to [<cite><a class="bibref" href="#bib-CSS3-TRANSITIONS">CSS3-TRANSITIONS</a></cite>].
        </li><li>Removed the abstract <code>TimingGroup</code> interface and
            renamed <code>ParGroup</code> to <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a>.
        </li><li>Renamed <code>SeqGroup</code> to <a href="#idl-def-AnimationSequence" class="idlType"><code>AnimationSequence</code></a> and made
            it inherit from <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a>.
        </li><li>Changed the type of the <var>effect</var> argument to the <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> constructor and
            the <code><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>.animate</code> method to
            <code>object?</code> and defined its <a href="#processing-the-effect-parameter">processing</a>.
        </li><li>Removed <code>null</code> as a possible value for the
            <em>timing</em> parameter of the <a href="#idl-def-AnimationGroup" class="idlType"><code>AnimationGroup</code></a>,
            <a href="#idl-def-AnimationSequence" class="idlType"><code>AnimationSequence</code></a>
            and <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> constructors and
            the <code><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>.animate</code> method.
        </li><li>Made the <code>target</code> member of the <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> interface no longer
            readonly.
        </li><li>Removed the <code>AnimationTarget</code> typedef and introduced the
            <a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a> interface in its place.
        </li><li>Made <code><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>.animate</code> return an
            <a href="#idl-def-AnimationPlayer" class="idlType"><code>AnimationPlayer</code></a> instead of an <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a>.
        </li><li>Marked <code><a href="#idl-def-Animatable" class="idlType"><code>Animatable</code></a>.getCurrentAnimations</code> as at
            risk.
        </li><li>Moved the <code>composite</code> member of <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a>
            and <a href="#idl-def-MotionPathEffect" class="idlType"><code>MotionPathEffect</code></a> to the base class,
            <a href="#idl-def-AnimationEffect" class="idlType"><code>AnimationEffect</code></a>.
        </li><li>Renamed <code>KeyframeAnimationEffect</code> to
            <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a>.
        </li><li>Changed the constructor for <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a> to take
            a <a href="#idl-def-KeyframeEffectOptions" class="idlType"><code>KeyframeEffectOptions</code></a> dictionary object.
        </li><li>Added a <code>spacing</code> member to both
            <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a> and <a href="#idl-def-KeyframeEffectOptions" class="idlType"><code>KeyframeEffectOptions</code></a> to specify <a href="#spacing-keyframes">spacing</a> behavior.
        </li><li>Made <code>getFrames</code> on <a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a> return the
            computed <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> as <code>computedOffset</code> and
            apply the normalization of keyframes defined in <a href="#normalizing-a-sequence-of-keyframes" class="sectionRef">section 5.14.6 Normalizing a sequence of keyframes</a>.
        </li><li>Introduced the <a href="#idl-def-ComputedKeyframe" class="idlType"><code>ComputedKeyframe</code></a> dictionary for representing
            the return values from <code><a href="#idl-def-KeyframeEffect" class="idlType"><code>KeyframeEffect</code></a>.getFrames</code>.
        </li><li>Removed the <code>OneOrMoreKeyframes</code> typedef since it is no
            longer a valid WebIDL union. Replaced useage of
            <code>OneOrMoreKeyframes</code> with <code>object</code> and defined
            its <a href="#processing-a-sequence-of-keyframe-objects-or-a-single-item">processing</a>.
        </li><li>Made the normalization of keyframes no longer fill in the
            <code>offset</code> of a keyframe.
            This is now incorporated in <a href="#spacing-keyframes" class="sectionRef">section 4.3.1 Spacing keyframes</a> which is now a core part of the model.
        </li><li>Defined the procedure used for iterating of the properties of
            a passed in keyframe object as using
            <code>[&#x200c;[Enumerate]]</code>.
        </li><li>Made the normalization of keyframes sort keyframes if all
            <a href="#dfn-keyframe-offset" class="internalDFN">keyframe offset</a> are specified or otherwise throw an exception
            if the frames are not <a href="#dfn-loosely-sorted-by-offset" class="internalDFN">loosely sorted by offset</a> and not all
            offsets are specified since the desired result in this case is
            ambiguous.
        </li><li>Added the <code>easing</code> member to the <a title="Keyframe interface" href="#idl-def-Keyframe" class="idlType"><code>Keyframe</code></a> dictionary.
        </li><li>Renamed path animation effects to <a href="#dfn-motion-path-animation-effect" class="internalDFN">motion path animation
            effects</a> and likewise <code>PathAnimationEffect</code> to
            <a href="#idl-def-MotionPathEffect" class="idlType"><code>MotionPathEffect</code></a>.
        </li><li>Changed the constructor for <a href="#idl-def-MotionPathEffect" class="idlType"><code>MotionPathEffect</code></a> to take
            a <a href="#idl-def-MotionPathEffectOptions" class="idlType"><code>MotionPathEffectOptions</code></a> dictionary object.
        </li><li>Added the <code>spacing</code> member to the
            <a href="#idl-def-MotionPathEffect" class="idlType"><code>MotionPathEffect</code></a> interface.
        </li><li>Replaced the <code>CustomEffect</code> callback interface with the
            <a href="#idl-def-EffectCallback" class="idlType"><code>EffectCallback</code></a> callback function and replaced the
            <code>currentIteration</code> and <code>target</code> parameters
            with the <a title="Animation interface" href="#idl-def-Animation" class="idlType"><code>Animation</code></a> object that is
            being sampled.
        </li><li>Renamed <code>getCurrentPlayers</code> on the <code>Element</code>
            interface to <code>getAnimationPlayers</code>.
        </li><li>Removed the <code>PseudoElementReference</code> interface to use the
            <a href="http://www.w3.org/TR/cssom/#the-pseudoelement-interface"><code>PseudoElement</code></a> interface from CSSOM instead.
        </li><li>Revised <a href="#script-execution-and-live-updates-to-the-model" class="sectionRef">section 5.23 Script execution and live updates to the model</a> so that computed style reflects the current
            state of the model.
        </li><li>Clarified the interaction between <a href="#dfn-sample" class="internalDFN">samples</a> of the timing model
            and <code>requestAnimationFrame</code> callbacks.
      </li></ul>
      <p>
        The <a href="https://dvcs.w3.org/hg/FXTF/log/default/web-animations/index.html">changelog</a>
        provides a more detailed history.
      </p>
    </section>
  

<section id="references" class="appendix"><!--OddPage--><h2><span class="secno">D. </span>References</h2><section id="normative-references"><h3><span class="secno">D.1 </span>Normative references</h3><dl class="bibliography"><dt id="bib-CSS21">[CSS21]</dt><dd>Bert Bos; et al. <a href="http://www.w3.org/TR/CSS21/"><cite>Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification.</cite></a>. W3C Recommendation. URL: <a href="http://www.w3.org/TR/CSS21/">http://www.w3.org/TR/CSS21/</a> 
</dd><dt id="bib-CSS3-VALUES">[CSS3-VALUES]</dt><dd>H&#xe5;kon Wium Lie; Tab Atkins; Elika J. Etemad. <a href="http://www.w3.org/TR/css3-values/"><cite>CSS Values and Units Module Level 3.</cite></a> 4 April 2013. W3C Candidate Recommendation. URL: <a href="http://www.w3.org/TR/css3-values/">http://www.w3.org/TR/css3-values/</a> 
</dd><dt id="bib-CSSOM">[CSSOM]</dt><dd>Anne van Kesteren. <a href="http://www.w3.org/TR/cssom/"><cite>CSSOM View Module.</cite></a> 12 July 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/cssom/">http://www.w3.org/TR/cssom/</a> 
</dd><dt id="bib-DOM4">[DOM4]</dt><dd>Anne van Kesteren; Aryeh Gregor; Lachlan Hunt; Ms2ger. <a href="http://www.w3.org/TR/dom/"><cite>DOM4.</cite></a> 6 December 2012. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/dom/">http://www.w3.org/TR/dom/</a> 
</dd><dt id="bib-ECMA-262">[ECMA-262]</dt><dd><a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm"><cite>ECMAScript Language Specification.</cite></a> June 2011. URL: <a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">http://www.ecma-international.org/publications/standards/Ecma-262.htm</a> 
</dd><dt id="bib-HTML5">[HTML5]</dt><dd>Robin Berjon; et. al. <a href="http://www.w3.org/TR/html5/"><cite>HTML5.</cite></a> 17 December 2012. W3C Candidate Recommendation. (Work in progress.) URL: <a href="http://www.w3.org/TR/html5/">http://www.w3.org/TR/html5/</a> 
</dd><dt id="bib-MEDIA-FRAGMENTS">[MEDIA-FRAGMENTS]</dt><dd>Rapha&#xeb;l Troncy; Erik Mannens; Silvia Pfeiffer and Davy Van Deursen. <a href="http://www.w3.org/TR/media-frags/"><cite>Media Fragments URI 1.0</cite></a>. W3C Working Draft 25 September 2012. URL: <a href="http://www.w3.org/TR/media-frags/">http://www.w3.org/TR/media-frags/</a> 
</dd><dt id="bib-NAVIGATION-TIMING">[NAVIGATION-TIMING]</dt><dd>Zhiheng Wang. <a href="http://www.w3.org/TR/navigation-timing/"><cite>Navigation Timing.</cite></a> 17 December 2012. W3C Recommendation. URL: <a href="http://www.w3.org/TR/navigation-timing/">http://www.w3.org/TR/navigation-timing/</a> 
</dd><dt id="bib-SELECT">[SELECT]</dt><dd>Daniel Glazman; et al. <a href="http://www.w3.org/TR/css3-selectors/"><cite>Selectors Level 3.</cite></a> 29 September 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/css3-selectors/">http://www.w3.org/TR/css3-selectors/</a> 
</dd><dt id="bib-SVG11">[SVG11]</dt><dd>Erik Dahlstr&#xf6;m; et al. <a href="http://www.w3.org/TR/SVG11/"><cite>Scalable Vector Graphics (SVG) 1.1 (Second Edition).</cite></a> 16 August 2011. W3C Recommendation. URL: <a href="http://www.w3.org/TR/SVG11/">http://www.w3.org/TR/SVG11/</a> 
</dd><dt id="bib-SVG2">[SVG2]</dt><dd>Nikos Andronikos et al. <a href="http://www.w3.org/TR/SVG2/"><cite>Scalable Vector Graphics (SVG) 2.</cite></a> 16 August 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/SVG2/">http://www.w3.org/TR/SVG2/</a> 
</dd><dt id="bib-WEBIDL">[WEBIDL]</dt><dd>Cameron McCormack. <a href="http://www.w3.org/TR/2011/WD-WebIDL-20110927/"><cite>Web IDL.</cite></a> 27 September 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/2011/WD-WebIDL-20110927/">http://www.w3.org/TR/2011/WD-WebIDL-20110927/</a> 
</dd></dl></section><section id="informative-references"><h3><span class="secno">D.2 </span>Informative references</h3><dl class="bibliography"><dt id="bib-CSS3-ANIMATIONS">[CSS3-ANIMATIONS]</dt><dd>Dean Jackson; et. al. <a href="http://www.w3.org/TR/css3-animations/"><cite>CSS Animations Module Level 3.</cite></a> 19 February 2013. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/css3-animations/">http://www.w3.org/TR/css3-animations/</a> 
</dd><dt id="bib-CSS3-TRANSFORMS">[CSS3-TRANSFORMS]</dt><dd>Simon Fraser; Dean Jackson; Edward O'Connor; Dirk Schulze; Aryeh Gregor. <a href="http://www.w3.org/TR/css3-transforms/"><cite>CSS Transforms</cite></a> 11 September 2012. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/css3-transforms/">http://www.w3.org/TR/css3-transforms/</a> 
</dd><dt id="bib-CSS3-TRANSITIONS">[CSS3-TRANSITIONS]</dt><dd>Dean Jackson; David Hyatt; Chris Marrin; David Baron. <a href="http://www.w3.org/TR/css3-transitions/"><cite>CSS Transitions Module Level 3.</cite></a> 12 February 2013. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/css3-transitions/">http://www.w3.org/TR/css3-transitions/</a> 
</dd><dt id="bib-CSS4-IMAGES">[CSS4-IMAGES]</dt><dd>Elika J. Etemad; Tab Atkins. <a href="http://dev.w3.org/csswg/css-images"><cite>CSS Image Values and Replaced Content Module Level 4</cite></a> 11 April 2013. W3C Editor's Draft. (Work in progress.) URL: <a href="http://dev.w3.org/csswg/css-images">http://dev.w3.org/csswg/css-images</a> 
</dd><dt id="bib-FUND-COMP-GRAPHICS">[FUND-COMP-GRAPHICS]</dt><dd>Peter Shirley, Michael Ashikhmin, Steve Marschner. <cite>Fundamentals of Computer Graphics.</cite> A K Peters Limited, 2009.
</dd><dt id="bib-HR-TIME">[HR-TIME]</dt><dd>Steven Pemberton. <a href="http://www.w3.org/TR/hr-time/"><cite>High Resolution Time.</cite></a> 17 December 2012. W3C Recommendation. URL: <a href="http://www.w3.org/TR/hr-time/">http://www.w3.org/TR/hr-time/</a> 
</dd><dt id="bib-RAF">[RAF]</dt><dd>J. Robinson, C. McCormack. <a href="http://www.w3.org/TR/animation-timing/"><cite>Timing control for script-based animations.</cite></a> 31 October 2013. W3C Candidate Recommendation. (Work in progress.) URL: <a href="http://www.w3.org/TR/animation-timing/">http://www.w3.org/TR/animation-timing/</a> 
</dd><dt id="bib-SMIL-ANIMATION">[SMIL-ANIMATION]</dt><dd>Patrick Schmitz; Aaron Cohen. <a href="http://www.w3.org/TR/smil-animation/"><cite>SMIL Animation.</cite></a> 4 September 2001. W3C Recommendation. URL: <a href="http://www.w3.org/TR/smil-animation/">http://www.w3.org/TR/smil-animation/</a> 
</dd></dl></section></section></body></html>
