<!DOCTYPE html public '-//W3C//DTD HTML 4.01//EN' 'http://www.w3.org/TR/html4/strict.dtd'>
<html lang="en">
<head profile="http://www.w3.org/2006/03/hcard">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
  <title>CSS Exclusions Module Level 1</title>
  <link rel="stylesheet" type="text/css" href="../shared/style/default.css" />
  <script src='https://test.csswg.org/harness/annotate.js#css-exclusions-1_dev' type='text/javascript' defer></script>


  <style type="text/css">
    .singleImgExample {
    	display: block;
    	margin: auto;
    }
    
    .example-table {
    	table-layout: fixed; 
    	width: 100%; 
    }
    
    .example-table tr td img {
    	width: 90%;
    }
  </style>  
       
        <link rel="stylesheet" type="text/css"
         href="../shared/style/issues.css">
       <link rel="stylesheet" type="text/css"
        href="https://www.w3.org/StyleSheets/TR/W3C-ED.css">
        

       <link id="st" href="../shared/style/alternate-spec-style.css" rel="stylesheet" 
              type="text/css" title="alternate spec style">     


</head>
<body>
    <div id="div-head" class="head">
        <!--begin-logo-->
        <p><a href="http://www.w3.org/"><img id="mobile-logo" alt="W3C" height="53" src=
        "https://www.w3.org/2008/site/images/logo-w3c-mobile-lg" width="90"></a> 
        
        

        <p><a href="http://www.w3.org/"><img id="logo" alt="W3C" height="48" src=
        "https://www.w3.org/Icons/w3c_home" width="72"></a> <!--end-logo--></p>
        <h1 id="css-exclusions-module">CSS Exclusions Module Level 1</h1>
        <h2 class="no-num no-toc">[LONGSTATUS] [DATE]</h2>
        <dl>
            <dt>This version:</dt>
            <dd><a href="https://drafts.csswg.org/css-exclusions/">https://drafts.csswg.org/css-exclusions/</a></dd>
            <!--<dd><a href="[VERSION]">http://www.w3.org/TR/[YEAR]/WD-css-exclusions-[CDATE]/</a></dd>-->

            <dt>Latest version:</dt>
            <dd><a href="http://www.w3.org/TR/css3-exclusions/">http://www.w3.org/TR/css3-exclusions/</a></dd>

            <dt>Editor's Draft:</dt>
            <dd><a href="https://drafts.csswg.org/[SHORTNAME]/">https://drafts.csswg.org/[SHORTNAME]/</a>

            <dt>Previous version:</dt>
            <dd><a href="http://www.w3.org/TR/2013/WD-css3-exclusions-20130528/">http://www.w3.org/TR/2013/WD-css3-exclusions-20130528/</a>

            <dt>Editors:</dt>
            <dd class="vcard"><span class="fn">Vincent Hardy</span>, <span class="org">Adobe Systems, Inc.</span>, <span class="email">vhardy@adobe.com</span></dd>
            <dd class="vcard"><span class="fn">Rossen Atanassov</span>, <span class="org">Microsoft Corporation</span>, <span class="email">ratan@microsoft.com</span></dd>
            <dd class="vcard"><span class="fn">Alan Stearns</span>, <span class="org">Adobe Systems, Inc.</span>, <span class="email">stearns@adobe.com</span></dd>

            <dt>Issues List:</dt>
            <dd><a href="https://www.w3.org/Bugs/Public/buglist.cgi?query_format=advanced&amp;product=CSS&amp;component=Exclusions&amp;resolution=---&amp;cmdtype=doit">in Bugzilla</a></dd>

  <dt>Feedback:</dt>
    <dd><a href="mailto:www-style@w3.org?subject=%5B[css-exclusions]%5D%20feedback"
         >www-style@w3.org</a> 
         with subject line &ldquo;<kbd>[css-exclusions] 
         <var>&hellip; message topic &hellip;</var></kbd>&rdquo;
         (<a rel="discussion" href="http://lists.w3.org/Archives/Public/www-style/"
           >archives</a>)
           
           <dt>Test Suite:</dt>
           <dd><a href="http://test.csswg.org/suites/css3-exclusions/nightly-unstable/">http://test.csswg.org/suites/css3-exclusions/nightly-unstable/</a></dd>

        </dl>
        <!--copyright-->
        <hr title="Separator for header">
    </div>

    <h2 class="no-num no-toc" id="abstract">Abstract</h2>
        
        
    <p>CSS Exclusions define arbitrary areas around which <a href="http://www.w3.org/TR/CSS2/visuren.html#inline-boxes">inline content</a> ([[!CSS21]]) can flow.
    CSS Exclusions can be defined on any CSS block-level elements. CSS
    Exclusions extend the notion of content wrapping previously limited to
    floats.</p>

    <h2 class="no-num no-toc" id="status">Status of this document</h2>
    <!--status-->
   
<p>This specification was previously called “CSS Exclusions and
Shapes.” The definitions for shapes are now in a separate
specification, see [[CSS-SHAPES]].

    <nav id="toc">
    <h2 class="no-num no-toc" id="contents">Table of contents</h2>
    <!--toc-->
    </nav>

    <h2 id="intro">Introduction</h2>
    <p><em>This section is not normative.</em></p>
    <p>
        This specification defines features that allow inline flow 
        content to wrap around outside the <span>exclusion area</span> of elements. 
    </p>

    <h2 id="definitions">Terminology</h2>
    
    <p><dfn>Exclusion box</dfn>
    
    <p>
        A <a href="http://www.w3.org/TR/css3-box/">box</a> ([[!CSS3BOX]]) that defines an <span>exclusion area</span> for other boxes. The 'wrap-flow'
        property is used to make an element's generated box an exclusion box. An exclusion box contributes
        its <span>exclusion area</span> to its <a href="http://www.w3.org/TR/CSS2/visudet.html#containing-block-details">
        containing block's</a> <span>wrapping context</span>. An element with a 'float'
        computed value other than 'none' does not become an exclusion.
    </p>
    
    <p><dfn>Exclusion area</dfn>

    <p>
        The area used for excluding inline flow content around an exclusion box. The
        <span>exclusion area</span> is equivalent to the <a href="http://www.w3.org/TR/CSS2/box.html#box-dimensions">
        border box</a> for an exclusion box.
    </p>

    <p class="note">
        If a user agent implements both CSS Exclusions and CSS Shapes, 
        the shape-outside property defines the exclusion area 
        instead of the border box.
    </p>

    <p><dfn>Exclusion element</dfn>
    
    <p>
        An <span>exclusion element</span> 
        is a block-level element 
        which is not a float 
        and generates an <span>exclusion box</span>. 
        An element generates an exclusion box when 
        its 'wrap-flow' property's computed value
        is not 'auto'.
    </p>
    
    <p><dfn>Wrapping context</dfn>
    
    <p>
        The <span>wrapping context</span> 
        of a box is a collection 
        of <span>exclusion areas</span> 
        contributed by its associated <span>exclusion boxes</span>. 
        During layout, 
        a box wraps its inline flow content 
        in the <code>wrapping area</code> 
        that corresponds to the subtraction 
        of its <span>wrapping context</span> 
        from its own <span>content area</span>.
    </p>
    
    <p>
        A box inherits its 
        <a href="http://www.w3.org/TR/CSS2/visudet.html#containing-block-details">containing block's</a> 
        <span>wrapping context</span> unless it specifically 
        resets it using the 'wrap-through' property.
    </p>
    
    <p><dfn>Content area</dfn>
    <p>
        The <a href="http://www.w3.org/TR/CSS2/box.html#box-dimensions">content area</a> 
        is normally used for layout of the inline flow content of a box.
    </p>

    <p><dfn>Wrapping area</dfn>
    <p>
        The area used for layout of inline flow content of a box affected by a <span>wrapping context</span>, defined by subtracting the <span>wrapping context</span> from its <span>content area</span>
    </p>
    
    <p><dfn title="outside-inside">Outside and inside</dfn>
    
    <p>
        In this specification, 'outside' refers to DOM content that is not a descendant of an element 
        while 'inside' refers to the element's descendants.
    </p>
    
    <h2 id="exclusions">Exclusions</h2>
    <p>
        Exclusion elements define <span>exclusion areas</span> that contribute to their containing block's 
        <span>wrapping context</span>. As a consequence, exclusions impact the layout of their 
        containing block's descendants.
    <p>
        
    <p>
        Elements lay out their inline content in their <span>content area</span> and wrap around the 
        <span>exclusion areas</span> in their associated <span>wrapping context</span>. If the element is itself an exclusion, it 
        does not wrap around its own exclusion area and the impact of other exclusions on other 
        exclusions is controlled by the 'z-index' property as explained in the 
        <a href="#exclusions-order">exclusions order</a> section.

    <h3 id="declaring-exclusions">Declaring exclusions</h3>
    <p>
        An element becomes an exclusion when its 'wrap-flow' property has a computed value other than 
        'auto'.
    </p>
    
    <h4 id="wrap-flow-property">The 'wrap-flow' property</h4>
    <table class="propdef">
        <tr>
            <th>Name:</th>
            <td><dfn title="'wrap-flow'">wrap-flow</dfn></td>
        </tr>
        <tr>
            <th>Value:</th>
            <td><var>auto</var> | <var>both</var> | <var>start</var> | <var>end</var> | <var>minimum</var> | <var>maximum</var> | <var>clear</var></td>
        </tr>
        <tr>
            <th>Initial:</th>
            <td>auto</td>
        </tr>
        <tr>
            <th>Applies to:</th>
            <td>block-level elements.</td>
        </tr>
        <tr>
            <th>Inherited:</th>
            <td>no</td>
        </tr>
        <tr>
            <th>Percentages:</th>
            <td>N/A</td>
        </tr>
        <tr>
            <th>Media:</th>
            <td>visual</td>
        </tr>
        <tr>
            <th>Computed&nbsp;value:</th>
            <td>as specified except for element's whose 'float' computed  value is not
                <code class="css">none</code>, in which case the computed value is 'auto'.</td>
        </tr>
    </table>

    <p>The values of this property have the following meanings:</p>
    <dl>
        <dt><dfn title="'wrap-flow'!!'auto'">auto</dfn></dt>
        <dd>
            No exclusion is created. Inline flow content interacts with the element as usual.
            In particular, if the element is a 
            <a href="http://www.w3.org/TR/CSS2/visuren.html#floats">float</a> (see [[CSS21]]), the 
            behavior is unchanged.
        </dd>
        <dt><dfn title="'wrap-flow'!!'both'">both</dfn></dt>
        <dd>
            Inline flow content can flow on all sides of the exclusion.
        </dd>
        <dt><dfn title="'wrap-flow'!!'start'">start</dfn></dt>
        <dd>
            Inline flow content can flow 
            around the start edge 
            of the <span>exclusion area</span> 
            but must leave the area 
            next to the end edge 
            of the exclusion empty.
        </dd>
        <dt><dfn title="'wrap-flow'!!'end'">end</dfn></dt>
        <dd>
            Inline flow content can flow 
            around the end edge 
            of the <span>exclusion area</span> 
            but must leave the area 
            next to the start edge 
            of the exclusion empty.
        </dd>
        <dt><dfn title="'wrap-flow'!!'minimum'">minimum</dfn></dt>
        <dd>
            Inline flow content can flow 
            around the edge of the exclusion 
            with the smallest available space 
            within the flow content's containing block, 
            and must leave the other edge
            of the exclusion empty.
        </dd>
        <dt><dfn title="'wrap-flow'!!'maximum'">maximum</dfn></dt>
        <dd>
            Inline flow content can flow 
            around the edge of the exclusion 
            with the largest available space 
            within the flow content's containing block, 
            and must leave the other edge
            of the exclusion empty.
        </dd>
        <dt><dfn title="'wrap-flow'!!'clear'">clear</dfn></dt>
        <dd>
            Inline flow content can only flow 
            before and after the exclusion 
            in the flow content's block direction 
            and must leave the areas 
            next to the start and end edges 
            of the exclusion empty.
        </dd>
    </dl>

    <p>
        If the property's computed value is 'auto', the element does not become an 
        <span>exclusion</span>.
    </p>
    <p>
        Otherwise, a computed 'wrap-flow' property value of 'both', 'start', 'end', 'minimum', 
        'maximum' or 'clear' on an  element makes that element an <span>exclusion element</span>. 
        It's <span>exclusion area</span> is contributed to its containing block's 
        <span>wrapping context</span>, causing the containing block's descendants to wrap around 
        its <span>exclusion area</span>.
    </p>

    <div class="figure">
        <img alt="LTR text wrapping on left edge, RTL text wrapping on right edge, and vertical text wrapping on top edge." src="images/exclusion-writing-modes.png" width="70%" />
        <p class="caption">Exclusion with 'wrap-flow: start' interacting with various writing modes.</p>
    </div>

    <p>Determining the relevant edges of the exclusion depends on the <a href="http://www.w3.org/TR/css3-writing-modes/#text-flow">writing mode</a> [[!CSS3-WRITING-MODES]] of the content wrapping around the <span>exclusion area</span>.
    
    <p>An <span>exclusion element</span> establishes a 
        new <a href="">block formatting context</a> (see [[!CSS21]]) for its content.</p>

    <div class="figure">
        <img alt="General illustration showing how exclusions combine" src="images/exclusions-illustration.png" width="70%" />
        <p class="caption">Combining exclusions</p>
    </div>
    
    <p>
        The above figure illustrates how exclusions are combined. 
        The outermost box represents an element's content box. 
        The A, B, C and D darker gray boxes represent exclusions 
        in the element's <span>wrapping context</span>. 
        A, B, C and D have their respective 'wrap-flow' 
        computed to 'both', 'start', 'end' and 'clear' respectively. 
        The lighter gray areas show the additional areas 
        that are excluded for inline layout 
        as a result of the 'wrap-flow'value. 
        For example, the area to the right of 'B' 
        cannot be used for inline layout 
        of left-to-right writing mode content 
        because the 'wrap-flow' for 'B' is 'start'.
    </p>
    <p>
        The background 'blue' area shows what areas are available 
        for a left-to-right writing mode element's inline content layout. 
        All areas represented with a light or dark shade of gray 
        are not available for (left-to-right writing mode) inline content layout.
    </p>

    <div class="example">
        <p>
            The 'wrap-flow' property values applied to exclusions as grid items.
        </p>
<pre>
    
&lt;div id="grid"&gt;
    &lt;div id="top-right" class="exclusion"&gt;&lt;/div&gt;
    &lt;div id="bottom-left" class="exclusion"&gt;&lt;/div&gt;
    &lt;div id="content"&gt;Lorem ipsum…&lt;/div&gt;
&lt;/div&gt;

&lt;style type="text/css"&gt; 
#grid {
    width: 30em;
    height: 30em;
    display: grid;
    grid-columns: 25% 25% 25% 25%;
    grid-rows: 25% 25% 25% 25%;

#top-right {
    grid-column: 3;
    grid-row: 2;
}

#bottom-left {
    grid-column: 2;
    grid-row: 3;
}

.exclusion {
    wrap-flow: &lt;see below&gt;
}

#content {
    grid-row: 1;
    grid-row-span: 4;
    grid-column: 1;
    grid-column-span: 4;
}
&lt;/style&gt; 
</pre>
        <p>The following figures illustrate the visual rendering for different values
            of the 'wrap-flow' property. The gray grid lines are marking the grid cells. and the 
            blue area is the exclusion box (positioned by the grid).</p>
        <table class="example-table">
            <tr>
                <td><code class="html">.exclusion{ wrap-flow: auto; }</code></td>
                <td><code class="html">.exclusion{ wrap-flow: both; }</code></td>
            </tr>
            <tr>
                <td><img src="images/exclusion_wrap_side_auto.png" alt="Example rendering for wrap-side: auto" /></td>
                <td><img src="images/exclusion_wrap_side_both.png" alt="Example rendering for wrap-side: both" /></td>
            </tr>
            <tr>
                <td><code class="html">.exclusion{ wrap-flow: start; }</code></td>
                <td><code class="html">.exclusion{ wrap-flow: end; }</code></td>
            </tr>
            <tr>
                <td><img src="images/exclusion_wrap_side_left.png" alt="Example rendering for wrap-side: start" /></td>
                <td><img src="images/exclusion_wrap_side_right.png" alt="Example rendering for wrap-side: end" /></td>
            </tr>
            <tr>
                <td><code class="html">.exclusion{ wrap-flow: minimum; }</code></td>
                <td><code class="html">.exclusion{ wrap-flow: maximum; }</code></td>
            </tr>
            <tr>
                <td><img src="images/exclusion_wrap_side_minimum.png" alt="Example rendering for wrap-side: minimum" /></td>
                <td><img src="images/exclusion_wrap_side_maximum.png" alt="Example rendering for wrap-side: maximum" /></td>
            </tr>
            <tr>
                <td><code class="html">.exclusion{ wrap-flow: clear; }</code></td>
                <td></td>
            </tr>
            <tr>
                <td><img src="images/exclusion_wrap_side_clear.png" alt="Example rendering for wrap-side: clear" /></td>
                <td></td>
            </tr>
        </table>
    </div>
    
    <!-- End section "wrap-flow Property" -->
    <!-- End section "Declaring Exclusions" -->
        
    <h3 id="scope-and-effect-of-exclusions">Scope and effect of exclusions</h3>
    <p>
        An <span>exclusion</span> affects 
        the inline flow content descended 
        from the exclusion's containing block 
        (defined in <a href="http://www.w3.org/TR/CSS2/visudet.html#containing-block-details">
        CSS 2.1 10.1</a>) 
        and that of all descendant elements 
        of the same containing block. 
        All inline flow content 
        inside the containing block 
        of the exclusions is affected. 
        To stop the effect of exclusions 
        defined outside an element, 
        the 'wrap-through' property can be used 
        (see the <a href="#propagation-of-exclusions">propagation of exclusions</a>
        section below).
    </p>
    
    <p>
        As a reminder, 
        for exclusions with 'position:fixed', 
        the containing block is that 
        of the root element.
    </p>
        
    <!-- End section "Scope and Effect of Exclusions" -->
    
    <h3 id="propagation-of-exclusions">Propagation of Exclusions</h3>
    <p>
        By default, an element inherits its parent <span>wrapping context</span>. In other words
        it is subject to the exclusions defined <span title="outside-inside">outside</span> the element.
    </p>
    <p>Setting the 'wrap-through' property to 'none' prevents an element from inheriting its parent
        <span>wrapping context</span>. In other words, exclusions defined 'outside' the element, have not effect
        on the element's children layout.
    </p>
    <div class="note">
        Exclusions defined by an element's descendants still contribute to their containing block's
        <span>wrapping context</span>. If that containing block is a child of an element with 'wrap-through'
        computes to none, or the element itself, then exclusion still have an effect on the children of that 
        containing block element.
    </div>

    <h4 id="wrap-through-property">The 'wrap-through' Property</h4>
    
    <table class="propdef">
        <tr>
            <th>Name:</th>
            <td><dfn title="'wrap-through'">wrap-through</dfn></td>
        </tr>
        <tr>
            <th>Value:</th>
            <td><var>wrap</var> | <var>none</var></td>
        </tr>
        <tr>
            <th>Initial:</th>
            <td>wrap</td>
        </tr>
        <tr>
            <th>Applies to:</th>
            <td>block-level elements</td>
        </tr>
        <tr>
            <th>Inherited:</th>
            <td>no</td>
        </tr>
        <tr>
            <th>Percentages:</th>
            <td>N/A</td>
        </tr>
        <tr>
            <th>Media:</th>
            <td>visual</td>
        </tr>
        <tr>
            <th>Computed&nbsp;value:</th>
            <td>as specified</td>
        </tr>
    </table>

    <p>The values of this property have the following meanings:</p>
    <dl>
        <dt><dfn title="'wrap-through'!!'wrap'">wrap</dfn></dt>
        <dd>
            The element inherits its parent node's <span>wrapping context</span>. Its descendant
            inline content wraps around exclusions defined <span title="outside-inside">outside</span>
            the element.
        </dd>
    </dl>
    <dl>
        <dt><dfn title="'wrap-through'!!'none'">none</dfn></dt>
        <dd>
            The element does not inherit its parent node's <span>wrapping context</span>. Its 
            descendants are only subject to exclusion areas defined <span title="outside-inside">inside</span>
            the element.
        </dd>
    </dl>
    <div class="example">
        <p>
            Using the 'wrap-through' property to control the effect of exclusions.
        </p>
<pre><code class="html">

&lt;style type="text/css"&gt; 
    #grid {
        display: grid;
        grid-columns: 25% 50% 25%;
        grid-rows: 25% 25% 25% 25%;
    }

    #exclusion {
        grid-row: 2;
        grid-row-span: 2;
        grid-column: 2;
        wrap-flow: &lt;see below&gt;
    }
    
    #rowA, #rowB {
        grid-row-span: 2;
        grid-column: 1;
        grid-column-span: 3;
    }

    #rowA {
        grid-row: 1;
    }
    
    #rowB {
        grid-row: 3;
    }
    &lt;/style&gt;
        
&lt;style type="text/css"&gt; 
    .exclusion  {
    	wrap-flow: both; 
    	position: absolute; 
    	left: 20%;
    	top: 20%;
    	width: 50%;
    	height: 50%;
    	background-color: rgba(220, 230, 242, 0.5); 
    } 
&lt;/style&gt; 

&lt;div id="grid"&gt; 
    &lt;div class=”exclusion”&gt;&lt;/div&gt; 
    &lt;div id="rowA" style=”wrap-through: wrap;”&gt; Lorem ipsum dolor sit amet...&lt;/div&gt; 
    &lt;div id="rowB" style=”wrap-through: none;”&gt; Lorem ipsum dolor sit amet...&lt;/div&gt; 
&lt;/div&gt;
</code></pre>

        <img class="singleImgExample" src="images/exclusion_wrap_through.png" alt="Example rendering of wrap-through: wrap | none" style="max-width:40%"/>
    </div>
    <!-- End section "wrap-through property" -->
    <!-- End section "Propagation of Exclusions" -->
    
    <h3 id="exclusions-order">Exclusions order</h3>
    <p>
        Exclusions follow the painting order (See [[!CSS21]] Appendix E). Exclusions are
        applied in reverse to the document order in which they are defined. The last exclusion
        appears on top of all other exclusion, thus it affects the inline flow content of
        all other preceding exclusions or elements descendant of the same containing block.
        The 'z-index' property can be used to change the ordering of 
        <a href="http://www.w3.org/TR/CSS2/visuren.html#choose-position">positioned</a> exclusion
        boxes (see [[!CSS21]]). Statically positioned exclusions are not affected by the 
        'z-index' property and thus follow the painting order.
    </p>

    <div class="example">
        <p>Ordering of exclusions.</p>
<pre><code class="html">
&lt;style type="text/css"&gt; 
    .exclusion  {
      wrap-flow: both; 
      position: absolute; 
      width: 200px;
    }
    .topleft {
      top: 10px;
      left: 10px;
      background-color: lightblue;
    }
    .middle {
      top: 90px;
      left: 90px;
      background-color: lightgreen;
    }
    .bottomright {
      top: 170px;
      left: 170px;
      background-color: pink;
    }
&lt;/style&gt; 

&lt;div class="exclusion topleft"&gt; 
    The top left div... 
&lt;/div&gt; 
&lt;div class="exclusion middle"&gt; 
    The middle div... 
&lt;/div&gt; 
&lt;div class="exclusion bottomright"&gt; 
    The bottom right div... 
&lt;/div&gt;
</code></pre>

    <table class="example-table">
        <tr>
            <td style="width:50%"><code class="html">.middle { z-index: auto; }</code></td>
            <td style="width:50%"><code class="html">.middle { z-index: 1; }</code></td>
        </tr>
        <tr>
            <td><img class="singleImgExample" src="images/exclusion_ordering.png" alt="Example rendering of default exclusion ordering." /></td>
            <td><img class="singleImgExample" src="images/exclusion_ordering_z_order.png" alt="Example rendering of default exclusion ordering." /></td>
        </tr>
    </table>

    </div>
    <!-- End section "Order of Exclusions" -->
        
    <div class="issue-marker wrapper">
    <div class="issue-marker">
        <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=15183">Issue-15183</a>
        <div class="issue-details">
            <p class="short-desc">Is the CSS exclusions processing model incorrect?</p>
        </div>
    </div>
    </div>

    <div class="issue">

        <p>The current draft provides a model for exclusions
        without a collision-avoidance model. 
        The existing exclusion model in CSS uses floats, 
        which have both exclusion and collision-avoidance behavior. 
        Concerns have been raised that allowing exclusions 
        without collision avoidance could be harmful, 
        particularly with absolutely-positioned elements. 
        Three options should be considered:<p>
        <ol>
            <li>Allow exclusions in positioning schemes 
                with no collision avoidance.</li>
            <li>Disallow exclusions in positioning schemes 
                with no collision avoidance.</li>
            <li>Define collision-avoidance behavior 
                for positioning schemes without it, 
                and use this behavior by default with exclusions.</li>
        </ol>
    </div>
    
        <h3 id="exclusions-processing-model">Processing model</h3>
        
        <h4 id="exclusions-processing-model-description">Description</h4>
        
        <p>Applying exclusions is a two-step process:</p>
        
        <ul>
            <li><strong>Step 1</strong>: resolve exclusion boxes belonging to each <span>wrapping context</span></li>
            <li><strong>Step 2</strong>: resolve <span>wrapping context</span>s and lay out each containing block in turn:
                <ul>
                    <li><strong>Step 2-A</strong>: resolve the position and size of exclusion boxes</li>
                    <li><strong>Step 2-B</strong>: lay out containing block, wrapping around <span>exclusion areas</span></li>
                </ul>
                </li>
        </ul>
        
        <h4 id="step-1-resolve-exclusion-boxes-belonging-to-each-wrapping-context">Step 1: resolve exclusion boxes belonging to each <span>wrapping context</span></h4>
        
        <p>In this step, the user agent determines which <a href="http://www.w3.org/TR/CSS2/visudet.html#containing-block-details">containing block</a> each 
            <span>exclusion area</span> belongs to. This is a simple step, based on the 
            definition of containing blocks and elements with a computed value for 'wrap-flow'
            that is not <code class="css">auto</code>.</p>
        
        <h4 id="step-2-resolve-wrapping-contexts-layout-containing-blocks">Step 2: resolve wrapping contexts and lay out containing blocks</h4>

        <p>In this step, starting from the 
            top of the <a href="http://www.w3.org/TR/CSS2/visuren.html#z-index">rendering tree</a> (see [[!CSS21]]), 
            the the agent processes each containing block in two sub-steps.</p>
        
        <h4 id="step-2-A-resolve-exclusions-position-and-size">Step 2-A: resolve the position and size of exclusion boxes</h4>
        
        <p>Resolving the position and size 
            of <span>exclusion boxes</span> 
            in the <span>wrapping context</span> 
            may or may not require a layout. 
            For example, 
            if an <span>exclusion box</span> 
            is absolutely positioned and sized,
            a layout may not be needed 
            to resolve its position and size. 
            In other situations, 
            laying out the containing block's content is required.</p>
            
        <p>When a layout is required, 
            it is carried out
            without applying any <span>exclusion area</span>.
            In other words, 
            the containing block is laid out
            without a <span>wrapping context</span>. </p>
            
        <p>Step 2-A yields a position and size
            for all <span>exclusion boxes</span> 
            in the <span>wrapping context</span>. 
            Each exclusion box is processed in turn, 
            starting from the top-most, 
            and each <span>exclusion area</span> 
            is computed and contributed 
            to the <a href="http://www.w3.org/TR/CSS2/visudet.html#containing-block-details">containing block's</a> 
            <span>wrapping context</span>. </p>
            
        <p>Scrolling is ignored in this step 
            when resolving the position and size 
            of 'position:fixed' <span>exclusion boxes</span>.</p>

        <p>Once the <a href="http://www.w3.org/TR/CSS2/visudet.html#containing-block-details">containing block's</a>
            <span>wrapping context</span> is computed, 
            all <span>exclusion boxes</span> 
            in that <span>wrapping context</span> 
            are removed from the normal flow.</p>

        <h4 id="step-2-B-layout-containing-block-applying-wrapping">Step 2-B: lay out containing block applying wrapping</h4>
            
        <p>Finally, the content 
            of the containing block is laid out, 
            with the inline content wrapping around 
            the <span>wrapping content</span>'s
            <span>exclusion areas</span> 
        </p>
            
        <p>When the containing block itself is an <span>exclusion box</span>, then 
            rules on <a href="#exclusions-order">exclusions order</a> define which exclusions
            affect the inline and descendant content of the box.</p>
            
        <h4 id="exclusions-processing-model-example">Example</h4>

        <p>This section illustrates the exclusions processing model with an example. It is meant 
            to be simple. Yet, it contains enough complexity to address the issues of 
            layout dependencies and re-layout.</p>


        <p>The code snippet in the following example has two exclusions affecting 
            the document's inline content.</p>

        <div class="example">
        <pre class="html">&lt;html&gt;
&lt;style&gt;
#d1 {
    position:relative;
    height: auto;
    color: #46A4E9;
    border: 1px solid gray;
}

#e1 {
    wrap-flow: both;
    position: absolute; 
    left: 50%; 
    top: 50%; 
    width: 40%; 
    height: 40%; 
    border: 1px solid red;
    margin-left: -20%;
    margin-top: -20%;
}

#d2 {
    position: static;
    width: 100%;
    height: auto;
    color: #808080;
}

#e2 {
    wrap-flow: both;
    position: absolute; 
    right: 5ex; 
    top: 1em; 
    width: 12ex;
    height: 10em; 
    border: 1px solid lime;
}
&lt;/style&gt;
&lt;body&gt;
    &lt;div id="d1"&gt;
        Lorem ipsusm ...
        &lt;p id="e1"&gt;&lt/p&gt;
    &lt;/div&gt;
    &lt;div id="d2"&gt;
        Lorem ipsusm ...
        &lt;p id="e2" &gt;&lt/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
        </div>
        <p>The following figures illustrate:</p>
        
        <ul>
            <li>the document's DOM tree</li>
            <li>the layout tree of generated block boxes
        </ul>
        
        <div class="figure">
            <img src="images/processing-model-example-dom.svg" width="200" 
                alt="DOM tree nodes"/>
            <p class="caption">DOM tree</p>
        </div>

        <div class="figure">
            <img src="images/processing-model-example-layout-tree.svg" width="350" 
                alt="Layout tree boxes"/>
            <p class="caption">Layout tree of generated block boxes</p>
        </div>

        <h5>Step 1: resolve exclusion boxes belonging to each <span>wrapping context</span></h5>
        
        <p>The figures illustrate how the boxes corresponding to the element sometimes
            have a different containment hierarchy in the layout tree than in the DOM tree. 
            For example, the box generated by <code class="idl">e1</code> is positioned in
            its containing block's box, which is the <code class="idl">d1-box</code>, because 
            <code class="idl">e1</code> is absolutely positioned and <code class="idl">d1</code>
            is relatively positioned. However, while <code class="idl">e2</code> is also absolutely 
            positioned, its containing block is the initial containing block (ICB). See the 
            section 10.1 of the CSS 2.1 specification ([[!CSS21]]) for details.</p>

        <p>As a result of the computation of containing blocks for the tree, the boxes belonging 
            to the <span>wrapping context</span>s of all the elements can be determined:</p>

        <ul>
            <li>The <span>wrapping context</span> for the html element contains the <code class="idl">e2</code> box: WC-1 (Wrapping Context 1)</li>
            <li>The <span>wrapping context</span> for the body element inherits the html element's <span>wrapping context</span>: WC-1</li>
            <li>The <span>wrapping context</span> for <code class="idl">d1</code> inherits the body element's 
                <span>wrapping context</span> and adds the <code class="idl">e1-box</code> to it. So the wrapping
                context is made of both the <code class="idl">e1-box</code> and the 
                <code class="idl">e2-box</code>: WC-2</li>
            <li>The <span>wrapping context</span> for <code class="idl">d2</code> inherits the body element's 
                <span>wrapping context</span>: WC-1</li>
        </ul>

        <h5>Step 2: resolve wrapping contexts and lay out containing blocks</h5>
        
        <p>In this step, each containing block is processed in turn. For each containing block,
            we (conceptually) go through two phases:</p>
        <ol>
            <li>resolve the <span>wrapping context</span>: resolve the position and size of its exclusions</li>
            <li>lay out the containing block</li>
        </ol>
            
        <p>In our example, this breaks down to:</p>
        <ol>
            <li>resolve the position and size of the exclusions belonging to WC-1: RWC-1 (Resolved Wrapping Context 1).</li>
            <li>lay out the initial containing block (i.e., lay out its content):
                <ol>
                    <li>resolve the html element's <span>wrapping context</span>: RWC-1</li>
                    <li>lay out the html element:
                        <ol>
                            <li>resolve the body element's <span>wrapping context</span>: RWC-1</li>
                            <li>lay out the body element:
                                <ol>
                                    <li>resolve the <code class="idl">d1</code> element's <span>wrapping context</span>: RWC-2</li>
                                    <li>lay out the <code class="idl">d1</code> element</li>
                                    <li>resolve the <code class="idl">d2</code> element's <span>wrapping context</span>: RWC-1</li>
                                    <li>lay out the <code class="idl">d2</code> element</li>
                                </ol>
                            </li>
                        </ol>
                    </li>
                </ol>
                </li>
        </ol>
        
        <h6>Resolving RWC-1</h6>
        
        <p>The top-most <span>wrapping context</span> in the layout tree contains the <code class="idl">e2</code>
            exclusion. Its position and size needs to be resolved. In general, computing an 
            exclusion's position and size may or may not require laying out other content.
            In our example, no content needs to be laid out to resolve the <code class="idl">e2</code>
            exclusion's position because it is absolutely positioned and its size can be resolved
            without layout either. At this point, RWC-1 is resolved and can be used when
            laying inline content out.</p>

        <h6>Resolving RWC-2</h6>
        
        <p>The process is similar: the position of the 
            <code class="idl">e1</code> exclusion needs to be resolved. Again, resolving the exclusion's 
            position and size may require processing the containing block (d1 here). 
            It is the case here because the size and position of
            <code class="idl">e1</code> depend on resolving the percentage lengths. The percentages are relative 
            to the size of 
            <code class="idl">d1</code>'s box. As a result, in order to resolve
            a size for <code class="idl">d1</code>'s box, a first layout of <code class="idl">d1</code>
            is done without any <span>wrapping context</span> (i.e., no exclusions applied). The layout yields a 
            position and size for <code class="idl">e1</code>'s box. 
        </p>
        <p>At this point, RWC-2 is resolved because the position and size of both 
            e1 and e2 are resolved.</p>

        <p class="note">The important aspect of the above processing example is that once an element's <span>wrapping context</span>
            is resolved (by resolving its exclusions' position and size), the position and size of the
            exclusions are not re-processed if the element's size changes between the layout that may be done 
            without considering any <span>wrapping context</span> (as for RWC-2) and the layout done with the resolved <span>wrapping context</span>. 
            This is what breaks the possible circular dependency between the resolution of <span>wrapping context</span>s
            and the layout of containing blocks.</p>
    
    <h3 id="floats-and-exclusions">Floats and exclusions</h3>
    
    <h4 id="floats-and-exclusions-similarities">Similarities</h4>
    
    <p>There are similarities between floats and exclusions in that inline content wraps around floats 
        and also wraps around <span>exclusion areas</span>. However, there are very significant differences.</p>
        
    <h4 id="floats-and-exclusions-differences">Differences</h4>
    
    <ul>
        <li><strong>scope</strong>. While floats apply to content that follows in the 
            document, exclusions apply to content in their containing block.</li>
        <li><strong>positioning</strong>. Floats are part of the inline flow and 'float' on the
            line box. Authors can control how the floats move on the line box, to the right or to the
            left. By contrast, exclusions can be positioned using any positioning scheme such
            as grid layout ([[CSS3-GRID-LAYOUT]]), flexible box ([[CSS3-FLEXBOX]]) or any other
            CSS positioning scheme.</li>
        <li><strong>separation of concerns</strong>. Making an element a float determines both
            its positioning scheme and its effect on inline content. Making an element an
            exclusion only determines its impact on inline content and does not impose constraints 
            on its positioning method.</li>
    </ul>
    
    <h4 id="floats-and-exclusions-interoperability">Interoperability</h4>
    
    <h5 id="effect-of-floats-on-exclusions">Effect of floats on exclusions</h5>
    
    <p>Floats have an effect on the positioning of exclusions and the layout of their inline content. For 
        example, if an exclusion is an inline-box which happens to be on the same line as a float,
        its' position, as computed in <a href="#step-2-A-resolve-exclusions-position-and-size">Step 2-A</a> will be impacted by the float, as 
        is any other inline content.</p>
    
    <h5 id="effect-of-exclusions-on-floats">Effect of exclusions on floats</h5>
    
    <p>Exclusions have an effect on the positioning of floats as they have an effect on inline content. 
        Therefore, in <a href="#step-2-B-layout-containing-block-applying-wrapping">Step 2-B</a>, floats will avoid <span>exclusion areas</span>.</p>

    <h2 id="conformance">Conformance</h2>
    <!--conformance-->

    <h2 class="no-num" id="acknowledgments">Acknowledgments</h2>
      <p>This specification is made possible by input from 
          Andrei Bucur, 
          Alexandru Chiculita,
          Arron Eicholz, 
          Daniel Glazman,  
          Arno Gourdol, 
          Chris Jones, 
          Bem Jones-Bey, 
          Marcus Mielke, 
          Alex Mogilevsky, 
          Hans Muller, 
          Mihnea Ovidenie, 
          Virgil Palanciuc, 
          Peter Sorotokin, 
          Bear Travis, 
          Eugene Veselov, 
          Stephen Zilles 
          and the CSS Working Group members.
      </p>
      <h2 class="no-num" id="references">References</h2>
      <h3 class="no-num" id="normative-references">Normative references</h3>
      <!--normative-->
      <h3 class="no-num" id="other-references">Other references</h3>
      <!--informative-->
      <h2 class="no-num" id="index">Index</h2>
      <!--index-->
      <h2 class="no-num" id="property-index">Property index</h2>
      <!-- properties -->

          <!-- template markup for issues pulled from Bugzilla -->
          <!-- issue template and script need a new API to access bugzilla
          <script type="text/template" id="issue-template">
      <div class="issue-marker" data-bug_id="{{bug_id}}" data-bug_status="{{bug_status}}">
          <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id={{bug_id}}">Issue-{{bug_id}}</a>
          <div class="issue-details">
              <p class="short-desc">{{short_desc}}</p>
          </div>  
      </div>
          </script>   

          <script type="text/javascript" src="../shared/scripts/BugzillaTrackerUtil.js"></script>
          <script type="text/javascript" src="../shared/scripts/BugzillaTracker.js"></script>
          <script type="text/javascript">
              checkSpecificationIssues('CSS', 'Exclusions');        
          </script>
          -->
      <h2 class="no-num" id="change-log">Change Log</h2>
      
      <h3 class="no-num" >Since <a href="http://www.w3.org/TR/2012/WD-css3-exclusions-20120503/">May 3rd 2012</a></h3>
      <ul>
          <li>split exclusions from shapes into separate modules</li>
          <li>added inset-rectangle() to basic shapes</li>
          <li>Changed shape-inside overflow diagrams to show exclusion behavior</li>
          <li>Changed shape-inside to contribute to the wrapping context</li>
          <li>Defined exclusion edges relative to wrapping content's writing mode</li>
          <li>Made use of start, end, before and after consistent</li>
          <li>Added interpolation for basic shapes</li>
          <li>Changed basic shapes to depend on box specified with box-sizing</li>
          <li>Added overflow behavior for shape-inside.</li>
          <li>Added wrap-flow:minimum.</li>
          <li>Clarified processing model.</li>
          <li>Changed wrap-margin and wrap-padding to shape-margin and shape-padding.</li>
          <li>Removed wrap shorthand.</li>
      </ul>

      <h3 class="no-num" >Since <a href="http://www.w3.org/TR/2011/WD-css3-exclusions-20111213/">December 13th 2011</a></h3>
      <ul>
          <li>Clarified processing model.</li>
          <li>Clarified interaction with floats.</li>
          <li>Clarified that an exclusion element establishes a new block formatting context.</li>
      </ul>
      
  </body>
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
sgml-omittag:nil
sgml-shorttag:nil
sgml-namecase-general:t
sgml-general-insert-case:lower
sgml-always-quote-attributes:t
sgml-indent-step:nil
sgml-indent-data:t
sgml-parent-document:nil
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->
 
