<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Spatial Navigation</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li li { font-size:   85%;    }

	.toc > li             { margin: 1.5rem 0;    }
	.toc > li li          { margin: 0.3rem 0;    }
	.toc > li li li       { margin-left: 2rem;   }

	/* Section numbers in a column of their own */
	.toc .secno {
		float: left;
		width: 4rem;
		white-space: nowrap;
	}
	.toc > li li li li .secno {
		font-size: 85%;
	}
	.toc > li li li li li .secno {
		font-size: 100%;
	}

	:not(li) > .toc              { margin-left:  5rem; }
	.toc .secno                  { margin-left: -5rem; }
	.toc > li li li .secno       { margin-left: -7rem; }
	.toc > li li li li .secno    { margin-left: -9rem; }
	.toc > li li li li li .secno { margin-left: -11rem; }

	/* Tighten up indentation in narrow ToCs */
	@media (max-width: 30em) {
		:not(li) > .toc              { margin-left:  4rem; }
		.toc .secno                  { margin-left: -4rem; }
		.toc > li li li              { margin-left:  1rem; }
		.toc > li li li .secno       { margin-left: -5rem; }
		.toc > li li li li .secno    { margin-left: -6rem; }
		.toc > li li li li li .secno { margin-left: -7rem; }
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) :not(li) > .toc              { margin-left:  4rem; }
		body:not(.toc-inline) .toc .secno                  { margin-left: -4rem; }
		body:not(.toc-inline) .toc > li li li              { margin-left:  1rem; }
		body:not(.toc-inline) .toc > li li li .secno       { margin-left: -5rem; }
		body:not(.toc-inline) .toc > li li li li .secno    { margin-left: -6rem; }
		body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	body.toc-sidebar #toc :not(li) > .toc              { margin-left:  4rem; }
	body.toc-sidebar #toc .toc .secno                  { margin-left: -4rem; }
	body.toc-sidebar #toc .toc > li li li              { margin-left:  1rem; }
	body.toc-sidebar #toc .toc > li li li .secno       { margin-left: -5rem; }
	body.toc-sidebar #toc .toc > li li li li .secno    { margin-left: -6rem; }
	body.toc-sidebar #toc .toc > li li li li li .secno { margin-left: -7rem; }

	.toc li {
		clear: both;
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-left: calc(13px + 26.5rem - 50vw);
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-left: calc(40em - 50vw) !important;
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-left: 0 !important;
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version 166744eb86a34dbc5493268ea410dc65275aa964" name="generator">
  <link href="http://wicg.github.io/spatial-navigation" rel="canonical">
  <meta content="59d9f4fed849c6037a716f12f193a93de245094e" name="document-revision">
<style>
code.key {
  border: solid 1px;
  border-radius: 0.5ch;
  padding: 1px 5px;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
.highlight .c { color: #708090 } /* Comment */
.highlight .k { color: #990055 } /* Keyword */
.highlight .l { color: #000000 } /* Literal */
.highlight .n { color: #0077aa } /* Name */
.highlight .o { color: #999999 } /* Operator */
.highlight .p { color: #999999 } /* Punctuation */
.highlight .cm { color: #708090 } /* Comment.Multiline */
.highlight .cp { color: #708090 } /* Comment.Preproc */
.highlight .c1 { color: #708090 } /* Comment.Single */
.highlight .cs { color: #708090 } /* Comment.Special */
.highlight .kc { color: #990055 } /* Keyword.Constant */
.highlight .kd { color: #990055 } /* Keyword.Declaration */
.highlight .kn { color: #990055 } /* Keyword.Namespace */
.highlight .kp { color: #990055 } /* Keyword.Pseudo */
.highlight .kr { color: #990055 } /* Keyword.Reserved */
.highlight .kt { color: #990055 } /* Keyword.Type */
.highlight .ld { color: #000000 } /* Literal.Date */
.highlight .m { color: #000000 } /* Literal.Number */
.highlight .s { color: #a67f59 } /* Literal.String */
.highlight .na { color: #0077aa } /* Name.Attribute */
.highlight .nc { color: #0077aa } /* Name.Class */
.highlight .no { color: #0077aa } /* Name.Constant */
.highlight .nd { color: #0077aa } /* Name.Decorator */
.highlight .ni { color: #0077aa } /* Name.Entity */
.highlight .ne { color: #0077aa } /* Name.Exception */
.highlight .nf { color: #0077aa } /* Name.Function */
.highlight .nl { color: #0077aa } /* Name.Label */
.highlight .nn { color: #0077aa } /* Name.Namespace */
.highlight .py { color: #0077aa } /* Name.Property */
.highlight .nt { color: #669900 } /* Name.Tag */
.highlight .nv { color: #222222 } /* Name.Variable */
.highlight .ow { color: #999999 } /* Operator.Word */
.highlight .mb { color: #000000 } /* Literal.Number.Bin */
.highlight .mf { color: #000000 } /* Literal.Number.Float */
.highlight .mh { color: #000000 } /* Literal.Number.Hex */
.highlight .mi { color: #000000 } /* Literal.Number.Integer */
.highlight .mo { color: #000000 } /* Literal.Number.Oct */
.highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
.highlight .sc { color: #a67f59 } /* Literal.String.Char */
.highlight .sd { color: #a67f59 } /* Literal.String.Doc */
.highlight .s2 { color: #a67f59 } /* Literal.String.Double */
.highlight .se { color: #a67f59 } /* Literal.String.Escape */
.highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
.highlight .si { color: #a67f59 } /* Literal.String.Interpol */
.highlight .sx { color: #a67f59 } /* Literal.String.Other */
.highlight .sr { color: #a67f59 } /* Literal.String.Regex */
.highlight .s1 { color: #a67f59 } /* Literal.String.Single */
.highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
.highlight .vc { color: #0077aa } /* Name.Variable.Class */
.highlight .vg { color: #0077aa } /* Name.Variable.Global */
.highlight .vi { color: #0077aa } /* Name.Variable.Instance */
.highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">Spatial Navigation</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="2018-02-06">6 February 2018</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://wicg.github.io/spatial-navigation">http://wicg.github.io/spatial-navigation</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/wicg/spatial-navigation/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:jh.hong@lge.com">Jihye Hong</a> (<span class="p-org org">LG Electronics</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://florian.rivoal.net">Florian Rivoal</a> (<span class="p-org org">Invited Expert</span>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2018 the Contributors to the Spatial Navigation Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines a general model for navigating the focus using the arrow keys,

as well as related CSS and JavaScript features.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content"> Introduction</span></a>
    <li><a href="#interaction"><span class="secno">2</span> <span class="content"> Module interaction</span></a>
    <li><a href="#overview"><span class="secno">3</span> <span class="content"> Overview</span></a>
    <li>
     <a href="#declarative"><span class="secno">4</span> <span class="content"> Controlling spatial navigation through declarative means</span></a>
     <ol class="toc">
      <li><a href="#activation"><span class="secno">4.1</span> <span class="content"> Activating Spatial Navigation: the <span class="property">spatial-navigation</span> property</span></a>
      <li><a href="#container"><span class="secno">4.2</span> <span class="content"> Establishing focus navigation containers: the <span class="property">spatnav-container</span> property</span></a>
     </ol>
    <li><a href="#js-api"><span class="secno">5</span> <span class="content"> Javascript API</span></a>
    <li>
     <a href="#processing-model"><span class="secno">6</span> <span class="content"> Processing Model</span></a>
     <ol class="toc">
      <li><a href="#key-presses"><span class="secno">6.1</span> <span class="content"> Handling key presses</span></a>
      <li><a href="#scrolling"><span class="secno">6.2</span> <span class="content"> Scrolling</span></a>
      <li><a href="#nav"><span class="secno">6.3</span> <span class="content"> Navigation</span></a>
      <li><a href="#heuristics"><span class="secno">6.4</span> <span class="content"> Focus Navigation Heuristics</span></a>
     </ol>
    <li><a href="#conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#property-index"><span class="secno"></span> <span class="content">Property Index</span></a>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="non-normative heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content"> Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>Historically, most browsers have not offered features to let users move the focus directionally.
Some, such as TV browsers, have enabled users to move the focus using the arrow keys out of necessity,
since no other input mechanism is available on a typical TV remote control.</p>
   <p>Others, have enabled different key combinations to control spatial navigation,
such as pressing the <code class="key">Shift</code> key together with arrow keys.</p>
   <p>This ability to move around the page directionally is called <dfn class="dfn-paneled" data-dfn-type="dfn" data-export="" data-lt="spatial navigation | spatnav" id="spatial-navigation">spatial navigation</dfn> (or <strong>spatnav</strong> for short).</p>
   <p><a data-link-type="dfn" href="#spatial-navigation" id="ref-for-spatial-navigation">Spatial navigation</a> can be useful for a webpage built with the grid layout.</p>
   <figure>
     <img alt="An image about enabling spatnav" src="images/spatnav-enable.png" style="width: 500px;"> 
    <figcaption>Application using the grid layout.</figcaption>
   </figure>
   <p>The figure above represents a photo gallery in the grid layout.
If the user press the <code class="key">Tab</code> key to move focus, there are some difficulties.
The user needs to press many times to move focus to the target element.
Also, sometimes the grid layout rearrange the layout of elements independent of their source order.
Therefore sequential navigation makes an unpredicted focus navigation.
But <a data-link-type="dfn" href="#spatial-navigation" id="ref-for-spatial-navigation①">spatial navigation</a> moves focus among focusable elements depending on their position,
it can solve problems of sequential navigation.</p>
   <p>While arrow keys are naturally suited to control spatial navigation,
pressing them (on devices that have such keys)
has generally triggered other behavior,
such as scrolling.
This specification introduces CSS properties and Javascript APIs
enabling authors to turn on spatial navigation using arrow keys
and to control its behavior.</p>
   <p>Some aspects of this specification, such as the Javascript Events,
also extent how sequential navigation work,
in order to make sure that keyboard navigation in general
has a consistent and well defined model.</p>
   <p class="note" role="note"><span>Note:</span> As a general principle,
keyboard navigation,
and spatial navigation in particular,
should be possible to control without JavaScript,
and declarative solutions are therefore preferred.
Since spatial navigation depends on layout,
that means CSS is typically the right mechanism to define
spatial navigation related controls.
However, in the spirit of the <a href="https://github.com/extensibleweb/manifesto">Extensible Web Manifesto</a>,
we feel it is important to provide the right JavaScript primitives
to let authors experiment and explore the problem space.
More declarative features may be added later,
based on feedback and experience acquired through such JavaScript usage.</p>
   <h2 class="heading settled" data-level="2" id="interaction"><span class="secno">2. </span><span class="content"> Module interaction</span><a class="self-link" href="#interaction"></a></h2>
   <p>This document depends on the Infra Standard <a data-link-type="biblio" href="#biblio-infra">[infra]</a>.</p>
   <p>The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" are to be interpreted as described in RFC 2119. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
   <h2 class="non-normative heading settled" data-level="3" id="overview"><span class="secno">3. </span><span class="content"> Overview</span><a class="self-link" href="#overview"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>When spatial navigation is <a data-link-type="dfn" href="#spatnav-active" id="ref-for-spatnav-active">active</a>,
pressing an arrow key will either
move the focus from its current location to a new focusable item in the direction requested,
or scroll if there is no appropriate item.</p>
   <p>More specifically,
the User Agent will first search for visible and focusable items
in the direction indicated
within the current <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container">spatial navigation focus container</a> (by default the root element, scrollable elements, and iframes,
but other elements can be made into <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①">spatial navigation focus containers</a> using the <a class="property" data-link-type="propdesc" href="#propdef-spatnav-container" id="ref-for-propdef-spatnav-container">spatnav-container</a> property).</p>
   <p>If it finds any, it will pick the best one for that direction,
and move the focus there.</p>
   <p>If it does not, it will scroll the <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container②">spatial navigation focus container</a> in the requested direction
instead of moving focus.
Doing so may uncover focusable elements
which would then be eligible targets to move the focus to
next time spatial navigation in the same direction is requested.</p>
   <p>If the <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container③">spatial navigation focus container</a> cannot be scrolled,
either because it is not a scrollable element
or because it is already scrolled to the maximum in that direction,
the User Agent will select the next <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container④">spatial navigation focus container</a> up the ancestry chain,
and repeat the process of
looking for eligible focus targets,
selecting the best one if there’s any,
scrolling if not,
going up the ancestry chain if it cannot scroll,
until it has either moved focus,
scrolled,
or reached the root.</p>
   <p>Additionally, when the user has focused a <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scroll-container" id="ref-for-scroll-container">scroll container</a> which contains focusable elements,
the user may move the focus to the nexted elements by pressing <code class="key">Enter</code>.</p>
   <p>The User Agent will then follow a similar logic: first, search for visible and focusable items
within the currently focused <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scroll-container" id="ref-for-scroll-container①">scroll container</a>,
and if there is any,
select the best one and move the focus there.</p>
   <div class="note" role="note">
    Note: This feature is needed because elements inside a scrollable container
are neither to its top, bottom, left or right.
They are inside, and could not be reached otherwise using spatial navigation only. 
    <p class="issue" id="issue-e08bbccb"><a class="self-link" href="#issue-e08bbccb"></a> While this ability is needed, it could be achieved by different mechanisms,
such as for example automatically moving the focus inside of a scroll container
instead of focusing it,
if it contains focusable elements.
The current proposition is felt to be more intuitive for end users.
Feedback appreciated.</p>
   </div>
   <p>At key points during this search for the appropriate response to the spatial navigation request,
the User Agent will fires events.
These enable authors to prevent the upcoming action
(by calling <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-preventdefault" id="ref-for-dom-event-preventdefault">preventDefault()</a></code>),
and if desired to provide an alternate action,
such as using calling the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/interaction.html#dom-focus" id="ref-for-dom-focus">focus()</a></code> method on a different
element of the author’s choosing.</p>
   <p>The following table summarizes the events that may be sent:</p>
   <table class="complex data">
    <thead>
     <tr>
      <td colspan="2">
      <th colspan="2">Attributes of the event 
     <tr>
      <th>Event type 
      <th>Description 
      <th><code class="idl"><a data-link-type="idl" href="#dom-navigationevent-dir" id="ref-for-dom-navigationevent-dir">dir</a></code> 
      <th><code class="idl"><a data-link-type="idl" href="#dom-navigationevent-relatedtarget" id="ref-for-dom-navigationevent-relatedtarget">relatedTarget</a></code> 
    <tbody>
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="NavigationEvent" data-dfn-type="event" data-export="" id="eventdef-navigationevent-navbeforefocus"><code>navbeforefocus</code></dfn> 
      <td>Fired before spatial or <a href="https://html.spec.whatwg.org/multipage/interaction.html#sequential-focus-navigation">sequential</a> navigation changes the focus. 
      <td rowspan="3">The intended direction of the navigation as requested by the user 
      <td>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#dom-anchor" id="ref-for-dom-anchor">DOM anchor</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusable-area" id="ref-for-focusable-area">focusable area</a> that will be focused 
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="NavigationEvent" data-dfn-type="event" data-export="" id="eventdef-navigationevent-navbeforescroll"><code>navbeforescroll</code></dfn> 
      <td>Fired before spatial navigation triggers scrolling 
      <td>The element that will be scrolled 
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="NavigationEvent" data-dfn-type="event" data-export="" id="eventdef-navigationevent-navnotarget"><code>navnotarget</code></dfn> 
      <td>Fired when spatial navigation has failed to find any acceptable candidate to move the focus to
          in the current <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container⑤">spatnav container</a> and when that same <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container⑥">spatnav container</a> cannot be scrolled either,
          before going up the tree to search in the nearest ancestor <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container⑦">spatnav container</a>. 
      <td>The <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container⑧">spatnav container</a> that was searched in. 
   </table>
   <div class="example" id="example-3eadfa70">
    <a class="self-link" href="#example-3eadfa70"></a> In this example, a series of elements are arranged in the <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container⑨">spatial navigation focus container</a>.
	This example allows the arrow keys to move focus among elements within a scrollable <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①⓪">spatial navigation focus container</a> using the <a class="property" data-link-type="propdesc" href="#propdef-spatial-navigation" id="ref-for-propdef-spatial-navigation">spatial-navigation</a> property. 
    <figure>
      <img alt="An image about enabling spatnav using active value" src="images/scroll-spatnav1.png" style="width: 200px;"> <img alt="An image about enabling spatnav using active value" src="images/scroll-spatnav2.png" style="width: 200px;"> 
     <figcaption>Moving focus to the visible element in the <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①①">spatial navigation focus container</a>.</figcaption>
    </figure>
     The left figure shows that the "Box 2" gains focus. After pressing the <code class="key">ArrowDown</code> key, focus moves to
	the "Box 3" without scrolling because the "Box 3" is visible in the viewport of the <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①②">spatial navigation focus container</a>. 
    <figure>
      <img alt="An image about enabling spatnav using active value" src="images/scroll-spatnav2.png" style="width: 200px;"> <img alt="An image about enabling spatnav using active value" src="images/scroll-spatnav3.png" style="width: 200px;"> <img alt="An image about enabling spatnav using active value" src="images/scroll-spatnav4.png" style="width: 200px;"> 
     <figcaption>Moving focus to the hidden element in the <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①③">spatial navigation focus container</a>.</figcaption>
    </figure>
     On the left figure, under the "Box 3", there isn’t any visible element in the viewport. Therefore pressing the <code class="key">ArrowDown</code> key works for moving the scrollbar down until any focusable element comes
	into the viewport as the figure in the middle. When the "Box 4" is visible, it will gain focus. 
    <p>This example uses the markup as follows:</p>
<pre class="lang-css highlight"><span class="nt">#scroller </span><span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="m">700</span><span class="l">px</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="m">700</span><span class="l">px</span><span class="p">;</span>
  <span class="k">overflow-x</span><span class="p">:</span> hidden<span class="p">;</span>
  <span class="k">overflow-y</span><span class="p">:</span> auto<span class="p">;</span>
  <span class="k">spatial-navigation</span><span class="p">:</span> active<span class="p">;</span>
<span class="p">}</span>

<span class="nt">.box </span><span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="m">150</span><span class="l">px</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="m">110</span><span class="l">px</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> blue<span class="p">;</span>
<span class="p">}</span>

<span class="nt">.box:focus </span><span class="p">{</span>
  <span class="k">background-color</span><span class="p">:</span> red<span class="p">;</span>
<span class="p">}</span>
</pre>
<pre class="lang-html highlight"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"scroller"</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"box"</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">"0"</span><span class="p">></span>Box 1<span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"box"</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">"0"</span><span class="p">></span>Box 2<span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"box"</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">"0"</span><span class="p">></span>Box 3<span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"box"</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">"0"</span><span class="p">></span>Box 4<span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">></span>
</pre>
   </div>
   <h2 class="heading settled" data-level="4" id="declarative"><span class="secno">4. </span><span class="content"> Controlling spatial navigation through declarative means</span><a class="self-link" href="#declarative"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="activation"><span class="secno">4.1. </span><span class="content"> Activating Spatial Navigation: the <a class="property" data-link-type="propdesc" href="#propdef-spatial-navigation" id="ref-for-propdef-spatial-navigation①">spatial-navigation</a> property</span><a class="self-link" href="#activation"></a></h3>
   <p>Spatial navigation is said to be <dfn class="dfn-paneled" data-dfn-for="spatnav" data-dfn-type="dfn" data-noexport="" id="spatnav-available">available</dfn> when there is a mechanism available to the user to invoke spatial navigation.</p>
   <p>Spatial navigation is said to be <dfn class="dfn-paneled" data-dfn-for="spatnav" data-dfn-type="dfn" data-noexport="" id="spatnav-active">active</dfn> on an element
when the user can invoke spatial navigation
by pressing the arrow keys without modifier keys
when that element is focused.</p>
   <p>The <a class="property" data-link-type="propdesc" href="#propdef-spatial-navigation" id="ref-for-propdef-spatial-navigation②">spatial-navigation</a> property enables the author to declare
that their document, or part of their document,
has been authored with spatial navigation in mind,
and the User Agent can make spatial navigation <a data-link-type="dfn" href="#spatnav-active" id="ref-for-spatnav-active①">active</a> without risk of interfering with other behavior.</p>
   <table class="def propdef" data-link-for-hint="spatial-navigation">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export="" id="propdef-spatial-navigation">spatial-navigation</dfn>
     <tr class="value">
      <th><a href="https://drafts.csswg.org/css-values/#value-defs">Value:</a>
      <td class="prod">auto <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one">|</a> active
     <tr>
      <th><a href="https://drafts.csswg.org/css-cascade/#initial-values">Initial:</a>
      <td>auto
     <tr>
      <th>Applies to:
      <td><a href="https://drafts.csswg.org/css-pseudo/#generated-content" title="Includes ::before and ::after pseudo-elements.">all elements</a>
     <tr>
      <th><a href="https://drafts.csswg.org/css-cascade/#inherited-property">Inherited:</a>
      <td>yes
     <tr>
      <th><a href="https://drafts.csswg.org/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th>Media:
      <td>visual
     <tr>
      <th><a href="https://drafts.csswg.org/css-cascade/#computed">Computed value:</a>
      <td>as specified
     <tr>
      <th>Canonical order:
      <td>per grammar
     <tr>
      <th><a href="https://drafts.csswg.org/css-transitions/#animatable-properties">Animation type:</a>
      <td>discrete
   </table>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="spatial-navigation" data-dfn-type="value" data-export="" id="valdef-spatial-navigation-auto">auto</dfn> 
    <dd>
     The User Agent defines
	whether spatial navigation is <a data-link-type="dfn" href="#spatnav-available" id="ref-for-spatnav-available">available</a>,
	and if so, which UI mechanisms may trigger the <a data-link-type="dfn" href="#spatial-navigation-steps" id="ref-for-spatial-navigation-steps">spatial navigation steps</a> (e.g. certain key combinations, gestures, buttons in the UI, voice commands…). 
     <p>On devices which do not have any pointing input device,
	and especially on devices such as TVs which also lack a <code class="key">Tab</code> key to control <a data-link-type="dfn" herf="https://html.spec.whatwg.org/multipage/interaction.html#sequential-focus-navigation" href="https://html.spec.whatwg.org/multipage/interaction.html#sequential-focus-navigation" id="ref-for-sequential-focus-navigation">sequential focus navigation</a>,
	User Agents should make spatial navigation <a data-link-type="dfn" href="#spatnav-active" id="ref-for-spatnav-active②">active</a>.</p>
    <dt><dfn class="css" data-dfn-for="spatial-navigation" data-dfn-type="value" data-export="" id="valdef-spatial-navigation-active">active<a class="self-link" href="#valdef-spatial-navigation-active"></a></dfn> 
    <dd>
     The User Agent must make spatial navigation <a data-link-type="dfn" href="#spatnav-active" id="ref-for-spatnav-active③">active</a> on the element. 
     <p>Additionally, User Agents which make spatial navigation <a data-link-type="dfn" href="#spatnav-available" id="ref-for-spatnav-available①">available</a> by other mechanisms
	when the value of <a class="property" data-link-type="propdesc" href="#propdef-spatial-navigation" id="ref-for-propdef-spatial-navigation③">spatial-navigation</a> is <a class="css" data-link-type="maybe" href="#valdef-spatial-navigation-auto" id="ref-for-valdef-spatial-navigation-auto">auto</a> must continue to do so.</p>
   </dl>
   <h3 class="heading settled" data-level="4.2" id="container"><span class="secno">4.2. </span><span class="content"> Establishing focus navigation containers: the <a class="property" data-link-type="propdesc" href="#propdef-spatnav-container" id="ref-for-propdef-spatnav-container①">spatnav-container</a> property</span><a class="self-link" href="#container"></a></h3>
   <p>While spatial navigation works from the layout of the document
and the relative position of focusable elements
in general,
in some cases the User Agent needs to prioritize finding elements
from a local logical grouping,
only looking for focusable elements outside of the grouping
if a suitable one cannot be found inside it.</p>
   <p>Such groupings are called <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="spatial navigation focus container | spatial navigation focus containers | spatnav container | spatnav containers" data-noexport="" id="spatial-navigation-focus-container">spatial navigation focus containers</dfn> (or <strong>spatnav containers</strong> for short),
and are controlled by the <a class="property" data-link-type="propdesc" href="#propdef-spatnav-container" id="ref-for-propdef-spatnav-container②">spatnav-container</a> property.</p>
   <table class="def propdef" data-link-for-hint="spatnav-container">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export="" id="propdef-spatnav-container">spatnav-container</dfn>
     <tr class="value">
      <th><a href="https://drafts.csswg.org/css-values/#value-defs">Value:</a>
      <td class="prod">auto <a data-link-type="grammar" href="https://drafts.csswg.org/css-values-4/#comb-one" id="ref-for-comb-one①">|</a> create
     <tr>
      <th><a href="https://drafts.csswg.org/css-cascade/#initial-values">Initial:</a>
      <td>auto
     <tr>
      <th>Applies to:
      <td><a href="https://drafts.csswg.org/css-pseudo/#generated-content" title="Includes ::before and ::after pseudo-elements.">all elements</a>
     <tr>
      <th><a href="https://drafts.csswg.org/css-cascade/#inherited-property">Inherited:</a>
      <td>no
     <tr>
      <th><a href="https://drafts.csswg.org/css-values/#percentages">Percentages:</a>
      <td>n/a
     <tr>
      <th>Media:
      <td>visual
     <tr>
      <th><a href="https://drafts.csswg.org/css-cascade/#computed">Computed value:</a>
      <td>as specified
     <tr>
      <th>Canonical order:
      <td>per grammar
     <tr>
      <th><a href="https://drafts.csswg.org/css-transitions/#animatable-properties">Animation type:</a>
      <td>discrete
   </table>
   <p class="issue" id="issue-f2a24612"><a class="self-link" href="#issue-f2a24612"></a> Bikeshedding: Are we OK with abbreviations?
Should this be spatial-navigation-container?
Is that too long, or does it make it seem like a longhand?
Should we go with navigation-container instead?
Doesn’t that suggest it would do something for sequential navigation too?</p>
   <dl>
    <dt><dfn class="css" data-dfn-for="spatnav-container" data-dfn-type="value" data-export="" id="valdef-spatnav-container-auto">auto<a class="self-link" href="#valdef-spatnav-container-auto"></a></dfn> 
    <dd>If the element is either
	the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#document-element" id="ref-for-document-element">document element</a> of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context" id="ref-for-browsing-context">browsing context</a>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a> (not limited to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing context</a>)
	or
	a <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scroll-container" id="ref-for-scroll-container②">scroll container</a> then it establishes a <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①④">spatial navigation focus container</a>,
	otherwise it does not. 
    <dt><dfn class="css" data-dfn-for="spatnav-container" data-dfn-type="value" data-export="" id="valdef-spatnav-container-create">create<a class="self-link" href="#valdef-spatnav-container-create"></a></dfn> 
    <dd>The element establishes a <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①⑤">spatial navigation focus container</a> 
   </dl>
   <p>See <a href="#overview">§3 Overview</a> for a high level description of how <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①⑥">spatial navigation focus containers</a> affects the behavior of spatial navigation,
and <a href="#processing-model">§6 Processing Model</a> for details.</p>
   <h2 class="heading settled" data-level="5" id="js-api"><span class="secno">5. </span><span class="content"> Javascript API</span><a class="self-link" href="#js-api"></a></h2>
   <p class="note" role="note"><span>Note:</span> The events and APIs described in this section relate both to spatial navigation
and to sequential navigation.</p>
<pre class="idl highlight def"><span class="kt">enum</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="enum" data-export="" id="enumdef-navigationdirection"><code>NavigationDirection</code></dfn> {
  <dfn class="s dfn-paneled idl-code" data-dfn-for="NavigationDirection" data-dfn-type="enum-value" data-export="" data-lt="&quot;up&quot;|up" id="dom-navigationdirection-up"><code>"up"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="NavigationDirection" data-dfn-type="enum-value" data-export="" data-lt="&quot;down&quot;|down" id="dom-navigationdirection-down"><code>"down"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="NavigationDirection" data-dfn-type="enum-value" data-export="" data-lt="&quot;left&quot;|left" id="dom-navigationdirection-left"><code>"left"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="NavigationDirection" data-dfn-type="enum-value" data-export="" data-lt="&quot;right&quot;|right" id="dom-navigationdirection-right"><code>"right"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="NavigationDirection" data-dfn-type="enum-value" data-export="" data-lt="&quot;forward&quot;|forward" id="dom-navigationdirection-forward"><code>"forward"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="NavigationDirection" data-dfn-type="enum-value" data-export="" data-lt="&quot;backward&quot;|backward" id="dom-navigationdirection-backward"><code>"backward"</code></dfn>,
  <dfn class="s dfn-paneled idl-code" data-dfn-for="NavigationDirection" data-dfn-type="enum-value" data-export="" data-lt="&quot;inside&quot;|inside" id="dom-navigationdirection-inside"><code>"inside"</code></dfn>
};

[<dfn class="nv idl-code" data-dfn-for="NavigationEvent" data-dfn-type="constructor" data-export="" data-lt="NavigationEvent(type, eventInitDict)|NavigationEvent(type)" id="dom-navigationevent-navigationevent"><code>Constructor</code><a class="self-link" href="#dom-navigationevent-navigationevent"></a></dfn>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><span class="kt">DOMString</span></a> <dfn class="nv idl-code" data-dfn-for="NavigationEvent/NavigationEvent(type, eventInitDict)" data-dfn-type="argument" data-export="" id="dom-navigationevent-navigationevent-type-eventinitdict-type"><code>type</code><a class="self-link" href="#dom-navigationevent-navigationevent-type-eventinitdict-type"></a></dfn>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-navigationeventinit" id="ref-for-dictdef-navigationeventinit">NavigationEventInit</a> <dfn class="nv idl-code" data-dfn-for="NavigationEvent/NavigationEvent(type, eventInitDict)" data-dfn-type="argument" data-export="" id="dom-navigationevent-navigationevent-type-eventinitdict-eventinitdict"><code>eventInitDict</code><a class="self-link" href="#dom-navigationevent-navigationevent-type-eventinitdict-eventinitdict"></a></dfn>)]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="navigationevent"><code>NavigationEvent</code></dfn> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/uievents/#uievent-uievent" id="ref-for-uievent-uievent">UIEvent</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#enumdef-navigationdirection" id="ref-for-enumdef-navigationdirection">NavigationDirection</a> <dfn class="nv dfn-paneled idl-code" data-dfn-for="NavigationEvent" data-dfn-type="attribute" data-export="" data-readonly="" data-type="NavigationDirection" id="dom-navigationevent-dir"><code>dir</code></dfn>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget">EventTarget</a>? <dfn class="nv dfn-paneled idl-code" data-dfn-for="NavigationEvent" data-dfn-type="attribute" data-export="" data-readonly="" data-type="EventTarget?" id="dom-navigationevent-relatedtarget"><code>relatedTarget</code></dfn>;
};

<span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-navigationeventinit"><code>NavigationEventInit</code></dfn> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/uievents/#dictdef-uieventinit-uieventinit" id="ref-for-dictdef-uieventinit-uieventinit">UIEventInit</a> {
  <span class="kt">required</span> <a class="n" data-link-type="idl-name" href="#enumdef-navigationdirection" id="ref-for-enumdef-navigationdirection①">NavigationDirection</a> <dfn class="nv idl-code" data-dfn-for="NavigationEventInit" data-dfn-type="dict-member" data-export="" data-type="NavigationDirection " id="dom-navigationeventinit-dir"><code>dir</code><a class="self-link" href="#dom-navigationeventinit-dir"></a></dfn>;
  <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget①">EventTarget</a>? <dfn class="nv idl-code" data-default="null" data-dfn-for="NavigationEventInit" data-dfn-type="dict-member" data-export="" data-type="EventTarget? " id="dom-navigationeventinit-relatedtarget"><code>relatedTarget</code><a class="self-link" href="#dom-navigationeventinit-relatedtarget"></a></dfn> = <span class="kt">null</span>;
};
</pre>
   <p class="note" role="note"><span>Note:</span> The way the direction is expressed allows us to expand to more than 4-way navigation
later of if this is found necessary.
More directional keywords or a numerical angle could be added.</p>
   <p>See <a href="#overview">§3 Overview</a> for a high level description of the various types of <code class="idl"><a data-link-type="idl" href="#navigationevent" id="ref-for-navigationevent">NavigationEvent</a></code> which may be dispatched,
and <a href="#processing-model">§6 Processing Model</a> for details.</p>
<pre class="idl highlight def"><span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-findfocusableoptions"><code>FindFocusableOptions</code></dfn> {
  <span class="kt">required</span> <a class="n" data-link-type="idl-name" href="#enumdef-navigationdirection" id="ref-for-enumdef-navigationdirection②">NavigationDirection</a> <dfn class="nv idl-code" data-dfn-for="FindFocusableOptions" data-dfn-type="dict-member" data-export="" data-type="NavigationDirection " id="dom-findfocusableoptions-dir"><code>dir</code><a class="self-link" href="#dom-findfocusableoptions-dir"></a></dfn>;
};

<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#element" id="ref-for-element">Element</a> {
  <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#element" id="ref-for-element①">Element</a>? <dfn class="nv dfn-paneled idl-code" data-dfn-for="Element" data-dfn-type="method" data-export="" data-lt="findFocusable(arg)" id="dom-element-findfocusable"><code>findFocusable</code></dfn>(<a class="n" data-link-type="idl-name" href="#dictdef-findfocusableoptions" id="ref-for-dictdef-findfocusableoptions">FindFocusableOptions</a> <dfn class="nv idl-code" data-dfn-for="Element/findFocusable(arg)" data-dfn-type="argument" data-export="" id="dom-element-findfocusable-arg-arg"><code>arg</code><a class="self-link" href="#dom-element-findfocusable-arg-arg"></a></dfn>);
};
</pre>
   <p>Calling <code class="idl"><a data-link-type="idl" href="#dom-element-findfocusable" id="ref-for-dom-element-findfocusable">findFocusable()</a></code> on an element
allows the author to find which element would be focused, if any,
if the user were to attempt spatial (in the case of <code class="idl"><a data-link-type="idl" href="#dom-navigationdirection-up" id="ref-for-dom-navigationdirection-up">up</a></code>, <code class="idl"><a data-link-type="idl" href="#dom-navigationdirection-down" id="ref-for-dom-navigationdirection-down">down</a></code>, <code class="idl"><a data-link-type="idl" href="#dom-navigationdirection-right" id="ref-for-dom-navigationdirection-right">right</a></code>, <code class="idl"><a data-link-type="idl" href="#dom-navigationdirection-left" id="ref-for-dom-navigationdirection-left">left</a></code>), or <code class="idl"><a data-link-type="idl" href="#dom-navigationdirection-inside" id="ref-for-dom-navigationdirection-inside">inside</a></code> or sequential (in the case of <code class="idl"><a data-link-type="idl" href="#dom-navigationdirection-forward" id="ref-for-dom-navigationdirection-forward">forward</a></code> or <code class="idl"><a data-link-type="idl" href="#dom-navigationdirection-backward" id="ref-for-dom-navigationdirection-backward">backward</a></code>)
navigation while that element has the focus.</p>
   <p>The result of calling this method is the same as running the <a data-link-type="dfn" href="#navigation-steps" id="ref-for-navigation-steps">navigation steps</a>,
except that:</p>
   <ul>
    <li data-md="">
     <p>The various events are not fired, and the steps should proceed as if they had returned <code>true</code></p>
    <li data-md="">
     <p>Running the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps" id="ref-for-focusing-steps">focusing steps</a> is replaced by returning the value</p>
   </ul>
   <p class="issue" id="issue-36f1c95a"><a class="self-link" href="#issue-36f1c95a"></a> Should we instead provide lower level methods to expose <a data-link-type="dfn" href="#find-candidates" id="ref-for-find-candidates">finding candidates</a> and <a data-link-type="dfn" href="#select-the-best-candidate" id="ref-for-select-the-best-candidate">selecting the best candidate</a>?</p>
   <h2 class="heading settled" data-level="6" id="processing-model"><span class="secno">6. </span><span class="content"> Processing Model</span><a class="self-link" href="#processing-model"></a></h2>
   <p>The <a href="#overview">§3 Overview</a> section gives a high level idea of how spatial navigation works,
to help readers of this specification build a general mental model.
It uses intuitive but imprecise terminology,
and glosses over many details
for the sake of readability.</p>
   <p>This section defines the corresponding normative behavior
and aims for as much detail as necessary
to fully define the behavior.
This include integration with sequential navigation.</p>
   <p class="note" role="note"><span>Note:</span> Much of section is monkey patches on other specs,
and should in the long term be integrated back into them.
This is all specified here for now in order to explore and incubate
this topic.</p>
   <p class="issue" id="issue-334ee4b3"><a class="self-link" href="#issue-334ee4b3"></a> The following currently does not account
for <a href="https://github.com/WICG/overscroll-behavior">the proposed overscroll-behavior specification</a>.</p>
   <p class="issue" id="issue-e0cc24e0"><a class="self-link" href="#issue-e0cc24e0"></a> The following does not take shadow dom into account.</p>
   <h3 class="heading settled" data-level="6.1" id="key-presses"><span class="secno">6.1. </span><span class="content"> Handling key presses</span><a class="self-link" href="#key-presses"></a></h3>
   <div class="algorithm" data-algorithm="react to key presses">
    <p class="issue" id="issue-9ca6a131"><a class="self-link" href="#issue-9ca6a131"></a> This should be a extension of <a data-link-type="biblio" href="#biblio-ui-events">[UI-EVENTS]</a>'s processing model
(or a monkey-patch over it if it were not extensible),
but <a data-link-type="biblio" href="#biblio-ui-events">[UI-EVENTS]</a> does not have a fully defined processing model.
It does define the events, but does not define the algorithm which
is supposed to dispatch them and respond to cancelation and so on.
Therefore, this is being written as (a rough sketch of) what that
model should be.
Once this is sufficiently detailed and tested, this should be turned into
a pull request against <a data-link-type="biblio" href="#biblio-ui-events">[UI-EVENTS]</a>.</p>
    <p>There is a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="navigation-starting-point">navigation starting point</dfn>, initially unset.
The user agent may set it when the user indicates that it should be moved.</p>
    <p class="note" role="note"><span>Note:</span> The user agent could set it to the position of the user’s click if the user clicks on the document contents.</p>
    <p class="issue" id="issue-49a79fa5"><a class="self-link" href="#issue-49a79fa5"></a> The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps" id="ref-for-focusing-steps①">focusing steps</a> should probably reset the <a data-link-type="dfn" href="#navigation-starting-point" id="ref-for-navigation-starting-point">navigation starting point</a></p>
    <p>When the user presses a key on the keyboard,
the following steps are run to <dfn data-dfn-type="dfn" data-noexport="" id="react-to-key-presses">react to key presses<a class="self-link" href="#react-to-key-presses"></a></dfn>.</p>
    <ol>
     <li data-md="">
      <p>Let <var>eventTarget</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#dom-anchor" id="ref-for-dom-anchor①">DOM anchor</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#currently-focused-area-of-a-top-level-browsing-context" id="ref-for-currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a>.</p>
     <li data-md="">
      <p>If <var>eventTarget</var> is the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">Document</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context①">top-level browsing context</a> set <var>eventTarget</var> to <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/dom.html#the-body-element-2" id="ref-for-the-body-element-2">the body element</a> if it is not <code>null</code> or
to the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#document-element" id="ref-for-document-element①">document element</a> otherwise.</p>
     <li data-md="">
      <p>If the <a data-link-type="dfn" href="#navigation-starting-point" id="ref-for-navigation-starting-point①">navigation starting point</a> is not <code>null</code> and it is a descendant of <var>eventTarget</var> then let <var>startingPoint</var> be the <a data-link-type="dfn" href="#navigation-starting-point" id="ref-for-navigation-starting-point②">navigation starting point</a>,
else let <var>startingPoint</var> be <var>eventTarget</var>.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire">Fire an event</a> named <a class="idl-code" data-link-type="event" href="https://w3c.github.io/uievents/#keydown" id="ref-for-keydown">keydown</a> at <var>eventTarget</var> using <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#keyboardevent-keyboardevent" id="ref-for-keyboardevent-keyboardevent">KeyboardEvent</a></code> with its arguments initialized as per <a href="https://www.w3.org/TR/uievents/#event-type-keydown">UI Events §event-type-keydown</a> and let <var>actOnKeyPress</var> be the result.</p>
     <li data-md="">
      <p>If <var>actOnKeyPress</var> is <code>false</code>, return</p>
     <li data-md="">
      <p>If the element is an editing host or a descendent of one,
or an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-textarea-element" id="ref-for-the-textarea-element">textarea</a></code> element,
or an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/input.html#the-input-element" id="ref-for-the-input-element">input</a></code> element comprising a text control
then…</p>
      <p class="issue" id="issue-4d6f723c"><a class="self-link" href="#issue-4d6f723c"></a> …invoke beforeinput events, execcommand, IMEs, input events, and numerous details…<br> However, a key point here is that if the caret is at the beggining (resp. end) of the content,
and the user presses an arrow key to go up or left (resp. down or right),
and there’s no IME or similar thing consuming that key,
then we should jump to point 11.1</p>
     <li data-md="">
      <p>Else if the key is .... and the modifiers are ..., then ....</p>
     <li data-md="">
      <p>Else if the key is enter</p>
      <ul>
       <li data-md="">
        <p>If the <var>eventTarget</var> has an <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#eventtarget-activation-behavior" id="ref-for-eventtarget-activation-behavior">activation behavior</a>,</p>
        <ol>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire①">Fire an event</a> named <a class="idl-code" data-link-type="event" href="https://w3c.github.io/uievents/#click" id="ref-for-click">click</a> at <var>eventTarget</var> using <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent">MouseEvent</a></code> with its arguments initialized as per <a href="https://www.w3.org/TR/uievents/#click">UI Events §click</a> and let <var>actOnClick</var> be the result.</p>
         <li data-md="">
          <p>If <var>actOnClick</var> is <code>false</code>, return</p>
         <li data-md="">
          <p>Initiate the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#eventtarget-activation-behavior" id="ref-for-eventtarget-activation-behavior①">activation behavior</a> (See <a href="https://www.w3.org/TR/uievents/#event-flow-activation">UI Events §event-flow-activation</a>) then return.</p>
        </ol>
       <li data-md="">
        <p>Else, if spatial navigation is <a data-link-type="dfn" href="#spatnav-active" id="ref-for-spatnav-active④">active</a> on <var>eventTarget</var> and <var>eventTarget</var> is a <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scroll-container" id="ref-for-scroll-container③">scroll container</a>,
run the <a data-link-type="dfn" href="#navigation-steps" id="ref-for-navigation-steps①">navigation steps</a> on <var>eventTarget</var> in direction <code>inside</code>,
then return</p>
      </ul>
     <li data-md="">
      <p class="issue" id="issue-20bb12bb"><a class="self-link" href="#issue-20bb12bb"></a> … more of the same, handling all sorts of keys in various situations …</p>
     <li data-md="">
      <p>Else, if the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-key" id="ref-for-dom-keyboardevent-key">key</a></code> is <code class="key">"Tab"</code> and all of <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-ctrlkey" id="ref-for-dom-keyboardevent-ctrlkey">ctrlKey</a></code>, <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-altkey" id="ref-for-dom-keyboardevent-altkey">altKey</a></code> and <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-metakey" id="ref-for-dom-keyboardevent-metakey">metaKey</a></code> are <code>false</code>,
run the <a data-link-type="dfn" href="#navigation-steps" id="ref-for-navigation-steps②">navigation steps</a> on <var>eventTarget</var> from <var>startingPoint</var> in the <code>forward</code> direction if <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-shiftkey" id="ref-for-dom-keyboardevent-shiftkey">shiftKey</a></code> is <code>false</code> or in the <code>backward</code> direction if it is <code>true</code>,
then return</p>
     <li data-md="">
      <p>Else, if the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-key" id="ref-for-dom-keyboardevent-key①">key</a></code> is one of <code class="key">ArrowUp</code>,<code class="key">ArrowDown</code>, <code class="key">ArrowLeft</code>, or <code class="key">ArrowRight</code>:</p>
      <ol>
       <li data-md="">
        <p>Let <var>dir</var> be:</p>
        <ul>
         <li data-md="">
          <p><code>up</code> if the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-key" id="ref-for-dom-keyboardevent-key②">key</a></code> is <code class="key">ArrowUp</code></p>
         <li data-md="">
          <p><code>down</code> if the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-key" id="ref-for-dom-keyboardevent-key③">key</a></code> is <code class="key">ArrowDown</code></p>
         <li data-md="">
          <p><code>left</code> if the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-key" id="ref-for-dom-keyboardevent-key④">key</a></code> is <code class="key">ArrowLeft</code></p>
         <li data-md="">
          <p><code>right</code> if the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-key" id="ref-for-dom-keyboardevent-key⑤">key</a></code> is <code class="key">ArrowRight</code></p>
        </ul>
       <li data-md="">
        <p>If <var>eventTarget</var> is a (form) control that reacts to arrow keys,
do that then return</p>
        <p class="issue" id="issue-0caac161"><a class="self-link" href="#issue-0caac161"></a> define a nice hook so that elements can be specified to react to arrow keys</p>
       <li data-md="">
        <p>Else, if <var>eventTarget</var> is a <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scroll-container" id="ref-for-scroll-container④">scroll container</a> that <a data-link-type="dfn" href="#can-be-manually-scrolled" id="ref-for-can-be-manually-scrolled">can be manually scrolled</a> in <var>dir</var> <a data-link-type="dfn" href="#directionally-scroll-an-element" id="ref-for-directionally-scroll-an-element">directionally scroll the element</a> <var>eventTarget</var> in the direction <var>dir</var> then return.</p>
       <li data-md="">
        <p>Else, if spatial navigation is <a data-link-type="dfn" href="#spatnav-active" id="ref-for-spatnav-active⑤">active</a> on <var>eventTarget</var> run the <a data-link-type="dfn" href="#navigation-steps" id="ref-for-navigation-steps③">navigation steps</a> on <var>eventTarget</var> in direction <var>dir</var> from <var>startingPoint</var>,
then return</p>
       <li data-md="">
        <p>Else, let <var>ancestor</var> be the nearest ancestor of <var>startingPoint</var> that is a <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scroll-container" id="ref-for-scroll-container⑤">scroll container</a> that <a data-link-type="dfn" href="#can-be-manually-scrolled" id="ref-for-can-be-manually-scrolled①">can be scrolled manually</a>,
including in <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ancestor-browsing-context" id="ref-for-ancestor-browsing-context">ancestor browsing contexts</a>,
or <code>null</code> if no such element can be found.</p>
        <p>If <var>ancestor</var> is <code>null</code>,
return,
otherwise <a data-link-type="dfn" href="#directionally-scroll-an-element" id="ref-for-directionally-scroll-an-element①">directionally scroll the element</a> <var>ancestor</var> in the direction <var>dir</var> then return.</p>
        <p class="issue" id="issue-6b95c421"><a class="self-link" href="#issue-6b95c421"></a> This is how Chrome and Safari do it.
Firefox only looks at the first ancestor of <var>startingPoint</var>,
and if that cannot be manually scrolled,
it stops there rather than look further up the ancestry chain.</p>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.2" id="scrolling"><span class="secno">6.2. </span><span class="content"> Scrolling</span><a class="self-link" href="#scrolling"></a></h3>
   <div class="algorithm" data-algorithm="can be manually scrolled">
    <p class="issue" id="issue-56c2d572"><a class="self-link" href="#issue-56c2d572"></a> Terminology like this should be in <a data-link-type="biblio" href="#biblio-cssom-view-1">[CSSOM-VIEW-1]</a>, <a data-link-type="biblio" href="#biblio-css-overflow-3">[CSS-OVERFLOW-3]</a>, <a data-link-type="biblio" href="#biblio-css-scroll-snap-1">[CSS-SCROLL-SNAP-1]</a>.</p>
    <p>An element <var>e</var> <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="can be manually scrolled | can be scrolled manually | cannot be scrolled manually | cannot be manually scrolled" data-noexport="" id="can-be-manually-scrolled">can be manually scrolled</dfn> in a given direction <var>d</var> if:</p>
    <ul>
     <li data-md="">
      <p>The <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#principal-box" id="ref-for-principal-box">principal box</a> established by <var>e</var> is a <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scroll-container" id="ref-for-scroll-container⑥">scroll container</a>, and</p>
     <li data-md="">
      <p>if <var>d</var> is <code>up</code> or <code>down</code>, the computed value of the <a class="property" data-link-type="propdesc" href="https://drafts.csswg.org/css-overflow-3/#propdef-overflow-y" id="ref-for-propdef-overflow-y">overflow-y</a> property is not <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-overflow-3/#valdef-overflow-hidden" id="ref-for-valdef-overflow-hidden">hidden</a>, and</p>
     <li data-md="">
      <p>if <var>d</var> is <code>left</code> or <code>right</code>, the computed value of the <a class="property" data-link-type="propdesc" href="https://drafts.csswg.org/css-overflow-3/#propdef-overflow-x" id="ref-for-propdef-overflow-x">overflow-x</a> property is not <a class="css" data-link-type="maybe" href="https://drafts.csswg.org/css-overflow-3/#valdef-overflow-hidden" id="ref-for-valdef-overflow-hidden①">hidden</a>, and</p>
     <li data-md="">
      <p><var>e</var> is not at the <a data-link-type="dfn" href="https://wicg.github.io/overscroll-behavior/#scroll-boundary" id="ref-for-scroll-boundary">scroll boundary</a> in the direction <var>d</var></p>
     <li data-md="">
      <p class="issue" id="issue-47978a70"><a class="self-link" href="#issue-47978a70"></a> Take mandatory scroll snappoints into account</p>
    </ul>
   </div>
   <div class="algorithm" data-algorithm="to directionally scroll an element">
    <p class="issue" id="issue-9297fdfc"><a class="self-link" href="#issue-9297fdfc"></a> <a data-link-type="biblio" href="#biblio-cssom-view-1">[CSSOM-VIEW-1]</a> should probably define
how to perform a scroll in a given direction without an explicit position.
Until then, we roll our own.</p>
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="directionally scroll an element | directionally scroll the element" data-noexport="" id="directionally-scroll-an-element">directionally scroll an element</dfn> <var>e</var> in direction <var>dir</var>:</p>
    <ol>
     <li data-md="">
      <p>Let <var>d</var> be a User Agent defined distance.</p>
     <li data-md="">
      <p>Let <var>x</var> be <var>e</var>’s current scroll position on the x axis.</p>
     <li data-md="">
      <p>Let <var>y</var> be <var>e</var>’s current scroll position on the y axis.</p>
     <li data-md="">
      <p>Use the <a data-link-type="dfn" href="https://drafts.csswg.org/cssom-view-1/#scroll-an-element" id="ref-for-scroll-an-element">scroll an element</a> algorithm from <a data-link-type="biblio" href="#biblio-cssom-view-1">[CSSOM-VIEW-1]</a> on <var>e</var> to</p>
      <ul>
       <li data-md="">
        <p>(<var>x</var>, <var>y</var> - <var>d</var>) if <var>dir</var> is <code>up</code></p>
       <li data-md="">
        <p>(<var>x</var>, <var>y</var> + <var>d</var>) if <var>dir</var> is <code>down</code></p>
       <li data-md="">
        <p>(<var>x</var> - <var>d</var>, <var>y</var>) if <var>dir</var> is <code>left</code></p>
       <li data-md="">
        <p>(<var>x</var> + <var>d</var>, <var>y</var>) if <var>dir</var> is <code>right</code></p>
      </ul>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.3" id="nav"><span class="secno">6.3. </span><span class="content"> Navigation</span><a class="self-link" href="#nav"></a></h3>
   <div class="algorithm" data-algorithm="to run the navigation steps">
     To run the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="navigation-steps">navigation steps</dfn> in <var>direction</var> on <var>eventTarget</var> from <var>startingPoint</var>, do the following: 
    <ul>
     <li data-md="">
      <p>If <var>direction</var> is <code>forward</code> or <code>backward</code>,
run step 1 through 9 of <a href="https://html.spec.whatwg.org/multipage/interaction.html#sequential-focus-navigation">the HTML steps for sequential navigation</a>,
with one change:
between step 5 and 6, add the following:</p>
      <blockquote>
       <p>5.5. if <var>candidate</var> is not <code>null</code>, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire②">Fire an event</a> named <a class="idl-code" data-link-type="event" href="#eventdef-navigationevent-navbeforefocus" id="ref-for-eventdef-navigationevent-navbeforefocus">navbeforefocus</a> at <var>eventTarget</var> using <code class="idl"><a data-link-type="idl" href="#navigationevent" id="ref-for-navigationevent①">NavigationEvent</a></code> with its <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-dir" id="ref-for-dom-navigationevent-dir①">dir</a></code> set to <var>direction</var> and <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-relatedtarget" id="ref-for-dom-navigationevent-relatedtarget①">relatedTarget</a></code> set to <var>candidate</var> and return if the result is false</p>
       <p class="issue" id="issue-8eb25daf"><a class="self-link" href="#issue-8eb25daf"></a> This is a monkeypatch on <a data-link-type="biblio" href="#biblio-html">[HTML]</a>.
Eventually this should be upstreamed:
modify the steps as described here,
and give them a name (“the sequential navigation steps”?) so that they can be invoked.</p>
      </blockquote>
      <p>Then, return.</p>
     <li data-md="">
      <p>Else if <var>direction</var> is <code>inside</code>,
run the <a data-link-type="dfn" href="#navigate-inside-steps" id="ref-for-navigate-inside-steps">navigate inside steps</a> on <var>eventTarget</var>,</p>
     <li data-md="">
      <p>Else (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">assert</a>: <var>direction</var> is one of <code>up</code>, <code>down</code>, <code>left</code>, or <code>right</code>),
run the <a data-link-type="dfn" href="#spatial-navigation-steps" id="ref-for-spatial-navigation-steps①">spatial navigation steps</a> in <var>direction</var> from <var>startingPoint</var>.</p>
    </ul>
   </div>
   <div class="algorithm" data-algorithm="to run the spatial navigation steps">
     To run the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="spatial-navigation-steps">spatial navigation steps</dfn> in <var>direction</var> from <var>startingPoint</var>, do the following: 
    <ol>
     <li data-md="">
      <p>Let <var>eventTarget</var> be <var>startingPoint</var> if <var>startingPoint</var> is an element,
or let <var>eventTarget</var> be the element which contains <var>startingPoint</var> if <var>startingPoint</var> is a position.
(<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">assert</a>: There is no other alternative)</p>
     <li data-md="">
      <p>Let <var>container</var> be the nearest ancestor of <var>eventTarget</var> that is a <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①⑦">spatnav container</a>.</p>
     <li data-md="">
      <p><i>Loop</i>: Let <var>candidates</var> be the result of <a data-link-type="dfn" href="#find-candidates" id="ref-for-find-candidates①">finding candidates</a> within <var>container</var> in <var>direction</var> starting from <var>startingPoint</var></p>
     <li data-md="">
      <p>If <var>candidates</var> is <code>null</code>:</p>
      <ul>
       <li data-md="">
        <p>If <var>container</var> is a <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scroll-container" id="ref-for-scroll-container⑦">scroll container</a> that <a data-link-type="dfn" href="#can-be-manually-scrolled" id="ref-for-can-be-manually-scrolled②">can be manually scrolled</a>:</p>
        <ol>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire③">Fire an event</a> named <a class="idl-code" data-link-type="event" href="#eventdef-navigationevent-navbeforescroll" id="ref-for-eventdef-navigationevent-navbeforescroll">navbeforescroll</a> at <var>eventTarget</var> using <code class="idl"><a data-link-type="idl" href="#navigationevent" id="ref-for-navigationevent②">NavigationEvent</a></code> with its <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-dir" id="ref-for-dom-navigationevent-dir②">dir</a></code> set to <var>direction</var> and <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-relatedtarget" id="ref-for-dom-navigationevent-relatedtarget②">relatedTarget</a></code> set to <var>container</var>,
and let <var>allowScroll</var> be the result.</p>
         <li data-md="">
          <p>If <var>allowScroll</var> is <code>true</code>,
then return <a data-link-type="dfn" href="#directionally-scroll-an-element" id="ref-for-directionally-scroll-an-element②">Directionally scroll the element</a> <var>container</var> in <var>direction</var> the return,
else return.</p>
        </ol>
       <li data-md="">
        <p>Else,</p>
        <ol>
         <li data-md="">
          <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire④">Fire an event</a> named <a class="idl-code" data-link-type="event" href="#eventdef-navigationevent-navnotarget" id="ref-for-eventdef-navigationevent-navnotarget">navnotarget</a> at <var>eventTarget</var> using <code class="idl"><a data-link-type="idl" href="#navigationevent" id="ref-for-navigationevent③">NavigationEvent</a></code> with its <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-dir" id="ref-for-dom-navigationevent-dir③">dir</a></code> set to <var>direction</var> and <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-relatedtarget" id="ref-for-dom-navigationevent-relatedtarget③">relatedTarget</a></code> set to <var>container</var>,
and return if the result is <code>false</code>.</p>
         <li data-md="">
          <ul>
           <li data-md="">
            <p>If <var>container</var> is the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#document-element" id="ref-for-document-element②">document element</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context" id="ref-for-top-level-browsing-context②">top-level browsing context</a>,
then return.
The User Agent may transfer focus to its own controls (if any) honouring <var>direction</var>.</p>
           <li data-md="">
            <p>Else, if <var>container</var> is the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#document-element" id="ref-for-document-element③">document element</a> of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context" id="ref-for-nested-browsing-context">nested browsing context</a> then:</p>
            <ol>
             <li data-md="">
              <p>Set <var>startingPoint</var> to <var>container</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container" id="ref-for-browsing-context-container">browsing context container</a></p>
             <li data-md="">
              <p>Set <var>eventTarget</var> be <var>startingPoint</var></p>
             <li data-md="">
              <p>Set <var>container</var> to the nearest ancestor of <var>startingPoint</var> that is a <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①⑧">spatnav container</a>.</p>
             <li data-md="">
              <p>Return to the step labeled <i>loop</i>.</p>
            </ol>
            <p class="issue" id="issue-d6bc89a9"><a class="self-link" href="#issue-d6bc89a9"></a> is it sane from a security standpoint that this propagates up from iframes?</p>
           <li data-md="">
            <p>Else, set <var>container</var> to its closest ancester that is itself a <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container①⑨">spatnav container</a> and return to the step labeled <i>loop</i>.</p>
          </ul>
        </ol>
      </ul>
     <li data-md="">
      <p>Let <var>bestCandidate</var> be the result of <a data-link-type="dfn" href="#select-the-best-candidate" id="ref-for-select-the-best-candidate①">selecting the best candidate</a> within <var>candidates</var> in <var>direction</var> starting from <var>startingPoint</var></p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire⑤">Fire an event</a> named <a class="idl-code" data-link-type="event" href="#eventdef-navigationevent-navbeforefocus" id="ref-for-eventdef-navigationevent-navbeforefocus①">navbeforefocus</a> at <var>eventTarget</var> using <code class="idl"><a data-link-type="idl" href="#navigationevent" id="ref-for-navigationevent④">NavigationEvent</a></code> with its <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-dir" id="ref-for-dom-navigationevent-dir④">dir</a></code> set to <var>direction</var> and <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-relatedtarget" id="ref-for-dom-navigationevent-relatedtarget④">relatedTarget</a></code> set to <var>bestCandidate</var>,
and let <var>allowFocusChange</var> be the result.</p>
     <li data-md="">
      <p>If <var>allowFocusChange</var> is <code>false</code>, return</p>
     <li data-md="">
      <p>Run the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps" id="ref-for-focusing-steps②">focusing steps</a> for <var>bestCandidate</var> and return</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="to run the navigate inside steps">
     To run the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="navigate-inside-steps">navigate inside steps</dfn> on <var>eventTarget</var>, do the following: 
    <ol>
     <li data-md="">
      <p>Let <var>candidates</var> be the result of <a data-link-type="dfn" href="#find-candidates" id="ref-for-find-candidates②">finding candidates</a> within <var>eventTarget</var> starting from <var>eventTarget</var></p>
     <li data-md="">
      <p>If <var>candidates</var> is <code>null</code>, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire⑥">Fire an event</a> named <a class="idl-code" data-link-type="event" href="#eventdef-navigationevent-navnotarget" id="ref-for-eventdef-navigationevent-navnotarget①">navnotarget</a> at <var>eventTarget</var> using <code class="idl"><a data-link-type="idl" href="#navigationevent" id="ref-for-navigationevent⑤">NavigationEvent</a></code> with its <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-dir" id="ref-for-dom-navigationevent-dir⑤">dir</a></code> set to <code>inside</code> and <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-relatedtarget" id="ref-for-dom-navigationevent-relatedtarget⑤">relatedTarget</a></code> set to <var>eventTarget</var>,
then return.</p>
     <li data-md="">
      <p>Let <var>bestCandidate</var> be the result of <a data-link-type="dfn" href="#select-the-best-candidate" id="ref-for-select-the-best-candidate②">selecting the best candidate</a> within <var>candidates</var> starting from the <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#inline-start" id="ref-for-inline-start">inline start</a> <a data-link-type="dfn" href="https://drafts.csswg.org/css-writing-modes-4/#block-start" id="ref-for-block-start">block start</a> corner of <var>eventTarget</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scrollport" id="ref-for-scrollport">scrollport</a>.</p>
     <li data-md="">
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire⑦">Fire an event</a> named <a class="idl-code" data-link-type="event" href="#eventdef-navigationevent-navbeforefocus" id="ref-for-eventdef-navigationevent-navbeforefocus②">navbeforefocus</a> at <var>eventTarget</var> using <code class="idl"><a data-link-type="idl" href="#navigationevent" id="ref-for-navigationevent⑥">NavigationEvent</a></code> with its <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-dir" id="ref-for-dom-navigationevent-dir⑥">dir</a></code> set to <code>inside</code> and <code class="idl"><a data-link-type="idl" href="#dom-navigationevent-relatedtarget" id="ref-for-dom-navigationevent-relatedtarget⑥">relatedTarget</a></code> set to <var>bestCandidate</var>,
and let <var>allowFocusChange</var> be the result.</p>
     <li data-md="">
      <p>If <var>allowFocusChange</var> is <code>false</code>, return</p>
     <li data-md="">
      <p>Run the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps" id="ref-for-focusing-steps③">focusing steps</a> for <var>bestCandidate</var> and return</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.4" id="heuristics"><span class="secno">6.4. </span><span class="content"> Focus Navigation Heuristics</span><a class="self-link" href="#heuristics"></a></h3>
   <p class="note" role="note"><span>Note:</span> The following algorithms are inspired from Chrome’s implementation
as well as from the <a href="https://www.w3.org/TR/WICD/#focus-handling">old WICD Spec</a>.
Implementors who find better approaches or refinements to these approaches are strongly
encouraged to provide feedback and help improve this specification
in order to maximize interoperability.
In particular, divergences in how User Agents <a data-link-type="dfn" href="#find-candidates" id="ref-for-find-candidates③">find candidates</a> may cause some elements to be focusable in some User Agents but not in others,
which would be bad for users.</p>
   <p>All geometrical operations in this section are defined to work on the result of CSS layout,
including all graphical transformations, such as <a data-link-type="dfn" href="https://drafts.csswg.org/css-position-3/#relative-position" id="ref-for-relative-position">relative positioning</a> or <a data-link-type="biblio" href="#biblio-css-transforms-1">[CSS-TRANSFORMS-1]</a>.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="boundary-box">boundary box</dfn> of a object is defined as follows:</p>
   <ul>
    <li data-md="">
     <p>if the object is a point, the boundary is that point</p>
    <li data-md="">
     <p>if the object is an element, the boundary is the <a data-link-type="dfn" href="https://drafts.csswg.org/css2/box.html#x14" id="ref-for-x14">border box</a> of the element’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#principal-box" id="ref-for-principal-box①">principal box</a>.</p>
    <li data-md="">
     <p>if the object is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusable-area" id="ref-for-focusable-area①">focusable area</a> which is not an element, the boundary is the axis-aligned the bounding box of that <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusable-area" id="ref-for-focusable-area②">focusable area</a></p>
    <li data-md="">
     <p>if the object is a geometric shape, the boundary is the axis-aligned the bounding box of that shape</p>
   </ul>
   <p class="issue" id="issue-c7f6d991"><a class="self-link" href="#issue-c7f6d991"></a> CSS should have a term for “border box taking into account corner shaping properties like border-radius”.</p>
   <div class="algorithm" data-algorithm="to find candidates">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="find candidates | finding candidates" data-noexport="" id="find-candidates">find candidates</dfn> within a <a data-link-type="dfn" href="#spatial-navigation-focus-container" id="ref-for-spatial-navigation-focus-container②⓪">spatnav container</a> <var>C</var>,
in an optional direction <var>D</var>,
starting from <var>starting point</var>,
follow the following steps:</p>
    <ol>
     <li data-md="">
      <p>Let <var>focusables</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> of all the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusable-area" id="ref-for-focusable-area③">focusable areas</a> that are descentants of <var>C</var>.</p>
     <li data-md="">
      <p>The UA should <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove">remove</a> from <var>focusables</var> elements whose <a data-link-type="element-attr" href="https://html.spec.whatwg.org/multipage/interaction.html#attr-tabindex" id="ref-for-attr-tabindex"><code>tabindex</code></a> attribute is set to a negative value.</p>
      <p class="note" role="note"><span>Note:</span> This is a "SHOULD" in order to mirror the exclusion of elements with negative tabindex
from the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#sequential-focus-navigation-order" id="ref-for-sequential-focus-navigation-order">sequential focus navigation order</a> as defined in <a href="https://html.spec.whatwg.org/multipage/#the-tabindex-attribute">HTML Standard §the-tabindex-attribute</a>.</p>
     <li data-md="">
      <p>Let <var>visibles</var> be the subset of items in <var>focusables</var> whose <a data-link-type="dfn" href="#boundary-box" id="ref-for-boundary-box">boundary box</a> is at least partly within <var>C</var>’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-overflow-3/#scrollport" id="ref-for-scrollport①">scrollport</a>.</p>
      <p class="issue" id="issue-2905b706"><a class="self-link" href="#issue-2905b706"></a> Should that be C’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-scroll-snap-1/#optimal-viewing-region" id="ref-for-optimal-viewing-region">optimal viewing region</a> instead?
Probably not, given the next step, but maybe.</p>
     <li data-md="">
      <p>Remove from <var>visibles</var> items are <a data-link-type="dfn" href="#obscured" id="ref-for-obscured">obscured</a> by other parts of the page:
If no point of the area enclosed by an item’s <a data-link-type="dfn" href="#boundary-box" id="ref-for-boundary-box①">boundary box</a> can be hit by a hit test due to some other object(s) overlapping it,
it is said to be <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport="" id="obscured">obscured</dfn>.</p>
      <p class="note" role="note"><span>Note:</span> Spatial navigation is often an afterthough for many web authors,
if it is remembered at all.
If elements which cannot be focused or activated clicking / pointing
could be focused by spatial navigation,
there would be a risk that activating them would violate the author’s assumptions
of what events can happen in certain states of the web page.
For instance, if the submit button of a form can be focused and activated even though
there is a dialog over it,
this may cause a bug in the application.
While careful authors should use the inert attribute (or similar practices) to prevent such problems,
but this specification aims to make spatial navigation robust even in the eventuality
that authors forget to do so.</p>
      <p class="issue" id="issue-88cc7acf"><a class="self-link" href="#issue-88cc7acf"></a> Some CSS spec needs to define hit testing.</p>
     <li data-md="">
      <ul>
       <li data-md="">
        <p>If <var>D</var> is null,
let <var>candidates</var> be the same as <var>visibles</var></p>
       <li data-md="">
        <p>Else, let <var>candidates</var> be the subset of the items in <var>visibles</var> whose <a data-link-type="dfn" href="#boundary-box" id="ref-for-boundary-box②">boundary box</a>’s geometric center is within the closed half plane
whose boundary goes through the geometric center of <var>starting point</var> and is perpendicular to <var>D</var>.</p>
      </ul>
     <li data-md="">
      <p>Return <var>candidates</var>.</p>
      <p class="note" role="note"><span>Note:</span> <var>candidates</var> may be <code>null</code>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="to select the best candidate">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="select the best candidate | selecting the best candidate" data-noexport="" id="select-the-best-candidate">select the best candidate</dfn> within a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a> of <var>candidates</var> in an optional direction <var>dir</var>,
starting from <var>starting point</var>,
follow the following steps:</p>
    <ol>
     <li data-md="">
      <p>If <var>candidates</var> is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">empty</a>, return <code>null</code></p>
     <li data-md="">
      <p>If <var>candidates</var> contains a single item, return that item</p>
     <li data-md="">
      <p>For each <var>candidate</var> in <var>candidates</var>,
find the points <var>P1</var> inside the <a data-link-type="dfn" href="#boundary-box" id="ref-for-boundary-box③">boundary box</a> of <var>starting point</var> and <var>P2</var> inside the <a data-link-type="dfn" href="#boundary-box" id="ref-for-boundary-box④">boundary box</a> of <var>candidate</var> that minimize the <var>distance</var> between these two points,
when <var>distance</var> is defined as follows:</p>
      <dl>
       <dt><var>distance</var>: 
       <dd><var>A</var> + <var>B</var> + <var>C</var> - <var>D</var> 
       <dt><var>A</var>: 
       <dd>The euclidian distance between <var>P1</var> and <var>P2</var>. 
       <dt><var>B</var>: 
       <dd>The absolute distance in the <var>dir</var> direction between <var>P1</var> and <var>P2</var>,
    or 0 if <var>dir</var> is <code>null</code>. 
       <dt><var>C</var>: 
       <dd>The absolute distance in the direction which is orthogonal to <var>dir</var> between <var>P1</var> and <var>P2</var>,
    or 0 if <var>dir</var> is <code>null</code>. 
       <dt><var>D</var>: 
       <dd>The square root of the area of intersection between the <a data-link-type="dfn" href="#boundary-box" id="ref-for-boundary-box⑤">boundary boxes</a> of <var>candidate</var> and <var>starting point</var> 
      </dl>
     <li data-md="">
      <p>Return the item of the <var>candidates</var> set that has the smallest <var>distance</var></p>
    </ol>
   </div>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content"> Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p> Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification. </p>
   <p> All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p> Examples in this specification are introduced with the words “for example”
            or are set apart from the normative text with <code>class="example"</code>, like this: </p>
   <div class="example" id="example-example"><a class="self-link" href="#example-example"></a> This is an example of an informative example. </div>
   <p> Informative notes begin with the word “Note”
            and are set apart from the normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note"> Note, this is an informative note. </p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li>
    active
    <ul>
     <li><a href="#spatnav-active">dfn for spatnav</a><span>, in §4.1</span>
     <li><a href="#valdef-spatial-navigation-active">value for spatial-navigation</a><span>, in §4.1</span>
    </ul>
   <li>
    auto
    <ul>
     <li><a href="#valdef-spatial-navigation-auto">value for spatial-navigation</a><span>, in §4.1</span>
     <li><a href="#valdef-spatnav-container-auto">value for spatnav-container</a><span>, in §4.2</span>
    </ul>
   <li><a href="#spatnav-available">available</a><span>, in §4.1</span>
   <li><a href="#dom-navigationdirection-backward">"backward"</a><span>, in §5</span>
   <li><a href="#dom-navigationdirection-backward">backward</a><span>, in §5</span>
   <li><a href="#boundary-box">boundary box</a><span>, in §6.4</span>
   <li><a href="#can-be-manually-scrolled">can be manually scrolled</a><span>, in §6.2</span>
   <li><a href="#can-be-manually-scrolled">can be scrolled manually</a><span>, in §6.2</span>
   <li><a href="#can-be-manually-scrolled">cannot be manually scrolled</a><span>, in §6.2</span>
   <li><a href="#can-be-manually-scrolled">cannot be scrolled manually</a><span>, in §6.2</span>
   <li><a href="#valdef-spatnav-container-create">create</a><span>, in §4.2</span>
   <li>
    dir
    <ul>
     <li><a href="#dom-navigationevent-dir">attribute for NavigationEvent</a><span>, in §5</span>
     <li><a href="#dom-navigationeventinit-dir">dict-member for NavigationEventInit</a><span>, in §5</span>
     <li><a href="#dom-findfocusableoptions-dir">dict-member for FindFocusableOptions</a><span>, in §5</span>
    </ul>
   <li><a href="#directionally-scroll-an-element">directionally scroll an element</a><span>, in §6.2</span>
   <li><a href="#directionally-scroll-an-element">directionally scroll the element</a><span>, in §6.2</span>
   <li><a href="#dom-navigationdirection-down">down</a><span>, in §5</span>
   <li><a href="#dom-navigationdirection-down">"down"</a><span>, in §5</span>
   <li><a href="#find-candidates">find candidates</a><span>, in §6.4</span>
   <li><a href="#dom-element-findfocusable">findFocusable(arg)</a><span>, in §5</span>
   <li><a href="#dictdef-findfocusableoptions">FindFocusableOptions</a><span>, in §5</span>
   <li><a href="#find-candidates">finding candidates</a><span>, in §6.4</span>
   <li><a href="#dom-navigationdirection-forward">forward</a><span>, in §5</span>
   <li><a href="#dom-navigationdirection-forward">"forward"</a><span>, in §5</span>
   <li><a href="#dom-navigationdirection-inside">"inside"</a><span>, in §5</span>
   <li><a href="#dom-navigationdirection-inside">inside</a><span>, in §5</span>
   <li><a href="#dom-navigationdirection-left">"left"</a><span>, in §5</span>
   <li><a href="#dom-navigationdirection-left">left</a><span>, in §5</span>
   <li><a href="#eventdef-navigationevent-navbeforefocus">navbeforefocus</a><span>, in §3</span>
   <li><a href="#eventdef-navigationevent-navbeforescroll">navbeforescroll</a><span>, in §3</span>
   <li><a href="#navigate-inside-steps">navigate inside steps</a><span>, in §6.3</span>
   <li><a href="#enumdef-navigationdirection">NavigationDirection</a><span>, in §5</span>
   <li><a href="#navigationevent">NavigationEvent</a><span>, in §5</span>
   <li><a href="#dictdef-navigationeventinit">NavigationEventInit</a><span>, in §5</span>
   <li><a href="#dom-navigationevent-navigationevent">NavigationEvent(type)</a><span>, in §5</span>
   <li><a href="#dom-navigationevent-navigationevent">NavigationEvent(type, eventInitDict)</a><span>, in §5</span>
   <li><a href="#navigation-starting-point">navigation starting point</a><span>, in §6.1</span>
   <li><a href="#navigation-steps">navigation steps</a><span>, in §6.3</span>
   <li><a href="#eventdef-navigationevent-navnotarget">navnotarget</a><span>, in §3</span>
   <li><a href="#obscured">obscured</a><span>, in §6.4</span>
   <li><a href="#react-to-key-presses">react to key presses</a><span>, in §6.1</span>
   <li>
    relatedTarget
    <ul>
     <li><a href="#dom-navigationevent-relatedtarget">attribute for NavigationEvent</a><span>, in §5</span>
     <li><a href="#dom-navigationeventinit-relatedtarget">dict-member for NavigationEventInit</a><span>, in §5</span>
    </ul>
   <li><a href="#dom-navigationdirection-right">right</a><span>, in §5</span>
   <li><a href="#dom-navigationdirection-right">"right"</a><span>, in §5</span>
   <li><a href="#select-the-best-candidate">selecting the best candidate</a><span>, in §6.4</span>
   <li><a href="#select-the-best-candidate">select the best candidate</a><span>, in §6.4</span>
   <li><a href="#propdef-spatial-navigation">spatial-navigation</a><span>, in §4.1</span>
   <li><a href="#spatial-navigation">spatial navigation</a><span>, in §1</span>
   <li><a href="#spatial-navigation-focus-container">spatial navigation focus container</a><span>, in §4.2</span>
   <li><a href="#spatial-navigation-focus-container">spatial navigation focus containers</a><span>, in §4.2</span>
   <li><a href="#spatial-navigation-steps">spatial navigation steps</a><span>, in §6.3</span>
   <li><a href="#spatial-navigation">spatnav</a><span>, in §1</span>
   <li><a href="#spatial-navigation-focus-container">spatnav container</a><span>, in §4.2</span>
   <li><a href="#propdef-spatnav-container">spatnav-container</a><span>, in §4.2</span>
   <li><a href="#spatial-navigation-focus-container">spatnav containers</a><span>, in §4.2</span>
   <li><a href="#dom-navigationdirection-up">up</a><span>, in §5</span>
   <li><a href="#dom-navigationdirection-up">"up"</a><span>, in §5</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[css-display-3]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-display-3/#principal-box">principal box</a>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-OVERFLOW-3]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-overflow-3/#valdef-overflow-hidden">hidden</a>
     <li><a href="https://drafts.csswg.org/css-overflow-3/#propdef-overflow-x">overflow-x</a>
     <li><a href="https://drafts.csswg.org/css-overflow-3/#propdef-overflow-y">overflow-y</a>
     <li><a href="https://drafts.csswg.org/css-overflow-3/#scroll-container">scroll container</a>
     <li><a href="https://drafts.csswg.org/css-overflow-3/#scrollport">scrollport</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-position-3]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-position-3/#relative-position">relative position</a>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-SCROLL-SNAP-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-scroll-snap-1/#optimal-viewing-region">optimal viewing region</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-values-3]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-values-4/#comb-one">|</a>
    </ul>
   <li>
    <a data-link-type="biblio">[css-writing-modes-4]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css-writing-modes-4/#block-start">block start</a>
     <li><a href="https://drafts.csswg.org/css-writing-modes-4/#inline-start">inline start</a>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS2]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/css2/box.html#x14">border box</a>
    </ul>
   <li>
    <a data-link-type="biblio">[CSSOM-VIEW-1]</a> defines the following terms:
    <ul>
     <li><a href="https://drafts.csswg.org/cssom-view-1/#scroll-an-element">scroll an element</a>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#element">Element</a>
     <li><a href="https://dom.spec.whatwg.org/#eventtarget">EventTarget</a>
     <li><a href="https://dom.spec.whatwg.org/#eventtarget-activation-behavior">activation behavior</a>
     <li><a href="https://dom.spec.whatwg.org/#concept-document">document</a>
     <li><a href="https://dom.spec.whatwg.org/#document-element">document element</a>
     <li><a href="https://dom.spec.whatwg.org/#concept-event-fire">fire an event</a>
     <li><a href="https://dom.spec.whatwg.org/#dom-event-preventdefault">preventDefault()</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#ancestor-browsing-context">ancestor browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context-container">browsing context container</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#dom-anchor">dom anchor</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#dom-focus">focus(options)</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#focusable-area">focusable area</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps">focusing steps</a>
     <li><a href="https://html.spec.whatwg.org/multipage/input.html#the-input-element">input</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context">nested browsing context</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#sequential-focus-navigation">sequential focus navigation</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#sequential-focus-navigation-order">sequential focus navigation order</a>
     <li><a href="https://html.spec.whatwg.org/multipage/interaction.html#attr-tabindex">tabindex</a>
     <li><a href="https://html.spec.whatwg.org/multipage/form-elements.html#the-textarea-element">textarea</a>
     <li><a href="https://html.spec.whatwg.org/multipage/dom.html#the-body-element-2">the body element</a>
     <li><a href="https://html.spec.whatwg.org/multipage/browsers.html#top-level-browsing-context">top-level browsing context</a>
    </ul>
   <li>
    <a data-link-type="biblio">[infra]</a> defines the following terms:
    <ul>
     <li><a href="https://infra.spec.whatwg.org/#assert">assert</a>
     <li><a href="https://infra.spec.whatwg.org/#list-empty">empty</a>
     <li><a href="https://infra.spec.whatwg.org/#list-remove">remove</a>
     <li><a href="https://infra.spec.whatwg.org/#ordered-set">set</a>
    </ul>
   <li>
    <a data-link-type="biblio">[overscroll-behavior]</a> defines the following terms:
    <ul>
     <li><a href="https://wicg.github.io/overscroll-behavior/#scroll-boundary">scroll boundary</a>
    </ul>
   <li>
    <a data-link-type="biblio">[UI-EVENTS]</a> defines the following terms:
    <ul>
     <li><a href="https://www.w3.org/TR/uievents/#keyboardevent-keyboardevent">KeyboardEvent</a>
     <li><a href="https://www.w3.org/TR/uievents/#mouseevent">MouseEvent</a>
     <li><a href="https://www.w3.org/TR/uievents/#uievent-uievent">UIEvent</a>
     <li><a href="https://www.w3.org/TR/uievents/#dictdef-uieventinit-uieventinit">UIEventInit</a>
     <li><a href="https://www.w3.org/TR/uievents/#dom-keyboardevent-altkey">altKey</a>
     <li><a href="https://w3c.github.io/uievents/#click">click</a>
     <li><a href="https://www.w3.org/TR/uievents/#dom-keyboardevent-ctrlkey">ctrlKey</a>
     <li><a href="https://www.w3.org/TR/uievents/#dom-keyboardevent-key">key</a>
     <li><a href="https://w3c.github.io/uievents/#keydown">keydown</a>
     <li><a href="https://www.w3.org/TR/uievents/#dom-keyboardevent-metakey">metaKey</a>
     <li><a href="https://www.w3.org/TR/uievents/#dom-keyboardevent-shiftkey">shiftKey</a>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-display-3">[CSS-DISPLAY-3]
   <dd>Elika Etemad. <a href="https://www.w3.org/TR/css-display-3/">CSS Display Module Level 3</a>. 20 July 2017. WD. URL: <a href="https://www.w3.org/TR/css-display-3/">https://www.w3.org/TR/css-display-3/</a>
   <dt id="biblio-css-overflow-3">[CSS-OVERFLOW-3]
   <dd>David Baron; Florian Rivoal. <a href="https://www.w3.org/TR/css-overflow-3/">CSS Overflow Module Level 3</a>. 31 May 2016. WD. URL: <a href="https://www.w3.org/TR/css-overflow-3/">https://www.w3.org/TR/css-overflow-3/</a>
   <dt id="biblio-css-position-3">[CSS-POSITION-3]
   <dd>Rossen Atanassov; Arron Eicholz. <a href="https://www.w3.org/TR/css-position-3/">CSS Positioned Layout Module Level 3</a>. 17 May 2016. WD. URL: <a href="https://www.w3.org/TR/css-position-3/">https://www.w3.org/TR/css-position-3/</a>
   <dt id="biblio-css-scroll-snap-1">[CSS-SCROLL-SNAP-1]
   <dd>Matt Rakow; et al. <a href="https://www.w3.org/TR/css-scroll-snap-1/">CSS Scroll Snap Module Level 1</a>. 14 December 2017. CR. URL: <a href="https://www.w3.org/TR/css-scroll-snap-1/">https://www.w3.org/TR/css-scroll-snap-1/</a>
   <dt id="biblio-css-values-3">[CSS-VALUES-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://www.w3.org/TR/css-values-3/">CSS Values and Units Module Level 3</a>. 29 September 2016. CR. URL: <a href="https://www.w3.org/TR/css-values-3/">https://www.w3.org/TR/css-values-3/</a>
   <dt id="biblio-css-writing-modes-4">[CSS-WRITING-MODES-4]
   <dd>Elika Etemad; Koji Ishii. <a href="https://www.w3.org/TR/css-writing-modes-4/">CSS Writing Modes Level 4</a>. 7 December 2017. WD. URL: <a href="https://www.w3.org/TR/css-writing-modes-4/">https://www.w3.org/TR/css-writing-modes-4/</a>
   <dt id="biblio-css2">[CSS2]
   <dd>Bert Bos; et al. <a href="https://www.w3.org/TR/CSS2/">Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification</a>. 7 June 2011. REC. URL: <a href="https://www.w3.org/TR/CSS2/">https://www.w3.org/TR/CSS2/</a>
   <dt id="biblio-cssom-view-1">[CSSOM-VIEW-1]
   <dd>Simon Pieters. <a href="https://www.w3.org/TR/cssom-view-1/">CSSOM View Module</a>. 17 March 2016. WD. URL: <a href="https://www.w3.org/TR/cssom-view-1/">https://www.w3.org/TR/cssom-view-1/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-ui-events">[UI-EVENTS]
   <dd>Gary Kacmarcik; Travis Leithead. <a href="https://www.w3.org/TR/uievents/">UI Events</a>. 4 August 2016. WD. URL: <a href="https://www.w3.org/TR/uievents/">https://www.w3.org/TR/uievents/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Cameron McCormack; Boris Zbarsky; Tobie Langel. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-css-transforms-1">[CSS-TRANSFORMS-1]
   <dd>Simon Fraser; et al. <a href="https://www.w3.org/TR/css-transforms-1/">CSS Transforms Module Level 1</a>. 30 November 2017. WD. URL: <a href="https://www.w3.org/TR/css-transforms-1/">https://www.w3.org/TR/css-transforms-1/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="property-index"><span class="content">Property Index</span><a class="self-link" href="#property-index"></a></h2>
  <div class="big-element-wrapper">
   <table class="index">
    <thead>
     <tr>
      <th scope="col">Name
      <th scope="col">Value
      <th scope="col">Initial
      <th scope="col">Applies to
      <th scope="col">Inh.
      <th scope="col">%ages
      <th scope="col">Media
      <th scope="col">Anim­ation type
      <th scope="col">Canonical order
      <th scope="col">Com­puted value
    <tbody>
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-spatial-navigation" id="ref-for-propdef-spatial-navigation④">spatial-navigation</a>
      <td>auto | active
      <td>auto
      <td>all elements
      <td>yes
      <td>n/a
      <td>visual
      <td>discrete
      <td>per grammar
      <td>as specified
     <tr>
      <th scope="row"><a class="css" data-link-type="property" href="#propdef-spatnav-container" id="ref-for-propdef-spatnav-container③">spatnav-container</a>
      <td>auto | create
      <td>auto
      <td>all elements
      <td>no
      <td>n/a
      <td>visual
      <td>discrete
      <td>per grammar
      <td>as specified
   </table>
  </div>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><span class="kt">enum</span> <a class="nv" href="#enumdef-navigationdirection"><code>NavigationDirection</code></a> {
  <a class="s" href="#dom-navigationdirection-up"><code>"up"</code></a>,
  <a class="s" href="#dom-navigationdirection-down"><code>"down"</code></a>,
  <a class="s" href="#dom-navigationdirection-left"><code>"left"</code></a>,
  <a class="s" href="#dom-navigationdirection-right"><code>"right"</code></a>,
  <a class="s" href="#dom-navigationdirection-forward"><code>"forward"</code></a>,
  <a class="s" href="#dom-navigationdirection-backward"><code>"backward"</code></a>,
  <a class="s" href="#dom-navigationdirection-inside"><code>"inside"</code></a>
};

[<a class="nv" href="#dom-navigationevent-navigationevent"><code>Constructor</code></a>(<a class="n idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①"><span class="kt">DOMString</span></a> <a class="nv" href="#dom-navigationevent-navigationevent-type-eventinitdict-type"><code>type</code></a>, <span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="#dictdef-navigationeventinit" id="ref-for-dictdef-navigationeventinit①">NavigationEventInit</a> <a class="nv" href="#dom-navigationevent-navigationevent-type-eventinitdict-eventinitdict"><code>eventInitDict</code></a>)]
<span class="kt">interface</span> <a class="nv" href="#navigationevent"><code>NavigationEvent</code></a> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/uievents/#uievent-uievent" id="ref-for-uievent-uievent①">UIEvent</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#enumdef-navigationdirection" id="ref-for-enumdef-navigationdirection③">NavigationDirection</a> <a class="nv" data-readonly="" data-type="NavigationDirection" href="#dom-navigationevent-dir"><code>dir</code></a>;
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget②">EventTarget</a>? <a class="nv" data-readonly="" data-type="EventTarget?" href="#dom-navigationevent-relatedtarget"><code>relatedTarget</code></a>;
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-navigationeventinit"><code>NavigationEventInit</code></a> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/uievents/#dictdef-uieventinit-uieventinit" id="ref-for-dictdef-uieventinit-uieventinit①">UIEventInit</a> {
  <span class="kt">required</span> <a class="n" data-link-type="idl-name" href="#enumdef-navigationdirection" id="ref-for-enumdef-navigationdirection①①">NavigationDirection</a> <a class="nv" data-type="NavigationDirection " href="#dom-navigationeventinit-dir"><code>dir</code></a>;
  <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget①①">EventTarget</a>? <a class="nv" data-default="null" data-type="EventTarget? " href="#dom-navigationeventinit-relatedtarget"><code>relatedTarget</code></a> = <span class="kt">null</span>;
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-findfocusableoptions"><code>FindFocusableOptions</code></a> {
  <span class="kt">required</span> <a class="n" data-link-type="idl-name" href="#enumdef-navigationdirection" id="ref-for-enumdef-navigationdirection②①">NavigationDirection</a> <a class="nv" data-type="NavigationDirection " href="#dom-findfocusableoptions-dir"><code>dir</code></a>;
};

<span class="kt">partial</span> <span class="kt">interface</span> <a class="nv idl-code" data-link-type="interface" href="https://dom.spec.whatwg.org/#element" id="ref-for-element②">Element</a> {
  <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#element" id="ref-for-element①①">Element</a>? <a class="nv" href="#dom-element-findfocusable"><code>findFocusable</code></a>(<a class="n" data-link-type="idl-name" href="#dictdef-findfocusableoptions" id="ref-for-dictdef-findfocusableoptions①">FindFocusableOptions</a> <a class="nv" href="#dom-element-findfocusable-arg-arg"><code>arg</code></a>);
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> While this ability is needed, it could be achieved by different mechanisms,
such as for example automatically moving the focus inside of a scroll container
instead of focusing it,
if it contains focusable elements.
The current proposition is felt to be more intuitive for end users.
Feedback appreciated.<a href="#issue-e08bbccb"> ↵ </a></div>
   <div class="issue"> Bikeshedding: Are we OK with abbreviations?
Should this be spatial-navigation-container?
Is that too long, or does it make it seem like a longhand?
Should we go with navigation-container instead?
Doesn’t that suggest it would do something for sequential navigation too?<a href="#issue-f2a24612"> ↵ </a></div>
   <div class="issue"> Should we instead provide lower level methods to expose <a data-link-type="dfn" href="#find-candidates">finding candidates</a> and <a data-link-type="dfn" href="#select-the-best-candidate">selecting the best candidate</a>?<a href="#issue-36f1c95a"> ↵ </a></div>
   <div class="issue"> The following currently does not account
for <a href="https://github.com/WICG/overscroll-behavior">the proposed overscroll-behavior specification</a>.<a href="#issue-334ee4b3"> ↵ </a></div>
   <div class="issue"> The following does not take shadow dom into account.<a href="#issue-e0cc24e0"> ↵ </a></div>
   <div class="issue"> This should be a extension of <a data-link-type="biblio" href="#biblio-ui-events">[UI-EVENTS]</a>'s processing model
(or a monkey-patch over it if it were not extensible),
but <a data-link-type="biblio" href="#biblio-ui-events">[UI-EVENTS]</a> does not have a fully defined processing model.
It does define the events, but does not define the algorithm which
is supposed to dispatch them and respond to cancelation and so on.
Therefore, this is being written as (a rough sketch of) what that
model should be.
Once this is sufficiently detailed and tested, this should be turned into
a pull request against <a data-link-type="biblio" href="#biblio-ui-events">[UI-EVENTS]</a>.<a href="#issue-9ca6a131"> ↵ </a></div>
   <div class="issue"> The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps">focusing steps</a> should probably reset the <a data-link-type="dfn" href="#navigation-starting-point">navigation starting point</a><a href="#issue-49a79fa5"> ↵ </a></div>
   <div class="issue"> …invoke beforeinput events, execcommand, IMEs, input events, and numerous details…<br> However, a key point here is that if the caret is at the beggining (resp. end) of the content,
and the user presses an arrow key to go up or left (resp. down or right),
and there’s no IME or similar thing consuming that key,
then we should jump to point 11.1<a href="#issue-4d6f723c"> ↵ </a></div>
   <div class="issue"> … more of the same, handling all sorts of keys in various situations …<a href="#issue-20bb12bb"> ↵ </a></div>
   <div class="issue"> define a nice hook so that elements can be specified to react to arrow keys<a href="#issue-0caac161"> ↵ </a></div>
   <div class="issue"> This is how Chrome and Safari do it.
Firefox only looks at the first ancestor of <var>startingPoint</var>,
and if that cannot be manually scrolled,
it stops there rather than look further up the ancestry chain.<a href="#issue-6b95c421"> ↵ </a></div>
   <div class="issue"> Terminology like this should be in <a data-link-type="biblio" href="#biblio-cssom-view-1">[CSSOM-VIEW-1]</a>, <a data-link-type="biblio" href="#biblio-css-overflow-3">[CSS-OVERFLOW-3]</a>, <a data-link-type="biblio" href="#biblio-css-scroll-snap-1">[CSS-SCROLL-SNAP-1]</a>.<a href="#issue-56c2d572"> ↵ </a></div>
   <div class="issue"> Take mandatory scroll snappoints into account<a href="#issue-47978a70"> ↵ </a></div>
   <div class="issue"> <a data-link-type="biblio" href="#biblio-cssom-view-1">[CSSOM-VIEW-1]</a> should probably define
how to perform a scroll in a given direction without an explicit position.
Until then, we roll our own.<a href="#issue-9297fdfc"> ↵ </a></div>
   <div class="issue"> This is a monkeypatch on <a data-link-type="biblio" href="#biblio-html">[HTML]</a>.
Eventually this should be upstreamed:
modify the steps as described here,
and give them a name (“the sequential navigation steps”?) so that they can be invoked.<a href="#issue-8eb25daf"> ↵ </a></div>
   <div class="issue"> is it sane from a security standpoint that this propagates up from iframes?<a href="#issue-d6bc89a9"> ↵ </a></div>
   <div class="issue"> CSS should have a term for “border box taking into account corner shaping properties like border-radius”.<a href="#issue-c7f6d991"> ↵ </a></div>
   <div class="issue"> Should that be C’s <a data-link-type="dfn" href="https://drafts.csswg.org/css-scroll-snap-1/#optimal-viewing-region">optimal viewing region</a> instead?
Probably not, given the next step, but maybe.<a href="#issue-2905b706"> ↵ </a></div>
   <div class="issue"> Some CSS spec needs to define hit testing.<a href="#issue-88cc7acf"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="spatial-navigation">
   <b><a href="#spatial-navigation">#spatial-navigation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-spatial-navigation">1. 
Introduction</a> <a href="#ref-for-spatial-navigation①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-navigationevent-navbeforefocus">
   <b><a href="#eventdef-navigationevent-navbeforefocus">#eventdef-navigationevent-navbeforefocus</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-navigationevent-navbeforefocus">6.3. 
Navigation</a> <a href="#ref-for-eventdef-navigationevent-navbeforefocus①">(2)</a> <a href="#ref-for-eventdef-navigationevent-navbeforefocus②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-navigationevent-navbeforescroll">
   <b><a href="#eventdef-navigationevent-navbeforescroll">#eventdef-navigationevent-navbeforescroll</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-navigationevent-navbeforescroll">6.3. 
Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="eventdef-navigationevent-navnotarget">
   <b><a href="#eventdef-navigationevent-navnotarget">#eventdef-navigationevent-navnotarget</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventdef-navigationevent-navnotarget">6.3. 
Navigation</a> <a href="#ref-for-eventdef-navigationevent-navnotarget①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="spatnav-available">
   <b><a href="#spatnav-available">#spatnav-available</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-spatnav-available">4.1. 
Activating Spatial Navigation: the spatial-navigation property</a> <a href="#ref-for-spatnav-available①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="spatnav-active">
   <b><a href="#spatnav-active">#spatnav-active</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-spatnav-active">3. 
Overview</a>
    <li><a href="#ref-for-spatnav-active①">4.1. 
Activating Spatial Navigation: the spatial-navigation property</a> <a href="#ref-for-spatnav-active②">(2)</a> <a href="#ref-for-spatnav-active③">(3)</a>
    <li><a href="#ref-for-spatnav-active④">6.1. 
Handling key presses</a> <a href="#ref-for-spatnav-active⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="propdef-spatial-navigation">
   <b><a href="#propdef-spatial-navigation">#propdef-spatial-navigation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-spatial-navigation">3. 
Overview</a>
    <li><a href="#ref-for-propdef-spatial-navigation①">4.1. 
Activating Spatial Navigation: the spatial-navigation property</a> <a href="#ref-for-propdef-spatial-navigation②">(2)</a> <a href="#ref-for-propdef-spatial-navigation③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="valdef-spatial-navigation-auto">
   <b><a href="#valdef-spatial-navigation-auto">#valdef-spatial-navigation-auto</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valdef-spatial-navigation-auto">4.1. 
Activating Spatial Navigation: the spatial-navigation property</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="spatial-navigation-focus-container">
   <b><a href="#spatial-navigation-focus-container">#spatial-navigation-focus-container</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-spatial-navigation-focus-container">3. 
Overview</a> <a href="#ref-for-spatial-navigation-focus-container①">(2)</a> <a href="#ref-for-spatial-navigation-focus-container②">(3)</a> <a href="#ref-for-spatial-navigation-focus-container③">(4)</a> <a href="#ref-for-spatial-navigation-focus-container④">(5)</a> <a href="#ref-for-spatial-navigation-focus-container⑤">(6)</a> <a href="#ref-for-spatial-navigation-focus-container⑥">(7)</a> <a href="#ref-for-spatial-navigation-focus-container⑦">(8)</a> <a href="#ref-for-spatial-navigation-focus-container⑧">(9)</a> <a href="#ref-for-spatial-navigation-focus-container⑨">(10)</a> <a href="#ref-for-spatial-navigation-focus-container①⓪">(11)</a> <a href="#ref-for-spatial-navigation-focus-container①①">(12)</a> <a href="#ref-for-spatial-navigation-focus-container①②">(13)</a> <a href="#ref-for-spatial-navigation-focus-container①③">(14)</a>
    <li><a href="#ref-for-spatial-navigation-focus-container①④">4.2. 
Establishing focus navigation containers: the spatnav-container property</a> <a href="#ref-for-spatial-navigation-focus-container①⑤">(2)</a> <a href="#ref-for-spatial-navigation-focus-container①⑥">(3)</a>
    <li><a href="#ref-for-spatial-navigation-focus-container①⑦">6.3. 
Navigation</a> <a href="#ref-for-spatial-navigation-focus-container①⑧">(2)</a> <a href="#ref-for-spatial-navigation-focus-container①⑨">(3)</a>
    <li><a href="#ref-for-spatial-navigation-focus-container②⓪">6.4. 
Focus Navigation Heuristics</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="propdef-spatnav-container">
   <b><a href="#propdef-spatnav-container">#propdef-spatnav-container</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-spatnav-container">3. 
Overview</a>
    <li><a href="#ref-for-propdef-spatnav-container①">4.2. 
Establishing focus navigation containers: the spatnav-container property</a> <a href="#ref-for-propdef-spatnav-container②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-navigationdirection">
   <b><a href="#enumdef-navigationdirection">#enumdef-navigationdirection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-navigationdirection">5. 
Javascript API</a> <a href="#ref-for-enumdef-navigationdirection①">(2)</a> <a href="#ref-for-enumdef-navigationdirection②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationdirection-up">
   <b><a href="#dom-navigationdirection-up">#dom-navigationdirection-up</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationdirection-up">5. 
Javascript API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationdirection-down">
   <b><a href="#dom-navigationdirection-down">#dom-navigationdirection-down</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationdirection-down">5. 
Javascript API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationdirection-left">
   <b><a href="#dom-navigationdirection-left">#dom-navigationdirection-left</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationdirection-left">5. 
Javascript API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationdirection-right">
   <b><a href="#dom-navigationdirection-right">#dom-navigationdirection-right</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationdirection-right">5. 
Javascript API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationdirection-forward">
   <b><a href="#dom-navigationdirection-forward">#dom-navigationdirection-forward</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationdirection-forward">5. 
Javascript API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationdirection-backward">
   <b><a href="#dom-navigationdirection-backward">#dom-navigationdirection-backward</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationdirection-backward">5. 
Javascript API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationdirection-inside">
   <b><a href="#dom-navigationdirection-inside">#dom-navigationdirection-inside</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationdirection-inside">5. 
Javascript API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="navigationevent">
   <b><a href="#navigationevent">#navigationevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigationevent">5. 
Javascript API</a>
    <li><a href="#ref-for-navigationevent①">6.3. 
Navigation</a> <a href="#ref-for-navigationevent②">(2)</a> <a href="#ref-for-navigationevent③">(3)</a> <a href="#ref-for-navigationevent④">(4)</a> <a href="#ref-for-navigationevent⑤">(5)</a> <a href="#ref-for-navigationevent⑥">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationevent-dir">
   <b><a href="#dom-navigationevent-dir">#dom-navigationevent-dir</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationevent-dir">3. 
Overview</a>
    <li><a href="#ref-for-dom-navigationevent-dir①">6.3. 
Navigation</a> <a href="#ref-for-dom-navigationevent-dir②">(2)</a> <a href="#ref-for-dom-navigationevent-dir③">(3)</a> <a href="#ref-for-dom-navigationevent-dir④">(4)</a> <a href="#ref-for-dom-navigationevent-dir⑤">(5)</a> <a href="#ref-for-dom-navigationevent-dir⑥">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-navigationevent-relatedtarget">
   <b><a href="#dom-navigationevent-relatedtarget">#dom-navigationevent-relatedtarget</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-navigationevent-relatedtarget">3. 
Overview</a>
    <li><a href="#ref-for-dom-navigationevent-relatedtarget①">6.3. 
Navigation</a> <a href="#ref-for-dom-navigationevent-relatedtarget②">(2)</a> <a href="#ref-for-dom-navigationevent-relatedtarget③">(3)</a> <a href="#ref-for-dom-navigationevent-relatedtarget④">(4)</a> <a href="#ref-for-dom-navigationevent-relatedtarget⑤">(5)</a> <a href="#ref-for-dom-navigationevent-relatedtarget⑥">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-navigationeventinit">
   <b><a href="#dictdef-navigationeventinit">#dictdef-navigationeventinit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-navigationeventinit">5. 
Javascript API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-findfocusableoptions">
   <b><a href="#dictdef-findfocusableoptions">#dictdef-findfocusableoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-findfocusableoptions">5. 
Javascript API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-element-findfocusable">
   <b><a href="#dom-element-findfocusable">#dom-element-findfocusable</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-element-findfocusable">5. 
Javascript API</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="navigation-starting-point">
   <b><a href="#navigation-starting-point">#navigation-starting-point</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigation-starting-point">6.1. 
Handling key presses</a> <a href="#ref-for-navigation-starting-point①">(2)</a> <a href="#ref-for-navigation-starting-point②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="can-be-manually-scrolled">
   <b><a href="#can-be-manually-scrolled">#can-be-manually-scrolled</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-can-be-manually-scrolled">6.1. 
Handling key presses</a> <a href="#ref-for-can-be-manually-scrolled①">(2)</a>
    <li><a href="#ref-for-can-be-manually-scrolled②">6.3. 
Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="directionally-scroll-an-element">
   <b><a href="#directionally-scroll-an-element">#directionally-scroll-an-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-directionally-scroll-an-element">6.1. 
Handling key presses</a> <a href="#ref-for-directionally-scroll-an-element①">(2)</a>
    <li><a href="#ref-for-directionally-scroll-an-element②">6.3. 
Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="navigation-steps">
   <b><a href="#navigation-steps">#navigation-steps</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigation-steps">5. 
Javascript API</a>
    <li><a href="#ref-for-navigation-steps①">6.1. 
Handling key presses</a> <a href="#ref-for-navigation-steps②">(2)</a> <a href="#ref-for-navigation-steps③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="spatial-navigation-steps">
   <b><a href="#spatial-navigation-steps">#spatial-navigation-steps</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-spatial-navigation-steps">4.1. 
Activating Spatial Navigation: the spatial-navigation property</a>
    <li><a href="#ref-for-spatial-navigation-steps①">6.3. 
Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="navigate-inside-steps">
   <b><a href="#navigate-inside-steps">#navigate-inside-steps</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-navigate-inside-steps">6.3. 
Navigation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="boundary-box">
   <b><a href="#boundary-box">#boundary-box</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-boundary-box">6.4. 
Focus Navigation Heuristics</a> <a href="#ref-for-boundary-box①">(2)</a> <a href="#ref-for-boundary-box②">(3)</a> <a href="#ref-for-boundary-box③">(4)</a> <a href="#ref-for-boundary-box④">(5)</a> <a href="#ref-for-boundary-box⑤">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="find-candidates">
   <b><a href="#find-candidates">#find-candidates</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-find-candidates">5. 
Javascript API</a>
    <li><a href="#ref-for-find-candidates①">6.3. 
Navigation</a> <a href="#ref-for-find-candidates②">(2)</a>
    <li><a href="#ref-for-find-candidates③">6.4. 
Focus Navigation Heuristics</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="obscured">
   <b><a href="#obscured">#obscured</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-obscured">6.4. 
Focus Navigation Heuristics</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="select-the-best-candidate">
   <b><a href="#select-the-best-candidate">#select-the-best-candidate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-select-the-best-candidate">5. 
Javascript API</a>
    <li><a href="#ref-for-select-the-best-candidate①">6.3. 
Navigation</a> <a href="#ref-for-select-the-best-candidate②">(2)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>