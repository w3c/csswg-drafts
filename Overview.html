<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html lang=en-US>
 <head>
  <title>Cascading Style Sheets Object Model (CSSOM)</title>

  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   dfn { font-weight:bold; font-style:normal }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   div.example table code { color:inherit }
   td, th { padding:.1em }
   .proposal { padding:.5em; border:solid blue }
   p.note {  margin-left:2em; color:green; font-style:italic; font-weight:bold }
   p.note::before { content:"Note: " }
   .issue { padding:.5em; border:solid red }
   .issue::before { content:"Issue: " }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
   .members dt { margin:.5em 0 }
   .members dd p:first-child { margin-top:0 }
   .members dd p:last-child { margin-bottom:0 }
  </style>
  <link href="http://www.w3.org/StyleSheets/TR/base" rel=stylesheet>

 <body class=draft>
  <div class=head>
   <h1 id=cssom>Cascading Style Sheets Object Model (<abbr>CSSOM</abbr>)</h1>

   <h2 class="no-num no-toc" id="">Editor's draft <!--W3C Working Draft--> 19
    January 2007</h2>

   <dl>
    <dt>This version:

    <dd><a
     href="http://www.w3.org/TR/2007/WD-cssom-20070119">http://www.w3.org/TR/2007/WD-cssom-20070119/</a>

    <dt>Latest version:

    <dd><a href="http://www.w3.org/TR/cssom/">http://www.w3.org/TR/cssom/</a>

    <dt>Previous versions:

    <dd><a
     href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/">http://www.w3.org/TR/2000/REC-DOM-Level-2-Style-20001113/</a>

    <dt>Editor:

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a> (<a
     href="http://www.opera.com/">Opera Software ASA</a>) &lt;<a
     href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;
   </dl>
  </div>

  <h2 class="no-num no-toc" id=abstract>Abstract</h2>

  <p>The Cascading Style Sheets Object Model defines the object model for
   <abbr title="Cascading Style Sheets">CSS</abbr> in order to be able to
   modify rules within the style sheets. It also defines ways for accessing
   style sheets associated with documents. In addition, this specification
   defines several ways for retrieving the dimensions of objects within a
   document.

  <h2 class="no-num no-toc" id=sotd>Status of this Document</h2>

  <p class=issue>This document is in its very early stages. The intention is
   that this specification will in due course supercede DOM Level 2 Style.

  <h2 class="no-num no-toc" id=toc>Table of Contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#introduction"><span class=secno>1. </span>Introduction</a>
    <ul class=toc>
     <li><a href="#history"><span class=secno>1.1. </span>History</a>

     <li><a href="#conformance"><span class=secno>1.2. </span>Conformance
      Requirements</a>
      <ul class=toc>
       <li><a href="#terminology"><span class=secno>1.2.1. </span>Terminology
        and Conventions</a>

       <li><a href="#dom-feature"><span class=secno>1.2.2. </span>DOM feature
        strings</a>
      </ul>
    </ul>

   <li><a href="#accessing"><span class=secno>2. </span>Accessing style
    sheets through the DOM</a>
    <ul class=toc>
     <li><a href="#terminology0"><span class=secno>2.1.
      </span>Terminology</a>

     <li><a href="#the-linkstyle"><span class=secno>2.2. </span>The
      <code>LinkStyle</code> Interface</a>

     <li><a href="#the-documentstyle"><span class=secno>2.3. </span>The
      <code>DocumentStyle</code> Interface</a>

     <li><a href="#the-stylesheetlist"><span class=secno>2.4. </span>The
      <code>StyleSheetList</code> Interface</a>

     <li><a href="#dynamically"><span class=secno>2.5. </span>Dynamically
      adding new style sheets</a>
      <ul class=toc>
       <li><a href="#adding"><span class=secno>2.5.1. </span>Adding style
        sheets</a>

       <li><a href="#changing"><span class=secno>2.5.2. </span>Changing the
        preferred style sheet set</a>

       <li><a href="#examples"><span class=secno>2.5.3. </span>Examples</a>
      </ul>

     <li><a href="#interaction"><span class=secno>2.6. </span>Interaction
      with the User Interface</a>
      <ul class=toc>
       <li><a href="#persisting"><span class=secno>2.6.1. </span>Persisting
        the selected style sheet set</a>
      </ul>

     <li><a href="#forward"><span class=secno>2.7. </span>Forward
      compatibility</a>

     <li><a href="#the-stylesheet"><span class=secno>2.8. </span>The
      <code>StyleSheet</code> Interface</a>

     <li><a href="#the-medialist"><span class=secno>2.9. </span>The
      <code>MediaList</code> Interface</a>
    </ul>

   <li><a href="#cascading"><span class=secno>3. </span>Cascading Style
    Sheets APIs</a>
    <ul class=toc>
     <li><a href="#introduction0"><span class=secno>3.1.
      </span>Introduction</a>

     <li><a href="#the-cssstylesheet"><span class=secno>3.2. </span>The
      <code>CSSStyleSheet</code> Interface</a>

     <li><a href="#the-cssrulelist"><span class=secno>3.3. </span>The
      <code>CSSRuleList</code> Interface</a>

     <li><a href="#interfaces"><span class=secno>3.4. </span>Interfaces For
      CSS Rules</a>
      <ul class=toc>
       <li><a href="#the-cssrule"><span class=secno>3.4.1. </span>The
        <code>CSSRule</code> Interface</a>
        <ul class=toc>
         <li><a href="#extensibility"><span class=secno>3.4.1.1.
          </span>Extensibility</a>
        </ul>

       <li><a href="#the-cssstylerule"><span class=secno>3.4.2. </span>The
        <code>CSSStyleRule</code> Interface</a>

       <li><a href="#the-csscharsetrule"><span class=secno>3.4.3. </span>The
        <code>CSSCharsetRule</code> Interface</a>

       <li><a href="#the-cssimportrule"><span class=secno>3.4.4. </span>The
        <code>CSSImportRule</code> Interface</a>

       <li><a href="#the-cssmediarule"><span class=secno>3.4.5. </span>The
        <code>CSSMediaRule</code> Interface</a>

       <li><a href="#the-cssfontfacerule"><span class=secno>3.4.6. </span>The
        <code>CSSFontFaceRule</code> Interface</a>

       <li><a href="#the-csspagerule"><span class=secno>3.4.7. </span>The
        <code>CSSPageRule</code> Interface</a>

       <li><a href="#the-cssnamespacerule"><span class=secno>3.4.8.
        </span>The <code>CSSNamespaceRule</code> Interface</a>
      </ul>

     <li><a href="#accessing0"><span class=secno>3.5. </span>Accessing
      declaration blocks</a>
      <ul class=toc>
       <li><a href="#introduction1"><span class=secno>3.5.1.
        </span>Introduction</a>

       <li><a href="#the-elementcssinlinestyle"><span class=secno>3.5.2.
        </span>The <code>ElementCSSInlineStyle</code> Interface</a>

       <li><a href="#the-viewcss"><span class=secno>3.5.3. </span>The
        <code>ViewCSS</code> Interface</a>

       <li><a href="#the-documentcss"><span class=secno>3.5.4. </span>The
        <code>DocumentCSS</code> Interface</a>
      </ul>

     <li><a href="#declaration"><span class=secno>3.6. </span>Declaration
      blocks</a>
      <ul class=toc>
       <li><a href="#the-cssstyledeclaration"><span class=secno>3.6.1.
        </span>The <code>CSSStyleDeclaration</code> Interface</a>

       <li><a href="#the-css2properties"><span class=secno>3.6.2. </span>The
        <code>CSS2Properties</code> Interface</a>

       <li><a href="#the-cssstyledeclarationproperties"><span
        class=secno>3.6.3. </span>The
        <code>CSSStyleDeclarationProperties</code> Interface</a>
      </ul>

     <li><a href="#css-value"><span class=secno>3.7. </span>CSS value related
      interfaces</a>
      <ul class=toc>
       <li><a href="#the-csspropertyvalue"><span class=secno>3.7.1.
        </span>The <code>CSSPropertyValue</code> Interface</a>

       <li><a href="#the-csscolorpropertyvalue"><span class=secno>3.7.2.
        </span>The <code>CSSColorPropertyValue</code> Interface</a>

       <li><a href="#the-cssurlpropertyvalue"><span class=secno>3.7.3.
        </span>The <code>CSSURLPropertyValue</code> Interface</a>

       <li><a href="#the-csslengthpropertyvalue"><span class=secno>3.7.4.
        </span>The <code>CSSLengthPropertyValue</code> Interface</a>
      </ul>
    </ul>

   <li><a href="#layout"><span class=secno>4. </span>Layout APIs</a>
    <ul class=toc>
     <li><a href="#the-windowlayout"><span class=secno>4.1. </span>The
      <code>WindowLayout</code> Interface</a>

     <li><a href="#the-elementlayout"><span class=secno>4.2. </span>The
      <code>ElementLayout</code> Interface</a>
      <ul class=toc>
       <li><a href="#the-getclientrects"><span class=secno>4.2.1. </span>The
        <code>getClientRects()</code> and <code>getBoundingClientRect</code>
        methods</a>

       <li><a href="#the-offset"><span class=secno>4.2.2. </span>The
        <code>offset<var>*</var></code> attributes</a>
        <ul class=toc>
         <li><a href="#determining"><span class=secno>4.2.2.1.
          </span>Determining <code>offsetParent</code></a>

         <li><a href="#offsetleft"><span class=secno>4.2.2.2.
          </span><code>offsetLeft</code> and <code>offsetRight</code></a>

         <li><a href="#offsetwidth"><span class=secno>4.2.2.3.
          </span><code>offsetWidth</code> and <code>offsetHeight</code></a>
        </ul>

       <li><a href="#the-scroll"><span class=secno>4.2.3. </span>The
        <code>scroll<var>*</var></code> attributes</a>

       <li><a href="#the-client"><span class=secno>4.2.4. </span>The
        <code>client<var>*</var></code> attributes</a>
      </ul>
    </ul>

   <li><a href="#canon"><span class=secno>5. </span>Canonicalization </a>
    <ul class=toc>
     <li><a href="#selectors"><span class=secno>5.1. </span>Selectors</a>

     <li><a href="#media"><span class=secno>5.2. </span>Media queries</a>
      <ul class=toc>
       <li><a href="#examples0"><span class=secno>5.2.1. </span>Examples</a>
      </ul>

     <li><a href="#css-values"><span class=secno>5.3. </span>CSS Values</a>
      <ul class=toc>
       <li><a href="#examples1"><span class=secno>5.3.1. </span>Examples</a>
      </ul>
    </ul>

   <li class=no-num><a href="#references">References</a>

   <li class=no-num><a href="#acknowledgements">Acknowledgements</a>
  </ul>
  <!--end-toc-->

  <h2 id=introduction><span class=secno>1. </span>Introduction</h2>

  <p class=issue>...

  <h3 id=history><span class=secno>1.1. </span>History</h3>

  <p><em>This section is non normative.</em>

  <p>Several interfaces from DOM Level 2 Style <a
   href="http://www.w3.org/mid/Pine.LNX.4.05.10310302134070.1173-100000@lanalana.inria.fr"
   title="[CSSOM] CSSValue and related interfaces (message from the CSS
   WG)">have been obsoleted</a> because they where thought to be too akward
   for frequent use. This specification no longer contains those features.

  <p>In addition, <code>DOMImplementationCSS</code> has been removed as well,
   because there was no use case provided in DOM Level 2 Style.

  <h3 id=conformance><span class=secno>1.2. </span>Conformance Requirements</h3>

  <p>Everything in this specification is normative except for diagrams,
   examples, notes and sections marked non-normative.

  <p>The key words <em class=ct>must</em>, <em class=ct>must not</em>, <em
   class=ct>required</em>, <em class=ct>shall</em>, <em class=ct>shall
   not</em>, <em class=ct>should</em>, <em class=ct>should not</em>, <em
   class=ct>recommended</em>, <em class=ct>may</em>, and <em
   class=ct>optional</em> in the normative parts of this document are to be
   interpreted as described in [<cite><a
   href="#ref-rfc2119">RFC2119</a></cite>].

  <p>The following conformance classes are defined (and considered) by this
   specification:

  <dl>
   <dt><dfn id=conforming-implementation>conforming implementation</dfn>

   <dd>A user agent that implements all interfaces described in this
    specification and follows all <em class=ct>must</em>-, <em
    class=ct>required</em>- and <em class=ct>shall</em>-level of critera in
    this specification.

   <dt><dfn id="conforming document">conforming document</dfn>

   <dd>A document that follows all <em class=ct>must</em>-, <em
    class=ct>required</em>- and <em class=ct>shall</em>-level of critera in
    this specification that apply to document authors.

   <dt><dfn id=conforming-authoring-tool>conforming authoring tool</dfn>

   <dd>One that produces conforming documents.
  </dl>

  <h4 id=terminology><span class=secno>1.2.1. </span>Terminology and
   Conventions</h4>

  <p>A <dfn id=color>color component integer</dfn> is a base-ten integer in
   the range 0-255 using digits 0-9, U+0030 to U+0039, in the shortest form
   possible.

  <p>A <dfn id=color0>color component separator</dfn> is a literal U+002C
   COMMA followed by a U+0020 SPACE.

  <p>When this specification talks about object <code><var>A</var></code>
   where <code><var>A</var></code> is actually an interface, it generally
   means an object implementing interface <code><var>A</var></code>.</p>
  <!--
  <p>The term <dfn id="whitespace">whitespace</dfn> when  used in this
   specification refers to the U+0020 SPACE, U+0009 &lt;control>, U+000A
   &lt;control>, U+000D &lt;control> and U+000C &lt;control> (if
   applicable).</p>
  -->

  <p>The terms <dfn id=whitespace>whitespace</dfn> and <dfn
   id=style-sheet>style sheet</dfn> are used as defined in the <cite>CSS 2.1
   Specification</cite> [CSS21].

  <p>A <dfn id=css-style-sheet>CSS style sheet</dfn> is a <a
   href="#style-sheet">style sheet</a> that conforms to the CSS syntax rules.</p>
  <!-- XXX: "Cascading Style Sheet style sheet" is just a joke... -->

  <h4 id=dom-feature><span class=secno>1.2.2. </span>DOM feature strings</h4>
  <!-- Thanks to Hixie. This is from HTML5. -->

  <p>DOM Level 3 Core defines mechanisms for checking for interface support,
   and for obtaining implementations of interfaces, using <a
   href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures">feature
   strings</a>. <a>[DOM3CORE]</a>

  <p>A DOM application can use the <code>hasFeature(<var
   title="">feature</var>, <var title="">version</var>)</code> method of the
   <code>DOMImplementation</code> interface with parameter values "<code
   title="">StyleSheets</code>" and "<code>3.0</code>" (respectively) to
   determine whether or not "Accessing style sheets through the DOM" is
   supported by the implementation. The feature string "<code
   title="">CSS</code>" (with version string "<code>3.0</code>") can be used
   to check if the implementation supports "Cascading Style Sheets APIs" and
   "<code title="">Layout</code>" (with version string "<code>3.0</code>")
   can be used to check if the implementation supports "Layout APIs". User
   agents <em class=ct>should</em> respond with a <code>true</code> value
   when the <code>hasFeature</code> method is queried with these values.
   Authors are cautioned, however, that user agents returning
   <code>true</code> might not be perfectly compliant, and that user agents
   returning <code>false</code> might well have support for features in this
   specification; in general, therefore, use of this method is discouraged.

  <p>The values "<code title="">StyleSheets</code>", "<code
   title="">CSS</code>" and "<code title="">Layout</code>" (all with version
   "<code>3.0</code>") <em class=ct>should</em> also be supported in the
   context of the <code>getFeature()</code> and <code>isSupported()</code>
   methods, as defined by DOM Level 3 Core.

  <p class=note>The interfaces defined in this specification are not always
   supersets of the interfaces defined in DOM Level 2 Style; some features
   that were formerly deprecated, poorly supported, rarely used or considered
   unnecessary have been removed. Therefore it is not guarenteed that an
   implementation that supports "<code title="">CSS</code>"
   "<code>3.0</code>" also supports "<code title="">CSS</code>"
   "<code>2.0</code>".

  <h2 id=accessing><span class=secno>2. </span>Accessing style sheets through
   the DOM</h2>
  <!--
  <p>An <dfn>associated style sheet</dfn> is a style sheet that is explicitly
   linked to or embedded within a document. (For the purposes of this definition
   HTTP headers are part of the document.) Examples on how you can associate
   style sheets with documents:</p>

  <ul>
   <li>The HTML <code>meta</code> element;</li>
   <li>The HTML <code>link</code> element;</li>
   <li>The HTML <code>style</code> element;</li>
   <li>The SVG <code>style</code> element;</li>
   <li>The <code>xml-stylesheet</code> processing instruction;</li>
   <li>The <code>Link</code> HTTP header.</li>
  </ul>

  <p>The <span>style sheet set</span> that's initially rendered unless the user
   has selected an alternate style sheet set is called the
   <span>preferred style sheet set</span>. All others are called
   <dfn title="alternate-style-sheet-set">alternate style sheet sets</dfn>. The
   <dfn id="preferred-style-sheet-set">preferred style sheet set</dfn> is either
   the first <span>style sheet set</span> or the style sheet set determined by
   the last recieved <code>Default-Style</code> HTTP header.</p>

  <!-- I mention <code>Default-Style</code> here. Should this specification
   define that header? It's already "defined" in HTML4, but it's very, very
   vague.

   -->

  <p>Each style sheet is represented by a <code><a
   href="#stylesheet">StyleSheet</a></code> object. These objects can be
   accessed through the <code><a href="#linkstyle">LinkStyle</a></code>
   interface implemented on individual <code>Node</code> objects or through
   the <code><a href="#documentstyle">DocumentStyle</a></code> interface
   implemented on the <code>Document</code> object. The <code><a
   href="#documentstyle">DocumentStyle</a></code> interface also provides an
   interface for enabling alternate style sheets and manipulating style sheet
   sets.

  <h3 id=terminology0><span class=secno>2.1. </span>Terminology</h3>

  <p>Each style sheet can have a title. A <a href="#style-sheet">style
   sheet</a> is said to <dfn id=style-sheet-title title="have a title">have a
   title</dfn> if the <code>title</code> attribute on the <code><a
   href="#stylesheet">StyleSheet</a></code> object is neither
   <code>null</code> nor the empty string.

  <p><dfn id=persistent title="persistent style sheet">Persistent style
   sheets</dfn> are style sheets <a href="#style-sheet-title" title="have a
   title">without a title</a>.

  <p>One or more style sheets <a href="#style-sheet-title" title="have a
   title">with the same title</a> (case-sensitive) form a <dfn id=style
   title="style sheet set">style sheet set</dfn>.

  <h3 id=the-linkstyle><span class=secno>2.2. </span>The <code><a
   href="#linkstyle">LinkStyle</a></code> Interface</h3>

  <p>Nodes within the DOM causing the association of a style sheet <em
   class=ct>must</em> implement the <code><a
   href="#linkstyle">LinkStyle</a></code> interface.

  <p>SVG UAs <em class=ct>must</em> implement <code><a
   href="#linkstyle">LinkStyle</a></code> on objects implementing the
   <code>SVGStyleElement</code> interface. HTML UAs <em class=ct>must</em>
   implement <code><a href="#linkstyle">LinkStyle</a></code> on objects
   implementing <code>HTMLLinkElement</code> or
   <code>HTMLStyleElement</code>. They <em class=ct>must</em> also implement
   it on objects implementing <code>HTMLMetaElement</code> if the
   <code>Link</code> HTTP header is supported. UAs supporting the
   <code>&lt;?xml-stylesheet?></code> processing instruction <em
   class=ct>must</em> implement <code><a
   href="#linkstyle">LinkStyle</a></code> on objects implementing
   <code>ProcessingInstruction</code>.

  <p>Specifications introducing new ways of associating style sheets through
   the DOM <em class=ct>should</em> define which objects implement the
   <code><a href="#linkstyle">LinkStyle</a></code> interface. In addition,
   these specifications <em class=ct>should</em> define how these objects
   create a <code><a href="#stylesheet">StyleSheet</a></code> object.

  <pre class=idl>interface <dfn id=linkstyle>LinkStyle</dfn> {
  readonly attribute <a href="#stylesheet">StyleSheet</a>       <a href="#linkstyle-sheet" title=linkstyle-sheet>sheet</a>;
};</pre>

  <dl class=members>
   <dt><dfn id=linkstyle-sheet title=linkstyle-sheet><code>sheet</code></dfn>
    of type <code><a href="#stylesheet">StyleSheet</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be the <code><a
    href="#stylesheet">StyleSheet</a></code> the node is referring to or
    <code>null</code> if the node is not referring to a <code><a
    href="#stylesheet">StyleSheet</a></code> (for example, all
    <code>link</code> elements in HTML implement this interface, but not all
    <code>link</code> elements are used for style sheets).
  </dl>

  <p class=note>Whether or not the node refers to a style sheet is defined by
   the specification the defines the semantics of said node.

  <h3 id=the-documentstyle><span class=secno>2.3. </span>The <code><a
   href="#documentstyle">DocumentStyle</a></code> Interface</h3>

  <p>Any object implementing the <code>Document</code> interface <em
   class=ct>must</em> also implement the <code><a
   href="#documentstyle">DocumentStyle</a></code> interface.</p>
  <!-- https://bugzilla.mozilla.org/show_bug.cgi?id=200930 (FIXED) -->

  <pre class=idl>interface <dfn id=documentstyle>DocumentStyle</dfn> {
  readonly attribute <a href="#stylesheetlist">StyleSheetList</a>   <a href="#documentstyle-stylesheets">styleSheets</a>;
           attribute DOMString        <a href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a>;
  readonly attribute DOMString        <a href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a>;
  readonly attribute DOMString        <a href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a>;
  readonly attribute DOMStringList    <a href="#documentstyle-styleSheetSets">styleSheetSets</a>;
  void               <a href="#documentstyle-enablestylesheetsforset" title=documentstyle-enablestylesheetsforset>enableStylesheetsForSet</a>(in DOMString <var>name</var>);
};</pre>

  <p>For this interface, the <code>DOMString</code> values <code>null</code>
   and "the empty string" are distinct, and <em class=ct>must</em> not be
   considered equivalent.

  <p>The members are defined as follows:

  <dl class=members>
   <dt><dfn id=documentstyle-stylesheets><code>styleSheets</code></dfn> of
    type <code><a href="#stylesheetlist">StyleSheetList</a></code>

   <dd>
    <p>This attribute <em class=ct>must</em> be a <code><a
     href="#stylesheetlist">StyleSheetList</a></code> object containing a
     collection of all style sheets associated with the document. (All
     objects implementing the <code><a href="#linkstyle">LinkStyle</a></code>
     interface in document order preceeded by style sheets introduced by HTTP
     headers.)</p>

   <dt><dfn
    id=documentstyle-selectedStyleSheetSet><code>selectedStyleSheetSet</code></dfn>
    of type <code>DOMString</code>

   <dd>
    <p>This attribute indicates which <a href="#style">style sheet set</a> is
     in use. This attribute is <span>live</span>; changing the <code
     title=stylesheet-disabled><a
     href="#stylesheet-disabled">disabled</a></code> attribute on style
     sheets directly will change the value of this attribute.</p>

    <p>If all the sheets that are enabled and <a
     href="#style-sheet-title">have a title</a> have the <em>same</em> title
     (by <span>case-sensitive</span> comparisons) then the value of this
     attribute <em class=ct>must</em> be exactly equal to the title of the
     first enabled style sheet with a title in the <code><a
     href="#documentstyle-stylesheets">styleSheets</a></code> list.
     Otherwise, if style sheets from different sets are enabled, then the
     return value <em class=ct>must</em> be <code>null</code> (there is no
     way to determine what the currently selected style sheet set is in those
     conditions). Otherwise, either all style sheets that <a
     href="#style-sheet-title">have a title</a> are disabled, or there are no
     alternate style sheets, and <code><a
     href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
     <em class=ct>must</em> return the empty string.</p>

    <p>Setting this attribute to the <code>null</code> value <em
     class=ct>must</em> have no effect.</p>

    <p>Setting this attribute to a non-<code>null</code> value <em
     class=ct>must</em> call <code
     title=documentstyle-enablestylesheetsforset><a
     href="#documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</a></code>
     with that value as the method's argument, and set <code><a
     href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code> to
     that value.</p>

    <p>From the DOM's perspective, all views have the same <code><a
     href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>.
     If a user agent supports multiple views with different selected
     alternate style sheets, then this attribute (and the <code><a
     href="#stylesheet">StyleSheet</a></code> interface's
     <code>disabled</code> attribute) <em class=ct>must</em> return and set
     the value for the default view.</p>

   <dt><dfn
    id=documentstyle-lastStyleSheetSet><code>lastStyleSheetSet</code></dfn>
    of type <code>DOMString</code>, readonly

   <dd>
    <p>This property <em class=ct>must</em> initially have the value
     <code>null</code>. Its value changes when the <code><a
     href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
     attribute is set.</p>

   <dt><dfn
    id=documentstyle-preferredStyleSheetSet><code>preferredStyleSheetSet</code></dfn>
    of type <code>DOMString</code>, readonly

   <dd>
    <p>This attribute <em class=ct>must</em> be the preferred style sheet set
     as set by the author. It is determined from the order of style sheet
     declarations and the <code>Default-Style</code> HTTP headers. If there
     is no preferred style sheet set, this attribute <em class=ct>must</em>
     be the empty string. The case of this attribute <em class=ct>must</em>
     exactly match the case given by the author where the preferred style
     sheet is specified or implied. This attribute <em class=ct>must</em>
     never be <code>null</code>.</p>

   <dt><dfn id=documentstyle-styleSheetSets><code>styleSheetSets</code></dfn>
    of type <code>DOMStringList</code>, readonly

   <dd>
    <p>This <em class=ct>must</em> be a <span>live</span> list of the
     currently available <span>style sheet sets</span>. This list is
     constructed by enumerating all the style sheets for this document
     available to the implementation, in the order they are listed in the
     <code><a href="#documentstyle-stylesheets">styleSheets</a></code>
     attribute, adding the title of each style sheet <a
     href="#style-sheet-title" title="have a title">with a title</a> to the
     list, avoiding duplicates by dropping titles that match
     (<span>case-sensitively</span>) titles that have already been added to
     the list.</p>

   <dt><dfn id=documentstyle-enablestylesheetsforset
    title=documentstyle-enablestylesheetsforset><code>enableStylesheetsForSet(<var
    title="">name</var>)</code></dfn>, method

   <dd>
    <p>Invoking this method <em class=ct>must</em> change the <code
     title=stylesheet-disabled><a
     href="#stylesheet-disabled">disabled</a></code> attribute on each
     <code><a href="#stylesheet">StyleSheet</a></code> object <a
     href="#style-sheet-title" title="have a title">with a title</a> in the
     <code><a href="#documentstyle-stylesheets">styleSheets</a></code>
     attribute, so that all those whose title matches the <var
     title="">name</var> argument are enabled, and all others are disabled.
     Title matches <em class=ct>must</em> be <span>case-sensitive</span>.</p>

    <p>Invoking this method with the empty string value <em
     class=ct>must</em> disable all alternate and preferred style sheets (but
     does not change the state of persistent style sheets).</p>

    <p>Invoking this method with the <code>null</code> value <em
     class=ct>must</em> have no effect.</p>
    <!-- fact: -->
    <p>Style sheets that do not <a href="#style-sheet-title">have a title</a>
     are never affected by this method. This method does not change the
     values of the <code><a
     href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code> or
     <code><a
     href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
     attributes.</p>
  </dl>

  <h3 id=the-stylesheetlist><span class=secno>2.4. </span>The <code><a
   href="#stylesheetlist">StyleSheetList</a></code> Interface</h3>

  <p>The object implementing this interface represents a live collection of
   all style sheets in document order preceeded by style sheets linked from
   HTTP headers.

  <p>In bindings that allow it, enumerating a <code><a
   href="#stylesheetlist">StyleSheetList</a></code> object <em
   class=ct>must</em> enumerate through the currently stored and accessible
   items in the list the object is associated with. This ensures
   <code>document.styleSheets[1].<var>x</var></code> is possible from
   ECMAScript for example.

  <pre class=idl>interface <dfn id=stylesheetlist>StyleSheetList</dfn> {
  readonly attribute unsigned long    <span title=stylesheetlist-length>length</span>;
  <a href="#stylesheet">StyleSheet</a>         <span title=stylesheetlist-item>item</span>(in unsigned long <var>index</var>);
};</pre>

  <p>The members of the <code><a
   href="#stylesheetlist">StyleSheetList</a></code> object are defined as
   follows:

  <dl class=members>
   <dt><dfn id=stylesheetlist-length><code>length</code></dfn>, of type
    <code>unsigned long</code>, readonly

   <dd>This attribute <em class=ct>must</em> be the number of style sheets
    currently in the list.

   <dt><dfn id=stylesheetlist-item><code>item(<var>index</var>)</code></dfn>,
    method

   <dd>When invoked, this method <em class=ct>must</em> return the <code><a
    href="#stylesheet">StyleSheet</a></code> in the list given by
    <var>index</var>. If <var>index</var> is less than zero then this method
    <em class=ct>must</em> raise an <code>INDEX_SIZE_ERR</code> exception. If
    <var>index</var> is greater than or equal to the number of style sheets
    currently in the list this method <em class=ct>must</em> return
    <code>null</code>.</dd>
   <!-- Internet Explorer throws an exception for [largevalue] as well. -->
  </dl>

  <h3 id=dynamically><span class=secno>2.5. </span>Dynamically adding new
   style sheets</h3>

  <p>If new style sheets <a href="#style-sheet-title" title="have a
   title">with titles</a> are added to the document, the user agent <em
   class=ct>must</em> decide whether or not the style sheets should be
   initially enabled or not. How this happens depends on the exact state of
   the document at the time the style sheet is added, as follows.

  <h4 id=adding><span class=secno>2.5.1. </span>Adding style sheets</h4>

  <p>First, if the style sheet is a preferred style sheet (it <a
   href="#style-sheet-title" title="have a title">has a title</a>, but is not
   marked as alternate), and there is no current preferred style sheet (the
   <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   attribute is equal to the empty string) then the <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   attribute is set to the exact value of this style sheet's title. (This
   changes the preferred style sheet set, which causes further changes
   &mdash; see below.)

  <p>Then, for all sheets, if any of the following is true, then the style
   sheet <em class=ct>must</em> be enabled:

  <ul>
   <li>The style sheet has an empty title.

   <li>The <code><a
    href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code> is
    <code>null</code>, and the style sheet's title matches (by
    <span>case-sensitive</span> match) the value of the <code><a
    href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
    attribute.

   <li>The style sheet's title matches (by <span>case-sensitive</span> match)
    the value of the <code><a
    href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
    attribute.
  </ul>

  <p>Otherwise, the style sheet <em class=ct>must</em> be disabled.

  <h4 id=changing><span class=secno>2.5.2. </span>Changing the preferred
   style sheet set</h4>

  <p>The first time the <span>preferred style sheet</span> set is set, which
   is either before any alternate style sheets are seen (e.g. using a
   <code>Default-Style</code> HTTP header), or is the first time a titled,
   non-alternate style sheet is seen (in the absence of information to the
   contrary, the first titled non-alternate sheet sets the name of the
   preferred set), the <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   attribute's value <em class=ct>must</em> be set to the name of that
   preferred style sheet set. This does not change the <code><a
   href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
   attribute.

  <p>If the user agent has the preferred style sheet set changed, for example
   if it receives a <code>Default-Style</code> HTTP header after it receives
   HTTP <code>Link</code> headers implying another preferred style sheet,
   then the <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   attribute's value <em class=ct>must</em> be changed appropriately, and, if
   the <code><a
   href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code> is
   <code>null</code>, the <code
   title=documentstyle-enablestylesheetsforset><a
   href="#documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</a></code>
   method <em class=ct>must</em> be called with the new <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   value. (The <code><a
   href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
   attribute is, again, not changed.)

  <h4 id=examples><span class=secno>2.5.3. </span>Examples</h4>

  <div class=example>
   <p>Thus, in the following HTML snippet:</p>

   <pre>&lt;link rel="alternate stylesheet" title="foo" href="a"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="b"&gt;
&lt;script&gt;

  document.selectedStyleSheetSet = 'foo';
  document.styleSheets[1].disabled = false;
&lt;/script&gt;
&lt;link rel="alternate stylesheet" title="foo" href="c"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="d"&gt;</pre>

   <p>...the style sheets that end up enabled are style sheets "a", "b", and
    "c", the <code><a
    href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
    attribute would return null, <code><a
    href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
    would return "foo", and <code><a
    href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
    would return "".</p>

   <p>Similarly, in the following HTML snippet:</p>

   <pre>&lt;link rel="alternate stylesheet" title="foo" href="a"&gt;
&lt;link rel="alternate stylesheet" title="bar" href="b"&gt;
&lt;script&gt;
  var before = document.preferredStyleSheetSet;
  document.styleSheets[1].disabled = false;
&lt;/script&gt;
&lt;link rel="stylesheet" title="foo" href="c"&gt;

&lt;link rel="alternate stylesheet" title="bar" href="d"&gt;
&lt;script&gt;
  var after = document.preferredStyleSheetSet;
&lt;/script&gt;</pre>

   <p>...the "before" variable will be equal to the empty string, the "after"
    variable will be equal to "foo", and style sheets "a" and "c" will be
    enabled. This is the case even though the first script block sets style
    sheet "b" to be enabled, because upon parsing the following
    <code>&lt;link&gt;</code> element, the <code><a
    href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
    is set and the <code title=documentstyle-enablestylesheetsforset><a
    href="#documentstyle-enablestylesheetsforset">enableStylesheetsForSet()</a></code>
    method is called (since <code><a
    href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
    was never set explicitly, leaving <code><a
    href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code> at
    <code>null</code> throughout), which changes which style sheets are
    enabled and which are not.</p>
  </div>

  <h3 id=interaction><span class=secno>2.6. </span>Interaction with the User
   Interface</h3>

  <p>The user interface of Web browsers that support style sheets <em
   class=ct>should</em> list the style sheet titles given in the <code><a
   href="#documentstyle-styleSheetSets">styleSheetSets</a></code> list,
   showing the <code><a
   href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
   as the selected style sheet set, leaving none selected if it is
   <code>null</code> or the empty string, and selecting an extra option
   "Basic Page Style" (or similar) if it is the empty string and the <code><a
   href="#documentstyle-preferredStyleSheetSet">preferredStyleSheetSet</a></code>
   is the empty string as well.

  <p>Selecting a style sheet from this list should set the <code><a
   href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
   attribute. This (by definition) affects the <code><a
   href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
   attribute.

  <h4 id=persisting><span class=secno>2.6.1. </span>Persisting the selected
   style sheet set</h4>

  <p>If UAs persist the selected style sheet set, they should use the value
   of the <code><a
   href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
   attribute, or if that is <code>null</code>, the <code><a
   href="#documentstyle-lastStyleSheetSet">lastStyleSheetSet</a></code>
   attribute, when leaving the page (or at some other time) to determine the
   set name to store. If that is <code>null</code> then the style sheet set
   should not be persisted.

  <p>When re-setting the style sheet set to the persisted value (which can
   happen at any time, typically at the first time the style sheets are
   needed for styling the document, after the <code>&lt;head&gt;</code> of
   the document has been parsed, after any scripts that are not dependent on
   computed style have executed), the style sheet set should be set by
   setting the <code><a
   href="#documentstyle-selectedStyleSheetSet">selectedStyleSheetSet</a></code>
   attribute as if the user had selected the set manually.

  <p class=note>This specification does not give any suggestions on how UAs
   should decide to persist the style sheet set or whether or how to persist
   the selected set across pages.

  <h3 id=forward><span class=secno>2.7. </span>Forward compatibility</h3>

  <p>Future versions of CSS may introduce ways of having alternate style
   sheets declared at levels lower than the top level, i.e. embedded within
   other style sheets. Implementations of this specification that also
   support this proposed declaration of alternate style sheets are expected
   to perform depth-first traversals of the <code><a
   href="#documentstyle-stylesheets">styleSheets</a></code> list, not simply
   enumerations of the <code><a
   href="#documentstyle-stylesheets">styleSheets</a></code> list that only
   contains the top level.

  <p class=issue>Would that actually work?!

  <h3 id=the-stylesheet><span class=secno>2.8. </span>The <code><a
   href="#stylesheet">StyleSheet</a></code> Interface</h3>

  <p>Each style sheet is represented by a <code><a
   href="#stylesheet">StyleSheet</a></code> object.

  <pre class=idl>interface <dfn id=stylesheet>StyleSheet</dfn> {
  readonly attribute DOMString        <a href="#stylesheet-type" title=stylesheet-type>type</a>;
           attribute boolean          <a href="#stylesheet-disabled" title=stylesheet-disabled>disabled</a>;
  readonly attribute Node             <a href="#stylesheet-ownernode" title=stylesheet-ownernode>ownerNode</a>;
  readonly attribute <a href="#stylesheet">StyleSheet</a>       <a href="#stylesheet-parentstylesheet" title=stylesheet-parentstylesheet>parentStyleSheet</a>;
  readonly attribute DOMString        <a href="#stylesheet-href" title=stylesheet-href>href</a>;
  readonly attribute DOMString        <a href="#stylesheet-title" title=stylesheet-title>title</a>;
  readonly attribute <a href="#medialist">MediaList</a>        <a href="#stylesheet-media" title=stylesheet-media>media</a>;
};</pre>

  <dl class=members>
   <dt><dfn id=stylesheet-type title=stylesheet-type><code>type</code></dfn>
    of type <code>DOMString</code>, readonly

   <dd>
    <p>This attribute <em class=ct>must</em> be the style sheet media type of
     the style sheet.</p>

    <p class=issue>Which specification defines what the media type of a style
     sheet is?</p>

   <dt><dfn id=stylesheet-disabled
    title=stylesheet-disabled><code>disabled</code></dfn> of type
    <code>boolean</code>

   <dd>
    <p>On getting, this attribute <em class=ct>must</em> be <code>true</code>
     when the style sheet is disabled and <code>false</code> otherwise.</p>

    <p>On setting, a value of <code>true</code> <em class=ct>must</em>
     disable the style sheet and a value of <code>false</code> enable it.</p>

   <dt><dfn id=stylesheet-ownernode
    title=stylesheet-ownernode><code>ownerNode</code></dfn> of type
    <code>Node</code>, readonly

   <dd>This attribute <em class=ct>must</em> be the <code>Node</code> that
    associates the style sheet with the document or <code>null</code>
    otherwise. This <code>Node</code> has implemented the <code><a
    href="#linkstyle">LinkStyle</a></code> interface.

   <dt><dfn id=stylesheet-parentstylesheet
    title=stylesheet-parentstylesheet><code>parentStyleSheet</code></dfn> of
    type <code><a href="#stylesheet">StyleSheet</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be the <code><a
    href="#stylesheet">StyleSheet</a></code> object that caused the inclusion
    of the current style sheet or <code>null</code> if there is no such
    object.

   <dt><dfn id=stylesheet-href title=stylesheet-href><code>href</code></dfn>
    of type <code>DOMString</code>, readonly

   <dd>This attribute <em class=ct>must</em> be an IRI pointing to the
    location of the standalone style sheet or <code>null</code> otherwise
    (when it's inside a <code>style</code> element for example).</dd>
   <!-- XXX: ready for IRI-hell? -->

   <dt><dfn id=stylesheet-title
    title=stylesheet-title><code>title</code></dfn> of type
    <code>DOMString</code>

   <dd>This attribute <em class=ct>must</em> be the <a
    href="#style-sheet-title" title="have a title">title</a> of the style
    sheet. In HTML this can obtained from the <code>HTMLLinkElement</code> or
    <code>HTMLStyleElement</code> for example.

   <dt><dfn id=stylesheet-media
    title=stylesheet-media><code>media</code></dfn> of type <code><a
    href="#medialist">MediaList</a></code>, readonly

   <dd>
    <p>This attribute <em class=ct>must</em> be a <code><a
     href="#medialist">MediaList</a></code> object.</p>

    <p>In binding languages that support setting to a readonly attribute
     setting <code title=stylesheet-media><a
     href="#stylesheet-media">media</a></code> to a string <em
     class=ct>must</em> set the value of <code title=medialist-mediatext><a
     href="#medialist-mediatext">mediaText</a></code> on the <code><a
     href="#medialist">MediaList</a></code> object.</p>
    <!-- XXX -->
  </dl>

  <h3 id=the-medialist><span class=secno>2.9. </span>The <code><a
   href="#medialist">MediaList</a></code> Interface</h3>

  <p class=issue>This interface depends on the Media Queries specification
   which still has some issues.

  <p>The <code><a href="#medialist">MediaList</a></code> object represents a
   collection of media queries. It provides various ways to manipulate this
   collection.

  <p>In bindings that allow it, enumerating a <code><a
   href="#medialist">MediaList</a></code> object <em class=ct>must</em>
   enumerate through the current collection of media queries.</p>
  <!--
  <p>The items in the <code>MediaList</code> <em class="ct">must</em> be
   accessible via an integral index, starting from 0.</p>
  -->

  <p>In bindings that allow it, such as ECMAScript, <code><a
   href="#medialist">MediaList</a></code> objects <em class=ct>must</em>
   stringify to their <code title=medialist-mediatext><a
   href="#medialist-mediatext">mediaText</a></code> attribute's value.

  <pre class=idl>interface <dfn id=medialist>MediaList</dfn> {
           attribute DOMString        <a href="#medialist-mediatext" title=medialist-mediatext>mediaText</a>;
  readonly attribute unsigned long    <a href="#medialist-length" title=medialist-length>length</a>;
  DOMString          <a href="#medialist-item" title=medialist-item>item</a>(in unsigned long <var title="">index</var>);
  void               <a href="#medialist-appendmedium" title=medialist-appendmedium>appendMedium</a>(in DOMString <var title="">medium</var>)
  void               <a href="#medialist-deletemedium" title=medialist-deletemedium>deleteMedium</a>(in DOMString <var title="">medium</var>)
};</pre>

  <dl class=members>
   <dt><dfn id=medialist-mediatext
    title=medialist-mediatext><code>mediaText</code></dfn> of type
    <code>DOMString</code>

   <dd>
    <p>On getting this attribute <em class=ct>must</em> be a comma-separated
     list of <a href="#canon-media" title=canon-media>normalized media
     queries</a> or the empty string otherwise.</p>

    <p>On setting <span class=issue>...</span>.</p>
    <!-- XXX Media Queries need to define parsing of media queries more
    accurately. -->
    

   <dt><dfn id=medialist-length
    title=medialist-length><code>length</code></dfn> of type <code>unsigned
    long</code>

   <dd>This attribute <em class=ct>must</em> be the number of media in the
    list.

   <dt><dfn id=medialist-item title=medialist-item><code>item(<var
    title="">index</var>)</code></dfn>, method

   <dd>When invoked, this method <em class=ct>must</em> return the media
    query in the collection given by <var>index</var>. If <var>index</var> is
    less than zero then this method <em class=ct>must</em> raise an
    <code>INDEX_SIZE_ERR</code> exception. If <var>index</var> is greater
    than or equal to the number of media queries currently in the collection
    this method <em class=ct>must</em> return <code>null</code>.

   <dt><dfn id=medialist-appendmedium
    title=medialist-appendmedium><code>appendMedium(<var
    title="">medium</var>)</code></dfn>, method

   <dd>When invoked, <span class=issue>...</span>. <!--
   XXX see above, Media Queries need to define parsing of media queries.

   otherwise it <em class="ct">must</em> act as if
   <code>deleteMedium</code> was invoked with <var>newMedium</var> as argument
   (if it was in the list) and add <var>newMedium</var> to the end of the
   list.
   -->

   <dt><dfn id=medialist-deletemedium
    title=medialist-deletemedium><code>deleteMedium(<var
    title="">medium</var>)</code></dfn>, method

   <dd>This method, when invoked, <em class=ct>must</em> raise a
    <code>NOT_FOUND_ERR</code> exception when <var>medium</var> is not in the
    collection. Otherwise, <var>medium</var> <em class=ct>must</em> be
    removed from the collection.
  </dl>

  <h2 id=cascading><span class=secno>3. </span>Cascading Style Sheets APIs</h2>

  <p class=issue>It would be very nice if parsing of style sheets was well
   defined. (Similar to parsing in HTML5.) That would make this section
   easier to write.

  <p><em>This section (and its subsections) are only applicable to UAs
   implementing CSS.</em>

  <p>The previous section provided a way of getting access to style sheets in
   a generic way. This section provides a way for getting access to the
   individual style rules within a Cascading Style Sheet as defined by the
   CSS 2.1 specification [CSS21].

  <h3 id=introduction0><span class=secno>3.1. </span>Introduction</h3>

  <p>A <a href="#css-style-sheet">CSS style sheet</a> consists of zero or
   more statements. A statement is either a ruleset or an at-rule. A ruleset
   consists of a group of selectors with a declaration block associated with
   it. A declaration block consists of multiple declarations. A declaration
   consists of a property and a value.

  <p>Each at-rule has its own syntax.

  <p>This specification generally refers to statements as rules or CSS rules.</p>
  <!-- http://www.w3.org/TR/2006/WD-CSS21-20060411/syndata.html#syntax -->

  <p class=issue>Do we need pointers here, explaining each?

  <h3 id=the-cssstylesheet><span class=secno>3.2. </span>The <code><a
   href="#cssstylesheet">CSSStyleSheet</a></code> Interface</h3>

  <p>The <code><a href="#cssstylesheet">CSSStyleSheet</a></code> interface
   represents a <a href="#css-style-sheet">CSS style sheet</a>.

  <pre
   class=idl>interface <dfn id=cssstylesheet>CSSStyleSheet</dfn> : <a href="#stylesheet">StyleSheet</a> {
  readonly attribute <a href="#cssrule">CSSRule</a>          <a href="#cssstylesheet-ownerrule">ownerRule</a>;
  readonly attribute <a href="#cssrulelist">CSSRuleList</a>      <a href="#cssstylesheet-cssrules" title=cssstylesheet-cssrules>cssRules</a>;
  unsigned long      <a href="#cssstylesheet-insertrule" title=cssstylesheet-insertrule>insertRule</a>(in DOMString <var>rule</var>, in unsigned long <var>index</var>);
  void               <a href="#cssstylesheet-deleterule" title=cssstylesheet-deleterule>deleteRule</a>(in unsigned long <var>index</var>);
};</pre>

  <dl class=members>
   <dt><dfn id=cssstylesheet-ownerrule><code>ownerRule</code></dfn> of type
    <code><a href="#cssrule">CSSRule</a></code>, readonly

   <dd>If the style sheet was loaded due to an <code>@import</code> rule this
    attribute <em class=ct>must</em> be the <code><a
    href="#cssimportrule">CSSImportRule</a></code> that caused this style
    sheet to be imported. Otherwise it <em class=ct>must</em> be
    <code>null</code>.

   <dt><dfn id=cssstylesheet-cssrules
    title=cssstylesheet-cssrules><code>cssRules</code></dfn> of type <code><a
    href="#cssrulelist">CSSRuleList</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be a <code><a
    href="#cssrulelist">CSSRuleList</a></code> that holds live references to
    each top level <code><a href="#cssrule">CSSRule</a></code> in the style
    sheet, including rule sets and at-rules.</dd>
   <!-- XXX define "top level" perhaps? -->

   <dt><dfn id=cssstylesheet-insertrule
    title=cssstylesheet-insertrule><code>insertRule(<var>rule</var>,
    <var>index</var>)</code></dfn>, method

   <dd>This method <em class=ct>must</em> raise a <code>SYNTAX_ERR</code>
    exception if <var>rule</var> contains a syntax error. If the
    <var>rule</var> is valid, but is inserted at a point where it can't occur
    (<code>@import</code> is inserted after a normal rule set) a
    <code>HIERARCHY_REQUEST_ERR</code> exception <em class=ct>must</em> be
    raised. If the specified <var>index</var> is not a valid insertion point
    a <code>INDEX_SIZE_ERR</code> exception <em class=ct>must</em> be raised.
    Otherwise, the <var>rule</var> <em class=ct>must</em> be inserted at
    given <var>index</var>.

   <dt><dfn id=cssstylesheet-deleterule
    title=cssstylesheet-deleterule><code>deleteRule(<var>index</var>)</code></dfn>,
    method

   <dd>This method <em class=ct>must</em> raise a <code>INDEX_SIZE_ERR</code>
    exception if the given <var>index</var> does not correspond to a rule in
    the style sheet. Otherwise, it <em class=ct>must</em> remove the rule at
    <var>index</var>.
  </dl>

  <h3 id=the-cssrulelist><span class=secno>3.3. </span>The <code><a
   href="#cssrulelist">CSSRuleList</a></code> Interface</h3>

  <p>In bindings that allow it, enumerating a <code><a
   href="#cssrulelist">CSSRuleList</a></code> object <em class=ct>must</em>
   enumerate through the currently stored and accessible items in the list
   the object is associated with.

  <pre class=idl>interface <dfn id=cssrulelist>CSSRuleList</dfn> {
  readonly attribute unsigned long    <a href="#cssrulelist-length" title=cssrulelist-length>length</a>;
  <a href="#cssrule">CSSRule</a>            <a href="#cssrulelist-item" title=cssrulelist-item>item</a>(in unsigned long <var>index</var>);
};</pre>

  <dl class=members>
   <dt><dfn id=cssrulelist-length
    title=cssrulelist-length><code>length</code></dfn> of type <code>unsigned
    long</code>, readonly

   <dd>This attribute <em class=ct>must</em> be the number of rules in the
    object.

   <dt><dfn id=cssrulelist-item
    title=cssrulelist-item><code>item</code></dfn>, method

   <dd>This method <em class=ct>must</em> return the <code><a
    href="#cssrule">CSSRule</a></code> in the list given by <var>index</var>
    using an ordinal index or <code>null</code> otherwise.
  </dl>

  <h3 id=interfaces><span class=secno>3.4. </span>Interfaces For CSS Rules</h3>

  <p>This section defines several specific interfaces and one generic for
   different types of CSS rules.

  <h4 id=the-cssrule><span class=secno>3.4.1. </span>The <code><a
   href="#cssrule">CSSRule</a></code> Interface</h4>

  <pre class=idl>interface <dfn id=cssrule>CSSRule</dfn> {
  const unsigned short      <a href="#cssrule-style-rule">STYLE_RULE</a>                     = 1;
  const unsigned short      <a href="#cssrule-charset-rule">CHARSET_RULE</a>                   = 2;
  const unsigned short      <a href="#cssrule-import-rule">IMPORT_RULE</a>                    = 3;
  const unsigned short      <a href="#cssrule-media-rule">MEDIA_RULE</a>                     = 4;
  const unsigned short      <a href="#cssrule-font-face-rule">FONT_FACE_RULE</a>                 = 5;
  const unsigned short      <a href="#cssrule-page-rule">PAGE_RULE</a>                      = 6;
  const unsigned short      <a href="#cssrule-namespace-rule">NAMESPACE_RULE</a>                 = 7;

  readonly attribute unsigned short   <a href="#cssrule-type" title=cssrule-type>type</a>;
           attribute DOMString        <a href="#cssrule-csstext" title=cssrule-csstext>cssText</a>;
  readonly attribute <a href="#cssrule">CSSRule</a>          <a href="#cssrule-parentrule" title=cssrule-parentrule>parentRule</a>;
  readonly attribute <a href="#cssstylesheet">CSSStyleSheet</a>    <a href="#cssrule-parentstylesheet" title=cssrule-parentstylesheet>parentStyleSheet</a>;
};</pre>

  <p>The <dfn id=cssrule-style-rule><code>STYLE_RULE</code></dfn>, <dfn
   id=cssrule-charset-rule><code>CHARSET_RULE</code></dfn>, <dfn
   id=cssrule-import-rule><code>IMPORT_RULE</code></dfn>, <dfn
   id=cssrule-media-rule><code>MEDIA_RULE</code></dfn>, <dfn
   id=cssrule-font-face-rule><code>FONT_FACE_RULE</code></dfn>, <dfn
   id=cssrule-page-rule><code>PAGE_RULE</code></dfn> and <dfn
   id=cssrule-namespace-rule><code>NAMESPACE_RULE</code></dfn> contants
   indicate if you have a <code><a
   href="#cssstylerule">CSSStyleRule</a></code>, <code><a
   href="#csscharsetrule">CSSCharsetRule</a></code>, <code><a
   href="#cssimportrule">CSSImportRule</a></code>, <code><a
   href="#cssmediarule">CSSMediaRule</a></code>, <code><a
   href="#cssfontfacerule">CSSFontFaceRule</a></code>, <code><a
   href="#csspagerule">CSSPageRule</a></code> or <code><a
   href="#cssnamespacerule">CSSNamespaceRule</a></code> rule type
   respectively.

  <dl class=members>
   <dt><dfn id=cssrule-type title=cssrule-type><code>type</code></dfn> of
    type <code>unsigned short</code>, readonly

   <dd>This attribute <em class=ct>must</em> be any of the defined constants.</dd>
   <!--Do we need to say anything about casting methods here?-->

   <dt><dfn id=cssrule-csstext
    title=cssrule-csstext><code>cssText</code></dfn> of type
    <code>DOMString</code>

   <dd>
    <p>This attribute <em class=ct>must</em> be a live textual representation
     of the style rule.

    <p>On setting a <code>SYNTAX_ERR</code> exception <em class=ct>must</em>
     be raised if the given rule has a syntax error (was not parsable per
     CSS). When set to a different type of rule a
     <code>INVALID_MODIFICATION_ERR</code> exception <em class=ct>must</em>
     be raised. Otherwise, the value becomes the setted value.</p>

    <p class=issue>Formatted how? When would you get a
     <code>HIERARCHY_REQUEST_ERR</code> exception here?</p>

   <dt><dfn id=cssrule-parentrule
    title=cssrule-parentrule><code>parentRule</code></dfn> of type <code><a
    href="#cssrule">CSSRule</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be the nearest enclosing rule of
    the current rule. For example, an <code>@media</code> block enclosing the
    current rule.

   <dt><dfn id=cssrule-parentstylesheet
    title=cssrule-parentstylesheet><code>parentStyleSheet</code></dfn> of
    type <code><a href="#cssstylesheet">CSSStyleSheet</a></code>, readonly

   <dd>attribute <em class=ct>must</em> point to the style sheet that
    contains the current rule.
  </dl>

  <h5 id=extensibility><span class=secno>3.4.1.1. </span>Extensibility</h5>

  <p>The values 0-1000 are reserved for future use by the CSS WG.

  <p>Vendors are suggested to use values outside this range and are
   reasonable unique so that they don't clash with extensions from other
   vendors. For example, the first value for Mozilla could be
   <code>0x08EC0001</code> and <code>0x09E8A001</code> could be the one for
   Opera.</p>
  <!-- 8EC0 -> Gecko
       09E8A -> Opera -->

  <h4 id=the-cssstylerule><span class=secno>3.4.2. </span>The <code><a
   href="#cssstylerule">CSSStyleRule</a></code> Interface</h4>

  <p>The <code><a href="#cssstylerule">CSSStyleRule</a></code> object
   represents a ruleset. It provides access to a declaration block as well as
   to the group of selectors.

  <pre
   class=idl>interface <dfn id=cssstylerule>CSSStyleRule</dfn> : <a href="#cssrule">CSSRule</a> {
           attribute DOMString        <a href="#cssstylerule-selectortext" title=cssstylerule-selectortext>selectorText</a>;
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a>  <a href="#cssstylerule-style" title=cssstylerule-style>style</a>;
};</pre>

  <dl class=members>
   <dt><dfn id=cssstylerule-selectortext
    title=cssstylerule-selectortext><code>selectorText</code></dfn> of type
    <code>DOMString</code>

   <dd>This attribute <em class=ct>must</em> contain a <span
    title=canon-selectors>textual representation of the group of
    selectors</span> for the declaration block. On setting, a
    <code>SYNTAX_ERR</code> exception <em class=ct>must</em> be raised if the
    selector was not parsable. Otherwise, it <em class=ct>must</em> be set to
    the specified value.

   <dt><dfn id=cssstylerule-style
    title=cssstylerule-style><code>style</code></dfn> of type <code><a
    href="#cssstyledeclaration">CSSStyleDeclaration</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be a live reference to the
    declaration block for the current rule set.
  </dl>

  <h4 id=the-csscharsetrule><span class=secno>3.4.3. </span>The <code><a
   href="#csscharsetrule">CSSCharsetRule</a></code> Interface</h4>

  <p><code>@charset</code> can (only) be used at the very start of a <a
   href="#css-style-sheet">CSS style sheet</a> to indicate the encoding of
   the file ([CSS21], section 4.4).</p>
  <!-- XXX: this was not readonly -->

  <pre
   class=idl>interface <dfn id=csscharsetrule>CSSCharsetRule</dfn> : <a href="#cssrule">CSSRule</a> {
  readonly attribute DOMString        <a href="#csscharsetrule-encoding">encoding</a>;
};</pre>

  <dl class=members>
   <dt><dfn id=csscharsetrule-encoding><code>encoding</code></dfn> of type
    <code>DOMString</code>, readonly

   <dd>This attribute <em class=ct>must</em> be the specified encoding.
  </dl>

  <h4 id=the-cssimportrule><span class=secno>3.4.4. </span>The <code><a
   href="#cssimportrule">CSSImportRule</a></code> Interface</h4>

  <p>The <code>@import</code> at rule as described in the <cite>CSS 2.1
   Specification</cite> ([CSS21], section 6.3).</p>
  <!-- I guess this gets a title attribute at some point... -->

  <pre
   class=idl>interface <dfn id=cssimportrule>CSSImportRule</dfn> : <a href="#cssrule">CSSRule</a> {
  readonly attribute DOMString        <a href="#cssimportrule-href" title=cssimportrule-href>href</a>;
  readonly attribute <a href="#medialist">MediaList</a>        <a href="#cssimportrule-media" title=cssimportrule-media>media</a>;
  readonly attribute <a href="#cssstylesheet">CSSStyleSheet</a>    <a href="#cssimportrule-stylesheet" title=cssimportrule-stylesheet>styleSheet</a>;
};</pre>

  <dl class=members>
   <dt><dfn id=cssimportrule-href
    title=cssimportrule-href><code>href</code></dfn> of type
    <code>DOMString</code>, readonly

   <dd>This attribute <em class=ct>must</em> be the <em>resolved</em> URI of
    the style sheet to be included.

   <dt><dfn id=cssimportrule-media
    title=cssimportrule-media><code>media</code></dfn> of type <code><a
    href="#medialist">MediaList</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be a <code><a
    href="#medialist">MediaList</a></code> containing a list of media types
    for which the style sheet to be imported may be used.

   <dt><dfn id=cssimportrule-stylesheet
    title=cssimportrule-stylesheet><code>styleSheet</code></dfn> of type
    <code><a href="#cssstylesheet">CSSStyleSheet</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be the <code><a
    href="#stylesheet">StyleSheet</a></code> object loaded or
    <code>null</code> otherwise.
  </dl>
  <!-- So what happens with a 404 that is a style sheet? Or a 401?
   Or something else happens. CSS issue I guess -->

  <h4 id=the-cssmediarule><span class=secno>3.4.5. </span>The <code><a
   href="#cssmediarule">CSSMediaRule</a></code> Interface</h4>

  <p>The <code>@media</code> at-rule is represented as a single statement in
   the CSS style sheet that contains zero or more rulesets (not at-rules)
   which are contrained by one or more media (unless one happens to be
   <code>all</code>).

  <pre
   class=idl>interface <dfn id=cssmediarule>CSSMediaRule</dfn> : <a href="#cssrule">CSSRule</a> {
  readonly attribute <a href="#medialist">MediaList</a>        <a href="#cssmediarule-media" title=cssmediarule-media>media</a>;
  readonly attribute <a href="#cssrulelist">CSSRuleList</a>      <a href="#cssmediarule-cssrules" title=cssmediarule-cssrules>cssRules</a>;
  unsigned long      <a href="#cssmediarule-insertrule" title=cssmediarule-insertrule>insertRule</a>(in DOMString <var>rule</var>, in unsigned long <var>index</var>);
  void               <a href="#cssmediarule-deleterule" title=cssmediarule-deleterule>deleteRule</a>(in unsigned long <var>index</var>);
};</pre>

  <dl class=members>
   <dt><dfn id=cssmediarule-media
    title=cssmediarule-media><code>media</code></dfn> of type <code><a
    href="#medialist">MediaList</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be a <code><a
    href="#medialist">MediaList</a></code> containing a list of media types
    for which the contained rulesets may be used.

   <dt><dfn id=cssmediarule-cssrules
    title=cssmediarule-cssrules><code>cssRules</code></dfn> of type <code><a
    href="#cssrulelist">CSSRuleList</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be a <code><a
    href="#cssrulelist">CSSRuleList</a></code> containing a list of all the
    rulesets.

   <dt><dfn id=cssmediarule-insertrule
    title=cssmediarule-insertrule><code>insertRule(<var>rule</var>,
    <var>index</var>)</code></dfn>, method

   <dd>This method <em class=ct>must</em> raise a <code>SYNTAX_ERR</code>
    exception if <var>rule</var> contains a syntax error. If the
    <var>rule</var> is valid, but is inserted at a point where it can't occur
    (any at-rule) a <code>HIERARCHY_REQUEST_ERR</code> exception <em
    class=ct>must</em> be raised. If the specified <var>index</var> is not a
    valid insertion point a <code>INDEX_SIZE_ERR</code> exception <em
    class=ct>must</em> be raised. Otherwise, the <var>rule</var> <em
    class=ct>must</em> be inserted at given <var>index</var> and the
    <var>index</var> <em class=ct>must</em> be returned.

   <dt><dfn id=cssmediarule-deleterule
    title=cssmediarule-deleterule><code>deleteRule(<var>index</var>)</code></dfn>,
    method

   <dd>This method <em class=ct>must</em> raise a <code>INDEX_SIZE_ERR</code>
    exception if the given <var>index</var> does not correspond to a rule in
    the style sheet. Otherwise, it <em class=ct>must</em> remove the rule at
    <var>index</var>.
  </dl>

  <h4 id=the-cssfontfacerule><span class=secno>3.4.6. </span>The <code><a
   href="#cssfontfacerule">CSSFontFaceRule</a></code> Interface</h4>

  <p><code>@font-face</code> is used for grouping a single declaration block
   related to font settings for the page.

  <pre
   class=idl>interface <dfn id=cssfontfacerule>CSSFontFaceRule</dfn> : <a href="#cssrule">CSSRule</a> {
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a>  <a href="#cssfontfacerule-style" title=cssfontfacerule-style>style</a>;
};</pre>

  <dl class=members>
   <dt><dfn id=cssfontfacerule-style
    title=cssfontfacerule-style><code>style</code></dfn> of type <code><a
    href="#cssstyledeclaration">CSSStyleDeclaration</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be a live reference to the
    declaration block for this rule.
  </dl>

  <p class=issue>Currently <code>@font-face</code> is more or less obsolete.

  <h4 id=the-csspagerule><span class=secno>3.4.7. </span>The <code><a
   href="#csspagerule">CSSPageRule</a></code> Interface</h4>

  <p>An @page at-rule consists of a declaration block with an associated
   selector.

  <pre
   class=idl>interface <dfn id=csspagerule>CSSPageRule</dfn> : <a href="#cssrule">CSSRule</a> {
           attribute DOMString        <a href="#csspagerule-selectortext" title=csspagerule-selectortext>selectorText</a>;
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a>  <a href="#csspagerule-style" title=csspagerule-style>style</a>;
};</pre>

  <dl class=members>
   <dt><dfn id=csspagerule-selectortext
    title=csspagerule-selectortext><code>selectorText</code></dfn> of type
    <code>DOMString</code>

   <dd>
    <p>On getting, this attribute <em class=ct>must</em> contain a live
     textual representation of the page selector for the rule.</p>

    <p>On setting, a <code>SYNTAX_ERR</code> exception <em class=ct>must</em>
     be raised if the page selector was not parsable. Otherwise, it <em
     class=ct>must</em> be set to the specified value.</p>

    <p class=issue>We need to define normalization...</p>

   <dt><dfn id=csspagerule-style
    title=csspagerule-style><code>style</code></dfn> of type <code><a
    href="#cssstyledeclaration">CSSStyleDeclaration</a></code>, readonly

   <dd>This attribute <em class=ct>must</em> be a live reference to the
    declaration block for the current rule set.
  </dl>

  <h4 id=the-cssnamespacerule><span class=secno>3.4.8. </span>The <code><a
   href="#cssnamespacerule">CSSNamespaceRule</a></code> Interface</h4>

  <p>An <code>@namespace</code> at-rule consists of a token, being the
   prefix, and a URI, being the namespace.

  <pre
   class=idl>interface <dfn id=cssnamespacerule>CSSNamespaceRule</dfn> : <a href="#cssrule">CSSRule</a> {
  readonly attribute DOMString        <a href="#cssnamespacerule-namespaceuri">namespaceURI</a>;
  readonly attribute DOMString        <a href="#cssnamespacerule-prefix">prefix</a>;
};</pre>

  <dl class=members>
   <dt><dfn id=cssnamespacerule-namespaceuri><code>namespaceURI</code></dfn>
    of type <code>DOMString</code>, readonly

   <dd>This attribute <em class=ct>must</em> be the specified namespace IRI.

   <dt><dfn id=cssnamespacerule-prefix><code>prefix</code></dfn> of type
    <code>DOMString</code>, readonly

   <dd>This attribute <em class=ct>must</em> be the specified prefix or the
    empty string if there is no prefix.</dd>
   <!-- XXX lowercased? -->
  </dl>

  <h3 id=accessing0><span class=secno>3.5. </span>Accessing declaration
   blocks</h3>

  <p>This section provides various way to get to declaration blocks which you
   can then manipulate.

  <h4 id=introduction1><span class=secno>3.5.1. </span>Introduction</h4>

  <p class=issue>...

  <h4 id=the-elementcssinlinestyle><span class=secno>3.5.2. </span>The
   <code><a href="#elementcssinlinestyle">ElementCSSInlineStyle</a></code>
   Interface</h4>

  <pre
   class=idl>interface <dfn id=elementcssinlinestyle>ElementCSSInlineStyle</dfn> {
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a>  <span>style</span>;
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a>  <span>currentStyle</span>;
  readonly attribute <a href="#cssstyledeclaration">CSSStyleDeclaration</a>  <span>runtimeStyle</span>;
};</pre>

  <p class=issue>Serialization of the <code>style</code> attribute is not
   guarenteed to work.

  <h4 id=the-viewcss><span class=secno>3.5.3. </span>The <code><a
   href="#viewcss">ViewCSS</a></code> Interface</h4>

  <p>This interface represents a CSS view. The <a
   href="#viewcss-getcomputedstyle">getComputedStyle</a> method provides a
   <em>read only access</em> to the computed values of an element.

  <p>The expectation is that an instance of the <code><a
   href="#viewcss">ViewCSS</a></code> interface can be obtained by using
   binding-specific casting methods on an instance of the
   <code>AbstractView</code> interface.

  <p>Since a computed style is related to an <code>Element</code> node, if
   this element is removed from the document, the associated <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> is no longer
   valid.

  <pre class=idl>interface <dfn id=viewcss>ViewCSS</dfn> : AbstractView {
  <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <a href="#viewcss-getcomputedstyle">getComputedStyle</a>(in Element <var title="">elt</var>, in DOMString <var title="">pseudoElt</var>);
};</pre>

  <p>The <dfn id=viewcss-getcomputedstyle><code>getComputedStyle</code></dfn>
   method <em class=ct>must</em> return the computed style ([CSS21]) for the
   <code>Element</code> <var title="">elt</var> (when <var
   title="">pseudoElt</var> is <code>null</code>) or for the pseudo-element
   <var title="">pseudoElt</var> of <code>Element</code> <var
   title="">elt</var>.

  <p>For language bindings that support optional arguments invoking <code><a
   href="#viewcss-getcomputedstyle">getComputedStyle</a></code> without the
   <var title="">pseudoElt</var> argument <em class=ct>must</em> be identical
   to invoking the method with that argument being <code>null</code>.

  <h4 id=the-documentcss><span class=secno>3.5.4. </span>The <code><a
   href="#documentcss">DocumentCSS</a></code> Interface</h4>

  <p>This interface represents a document with a CSS view.</p>
  <!--
   so this is how this all comes together:

     UA style sheet
     Author style sheet
     Override ("temporary") style sheet
     User style sheet
       Author !important styles
       Override !important styles
       User !important styles
       UA !important styles (fwiw) - or does this come before user?!

    on getting you actually don't create an override style sheet you just read
    the computed style of a certain property. this should be clear.

    that's what runtimeStyle should do more or less. removeAttribute() allows
    you to remove the current style... removeAttribute is such an ugly name

    currentStyle works sort of like this
  -->

  <p>The <code><a
   href="#documentcss-getoverridestyle">getOverrideStyle</a></code> method
   provides a mechanism through which a DOM author could effect immediate
   change to the style of an element without modifying the explicitly linked
   style sheets of a document or the inline style of elements in the style
   sheets. This style sheet comes after the author style sheet in the cascade
   algorithm and is called override style sheet. The override style sheet
   takes precedence over author style sheets. An <code>!important</code>
   declaration in an author style sheet still takes precedence over a normal
   declaration in an author style sheet. Override, author and user style
   sheets may all contain <code>!important</code> declarations. User
   <code>!important</code> rules take precedence over both override and
   author <code>!important</code> rules, and override <code>!important</code>
   rules take precedence over author <code>!important</code> rules.

  <p>The expectation is that an instance of the <code><a
   href="#documentcss">DocumentCSS</a></code> interface can be obtained by
   using binding-specific casting methods on an instance of the
   <code>Document</code> interface.

  <pre
   class=idl>interface <dfn id=documentcss>DocumentCSS</dfn> : <a href="#documentstyle">DocumentStyle</a> {
  <a href="#cssstyledeclaration">CSSStyleDeclaration</a> <a href="#documentcss-getoverridestyle">getOverrideStyle</a>(in Element <var>elt</var>, in DOMString <var>pseudoElt</var>);
};</pre>

  <p>The <dfn
   id=documentcss-getoverridestyle><code>getOverrideStyle</code></dfn> method
   <em class=ct>must</em> return the override style declaration for the
   <code>Element</code> <var>elt</var> (when <var title="">pseudoElt</var> is
   <code>null</code>) or for the pseudo-element <var>pseudoElt</var> of
   <code>Element</code> <var title="">elt</var>.

  <p>For language bindings that support optional arguments invoking <code><a
   href="#documentcss-getoverridestyle">getOverrideStyle</a></code> without
   the <var>pseudoElt</var> argument <em class=ct>must</em> be identical to
   invoking the method with that argument being <code>null</code>.

  <h3 id=declaration><span class=secno>3.6. </span>Declaration blocks</h3>

  <h4 id=the-cssstyledeclaration><span class=secno>3.6.1. </span>The <code><a
   href="#cssstyledeclaration">CSSStyleDeclaration</a></code> Interface</h4>

  <pre
   class=idl>interface <dfn id=cssstyledeclaration>CSSStyleDeclaration</dfn> {
           attribute DOMString        cssText;
  DOMString          getPropertyValue(in DOMString propertyName);
  DOMString          removeProperty(in DOMString propertyName);
  DOMString          getPropertyPriority(in DOMString propertyName);
  void               setProperty(in DOMString propertyName, in DOMString value, in DOMString priority);
  readonly attribute unsigned long    length;
  DOMString          item(in unsigned long index);
  readonly attribute CSSRule          parentRule;
};</pre>

  <p class=issue>...

  <h4 id=the-css2properties><span class=secno>3.6.2. </span>The
   <code>CSS2Properties</code> Interface</h4>

  <p class=issue>If we have all the properties on
   <code>CSSStyleDeclaratoinProperties</code> do we still need this
   interface?

  <h4 id=the-cssstyledeclarationproperties><span class=secno>3.6.3.
   </span>The <code><a
   href="#cssstyledeclarationproperties">CSSStyleDeclarationProperties</a></code>
   Interface</h4>

  <pre
   class=idl>interface <dfn id=cssstyledeclarationproperties>CSSStyleDeclarationProperties</dfn> {
           // This list will be updated when more CSS property related
           // specifications become stable (for example, W3C Recommendation).

           attribute CSSAngleValue    azimuth;
           attribute <span>CSSColorValue</span>    backgroundColor;
           attribute <span>CSSURLValue</span>      backgroundImage;
           // backgroundPosition?
           // borderSpacing?
           attribute CSSColorValue    borderTopColor;
           attribute CSSColorValue    borderRightColor;
           attribute CSSColorValue    borderBottomColor;
           attribute CSSColorValue    borderLeftColor;

           // what is border takes a percentage as value in CSS3/CSS4???
           // perhaps percent should be part of length but sometimes disabled
           // based on binding specific knowledge
           attribute CSSLengthValue   borderTopWidth;
           attribute CSSLengthValue   borderRightWidth;
           attribute CSSLengthValue   borderBottomWidth;
           attribute CSSLengthValue   borderLeftWidth;

           attribute CSSLengthAndPercentageValue  bottom;

           // clip?
           attribute CSSColorValue    color;
           // content?

           attribute CSSURLValue      cueAfter;
           attribute CSSURLValue      cueBefore;
           attribute CSSURLValue      cursor;
           attribute CSSAngleValue    elevation;
           attribute CSSLengthAndPercentageValue  fontSize;
           // Number fontWeight?
           attribute CSSLengthAndPercentageValue  height;
           attribute CSSLengthAndPercentageValue  left;
           attribute CSSLengthValue   letterSpacing;
           // lineHeight CSSLengthAndPercentageAndNumberValue???!
           attribute CSSURLValue      listStyleImage;

           // \/ TRouBLe, haha
           attribute CSSLengthAndPercentageValue  marginTop;
           attribute CSSLengthAndPercentageValue  marginRight;
           attribute CSSLengthAndPercentageValue  marginBottom;
           attribute CSSLengthAndPercentageValue  marginLeft;

           attribute CSSLengthAndPercentageValue  maxHeight;
           attribute CSSLengthAndPercentageValue  maxWidth;
           attribute CSSLengthAndPercentageValue  minHeight;
           attribute CSSLengthAndPercentageValue  minWidth;
           // orphans ...
           attribute CSSColorValue    outlineColor;
           attribute CSSLengthValue   outlineWidth;
           attribute CSSLengthAndPercentageValue  paddingTop;
           attribute CSSLengthAndPercentageValue  paddingRight;
           attribute CSSLengthAndPercentageValue  paddingBottom;
           attribute CSSLengthAndPercentageValue  paddingLeft;

           attribute CSSTimeAndPercentageValue  pauseAfter;
           attribute CSSTimeAndPercentageValue  pauseBefore;
           // pitchRange?
           attribute CSSFrequencyValue  pitch;

           attribute CSSURLValue      playDuring;
           // Number richness?

           attribute CSSLengthAndPercentageValue  right;
           // speechRate?
           // stress?

           attribute CSSTimeAndPercentageValue  textIndent;
           attribute CSSLengthAndPercentageValue  top;
           attribute CSSLengthAndPercentageValue  verticalAlign;

           attribute CSSLengthAndPercentageValue  width;
           // volume?
           // widows?

           attribute CSSLengthValue   wordSpacing;
           // z-index?

};</pre>

  <h3 id=css-value><span class=secno>3.7. </span>CSS value related interfaces</h3>

  <p class=issue>...

  <h4 id=the-csspropertyvalue><span class=secno>3.7.1. </span>The <code><a
   href="#csspropertyvalue">CSSPropertyValue</a></code> Interface</h4>

  <pre class=idl>interface <dfn id=csspropertyvalue>CSSPropertyValue</dfn> {
           attribute DOMString        <span>cssText</span>;
};</pre>

  <p class=issue>...

  <h4 id=the-csscolorpropertyvalue><span class=secno>3.7.2. </span>The
   <code><a href="#csscolorpropertyvalue">CSSColorPropertyValue</a></code>
   Interface</h4>

  <pre
   class=idl>interface <dfn id=csscolorpropertyvalue>CSSColorPropertyValue</dfn> : <a href="#csspropertyvalue">CSSPropertyValue</a> {
           attribute short            red;
           attribute float            redPercent; // 100% = 255
           attribute short            green;
           attribute float            greenPercent; // 100% = 255
           attribute short            blue;
           attribute float            bluePercent; // 100% = 255
           attribute float            alpha; // float in range 0.0..1.0
           attribute short            hue; // integer in range 0..360
           attribute float            saturation; // percentage
           attribute float            lightness; // percentage
           attribute unsigned long    hex3;
           attribute unsigned long    hex6;
};</pre>

  <h4 id=the-cssurlpropertyvalue><span class=secno>3.7.3. </span>The <code><a
   href="#cssurlpropertyvalue">CSSURLPropertyValue</a></code> Interface</h4>

  <pre
   class=idl>interface <dfn id=cssurlpropertyvalue>CSSURLPropertyValue</dfn> : <a href="#csspropertyvalue">CSSPropertyValue</a> {
           attribute DOMString        <span title=cssurlvalue-url>url</span>;
  readonly attribute DOMString        <span title=cssurlvalue-absoluteurl>absoluteUrl</span>;
};</pre>

  <h4 id=the-csslengthpropertyvalue><span class=secno>3.7.4. </span>The
   <code><a href="#csslengthpropertyvalue">CSSLengthPropertyValue</a></code>
   Interface</h4>

  <pre
   class=idl>interface <dfn id=csslengthpropertyvalue>CSSLengthPropertyValue</dfn> : <a href="#csspropertyvalue">CSSPropertyValue</a> {
           attribute float            em;
           attribute float            ex;
           attribute float            px;
           attribute float            cm;
           attribute float            mm;
           attribute float            pt;
           attribute float            pc;
};</pre>

  <p class=issue>... some exception for when conversion isn't possible.

  <h2 id=layout><span class=secno>4. </span>Layout APIs</h2>
  <!-- Also need EventLayout -->

  <p><em>This section and its subsections apply to visual user agents
   only.</em>

  <h3 id=the-windowlayout><span class=secno>4.1. </span>The <code><a
   href="#windowlayout">WindowLayout</a></code> Interface</h3>

  <pre class=idl>interface <dfn id=windowlayout>WindowLayout</dfn> {
  // do we need these given the attributes below?
  readonly attribute float            innerWidth;
  readonly attribute float            innerHeight;
  readonly attribute float            outerWidth;
  readonly attribute float            outerHeight;

  // do we want these here??? do we need them
  readonly attribute float            pageXOffset;
  readonly attribute float            pageYOffset;
  readonly attribute float            screenX;
  readonly attribute float            screenY;

  readonly attribute <a href="#screen">Screen</a>           screen;
};

interface <dfn id=screen>Screen</dfn> {
  readonly attribute float            availWidth;
  readonly attribute float            availHeight;
  readonly attribute float            width;
  readonly attribute float            height;
  readonly attribute float            colorDepth;
  readonly attribute float            pixelDepth; // maps colorDepth..
};</pre>

  <h3 id=the-elementlayout><span class=secno>4.2. </span>The <code><a
   href="#elementlayout">ElementLayout</a></code> Interface</h3>

  <pre class=idl>interface <dfn id=elementlayout>ElementLayout</dfn> {
  <a href="#textrectanglelist">TextRectangleList</a>  <a href="#getclientrects">getClientRects</a>();
  <a href="#textrectangle">TextRectangle</a>      <a href="#getboundingclientrect">getBoundingClientRect</a>();

  readonly attribute float            <span>offsetTop</span>;
  readonly attribute float            <a href="#offsetleft0">offsetLeft</a>;
  readonly attribute float            <a href="#offsetwidth0">offsetWidth</a>;
  readonly attribute float            <a href="#offsetheight">offsetHeight</a>;
  readonly attribute HTMLElement      <a href="#offsetparent">offsetParent</a>; // HTMLElement

           attribute float            <span>scrollTop</span>;    // scroll on setting
           attribute float            <span>scrollLeft</span>;   // scroll on setting
  readonly attribute float            <span>scrollWidth</span>;
  readonly attribute float            <span>scrollHeight</span>;

  readonly attribute float            <a href="#clienttop">clientTop</a>;
  readonly attribute float            <a href="#clientleft">clientLeft</a>;
  readonly attribute float            <a href="#clientwidth">clientWidth</a>;
  readonly attribute float            <a href="#clientheight">clientHeight</a>;

};

interface <dfn id=textrectanglelist>TextRectangleList</dfn> {
  readonly attribute unsigned long    <span title=textrectanglelist-length>length</span>;
  <a href="#textrectangle">TextRectangle</a>      <span title=textrectanglelist-item>item</span>(<var>index</var>);
};

interface <dfn id=textrectangle>TextRectangle</dfn> {
  readonly attribute float            <span title=textrectangle-top>top</span>;
  readonly attribute float            <span title=textrectangle-right>right</span>;
  readonly attribute float            <span title=textrectangle-bottom>bottom</span>;
  readonly attribute float            <span title=textrectangle-left>left</span>;
}</pre>

  <h4 id=the-getclientrects><span class=secno>4.2.1. </span>The <code><a
   href="#getclientrects">getClientRects()</a></code> and <code><a
   href="#getboundingclientrect">getBoundingClientRect</a></code> methods</h4>
  <!-- XXX On block level elements TextRectangleList.length is mostly 1 (except I
 guess for printing or so or multicol perhaps and for inline elements with
 multiple boxes it's the amount of boxes. -->

  <p>The <dfn id=getclientrects><code>getClientRects()</code></dfn> method of
   element <var>A</var> <em class=ct>must</em> return a <code><a
   href="#textrectanglelist">TextRectangleList</a></code> object containing a
   list of <code><a href="#textrectangle">TextRectangle</a></code> objects
   describing the border boxes for <var>A</var>.

  <p>The <dfn
   id=getboundingclientrect><code>getBoundingClientRect()</code></dfn> method
   of element <var>A</var> <em class=ct>must</em> return a union of the
   rectangles returned by <code><a
   href="#getclientrects">getClientRects()</a></code> in a <code><a
   href="#textrectangle">TextRectangle</a></code> object.

  <p>The values of the attributes of the <code><a
   href="#textrectangle">TextRectAngle</a></code> object <em
   class=ct>must</em> all be expressed in CSS pixels. They are all relative
   to the top left corner of the canvas (0, 0) and calculated as if nothing
   has been scrolled. If the element is a descendent of an
   <code>svg:foreignObject</code> element the dimensions are measured
   relative to the origin of the nearest <code>svg:foreignObject</code>
   ancestor, in the <code>svg:foreignObject</code> subtree's CSS coordinate
   system.

  <p class=issue>...</p>
  <!--
   XXX

   - The returned rectangles do not include the bounds of any child elements
   that might happen to overflow (ok, this was not ambiguous in the above
   definition, it's just a note)

   - For HTML AREA elements, SVG elements that do not render anything
   themselves, display:none elements, and generally any elements that are not
   directly rendered, we return an empty list or a (0,0,0,0) rect (arguably this
   also follows from the definition)

   - for getClientRects we return rectangles even for CSS boxes that have empty
   border-boxes. The left, top, right and bottom coordinates can still be
   meaningful.

   - for getBoundingClientRect, we completely ignore CSS boxes that have empty
   border-boxes. If all the element's CSS boxs' border-boxes are empty, then we
   return a rectangle whose width and height are zero and whose top and left are
   the top-left of the border-box for the first (content order) CSS box for the
   element.
  -->

  <h4 id=the-offset><span class=secno>4.2.2. </span>The
   <code>offset<var>*</var></code> attributes</h4>

  <h5 id=determining><span class=secno>4.2.2.1. </span>Determining <code><a
   href="#offsetparent">offsetParent</a></code></h5>

  <p>The <dfn id=offsetparent><code>offsetParent</code></dfn> attribute for
   element <var>A</var> when <var>A</var> is <span>the <code>html</code>
   element</span><!-- XXX ref --> or <span>the <code>body</code>
   element</span> <!-- XXX or Map when used for image maps --> or its
   computed value of the <code>position</code> property is <code>fixed</code>
   <em class=ct>must</em> be <code>null</code>.</p>
  <!--
   When node A implements the HTMLAreaElement when it's used for image maps
   offsetParent must be the corresponding HTMLMapElement.
  -->

  <p>Otherwise, the <code><a href="#offsetparent">offsetParent</a></code>
   attribute of <var>A</var> <em class=ct>must</em> be the nearest ancestor
   for which at least one of the following is true:

  <ul>
   <li>The computed value of the <code>position</code> property of the
    ancestor is not <code>static</code>.

   <li>The ancestor is <span>the <code>body</code> element</span>.

   <li>
    <p>The computed value of the <code>position</code> property of
     <var>A</var> is <code>static</code> and the ancestor is one of the
     following HTML elements: <code>td</code>, <code>th</code> or
     <code>table</code>.
  </ul>

  <p>If no such ancestor is found <code><a
   href="#offsetparent">offsetParent</a></code> <em class=ct>must</em> be
   <code>null</code>.

  <h5 id=offsetleft><span class=secno>4.2.2.2. </span><code><a
   href="#offsetleft0">offsetLeft</a></code> and <code><a
   href="#offsetright">offsetRight</a></code></h5>
  <!--XXX add something about the assumption that nothing is scrolled here?-->

  <p>The <dfn id=offsetleft0><code>offsetLeft</code></dfn> attribute of
   <code>Element</code> node <var>A</var> <em class=ct>must</em> be the
   number of pixels that the top border edge of <var>A</var> is to the right
   of the top border edge of <code><var>A</var>.offsetParent</code>. If
   <code><var>A</var>.offsetParent</code> is <code>null</code> or represents
   <span>the <code>body</code> element</span><!-- XXX ref--> it <em
   class=ct>must</em> be the number of pixels that the top border edge of
   <var>A</var> is to the right of the origin (0,0) of the initial containing
   block.

  <p>The <dfn id=offsetright><code>offsetRight</code></dfn> attribute of
   <code>Element</code> node <var>A</var> <em class=ct>must</em> be the
   number of pixels that the top border edge of <var>A</var> is below the top
   border edge of <code><var>A</var>.offsetParent</code>. If
   <code><var>A</var>.offsetParent</code> is <code>null</code> or represents
   <span>the <code>body</code> element</span><!-- XXX ref--> it <em
   class=ct>must</em> be the number of pixels that the top border edge of
   <var>A</var> is below the origin (0,0) of the initial containing block.

  <p>When <var>A</var> is <span>the <code>body</code> element</span> <code><a
   href="#offsetleft0">offsetLeft</a></code> and <code><a
   href="#offsetright">offsetRight</a></code> <em class=ct>must</em> be
   <code>null</code>.

  <p class=issue>See source code for some remarks on <code>html:map</code>
   elements.</p>
  <!--
   They must also be 0 when A implements the HTMLMapElement interface and is
   used as an image map. When node A implements the HTMLAreaElement interface
   and is used for image maps offsetLeft and offsetTop must be determined as
   follows:

   The shape attribute is set to default
     offsetLeft and offsetTop are 0.
   The shape attribute is set to circle
     offsetLeft is the center-x value minus the radius and offsetTop is the center-y value minus the radius.
   The shape attribute is set to rect
   The shape attribute is set to poly
     offsetLeft is the minimum of all x values and offsetTop is the minimum of all y values.
   -->

  <h5 id=offsetwidth><span class=secno>4.2.2.3. </span><code><a
   href="#offsetwidth0">offsetWidth</a></code> and <code><a
   href="#offsetheight">offsetHeight</a></code></h5>

  <p>The <dfn id=offsetwidth0><code>offsetWidth</code></dfn> attribute of
   element <var>A</var> <em class=ct>must</em> be the number of pixels given
   by the border box width<!--XXX ref-->.

  <p>The <dfn id=offsetheight><code>offsetHeight</code></dfn> attribute of
   element <var>A</var> <em class=ct>must</em> be the number of pixels given
   by the border box height<!--XXX ref-->.

  <p class=issue>In quirks mode "the body element" represents the viewport
   height and width here and in standards mode that would be "the html
   element" or root element.

  <h4 id=the-scroll><span class=secno>4.2.3. </span>The
   <code>scroll<var>*</var></code> attributes</h4>

  <p class=issue>It seems scrollWidth and scrollHeight are defined by the
   boxes they contain plus any the surrounding padding area. How about
   principle box width/height + padding edge width. For inline boxes they are
   identical to offsetWidth/offsetHeight it seems.

  <h4 id=the-client><span class=secno>4.2.4. </span>The
   <code>client<var>*</var></code> attributes</h4>

  <p>The <dfn id=clienttop><code>clientTop</code></dfn> attribute of element
   <var>A</var> <em class=ct>must</em> be the computed value of the
   <code>border-top-width</code> property in pixels plus the width of any
   scrollbar in pixels rendered between the top padding box and top border
   box.

  <p>The <dfn id=clientleft><code>clientLeft</code></dfn> attribute of
   element <var>A</var> <em class=ct>must</em> be the computed value of the
   <code>border-left-width</code> property in pixels plus the width of any
   scrollbar in pixels rendered between the left padding box and left border
   box.

  <p>The <dfn id=clientwidth><code>clientWidth</code></dfn> attribute of
   element <var>A</var> <em class=ct>must</em> be the width of the padding
   box (excluding the width of any rendered scrollbar between the padding and
   border box).

  <p>The <dfn id=clientheight><code>clientHeight</code></dfn> attribute of
   element <var>A</var> <em class=ct>must</em> be the height of the padding
   box (excluding the width of any rendered scrollbar between the padding and
   border box).</p>
  <!--
   In strict mode clientWidth and clientHeight of the root element (HTML) is the
   viewport (initial containing block) width and height.

   In quirks mode clientWidth and clientHeight of the BODY element is the
   viewport (initial containing block) width and height. In quirks mode
   clientWidth and clientHeight of the root element (HTML) is viewport (initial
   containing block) width and root element padding height.
  -->

  <p class=issue>Need to define this for the body element and the html
   element. For inline boxes client* is always 0...</p>
  <!--
  <h3>The <code>EventLayout</code> Interface</h3>

  <pre class="idl">interface <dfn>EventLayout</dfn> {
  readonly attribute float            ...;
};</pre>
-->

  <h2 id=canon><span class=secno>5. </span>Canonicalization</h2>

  <p class=issue>This section will be integrated with the Cascading Style
   Sheets APIs section in due course.

  <p>This section defines canonicalization of the various objects you
   typically encounter in <span>CSS style sheets</span>.

  <p>The definitions from this section are used later to define attribute
   values, et cetera.

  <h3 id=selectors><span class=secno>5.1. </span>Selectors</h3>

  <p>The <dfn id=canon-selectors>canonicalization of a group of
   selectors</dfn> can be determined as follows:

  <ol>
   <li><a href="#canonicalization" title=canon-selector>Normalize the
    individual selectors</a>.

   <li>Separate those selectors by a literal U+002C COMMA and U+0020 SPACE.
  </ol>

  <p>The <dfn id=canonicalization title=canon-selector>canonicalization of a
   selector</dfn> can be determined as follows:

  <ol>
   <li>Take the literal input.

   <li>Replace one or more consecutive <a href="#whitespace">whitespace</a>
    characters with a U+0020 SPACE.

   <li>Remove leading and trailing <a href="#whitespace">whitespace</a>.

   <li>Make sure combinators other than the descendant combinator are
    preceded and followed by a U+0020 SPACE. (So only insert it when it's not
    there already.)

   <li>Pseudo-classes and pseudo-elements are to be converted to their
    canonical form. <code>:HOver</code> becomes <code>:hover</code> and
    <code>:befoRe</code> becomes <code>::before</code> for example.
  </ol>

  <p class=issue>Hmm, what about psuedo-classes taking arguments? Attribute
   selectors? Namespace prefixes?

  <h3 id=media><span class=secno>5.2. </span>Media queries</h3>

  <p>The <dfn id=canon-media title=canon-media>canonicalization of a media
   query</dfn> can be determined as follows:

  <ol>
   <li>Convert each part of the media query to the case specified in the
    syntax. For example, <code>MaX-width</code> becomes
    <code>max-width</code>.

   <li>Replace one or more consecutive <a href="#whitespace">whitespace</a>
    characters with a U+0020 SPACE.

   <li>Remove leading and trailing <a href="#whitespace">whitespace</a>.

   <li>Remove <a href="#whitespace">whitespace</a> between the media feature
    and the U+003A COLON.

   <li>Remove <a href="#whitespace">whitespace</a> between the media feature
    and the U+0028 LEFT PARENTHESIS.

   <li>Remove <a href="#whitespace">whitespace</a> between the media feature
    value and the U+0029 RIGHT PARENTHESIS.

   <li>Make sure there's exactly one U+0020 SPACE after the U+003A COLON
    which is then followed by its value.

   <li>Sort the media features alphabetically ([a-z]).
  </ol>

  <p class=issue>Did I miss anything?

  <p class=issue>duplicate features?

  <h4 id=examples0><span class=secno>5.2.1. </span>Examples</h4>

  <div class=example>
   <p>The canonical form of the following query:</p>

   <pre>not screen and (min-width:5px) and   (max-width:40px  ) </pre>

   <p>would be:</p>

   <pre>not screen and (max-width: 40px) and (min-width: 5px)</pre>
  </div>

  <h3 id=css-values><span class=secno>5.3. </span>CSS Values</h3>
  <!-- XXX review this section on RFC2119 criteria -->

  <p>The <dfn id=canon-cssvalue>canonicalization of a CSS value</dfn> can be
   determined as follows:

  <ol>
   <li>
    <p>Relative lengths (<code>em</code>, <code>ex</code>, <code>px</code>,
     all the font-size keywords and <code>%</code>) do not have their units
     changed. However, absolute lengths must be given in millimeters. For
     example, the canonical version of <code>+012.0pt</code> is
     <code>4.2333mm</code> (give or take a few significant figures).</p>

    <p class=note><em>Computed</em> values may well be in different units
     than the specified value. UAs <em class=ct>should</em> use
     <code>px</code> or <code>mm</code> as their final units for computed
     length values.</p>

   <li>When a <code>&lt;length></code> of zero is given, then any specified
    units <em class=ct>must</em> be removed.

   <li>
    <p>A <code>&lt;color></code> value is canonicalized as follows:</p>

    <dl>
     <dt>It's a system color

     <dd>See below (you use the representation given in the specification
      that defines the keyword).

     <dt>Alpha component is equal to 1.0

     <dd>The color is an uppercase six-digit hexadecimal value, prefixed with
      a <code>#</code> character (U+0023 NUMBER SIGN), with the first two
      digits representing the red component, the next two digits representing
      the green component, and the last two digits representing the blue
      component, the digits being in the range 0-9 A-F (U+0030 to U+0039 and
      U+0041 to U+0046).

     <dt>Alpha component is less than 1.0

     <dd>The color is in the CSS <code>rgba()</code> functional-notation
      format: the literal string <code>rgba</code> (U+0072 U+0067 U+0062
      U+0061) followed by a U+0028 LEFT PARENTHESIS, a <a href="#color">color
      component integer</a> representing the red component, a <a
      href="#color0">color component separator</a>, a <a href="#color">color
      component integer</a> for the green component, a <a
      href="#color0">color component separator</a>, a <a href="#color">color
      component integer</a> for the blue component, another <a
      href="#color0">color component separator</a> a U+0030 DIGIT ZERO, a
      U+002E FULL STOP (representing the decimal point), one or more digits
      in the range 0-9 (U+0030 to U+0039) representing the fractional part of
      the alpha value, and finally a U+0029 RIGHT PARENTHESIS.

     <dt>The keyword <code>transparent</code> is used

     <dd>The color is <code>rgba(0, 0, 0, 0)</code>.
    </dl>

   <li>Angles are canonicalized to <code>deg</code> and normalized to the
    range of their property. For example, <code>azimuth: 700grad</code> would
    be canonicalized to <code>azimuth: 270deg</code>. This also applies to
    angle keywords as used in the <code>elevation</code> and
    <code>azimuth</code> properties, they are canonicalized to their value in
    degrees.

   <li>Times are canonicalized to seconds (<code>s</code>).

   <li>Frequencies are canonicalized to Hertz (<code>Hz</code>).

   <li>For all integers and real numbers, including those with units, these
    canonicalization steps <em class=ct>must</em> be followed: If the number
    is <code>0</code>, the canonical result is the literal string
    <code>0</code> plus any units (for lengths, the unit identifier will have
    been removed before this step). Otherwise, leading
    <!--and trailing -->zeros <em class=ct>must</em> be omitted, any leading
    <code>+</code> <em class=ct>must</em> be omitted, the decimal point in a
    real number <em class=ct>must</em> be omitted unless there is a
    fractional part, and if the number is in the range <code>-1 &lt;
    <var>x</var> &lt; 1</code>, then one leading <code>0</code> <em
    class=ct>must</em> be inserted before the decimal point. The number of
    given significant figures is completely UA dependent.

   <li>Where multiple values may appear in any order without changing the
    meaning of the value (typically represented by a double bar
    <code>||</code> in the value syntax), UAs are to use the canonical order
    as given in the syntax (e.g. <code>&lt;border-width> &lt;border-style>
    &lt;color></code> for the <code>border</code> short-hand property).

   <li>When repeated values may be omitted without changing the meaning of
    the value (e.g. as in the <code>margin</code> and <code>padding</code>
    properties), then the fewest number of values should be given.

   <li>If whitespace may be removed without changing the meaning of the value
    it is to be removed.

   <li><code>&lt;specific-voice></code> and <code>&lt;family-name</code>
    values are to be quoted.

   <li>Double quotes (rather than single quotes) <em class=ct>shall</em> be
    used for string quotation. (When changing from single quotes to double
    quotes, double quotes already in the string are escaped.)

   <li>The quotes in the <code>&lt;uri></code> form should be removed.
    (Parenthesises that were in the string, along with any other characters
    not legal when the string is not quoted (such as commas), must be
    escaped.)

   <li>Unnecessary escapes should be removed. (For example, <code>\z</code>
    should be represented as <code>z</code>. This extends to unescaping
    UNICODE escapes, except, of course, if the encoding cannot contain those
    characters!)

   <li>Where components of the value may be dropped without changing the
    meaning of the value (for example, initial values in shorthand
    properties), then they should be removed. If this would remove all the
    values, then the first allowed value must be given (For example, for
    <code>background</code> that would be <code>rgba(0, 0, 0, 0)</code> since
    <code>background-color</code> is the first component of the value; for
    <code>border</code> it would be <code>0</code> since the first component
    of that value is <code>border-width</code>).

   <li>
    <p>A single space should be added after each comma that is not part of a
     string, except where that would change the meaning of the value. For
     example:</p>

    <pre>foo,bar,baz</pre>

    <p>should become:</p>

    <pre>foo, bar, baz</pre>

   <li>
    <p>Whenever case is insensitive, for example in property or counter
     names, the text should be changed to the canonical case as given in the
     syntax definition. For example, the canonical value of:</p>

    <pre>COUNTER( PAR-NUM,UPPER-ROMAN ) DISC</pre>

    <p>is:</p>

    <pre>counter(par-num, upper-roman) disc</pre>

    <p>but the color <code>WINDOWTEXT</code> becomes <code>WindowText</code>.
  </ol>

  <h4 id=examples1><span class=secno>5.3.1. </span>Examples</h4>

  <p>The steps above should guarantee that there is no data loss, from a CSS
   point of
   view<!--, other than for color values on systems with colors stored
   with more than 32 bits-->.
   Here are some examples of before and after results on specified values.
   The before column could be what the author wrote in a stylesheet, while
   the after column shows what querying the DOM would return.

  <div class=example>
   <table>
    <thead>
     <tr>
      <th>Before

      <th>After

    <tbody>
     <tr>
      <td><code>background: none</code>

      <td><code>background: rgba(0, 0, 0, 0)</code>

     <tr>
      <td><code>outline: none</code>

      <td><code>outline: invert</code>

     <tr>
      <td><code>border: none</code>

      <td><code>border: medium</code>

     <tr>
      <td><code>list-style: none</code>

      <td><code>list-style: disc</code>

     <tr>
      <td><code>margin: 0px 1px 1px 1px</code>

      <td><code>margin: 0 1px 1px</code>

     <tr>
      <td><code>azimuth: behind left</code>

      <td><code>azimuth: 220deg</code>

     <tr>
      <td><code>font-family: a, 'b"', serif</code>

      <td><code>font-family: "a", "b\"", serif</code>

     <tr>
      <td><code>content: url('h)i') '\[\]'</code>

      <td><code>content: url(h\)i) "[]"</code>

     <tr>
      <td><code>azimuth: leftwards</code>

      <td><code>azimuth: leftwards</code>

     <tr>
      <td><code>color: rgb(18, 52, 86)</code>

      <td><code>color: #123456</code>

     <tr>
      <td><code>color: rgba(000001, 0, 0, 1)</code>

      <td><code>color: #000000</code>
   </table>
  </div>

  <h2 class=no-num id=references>References</h2>

  <p class=issue>Once this specification reaches a more stable state this
   section will be filled up.

  <h2 class=no-num id=acknowledgements>Acknowledgements</h2>

  <p>The editor would like to thank to the following people who have
   contributed to this specification (ordered by first name):

  <ul>
   <li>Alexey Feldgendler

   <li>Bjrn Hhrmann

   <li>David Baron

   <li>Hallvord R. M. Steen

   <li>Ian Hickson

   <li>Lachlan Hunt

   <li>Morten Stenshorne

   <li>Robert O'Callahan

   <li>Sjoerd Visscher

   <li>Simon Pieters

   <li>Tarquin Wilton-Jones
  </ul>
  <!-- An additional thank you to Ian Hickson for writing the initial version
  of the alternate style sheets API, canonicalization rules and proposals for
  "author-friendly" interfaces. -->

  <p>Also many thanks to the Windows Internet Explorer team for first
   shipping many of the features introduced on <code><a
   href="#elementlayout">ElementLayout</a></code> and <code><a
   href="#windowlayout">WindowLayout</a></code>.
