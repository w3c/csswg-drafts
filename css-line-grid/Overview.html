<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">

<html lang=en>
 <head
  profile="http://dublincore.org/documents/2008/08/04/dc-html/ http://www.w3.org/2006/03/hcard">
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <title>CSS Line Grid Module Level 1</title>

  <link href="http://purl.org/dc/terms/" rel=schema.dcterms>
  <link href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright"
   rel=dcterms.rights>
  <meta content="CSS Line Grid Module Level 1" name=dcterms.title>
  <meta content=text name=dcterms.type>
  <meta content=2014-07-22 name=dcterms.date>
  <meta content="Elika Etemad" name=dcterms.creator>
  <meta content="Koji Ishii" name=dcterms.creator>
  <meta content="Alan Stearns" name=dcterms.creator>
  <meta content=W3C name=dcterms.publisher>
  <meta content="http://dev.w3.org/csswg/css-line-grid-1/"
   name=dcterms.identifier>
  <link href="../default.css" rel=stylesheet type="text/css">
  <style type="text/css">
    .sidenote-block {
    	border: 1px solid gray;
    	margin: auto;
    	text-align: left;
    	padding: 4pt;
    	position: relative;
    	max-width: 400pt;
    }
    .sidenote-body {
    	margin-left: 120pt;
    	font-size: 12pt;
    	line-height: 18pt;
    }
    .sidenote-note {
    	font-size: 10pt;
    	line-height: 18pt;
    	position: absolute; left: 4pt; top: 4pt;
    	width: 110pt;
    }
  </style>
  <link href="http://www.w3.org/StyleSheets/TR/W3C-ED.css" rel=stylesheet
   type="text/css">

 <body>
  <div class=head> <!--begin-logo-->
   <p><a href="http://www.w3.org/"><img alt=W3C height=48
    src="http://www.w3.org/Icons/w3c_home" width=72></a> <!--end-logo-->

   <h1>CSS Line Grid Module Level 1</h1>

   <h2 class="no-num no-toc">Editor's Draft 22 July 2014</h2>

   <dl>
    <dt>This version:

    <dd><a href="http://dev.w3.org/csswg/css-line-grid-1/">
     http://www.w3.org/TR/2014/ED-css-line-grid-1-20140722/</a>

    <dt>Latest version:

    <dd><a href="http://www.w3.org/TR/css-line-grid-1/">
     http://www.w3.org/TR/css-line-grid-1/</a> <!--
  <dt>Previous version:
    <dd><a href="http://www.w3.org/PreviousVersionURI">
    http://www.w3.org/PreviousVersionURI</a>
-->

    <dt>Editors:

    <dd class=vcard><a class="fn url"
     href="http://fantasai.inkedblade.net/contact">Elika Etemad</a>, <span
     class=org>Invited Expert</span>

    <dd class=vcard><a class="fn email"
     href="mailto:kojiishi@gluesoft.co.jp">Koji Ishii</a>, <span
     class=org>Invited Expert</span>

    <dd class=vcard><a class="fn email" href="mailto:stearns@adobe.com">Alan
     Stearns</a>, <span class=org>Adobe Systems, Inc.</span>
   </dl>
   <!--begin-copyright-->
   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright"
    rel=license>Copyright</a> © 2014 <a href="http://www.w3.org/"><abbr
    title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
    href="http://www.csail.mit.edu/"><abbr
    title="Massachusetts Institute of Technology">MIT</abbr></a>, <a
    href="http://www.ercim.eu/"><abbr
    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
    <a href="http://www.keio.ac.jp/">Keio</a>, <a
    href="http://ev.buaa.edu.cn/">Beihang</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
   <!--end-copyright-->
   <hr title="Separator for header">
  </div>

  <h2 class="no-num no-toc" id=abstract>Abstract</h2>

  <p> <span class=p-summary> This module contains CSS features for aligning
   content to a baseline grid. </span> <a
   href="http://www.w3.org/TR/CSS/">CSS</a> is a language for describing the
   rendering of structured documents (such as HTML and XML) on screen, on
   paper, in speech, etc.

  <h2 class="no-num no-toc" id=status>Status of this document</h2>
  <!--begin-status-->

  <p>This is a public copy of the editors' draft. It is provided for
   discussion only and may change at any moment. Its publication here does
   not imply endorsement of its contents by W3C. Don't cite this document
   other than as work in progress.

  <p>The (<a
   href="http://lists.w3.org/Archives/Public/www-style/">archived</a>) public
   mailing list <a
   href="mailto:www-style@w3.org?Subject=%5Bcss-line-grid-1%5D%20PUT%20SUBJECT%20HERE">
   www-style@w3.org</a> (see <a
   href="http://www.w3.org/Mail/Request">instructions</a>) is preferred for
   discussion of this specification. When sending e-mail, please put the text
   “css-line-grid-1” in the subject, preferably like this:
   “[<!---->css-line-grid-1<!---->] <em>…summary of comment…</em>”

  <p>This document was produced by the <a
   href="http://www.w3.org/Style/CSS/members">CSS Working Group</a> (part of
   the <a href="http://www.w3.org/Style/">Style Activity</a>).

  <p>This document was produced by a group operating under the <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
   2004 W3C Patent Policy</a>. W3C maintains a <a
   href="http://www.w3.org/2004/01/pp-impl/32061/status"
   rel=disclosure>public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also includes
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.</p>
  <!--end-status-->

  <p>The following features are at risk: …

  <h2 class="no-num no-toc" id=contents>Table of contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#introduction"><span class=secno>1. </span>Introduction</a>
    <ul class=toc>
     <li><a href="#context"><span class=secno>1.1. </span>Background</a>

     <li><a href="#placement"><span class=secno>1.2. </span>Module
      Interactions</a>

     <li><a href="#values"><span class=secno>1.3. </span>Values</a>
    </ul>

   <li><a href="#line-grid"><span class=secno>2. </span> Defining a Line
    Grid: the ‘<code class=property>line-grid</code>’ property</a>

   <li><a href="#snapping-to-a-grid"><span class=secno>3. </span>Snapping to
    a Grid</a>
    <ul class=toc>
     <li><a href="#line-snap"><span class=secno>3.1. </span> Snapping Line
      Boxes: the ‘<code class=property>line-snap</code>’ property</a>

     <li><a href="#box-snap"><span class=secno>3.2. </span> Snapping Block
      Boxes: the ‘<code class=property>box-snap</code>’ property</a>
    </ul>

   <li><a href="#conformance"><span class=secno>4. </span> Conformance</a>
    <ul class=toc>
     <li><a href="#conventions"><span class=secno>4.1. </span>Document
      Conventions</a>

     <li><a href="#conformance-classes"><span class=secno>4.2. </span>
      Conformance Classes</a>

     <li><a href="#partial"><span class=secno>4.3. </span> Partial
      Implementations</a>

     <li><a href="#experimental"><span class=secno>4.4. </span> Experimental
      Implementations</a>

     <li><a href="#cr-exit-criteria"><span class=secno>4.5. </span> CR Exit
      Criteria</a>
    </ul>

   <li class=no-num><a href="#acknowledgments">Acknowledgments</a>

   <li class=no-num><a href="#references">References</a>
    <ul class=toc>
     <li class=no-num><a href="#normative-references">Normative
      references</a>

     <li class=no-num><a href="#other-references">Other references</a>
    </ul>

   <li class=no-num><a href="#index">Index</a>

   <li class=no-num><a href="#property-index">Property index</a>
  </ul>
  <!--end-toc-->

  <h2 id=introduction><span class=secno>1. </span>Introduction</h2>

  <h3 id=context><span class=secno>1.1. </span>Background</h3>

  <p><em>This section is not normative.</em>

  <p>This specification provides features to align lines and blocks to
   invisible grids in the document.

  <p>Aligning lines and blocks to grids provides the following benefits:

  <ul>
   <li>Vertical rhythm is kept for better readability.

   <li>Lines are aligned between columns in multi-column documents.

   <li>The top and the bottom margins of pictures are made equal, while
    keeping the vertical rhythm of text before and after the pictures.</li>
   <!--
    <li>Aligning to grids can sometimes be turned off for objects like tables,
      but then turned back on for the following text
      to the same grids as the one for the text before the objects.</li>
    -->

   <li>Layout lines are at the same position on every page in paged media.
    Keeping the position of the bottom line of a page has benefits for design
    and readability. This also improves the readability of duplex printing,
    two pages spreads, and displaying on slow display devices like e-ink.

   <li>East Asian layouts require vertical rhythm more often than other
    scripts do, even in single column, non-paged media documents, as defined
    in <a href="#ref-JLREQ" rel=biblioentry>[JLREQ]<!--{{JLREQ}}--></a>.
  </ul>

  <p>There are several types of objects in a document that can break the
   vertical rhythm. Examples include lines with different sizes of text,
   pictures, and tables.

  <div class=figure> <img
   alt="Vertical rhythm kept through pictures and different size of text in a multi-column document"
   height=246 src=line-grid-multicol.png width=480>
   <p class=caption>Vertical rhythm kept through pictures and different size
    of text in a multi-column document.
  </div>

  <div class=example>
   <div class=sidefigure> <img alt="Large text wraps within line grids"
    height=244 src=line-grid-wrap.png width=276>
    <p class=caption>Large text wraps within line grids.
   </div>

   <p>When a different size of text, such as a headings, wraps, it is usually
    aligned to grids as a block and the lines within the block do not align.</p>
   <br style="clear:both;">
  </div>

  <div class=figure id=ex-sidenote>
   <div class=sidenote-block>
    <div class=sidenote-body> Sidenotes (and footnotes for that matter) are
     often set at a smaller size than the basic text. This smaller text
     should still line up with the basic text. Authors can achieve this
     effect by calculating appropriate font-size, line-height, and margins*.</div>

    <div class=sidenote-note> Only if author controls everything. It can
     easily be broken by user stylesheet, for instance.</div>
   </div>

   <p class=caption>Sidenotes are set at a smaller size, but still line up
    with the basic text.
  </div>

  <div class=sidefigure id=ex-width> <img
   alt="East Asian layouts may require width be a multiple of em without fractions"
   height=142 src=width-multiple-of-em.png width=180>
   <p class=caption>East Asian layouts may require width be a multiple of
    <em>em</em> without fractions.
  </div>

  <p>East Asian layouts may require grid-like features in inline progression
   direction as well.

  <p>It is often desirable in East Asian layouts to make the line width a
   multiple of <em>em</em> without fractions. Because most East Asian
   characters have 1em advance and most East Asian documents are justified,
   this minimizes cases where justification needs to expand character
   spacing.

  <p>This module provides the following capabilities:

  <ul>
   <li>Defining grids in the line progression direction.

   <li>Controling how lines and blocks align to the grids.
  </ul>

  <p>It is important to control these capabilities independently, so that,
   for example, aligning to grids can be turned off for tables, but can then
   be turned back on for aligning the following text to the grids.

  <h3 id=placement><span class=secno>1.2. </span>Module Interactions</h3>

  <p>This module extends the line box model defined in <a href="#ref-CSS21"
   rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a> sections 9.4.2 and 10.8.

  <h3 id=values><span class=secno>1.3. </span>Values</h3>

  <p>This specification follows the <a
   href="http://www.w3.org/TR/CSS21/about.html#property-defs">CSS property
   definition conventions</a> from <a href="#ref-CSS21"
   rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>. Value types not defined in
   this specification are defined in CSS Level 2 Revision 1 <a
   href="#ref-CSS21" rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>. Other CSS
   modules may expand the definitions of these value types: for example <a
   href="#ref-CSS3COLOR" rel=biblioentry>[CSS3COLOR]<!--{{CSS3COLOR}}--></a>,
   when combined with this module, expands the definition of the
   &lt;color&gt; value type as used in this specification.

  <p>In addition to the property-specific values listed in their definitions,
   all properties defined in this specification also accept the <a
   href="http://www.w3.org/TR/CSS21/cascade.html#value-def-inherit">inherit</a>
   keyword as their property value. For readability it has not been repeated
   explicitly.

  <h2 id=line-grid><span class=secno>2. </span> Defining a Line Grid: the
   ‘<a href="#line-grid0"><code class=property>line-grid</code></a>’
   property</h2>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=line-grid0>line-grid</dfn>

    <tr>
     <th><a href="#values">Value</a>:

     <td>match-parent | create

    <tr>
     <th>Initial:

     <td>match-parent

    <tr>
     <th>Applies to:

     <td>block containers

    <tr>
     <th>Inherited:

     <td>no

    <tr>
     <th>Animatable:

     <td>no

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed value:

     <td>specified value

    <tr>
     <th>Canonical order:

     <td><abbr title="follows order of property value definition">per
      grammar<abbr> </abbr></abbr>
  </table>

  <p>Specifies whether this box creates a new baseline grid for its
   descendants or uses the same baseline grid as its parent. (Each box always
   has an associated line grid. However, whether a box or its contents snap
   to a line grid is determined by ‘<a href="#line-snap0"><code
   class=css>line-snap</code></a>’ and ‘<a href="#box-snap0"><code
   class=css>box-snap</code></a>’.)

  <dl>
   <dt><dfn id=match-parent>‘<code class=css>match-parent</code>’</dfn>

   <dd>Box assumes the line grid of its parent.

   <dt><dfn id=create>‘<code class=css>create</code>’</dfn>

   <dd>Box creates a new line grid using its own font and line layout
    settings. The line grid consists of a series of horizontal lines
    corresponding to all the baselines (alphabetic, text-top, text-bottom,
    mathematic, central, hanging, etc.) and to the line-over and line-under
    edges, positioned where they would fall if the contents of this element
    consisted entirely of line boxes filled with text (no sub-elements) using
    the first available font. If the box is paginated, the line grid is
    restarted on each page; since line boxes cannot be fragmented, no page
    begins with the bottom part of a line's grid.
  </dl>

  <p>

  <p class=issue>The names of these values is currently up for debate.
   Current suggestions for ‘<a href="#match-parent"><code
   class=css>match-parent</code></a>’ include ‘<a
   href="#match-parent"><code class=css>match-parent</code></a>’ and
   ‘<code class=css>normal</code>’; those for ‘<a href="#create"><code
   class=css>create</code></a>’ include ‘<a href="#create"><code
   class=css>create</code></a>’ and ‘<code class=css>new</code>’.

  <p class=note>The original proposal for line grids allowed an element to
   create a named grid. This property could still be extended to do this in
   the future.

  <p class=issue><a
   href="http://www.w3.org/mid/21262.26596.32230.32937@gargle.gargle.HOWL">Håkon
   points out</a> that there might be a need to have line grids aligned to
   the page box rather than the page content box. The current proposal has no
   way to switch between the two.

  <p class=note>There might need to be an offset for more complicated
   designs. How to set this offset is problematic: usually it's not a fixed
   length, but the distance to clear some header content. This could be added
   to a later level of line-grid.

  <h2 id=snapping-to-a-grid><span class=secno>3. </span>Snapping to a Grid</h2>

  <h3 id=line-snap><span class=secno>3.1. </span> Snapping Line Boxes: the
   ‘<a href="#line-snap0"><code class=property>line-snap</code></a>’
   property</h3>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=line-snap0>line-snap</dfn>

    <tr>
     <th><a href="#values">Value</a>:

     <td>none | baseline | contain

    <tr>
     <th>Initial:

     <td>none

    <tr>
     <th>Applies to:

     <td>all elements

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Animatable:

     <td>no

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed value:

     <td>specified value

    <tr>
     <th>Canonical order:

     <td><abbr title="follows order of property value definition">per
      grammar<abbr> </abbr></abbr>
  </table>

  <p>This property applies to all the line boxes directly contained by the
   element, and, when not ‘<a href="#none0"><code
   class=css>none</code></a>’, causes each line box to shift (usually
   downward, possibly by zero) until it snaps to the line grid specified by
   ‘<a href="#line-grid0"><code class=property>line-grid</code></a>’.
   (The unshifted position is the position that would be determined by normal
   line stacking rules, with consideration of any new controls defined by
   other modules such as <a href="#ref-CSS3LINE"
   rel=biblioentry>[CSS3LINE]<!--{{CSS3LINE}}--></a>.) Shifting line boxes in
   this way affects layout – it is not merely a display translation. If a
   line box is shifted downward, then subsequent line boxes will be laid out
   using the new shifted position as input to their line stacking rules.

  <p>Values have the following meanings:

  <dl>
   <dt><dfn id=none>‘<code class=css>none</code>’</dfn>

   <dd>Line boxes do not snap to the grid; they stack normally.

   <dt><dfn id=baseline>‘<code class=css>baseline</code>’</dfn>

   <dd>The dominant baseline snaps with the matching baseline on the line
    grid applying to the element.

   <dt><dfn id=contain>‘<code class=css>contain</code>’</dfn>

   <dd>Two baselines are used to align the line box: the line box is snapped
    so that its ‘<code class=css>central</code>’ baseline (halfway
    between the ‘<code class=css>text-over</code>’ and ‘<code
    class=css>text-under</code>’ baselines) is centered between one of the
    line grid's ‘<code class=css>text-over</code>’ baselines and a
    subsequent (but not necessarily consecutive) ‘<code
    class=css>text-under</code>’ baseline.
  </dl>

  <p>In some cases lines of equal line height will not align perfectly to a
   baseline grid: this happens, for example, when fonts (of the same size)
   with different baseline tables are mixed on a line. For this reason, if
   shifting the line by the largest difference between the smallest ascent
   and largest ascent of a single size used on the line would result in a
   smaller shift, then the contents of the line box are shifted up within the
   line box so as to allow the line to snap without jumping downward to the
   next grid line.

  <div class=example>
   <p>Line boxes almost always shift downward (towards the block-end
    direction) when snapping to a line grid. Here there are three lines with
    20px line-height and line-snap:baseline that should snap to a 30px line
    grid. Each line box shifts down so that the baselines align with the grid
    lines. <figure style="float:left;"> <img
    alt="line positions before snapping" src="images/simple-no-snap.png">
    <figcaption> Before line snapping </figcaption> </figure> <figure
    style="float:left;"> <img alt="line positions after snapping"
    src="images/simple-snapped.png"> <figcaption> After line snapping
    </figcaption> </figure>

   <p style="clear:left;"> In the figures below, there are two additional
    lines from h3 elements with line-snap:none. These lines do not shift to
    align to the grid, but their positions can change based on the shifting
    of lines around them. In this example, lines 1 2 and 3 shift down to snap
    their baselines to the grid lines, and line B has normal line box
    placement just below the line above.
   <figure style="float:left;"> <img alt="line positions before snapping"
   src="images/top-no-snap.png"> <figcaption> Before line snapping
   </figcaption> </figure> <figure style="float:left;"> <img
   alt="line positions after snapping" src="images/top-snapped.png">
   <figcaption> After line snapping </figcaption> </figure></div>

  <div class=example>
   <p> The block containing all of these lines might not be top-aligned
    within its container. In the figures below, the block containing the
    elements is centered. In a centered situation, you have to align
    baselines while maintaining centering.

   <p> This can be done in two shift-and-center steps. First, shift the
    snapping lines as if there were no centering (as in figure 8 above), then
    remove the shift for the very first snapping line and center the block.
    You can see the result in the partial shifting figure below.

   <p> In the second step, measure the distance from the first snapped line's
    baseline to the grid lines above and below, looking for the closest grid
    line to that baseline.

   <p> If the closest grid line is in the block-start direction, then add
    space below the last line in the block equal to twice that distance. Then
    the block is centered again, which will align all of the snapped lines to
    the grid.
   <figure style="float:left;"> <img alt="line positions at step 1"
   src="images/first-center-part-snapped.png"> <figcaption> Partial shifting
   </figcaption> </figure> <figure style="float:left;"> <img
   alt="line positions after full snapping"
   src="images/first-center-snapped.png"> <figcaption> Full line snapping
   </figcaption> </figure>
   <p style="clear:left;"> If the closest grid line is in the block-end
    direction, then the first snapped line is shifted downward by twice that
    distance. Then the block is centered again, which will again align all of
    the snapped lines to the grid.
   <figure style="float:left;"> <img alt="line positions at step 1"
   src="images/second-center-part-snapped.png"> <figcaption> Partial shifting
   </figcaption> </figure> <figure style="float:left;"> <img
   alt="line positions after full snapping"
   src="images/second-center-snapped.png"> <figcaption> Full line snapping
   </figcaption> </figure></div>

  <div class=example>
   <p>An end-aligned block shifts snapped lines upward from the block-end
    direction. The shifting distance between any two adjacent snapped lines
    will be the same as in the other alignment cases. The main difference is
    that the shifting between snapped and not-snapped lines (or the block
    edge) occurs below the snapped lines.
   <figure style="float:left;"> <img alt="line positions before snapping"
   src="images/bottom-no-snap.png"> <figcaption> Before snapping
   </figcaption> </figure> <figure style="float:left;"> <img
   alt="line positions after snapping" src="images/bottom-snapped.png">
   <figcaption> After line snapping </figcaption> </figure></div>

  <h3 id=box-snap><span class=secno>3.2. </span> Snapping Block Boxes: the
   ‘<a href="#box-snap0"><code class=property>box-snap</code></a>’
   property</h3>

  <p class=issue> This is a rough draft of trying to solve the box-snapping
   problem.

  <p class=issue> Some optional box values (margin-box, border-box) could be
   added to the before and after values to allow snapping various box model
   edges to the line grid.

  <p class=issue> An ‘<code class=property>auto</code>’ value could be
   useful - one that defaults to center, but snaps to before if it's the
   first block in a fragment container, and snaps to after if it's the last
   block in a fragment container.

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=box-snap0>box-snap</dfn>

    <tr>
     <th><a href="#values">Value</a>:

     <td> none | before | after | center | first-baseline | last-baseline

    <tr>
     <th>Initial:

     <td>none

    <tr>
     <th>Applies to:

     <td>block-level boxes and internal table elements except table cells

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Animatable:

     <td>no

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed value:

     <td>specified value

    <tr>
     <th>Canonical order:

     <td><abbr title="follows order of property value definition">per
      grammar<abbr> </abbr></abbr>
  </table>

  <p>Specifies how the block is snapped to the baseline grid. Values have the
   following meanings:

  <dl>
   <dt><dfn id=none0>none</dfn>

   <dd>The block is not snapped to any grid.

   <dt><dfn id=before>before</dfn>

   <dd>The before edge is snapped to the nearest grid line.

   <dt><dfn id=after>after</dfn>

   <dd>The after edge is snapped to the nearest grid line.

   <dt><dfn id=center>center</dfn>

   <dd>The block is centered centered between one of the baseline grid's
    ‘<code class=css>text-over</code>’ baselines and a subsequent (but
    not necessarily consecutive) ‘<code class=css>text-under</code>’
    baseline.

   <dt><dfn id=first-baseline>first-baseline</dfn>

   <dd>The first line box's dominant baseline is snapped to the nearest grid
    line.

   <dt><dfn id=last-baseline>last-baseline</dfn>

   <dd>The last line box's dominant baseline is snapped to the nearest grid
    line.
  </dl>

  <p>When snapping to baselines on a line grid, either the <i>text-over</i>
   or <i>text-under</i> baseline is chosen: whichever one is on the matching
   side of the central baseline. For example, when snapping the before edge
   in horizontal writing mode, the <i>over</i> edge is chosen. In some cases
   the <i>under</i> edge might be used instead for the before edge: for
   example, when the writing mode of the line grid doesn't match that of the
   affected element, or when due to the ‘<code
   class=property>text-orientation</code>’ settings the <i>under</i> side
   corresponds to the <a href="#after"><i>after</i></a> edge.

  <p>To snap a block-level element to a grid line, the effective margin is
   increased at that edge.
   <!--To snap an after border-box or half-border edge to a grid
  line, the effective content-box height is increased.-->
   If, however, the box is an empty block that could be <a
   href="http://www.w3.org/TR/CSS21/box.html">collapsed through</a>, then
   this property has no effect. <a href="#ref-CSS21"
   rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>

  <p>When applied to table row group and table row boxes, ‘<a
   href="#box-snap0"><code class=property>box-snap</code></a>’ only affects
   the before and after edges, and only if those edges are not at the
   beginning or end of the table, respectively. To snap a before edge on a
   table row or row group, the preceding row's height is increased. To snap
   an after edge on a table row or row group, the affected row's height is
   increased.

  <p>When applied to table column group and table column boxes, ‘<a
   href="#box-snap0"><code class=property>box-snap</code></a>’ only affects
   the start and end edges, and only if those edges are not at the start or
   end of the table, respectively. How the space is redistributed among
   columns to satisfy snapping constraints is not defined, however:

  <ul>
   <li>In an auto-sized table no column may be smaller than its minimum
    content width.

   <li>The resulting table must not exceed its original measure if it had a
    non-‘<code class=css>auto</code>’ measure.

   <li>The adjusted widths must not cause the table to overflow its
    containing block any more than it would with ‘<code class=css>box-snap:
    none</code>’.
  </ul>

  <p>To satisfy these constraints, some column edges may remain unsnapped.
   <!-- 
  Line snapping for columnsis processed from start to end: column widths
  are increased or decreased in order to snap the column edges.
  By preference, the widths are increased.
  However if the table has an explicit size or is auto-sized and the resulting
  table overflows its containing block, then columns whose widths were
  increased must, one by one, switch their snap to decreasing the column
  width, until the table reaches its specified size or 
-->
   <!--
  <p>For internal table elements in separated borders tables, ''margin-box''
  represents the edge at the midpoint of the border spacing. For collapsed
  tables, ''margin-box'' and ''border-box'' are treated as ''half-border''.
  When two coinciding edges have conflicting snap values, the later value
  wins.
-->

  <h2 id=conformance><span class=secno>4. </span> Conformance</h2>

  <h3 id=conventions><span class=secno>4.1. </span>Document Conventions</h3>

  <p>Conformance requirements are expressed with a combination of descriptive
   assertions and RFC 2119 terminology. The key words “MUST”, “MUST
   NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”,
   “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in the
   normative parts of this document are to be interpreted as described in RFC
   2119. However, for readability, these words do not appear in all uppercase
   letters in this specification.

  <p>All of the text of this specification is normative except sections
   explicitly marked as non-normative, examples, and notes. <a
   href="#ref-RFC2119" rel=biblioentry>[RFC2119]<!--{{!RFC2119}}--></a>

  <p>Examples in this specification are introduced with the words “for
   example” or are set apart from the normative text with
   <code>class="example"</code>, like this:

  <div class=example>
   <p>This is an example of an informative example.
  </div>

  <p>Informative notes begin with the word “Note” and are set apart from
   the normative text with <code>class="note"</code>, like this:

  <p class=note>Note, this is an informative note.

  <h3 id=conformance-classes><span class=secno>4.2. </span> Conformance
   Classes</h3>

  <p>Conformance to CSS Line Grid Level 1 is defined for three conformance
   classes:

  <dl>
   <dt><dfn id=style-sheet title="style sheet!!as conformance class">style
    sheet</dfn>

   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
    style sheet</a>.

   <dt><dfn id=renderer>renderer</dfn>

   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
    that interprets the semantics of a style sheet and renders documents that
    use them.

   <dt><dfn id=authoring-tool>authoring tool</dfn>

   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
    that writes a style sheet.
  </dl>

  <p>A style sheet is conformant to CSS Line Grid Level 1 if all of its
   declarations that use properties defined in this module have values that
   are valid according to the generic CSS grammar and the individual grammars
   of each property as given in this module.

  <p>A renderer is conformant to CSS Line Grid Level 1 if, in addition to
   interpreting the style sheet as defined by the appropriate specifications,
   it supports all the properties defined by CSS Line Grid Level 1 by parsing
   them correctly and rendering the document accordingly. However, the
   inability of a UA to correctly render a document due to limitations of the
   device does not make the UA non-conformant. (For example, a UA is not
   required to render color on a monochrome monitor.)

  <p>An authoring tool is conformant to CSS Line Grid Level 1 if it writes
   syntactically correct style sheets, according to the generic CSS grammar
   and the individual grammars of each property in this module.

  <h3 id=partial><span class=secno>4.3. </span> Partial Implementations</h3>

  <p>So that authors can exploit the forward-compatible parsing rules to
   assign fallback values, CSS renderers <strong>must</strong> treat as
   invalid (and <a
   href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore as
   appropriate</a>) any at-rules, properties, property values, keywords, and
   other syntactic constructs for which they have no usable level of support.
   In particular, user agents <strong>must not</strong> selectively ignore
   unsupported component values and honor supported values in a single
   multi-value property declaration: if any value is considered invalid (as
   unsupported values must be), CSS requires that the entire declaration be
   ignored.

  <h3 id=experimental><span class=secno>4.4. </span> Experimental
   Implementations</h3>

  <p>To avoid clashes with future CSS features, the CSS specifications
   reserve a <a
   href="http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords">prefixed
   syntax</a> for proprietary property and value extensions to CSS. The CSS
   Working Group recommends that experimental implementations of features in
   CSS Working Drafts also use vendor-prefixed property or value names. This
   avoids any incompatibilities with future changes in the draft. Once a
   specification reaches the Candidate Recommendation stage, implementors
   should implement the non-prefixed syntax for any feature they consider to
   be correctly implemented according to spec.

  <h3 id=cr-exit-criteria><span class=secno>4.5. </span> CR Exit Criteria</h3>

  <p> For this specification to be advanced to Proposed Recommendation, there
   must be at least two independent, interoperable implementations of each
   feature. Each feature may be implemented by a different set of products,
   there is no requirement that all features be implemented by a single
   product. For the purposes of this criterion, we define the following
   terms:

  <dl>
   <dt>independent

   <dd>each implementation must be developed by a different party and cannot
    share, reuse, or derive from code used by another qualifying
    implementation. Sections of code that have no bearing on the
    implementation of this specification are exempt from this requirement.

   <dt>interoperable

   <dd>passing the respective test case(s) in the official CSS test suite,
    or, if the implementation is not a Web browser, an equivalent test. Every
    relevant test in the test suite should have an equivalent test created if
    such a user agent (UA) is to be used to claim interoperability. In
    addition if such a UA is to be used to claim interoperability, then there
    must one or more additional UAs which can also pass those equivalent
    tests in the same way for the purpose of interoperability. The equivalent
    tests must be made publicly available for the purposes of peer review.

   <dt>implementation

   <dd>a user agent which:
    <ol class=inline>
     <li>implements the specification.

     <li>is available to the general public. The implementation may be a
      shipping product or other publicly available version (i.e., beta
      version, preview release, or “nightly build”). Non-shipping product
      releases must have implemented the feature(s) for a period of at least
      one month in order to demonstrate stability.

     <li>is not experimental (i.e., a version specifically designed to pass
      the test suite and is not intended for normal usage going forward).
    </ol>
  </dl>

  <p>The specification will remain Candidate Recommendation for at least six
   months.

  <h2 class=no-num id=acknowledgments>Acknowledgments</h2>

  <p>This module was made possible by the advice and contributions of …

  <h2 class=no-num id=references>References</h2>

  <h3 class=no-num id=normative-references>Normative references</h3>
  <!--begin-normative-->
  <!-- Sorted by label -->

  <dl class=bibliography>
   <dd style="display: none"><!-- keeps the doc valid if the DL is empty -->
    <!---->

   <dt id=ref-CSS21>[CSS21]

   <dd>Bert Bos; et al. <a
    href="http://www.w3.org/TR/2011/REC-CSS2-20110607"><cite>Cascading Style
    Sheets Level 2 Revision 1 (CSS 2.1) Specification.</cite></a> 7 June
    2011. W3C Recommendation. URL: <a
    href="http://www.w3.org/TR/2011/REC-CSS2-20110607">http://www.w3.org/TR/2011/REC-CSS2-20110607</a>
   </dd>
   <!---->

   <dt id=ref-RFC2119>[RFC2119]

   <dd>S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key
    words for use in RFCs to Indicate Requirement Levels.</cite></a> RFC
    2119. URL: <a
    href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a>
   </dd>
   <!---->
  </dl>
  <!--end-normative-->

  <h3 class=no-num id=other-references>Other references</h3>
  <!--begin-informative-->
  <!-- Sorted by label -->

  <dl class=bibliography>
   <dd style="display: none"><!-- keeps the doc valid if the DL is empty -->
    <!---->

   <dt id=ref-CSS3COLOR>[CSS3COLOR]

   <dd>Tantek Çelik; Chris Lilley; L. David Baron. <a
    href="http://www.w3.org/TR/2011/REC-css3-color-20110607"><cite>CSS Color
    Module Level 3.</cite></a> 7 June 2011. W3C Recommendation. URL: <a
    href="http://www.w3.org/TR/2011/REC-css3-color-20110607">http://www.w3.org/TR/2011/REC-css3-color-20110607</a>
   </dd>
   <!---->

   <dt id=ref-CSS3LINE>[CSS3LINE]

   <dd>Michel Suignard; Eric A. Meyer. <a
    href="http://www.w3.org/TR/2002/WD-css3-linebox-20020515"><cite>CSS3
    module: line.</cite></a> 15 May 2002. W3C Working Draft. (Work in
    progress.) URL: <a
    href="http://www.w3.org/TR/2002/WD-css3-linebox-20020515">http://www.w3.org/TR/2002/WD-css3-linebox-20020515</a>
   </dd>
   <!---->

   <dt id=ref-JLREQ>[JLREQ]

   <dd>Yasuhiro Anan (阿南 康宏); et al. <a
    href="http://www.w3.org/TR/2012/NOTE-jlreq-20120403/"><cite>Requirements
    for Japanese Text Layout.</cite></a> 3 April 2012. W3C Working Group
    Note. URL: <a
    href="http://www.w3.org/TR/2012/NOTE-jlreq-20120403/">http://www.w3.org/TR/2012/NOTE-jlreq-20120403/</a>
   </dd>
   <!---->
  </dl>
  <!--end-informative-->

  <h2 class=no-num id=index>Index</h2>
  <!--begin-index-->

  <ul class=indexlist>
   <li>after, <a href="#after" title="section 3.2."><strong>3.2.</strong></a>

   <li>authoring tool, <a href="#authoring-tool"
    title="section 4.2."><strong>4.2.</strong></a>

   <li>‘<code class=css>baseline</code>’, <a href="#baseline"
    title="section 3.1."><strong>3.1.</strong></a>

   <li>before, <a href="#before"
    title="section 3.2."><strong>3.2.</strong></a>

   <li>box-snap, <a href="#box-snap0"
    title="section 3.2."><strong>3.2.</strong></a>

   <li>center, <a href="#center"
    title="section 3.2."><strong>3.2.</strong></a>

   <li>‘<code class=css>contain</code>’, <a href="#contain"
    title="section 3.1."><strong>3.1.</strong></a>

   <li>‘<code class=css>create</code>’, <a href="#create"
    title="section 2."><strong>2.</strong></a>

   <li>first-baseline, <a href="#first-baseline"
    title="section 3.2."><strong>3.2.</strong></a>

   <li>last-baseline, <a href="#last-baseline"
    title="section 3.2."><strong>3.2.</strong></a>

   <li>line-grid, <a href="#line-grid0"
    title="section 2."><strong>2.</strong></a>

   <li>line-snap, <a href="#line-snap0"
    title="section 3.1."><strong>3.1.</strong></a>

   <li>‘<code class=css>match-parent</code>’, <a href="#match-parent"
    title="section 2."><strong>2.</strong></a>

   <li>none, <a href="#none0" title="section 3.2."><strong>3.2.</strong></a>

   <li>‘<code class=css>none</code>’, <a href="#none"
    title="section 3.1."><strong>3.1.</strong></a>

   <li>renderer, <a href="#renderer"
    title="section 4.2."><strong>4.2.</strong></a>

   <li>style sheet
    <ul>
     <li>as conformance class, <a href="#style-sheet"
      title="section 4.2."><strong>4.2.</strong></a>
    </ul>
  </ul>
  <!--end-index-->

  <h2 class=no-num id=property-index>Property index</h2>
  <!--begin-properties-->

  <table class=proptable>
   <thead>
    <tr>
     <th>Property

     <th>Values

     <th>Initial

     <th>Applies to

     <th>Inh.

     <th>Percentages

     <th>Media

   <tbody>
    <tr>
     <th><a class=property href="#box-snap0">box-snap</a>

     <td>none | before | after | center | first-baseline | last-baseline

     <td>none

     <td>block-level boxes and internal table elements except table cells

     <td>yes

     <td>N/A

     <td>visual

    <tr>
     <th><a class=property href="#line-grid0">line-grid</a>

     <td>match-parent | create

     <td>match-parent

     <td>block containers

     <td>no

     <td>N/A

     <td>visual

    <tr>
     <th><a class=property href="#line-snap0">line-snap</a>

     <td>none | baseline | contain

     <td>none

     <td>all elements

     <td>yes

     <td>N/A

     <td>visual
  </table>
  <!--end-properties-->
</html>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
sgml-omittag:nil
sgml-shorttag:nil
sgml-namecase-general:t
sgml-general-insert-case:lower
sgml-always-quote-attributes:t
sgml-indent-step:nil
sgml-indent-data:t
sgml-parent-document:nil
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->
